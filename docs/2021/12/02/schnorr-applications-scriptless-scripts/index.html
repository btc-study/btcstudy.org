<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>Schnorr 签名系列：隐形脚本</title><meta name="keywords" content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name="description" content="比特币思想的中文集结地"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css?v=1675068537082"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/style/common/iconfont.css?v=1675068537082"><link rel="stylesheet" href="/style/base.css?v=1675068537082"><link rel="stylesheet" href="/style/common/helper.css?v=1675068537082"><link rel="stylesheet" href="/style/themes/animation.css?v=1675068537082"><script>function ready() {
  var bodyEl = document.querySelector('.body-container');
  var theme = localStorage.getItem('theme') || 'light';
  if (!['light', 'dark'].includes(theme)) {
    theme = 'light';
    localStorage.setItem('theme', 'light');
  }
  bodyEl.classList.remove('appearance-auto');
  bodyEl.classList.add('appearance-' + theme);
  quickInitialTheme();
}
function quickInitialTheme() {
  var theme = localStorage.getItem('theme') || 'light';
  var logoLightEl = document.querySelector('.logo-light');
  var logoDarkEl = document.querySelector('.logo-dark');
  
  var mLogoLightEl = document.querySelector('#mobile-header-logo > .logo-light');
  var mLogoDarkEl = document.querySelector('#mobile-header-logo > .logo-dark');
  var themeBtnEl = document.getElementById('theme-btn');
  
  var slideThemeLightEl = document.querySelector('.slide-theme-light');
  var slideThemeDarkEl = document.querySelector('.slide-theme-dark');
  
  document.body.classList.add(theme);
  if (theme === 'dark') {
    logoLightEl.classList.add('hidden');
    logoDarkEl.classList.remove('hidden');
    
    mLogoLightEl.classList.add('hidden');
    mLogoDarkEl.classList.remove('hidden');
    
    themeBtnEl.classList.remove('icon-icon_dark');
    themeBtnEl.classList.add('icon-icon_light');
    
    slideThemeLightEl.classList.remove('hidden');
  } else {
    slideThemeDarkEl.classList.remove('hidden');
  }
}
document.addEventListener("DOMContentLoaded", ready);</script><script src="/js/common.js?v=1675068537082"></script><script src="/js/libs/zepto.min.js"></script><link rel="stylesheet" href="/style/post.css?v=1675068537082"><link rel="stylesheet" href="/style/themes/highlight.css?v=1675068537082"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="BTC Study" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column" onload="initialTheme()"><div class="clip"></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id="header"><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href="/"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id="header-menu"><a class="is-inline-block header-activity mr-4" href="/">首页</a><a class="is-inline-block mr-4" href="/archives">全站目录</a><a class="is-inline-block mr-4" href="/tags">标签</a><a class="is-inline-block mr-4" href="/maps">地图</a><a class="is-inline-block mr-4" href="/mempool">mempool</a><a class="is-inline-block mr-4" target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input" type="range" min="12" max="32" step="2"></div></div></div><i class="iconfont icon-icon_dark mr-1" id="theme-btn"></i><div class="search-wrap"><input class="pl-3" id="search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search" id="search-input-btn"></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Schnorr 签名系列：隐形脚本</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn2"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input2" type="range" min="12" max="32" step="2"></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id="mobile-header"><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id="mobile-header-logo"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopicMobile"><p class="is-full-height">Schnorr 签名系列：隐形脚本</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class="mobile-search-wrap"><div class="search-input"><input class="pl-3" id="mobile-search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class="mobile-search-input-btn">搜 索</button></div></div></header><div class="mobile-slide-menu"><a class="header-activity" href="/">首页</a><a href="/archives">全站目录</a><a href="/tags">标签</a><a href="/maps">地图</a><a href="/mempool">mempool</a><a target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class="slide-menu-fontsize"><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1675068537082"> </script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E7%AD%BE%E5%90%8D"><span class="toc-text">适配器签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E7%AD%BE%E5%90%8D%E4%B8%8E-MuSig"><span class="toc-text">适配器签名与 MuSig</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-text">应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%A8%E6%85%8E%E6%97%A5%E5%BF%97%E5%90%88%E7%BA%A6"><span class="toc-text">谨慎日志合约</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%B6%E7%9F%A5%E8%AF%86%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%94%AF%E4%BB%98%EF%BC%88Zero-Knowledge-Contingent-Payment%EF%BC%89"><span class="toc-text">零知识的条件支付（Zero Knowledge Contingent Payment）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%89%98%E7%AE%A1%E5%90%88%E7%BA%A6%EF%BC%88Simple-Escrow-Contract%EF%BC%89"><span class="toc-text">简单托管合约（Simple Escrow Contract）</span></a></li></ol></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id="postTitle">Schnorr 签名系列：隐形脚本</h1><div class="page-author"><div class="is-flex is-flex-direction-row page-data mr-6"><img class="mr-1" src="//res.btcstudy.org/btcstudy/images/default_avatar.png" alt="Nadav Kohen"><div class="page-author-info"><strong>Nadav Kohen</strong><time class="has-text-grey" datetime="2021-12-02T02:55:06.000Z">2021-12-02</time></div></div><div class="is-flex"><a href="/tags/%E5%BC%80%E5%8F%91"><i class="page-tag mr-1 px-1">开发<!-- 订正图片路径--></i></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6"><i class="page-tag mr-1 px-1">密码学<!-- 订正图片路径--></i></a><a href="/tags/PTLC"><i class="page-tag mr-1 px-1">PTLC<!-- 订正图片路径--></i></a></div></div><article class="mt-4 post-content"><blockquote>
<p><em>作者：Nadav Kohen</em></p>
<p><em>来源：<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-applications-scriptless-scripts/">https://suredbits.com/schnorr-applications-scriptless-scripts/</a></em></p>
<p><em><a href="https://www.btcstudy.org/2021/11/29/schnorr-applications-musig/">前篇中文译本</a></em></p>
</blockquote>
<p>本篇我们继续探讨由 Schnorr 签名赋能的方案以及它们在比特币中的应用。本次我们要探索的是 “隐形脚本（Scriptless Script）” 的概念，这种范式是由一种叫做 “适配器签名（<a target="_blank" rel="noopener" href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki#Adaptor_Signatures">Adaptor Signatures</a>）” 的签名方案支持的。在此要提醒的是，虽然<a target="_blank" rel="noopener" href="https://github.com/LLFourn/one-time-VES/blob/master/main.pdf">用 ECDSA 实现适配器签名也不会很麻烦</a>，但使用 Schnorr 签名仍然有好处，也更容易集成到其他的 Schnorr 签名变种中。</p>
<details><summary><strong>Schnorr 签名系列</strong></summary>
<a target="_blank" rel="noopener" href="https://suredbits.com/introduction-to-schnorr-signatures/">What are Schnorr Signatures – Introduction</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-security-part-1-schnorr-id-protocol/">Schnorr Signature Security: Part 1 – Schnorr ID Protocol</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-security-part-2-from-id-to-signature/">Schnorr Signature Security: Part 2 – From IDs to Signatures</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-applications-musig/">Schnorr Multi-Signatures – MuSig</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-applications-scriptless-scripts/">Scriptless Scripts – Adaptor Signatures</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-applications-batch-verification/">Batch Verification</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-applications-threshold-signatures/">Schnorr Threshold Sigantures</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-applications-frost/">Flexible Round-Optimized Schnorr Threshold – FROST</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-applications-blind-signatures/">Schnorr Blind Signatures</a><br>
<a target="_blank" rel="noopener" href="https://suredbits.com/the-taproot-upgrade/">Taproot Upgrade – Activating Schnorr</a>
</details><br>

<p>Andrew Poelstra 提出<a target="_blank" rel="noopener" href="https://download.wpsoftware.net/bitcoin/wizardry/mw-slides/2018-05-18-l2/slides.pdf">隐形脚本</a>的概念很大程度上是受到了 MimbleWimble 协议开发工作的启发：在后者的语境中，只允许使用签名，而不包含任何大部分其他区块链协议（比如比特币）具有的脚本执行措施。顾名思义，隐形脚本是一种合约（这个词在常见的区块链语境下意味着编程好的支付条件）、但由实际上并不包含任何代码的区块链协议来执行，因此，它意味着只用签名方案来执行合约。</p>
<p>在我们的 Schnorr 签名解释系列中，迄今为止，签名方案都几乎只用于相对简单的验证。由普通的 Schnorr 签名推动执行的 “合约” ，就是只有私钥所有者一个人能解锁的支付条件；至于 MuSig，你可以认为是稍微复杂一些的 “合约”，其中 n 个参与者必须团结一致来解锁资金。这无疑是朝着只使用普通的 Schnorr 签名验证、不使用别的模块来执行比特币智能合约的目标迈出了一步，因为它已经能替代 OP_CHECKMULTISIG 在许多场景下的作用。</p>
<p>要进一步推进隐形脚本的开发，我们要开始考虑一种常见的比特币合约：<a target="_blank" rel="noopener" href="https://en.bitcoin.it/wiki/Hash_Time_Locked_Contracts">哈希时间锁合约</a>（HTLC）。HTLC 是一种资金有条件、原子化解锁的合约，当且仅当收款人公开一个秘密值，才能拿走支付者支付的资金。HTLC 最流行的应用场景是<a target="_blank" rel="noopener" href="https://suredbits.com/category/lightning-network/">闪电网络</a>，这种合约允许 Alice 通过 Bob 向 Carlol 支付（原子化支付路由）：Alice 给 Bob 设置一个 HTLC，要求 Bob 出示一个仅有 Carol 才知道的秘密值；Bob 要想取得这个秘密值（并拿到 Alice 承诺支付的资金），就只有给 Carol 也设立一个 HTLC。在当前的闪电网络实现中，HTCL 需要<a target="_blank" rel="noopener" href="https://github.com/lightningnetwork/lightning-rfc/blob/master/03-transactions.md#offered-htlc-outputs">非常多的脚本编程</a>，但可以证明，HTLC 有隐形的版本：可以使用简单的签名验证来替代脚本，并使之与普通的转账活动无从分别。</p>
<h2 id="适配器签名"><a href="#适配器签名" class="headerlink" title="适配器签名"></a>适配器签名</h2><p>我们的目标是修改 Schnorr 签名方案，使之能在签名中 “藏匿一个秘密值”，当收款方要取走资金时，他们必须向支付者公开这个秘密值。</p>
<p>设 t 为支付秘密值（对收款方是已知的），并使得 <code>T = t * G</code>，也就是与这个秘密值相关联的 公钥&#x2F;椭圆曲线点（双方都可知）。就像一笔普通的支付一样，支付者&#x2F;资金发送方会为发送资金给收款方的交易生成一个 Schnorr 签名；但跟普通的支付有区别的地方是，发送者将使用 T 来调整其签名，使得收款方必须使用 t 来修复这个签名才能使之成为一个有效的签名（并使支付生效）。这个支付方生成的无效签名将被发送给收款方（而不是发送到区块链网络中），后者会先用秘密值修复这个签名，然后再把交易和有效的签名发送到区块链网络中。</p>
<p>现在，我们来看看到底哪里需要 “调整” 。我们希望产生的是一个适配器签名 (R’, s’)，使得对某些 R 和 s &#x3D; s’ + t，(R, s) 是一个有效的 Schnorr 签名（用法与本系列的起始篇介绍的相同）。一个普通的 Schnorr 签名的形式是：</p>
<p>$$k’ + H(X, R’, m)*x$$</p>
<p>如果我们给它加入一个调整项 t，我们可以认为是 t 跟 k’ 值结合了起来：</p>
<p>$$(k’ + H(X, R’, m)*x) + t &#x3D; (k’ + t) + H(X, R’, m)*x$$</p>
<p>我们把 k’ + t 的值记为 k，因为它实际上才是修复后的签名的 k 值。但是，这样的修复似乎会打破其它的一些东西。上述形式并不是一个有效的签名，因为哈希函数中的 R’ 并不是 <code>k * G</code>，因为 <code>k * G = (k&#39; + t)*G = R&#39; + T</code>。但这个小错误也很容易修正，我们只需令 R &#x3D; R’ + T，放在初始签名的哈希函数中即可。</p>
<p>因此，对于消息 m、私钥 x、一次性私钥 k’，以及秘密值 t（其中 <code>T = t * G</code>），一个适配器签名是 (R’, s’, T)，其中</p>
<p>$$s’ &#x3D; k’ + H(X, R’ + T, m)*x$$</p>
<p>在修复这个签名（即为这个适配器签名添加调整项）之前，收款方先验证这是不是一个有效的适配器签名：</p>
<p>$$s’*G ?&#x3D; R’ + H(X, R’ + T, m)*X$$</p>
<p>检查等式成立后，再把 t 补充进这个签名：</p>
<p>$$s &#x3D; s’ + t &#x3D; (k’ + t) + H(X, R’ + T, m)*x &#x3D; k + H(X, R, m)*x$$</p>
<p>最后，收款者就得到了一个有效的数字签名 (R, s)，它事实上跟任何普通的签名没有两样，除非之前看到了适配器版本 s’，否则根本无法识别。</p>
<p>我们现在已经知道如何创建、验证适配器签名以及补完适配器签名以形成一个有效的签名了。最后的部分是，发送者如何从补完的签名中复原出秘密值 t？因为 s &#x3D; s’ + t，所以只需在区块链上或者其它地方找到签名 s 就可以了；找出 s 之后，求它与适配器签名 s’ 的差值就得到了 t。</p>
<p>所以，完整的流程如下：</p>
<ol>
<li>资金发送方生成一个适配器签名（只需要用到有关 T 的知识）</li>
<li>接收方验证这个适配器签名</li>
<li>接收方使用秘密值 t 来补完这个适配器签名，并使用这个完整的签名</li>
<li>发送方取完整的签名与适配器签名的差值，获得秘密值 t</li>
</ol>
<p>我最后要强调的是，适配器签名有一种可抵赖的属性。也就是说，给定任何有效的数字签名 (R, s) 和标量值 t，任何人都能计算出有效的适配器签名 <code>(R – t*G, s – t, t*G)</code>，所以没有任何适配器签名可以被证明是链上某个有效签名的前身。</p>
<h2 id="适配器签名与-MuSig"><a href="#适配器签名与-MuSig" class="headerlink" title="适配器签名与 MuSig"></a>适配器签名与 MuSig</h2><p>适配器签名的一个关键属性是，它与普通的 Schnorr 签名有一样的结构，只不过我们哈希的是 R’ + T 而不是 R’。因此，我们大体上可以相信，Schnorr 适配器签名<a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-security-part-1-schnorr-id-protocol/">和 Schnorr 签名一样安全（不可伪造）</a>！</p>
<p>更进一步地，因为 <a target="_blank" rel="noopener" href="https://suredbits.com/schnorr-applications-musig/">MuSig</a> 运用过程中的碎片签名（partial signature）也相似于普通的 Schnorr 签名，适配器签名方案也可以跟碎片签名结合起来。以我们在上一篇博客中提到的 CoinSwap 应用为例，它本质上就是两个独立但使用同一个秘密值的 HTLC。我们现在可以使用用一个标量（scalar）和 PTLC（点时间锁合约）来替代 HTLC：假设参与的两个公钥 X 和 Y 有 MuSig 聚合密钥 <code>a_x * X + a_y * Y</code> ；假设 X 希望把资金发送给 Y，条件是他们公开一个可以生成椭圆曲线点 T 的标量（在这个案例中，这个标量即是用来解锁资金的秘密值）。我们可以将 MuSig 签名方案与适配器签名方案结合起来：令 X 的碎片签名为：</p>
<p>$$s_x’ &#x3D; k_x + H(a_x * X + a_y * Y, R_x + T, m) * x$$</p>
<p>（注意，被哈希的 Nonce 值加上了 T。）在收到并验证了 Y 的碎片签名 s<sub>y</sub> 之后，X 交出自己的适配器签名 s<sub>x</sub>‘ ，使用该值，Y 可以计算 s<sub>x</sub> &#x3D; s<sub>x</sub>‘ + t；最后，s &#x3D; s<sub>x</sub> + s<sub>y</sub> 就是对链上聚合公钥有效的签名。而只要 X 看到了这条签名，Ta 就可以计算 s - s<sub>x</sub> - s<sub>y</sub> &#x3D; t。</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>现在，我们可以构造适配器签名了，我们来简单了解下它的应用。我们刚刚已经展示了，适配器签名可以消除 CoinSwap 的两笔交易之间的关联！它跟任何使用 HTLC 的 CoinSwap 形成了鲜明对比，因为两个 HTLC 需用使用相同的哈希值，出现在链上时就让人能够把两笔交易关联起来。</p>
<p>我们已经讨论到的这个替代 HTLC 的工具通常被称为 “点时间锁合约（Point Time Lock Contract，PTLC）”，它跟 HTLC 功能相似，只不过揭晓的是生成某个点的标量，而不是生成某个哈希值的原像。除了更加隐私、让更多合约可以在链外执行以外，事实证明 PTLC 对闪电网络有非常多的好处，多到我专门写了两个系列的博客来介绍！</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://suredbits.com/payment-points-part-1/">Payment Points Series 1</a></li>
<li><a target="_blank" rel="noopener" href="https://suredbits.com/payment-points-monotone-access-structures/">Payment Points Series 2</a></li>
</ul>
<p>除了 PTLC，适配器签名可以为闪电网络带来的另一个提升叫做“统一状态的闪电通道（Unified State Lightning Channel）”。关于这个点子，我写过一个<a target="_blank" rel="noopener" href="https://suredbits.com/generalized-bitcoin-channels/">详尽的讲解</a>，这里只讲一个非常抽象的大概：当前的闪电网络撤销机制需要参与通道的双方保存双双对称的状态（每一方都有利于自己的惩罚条款），但我们可以把它转变成一个统一的状态，基于交易中使用的签名检测出是哪一方发布了旧状态。这是通过适配器签名来实现的：一方向通道对手提供的适配器签名中包含了只有自己知道的秘密值，因此这个秘密值可以用来锁定惩罚机制，而不需要保存与对方对称的状态。</p>
<h3 id="谨慎日志合约"><a href="#谨慎日志合约" class="headerlink" title="谨慎日志合约"></a>谨慎日志合约</h3><p>在我的 PTLC 博客系列中，一种常见的窍门是构造一个不仅代表了一个随机值的特殊点（普通的通道点时间锁合约只使用一个代表随机值的点）。在此我想简要讨论一种这样做的方案，因为它也契合于 Schnorr 签名的良好结构。设想一种场景：一个客户端想从服务端处购买对一条消息 m 的签名。一个签名也是一个标量，所以，如果我们能计算与这个标量关联的 点&#x2F;公钥，我们就能使用这个点来建立一个 PTLC，并保证客户端只要且只需付出金钱，就一定能获得有效的签名。回忆一下，所有有效的 Schnorr 签名都满足：</p>
<p>$$ s_m*G &#x3D; R + H(X, R, m)*x$$</p>
<p>因此，只要服务器预先承诺自己要用到的 nonce 值 R，客户端就可以计算 <code>R + H(X, R, m) * X</code> ，无需知道 s 。那么，客户端又可以用这个等于 <code>s_m * G </code> 的点作为 PTLC 的适配器点，给服务器支付。只要服务器发布了完整的签名并取走了资金，客户端就可以计算出 s<sub>m</sub> （即完整签名与他们向服务器发送的适配器签名的差值）。否则，服务器将不能取走这些资金。换句话来说，适配器签名（以及预先承诺 R 的方案）支持了普通 Schnorr 签名的免信任销售。</p>
<p>使用 “给签名支付” 作为暗箱装置的一个更有趣的应用是所谓的 “谨慎日志合约（DLC）”。我们已经写过<a target="_blank" rel="noopener" href="https://suredbits.com/category/discreet-log-contracts/">详尽的 DLC 介绍</a>，也正在开发一个<a target="_blank" rel="noopener" href="https://github.com/discreetlogcontracts/dlcspecs">开源的规范</a>和一种<a target="_blank" rel="noopener" href="https://github.com/bitcoin-s/bitcoin-s/tree/adaptor-dlc">实现</a>。在 DLC 的运行中，一个签名者（通常被称为 “断言机（oracle）”）会承诺在未来签名并发布一些数据（比如，哪个队赢了哪一场球赛啦，比特币的价格是多少啦），并为这些.事件的签名预先承诺 R。这就意味着，只要所有可能被签名的结果 m 都是可知的，那所有可能的点 <code>s_m * G </code> 都可以提前计算出来（就像上面一样）。想结成一个 DLC 赌博合约的双方可以构造一笔将产生一个 MuSig 2-2 输出的充值交易，并使用自己的密钥为每一个可能的结果向对方给出一个适配器碎片签名。具体来说，需要为每一个可能的结果都构造一笔花费充值交易的交易，因此，当断言机发布某条消息的签名时，双方都可以拿断言机的签名补完合约缔结时提前准备好的适配器碎片签名，并加上自己的碎片签名来获得可以有效的签名，从而按照断言机的结果花费充值交易！DLC 的主要执行过程都是发生在链下的，而这样一来，链上的足迹将只剩下一个 Schnorr 签名，与其它的应用和普遍的支付没有区别！</p>
<h3 id="零知识的条件支付（Zero-Knowledge-Contingent-Payment）"><a href="#零知识的条件支付（Zero-Knowledge-Contingent-Payment）" class="headerlink" title="零知识的条件支付（Zero Knowledge Contingent Payment）"></a>零知识的条件支付（Zero Knowledge Contingent Payment）</h3><p>虽然 Schnorr 签名具备这种点可以从公开信息（假定 R 也公开了）中预先计算出来的良好属性，还有一类更广泛的结构化数据，可以零知识地证明其具有给定的公钥。举个例子，假设支付者希望从收款人处购买一个哈希值的原像，但又不想使用 HTLC，因为 HTLC 在链上是可见的（以及其它原因）。收款方可以使用原像计算出一个点，并向支付者提供一个零知识证明，证明这个点背后的标量的哈希值将是 XXX。这个证明使得支付者可以放心建立一个 PTLC，相信自己的资金被拿走之时自己就可以知道这个哈希值的原像。目前我们<a target="_blank" rel="noopener" href="https://bitcoincore.org/en/2016/02/26/zero-knowledge-contingent-payments-announcement/">已经知道</a>，这种叫做 “零知识条件支付” 的形式，是可以使用 HTCL 的一些变种来实现的，但 PTLC 提供了更好的隐私性和可扩展性（只不过面临一些特殊的限制，我就不在这里讨论了）。ZKCP 可以被认为是 PTLC（给标量支付）和给签名支付的一种普遍化形式（而这些特殊形式则是使用较简单的证明的 ZKCP）。</p>
<h3 id="简单托管合约（Simple-Escrow-Contract）"><a href="#简单托管合约（Simple-Escrow-Contract）" class="headerlink" title="简单托管合约（Simple Escrow Contract）"></a>简单托管合约（Simple Escrow Contract）</h3><p>我在这里想讲的最后一个应用是简单托管合约。传统上，这类合约表现在链上是一个 2-3 的 OP_CHECKMULTISIG 输出（三个公钥中任意两个的签名可以解锁的资金），参与的双方各有一个公钥，第三把公钥则属于托管者。如果双方已经（在链下）签名了一个合约操作，并一致同意合约资金的分割，他们就无需通知托管方，只需两人合作就可以解锁资金。但如果双方意见有分歧，任何一方都可以联系托管方，而托管方会决定向哪一方提供签名，使之可以无需对手方的同意就取走资金。想往常一样，我们希望使用 Schnorr 签名把这些活动都隐藏在一个公钥的后面，使他人无法在链上发现合约的存在。这个可以使用一个双密钥的 MuSig 方案来实现，就像 CoinSwap 一样，但每一方都为所有可能的结果提供相应的适配器碎片签名，这些适配器签名使用只有托管方才知道的秘密值作为调整项（比如，这些秘密值可以是托管者对结果的签名）。如此一来，只要双方意见一致，就可以直接执行普通的 MuSig 签名流程，来花费资金；否则，任何一方都可以联系托管方，请后者补完适配器碎片签名，加上自己的碎片签名后发到链上、结算资金。</p>
<p>托管合约本质上也是一种 DLC，只不过断言机在这里换成了托管者，因此，用户在链下要承担更多的开销。在未来关于 Schnorr 门限签名的博客中，我们会尝试创建一个更加简洁、更有表现力的托管合约。</p>
<p>关于适配器签名的讨论，到这里就结束了。不过，如果你发现这些应用都很有趣，我强烈建议你阅读我撰写的关于 PTLC 和适配器签名的进阶用法的博客。本系列剩余的部分，我们会研究批量验证、门限签名、盲签名和 Taproot。</p>
<p>（完）</p>
<blockquote>
<p><em><a href="https://www.btcstudy.org/2021/12/06/schnorr-applications-batch-verification/">后篇中文译本</a></em></p>
</blockquote>
</article></div></div></main><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});
MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
  }
});</script><script src="/js/post.js?v=1675068537082"></script><script src="/js/highlight.min.js?v=1675068537082"></script><script>var containerEl = document.querySelector('.post-container');
var postFontSize = localStorage.getItem('post-font-size') || '16';
var inputEl = document.querySelector('#size-change-input');
var inputEl2 = document.querySelector('#size-change-input2');
inputEl.value = postFontSize;
inputEl2.value = postFontSize;
containerEl.style.fontSize = postFontSize + 'px';
$(function(){
  function setSizeChangeInputValue(size) {
    $('.post-container').css('font-size', size + 'px');
    localStorage.setItem('post-font-size', size);
    $('#size-change-input').val(size);
    $('#size-change-input2').val(size);
  }
  $('#size-change-input').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
  $('#size-change-input2').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
});
</script><script>hljs.initHighlightingOnLoad();</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/btcstudy">Twitter</a><!-- Github--><!-- Ins--><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml">rss</a><!-- 知乎--><!-- 领英--><!-- 脸书--><!-- Telegram--><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/btcstudyorg">Telegram</a></section></footer><script async src="/js/buttons.js?v=1675068537082"></script><script async src="/js/index.js?v=1675068537082"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-JVCJ9XXG1Z');</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306";
  hm.async = true;
  hm.defer = true;
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
  </script></body></html>