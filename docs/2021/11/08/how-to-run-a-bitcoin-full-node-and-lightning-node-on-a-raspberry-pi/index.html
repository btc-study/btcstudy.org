<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>如何在一台树莓派上运行比特币全节点 + 闪电节点</title><meta name="keywords" content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name="description" content="比特币思想的中文集结地"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css?v=1675838664010"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/style/common/iconfont.css?v=1675838664010"><link rel="stylesheet" href="/style/base.css?v=1675838664010"><link rel="stylesheet" href="/style/common/helper.css?v=1675838664010"><link rel="stylesheet" href="/style/themes/animation.css?v=1675838664010"><script>function ready() {
  var bodyEl = document.querySelector('.body-container');
  var theme = localStorage.getItem('theme') || 'light';
  if (!['light', 'dark'].includes(theme)) {
    theme = 'light';
    localStorage.setItem('theme', 'light');
  }
  bodyEl.classList.remove('appearance-auto');
  bodyEl.classList.add('appearance-' + theme);
  quickInitialTheme();
}
function quickInitialTheme() {
  var theme = localStorage.getItem('theme') || 'light';
  var logoLightEl = document.querySelector('.logo-light');
  var logoDarkEl = document.querySelector('.logo-dark');
  
  var mLogoLightEl = document.querySelector('#mobile-header-logo > .logo-light');
  var mLogoDarkEl = document.querySelector('#mobile-header-logo > .logo-dark');
  var themeBtnEl = document.getElementById('theme-btn');
  
  var slideThemeLightEl = document.querySelector('.slide-theme-light');
  var slideThemeDarkEl = document.querySelector('.slide-theme-dark');
  
  document.body.classList.add(theme);
  if (theme === 'dark') {
    logoLightEl.classList.add('hidden');
    logoDarkEl.classList.remove('hidden');
    
    mLogoLightEl.classList.add('hidden');
    mLogoDarkEl.classList.remove('hidden');
    
    themeBtnEl.classList.remove('icon-icon_dark');
    themeBtnEl.classList.add('icon-icon_light');
    
    slideThemeLightEl.classList.remove('hidden');
  } else {
    slideThemeDarkEl.classList.remove('hidden');
  }
}
document.addEventListener("DOMContentLoaded", ready);</script><script src="/js/common.js?v=1675838664010"></script><script src="/js/libs/zepto.min.js"></script><link rel="stylesheet" href="/style/post.css?v=1675838664010"><link rel="stylesheet" href="/style/themes/highlight.css?v=1675838664010"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="BTC Study" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column" onload="initialTheme()"><div class="clip"></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id="header"><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href="/"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id="header-menu"><a class="is-inline-block header-activity mr-4" href="/">首页</a><a class="is-inline-block mr-4" href="/archives">全站目录</a><a class="is-inline-block mr-4" href="/tags">标签</a><a class="is-inline-block mr-4" href="/maps">地图</a><a class="is-inline-block mr-4" href="/mempool">mempool</a><a class="is-inline-block mr-4" target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input" type="range" min="12" max="32" step="2"></div></div></div><i class="iconfont icon-icon_dark mr-1" id="theme-btn"></i><div class="search-wrap"><input class="pl-3" id="search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search" id="search-input-btn"></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">如何在一台树莓派上运行比特币全节点 + 闪电节点</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn2"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input2" type="range" min="12" max="32" step="2"></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id="mobile-header"><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id="mobile-header-logo"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopicMobile"><p class="is-full-height">如何在一台树莓派上运行比特币全节点 + 闪电节点</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class="mobile-search-wrap"><div class="search-input"><input class="pl-3" id="mobile-search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class="mobile-search-input-btn">搜 索</button></div></div></header><div class="mobile-slide-menu"><a class="header-activity" href="/">首页</a><a href="/archives">全站目录</a><a href="/tags">标签</a><a href="/maps">地图</a><a href="/mempool">mempool</a><a target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class="slide-menu-fontsize"><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1675838664010"> </script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E5%87%86%E5%A4%87%E5%92%8C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%80%89%E6%8B%A9"><span class="toc-text">硬件准备和操作系统选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E6%96%B9%E6%A1%88"><span class="toc-text">硬件方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E8%A7%A3%E9%87%8A"><span class="toc-text">方案解释</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%87%86%E5%A4%87"><span class="toc-text">系统准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%A7%E5%BD%95%E7%B3%BB%E7%BB%9F%E7%9B%98"><span class="toc-text">烧录系统盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B3%BB%E7%BB%9F"><span class="toc-text">初始化系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E7%A1%AC%E7%9B%98"><span class="toc-text">挂载硬盘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE-Bitcoin-Core"><span class="toc-text">安装和配置 Bitcoin Core</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Bitcoin-Core"><span class="toc-text">安装 Bitcoin Core</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%AF%94%E7%89%B9%E5%B8%81"><span class="toc-text">配置比特币</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E5%92%8C%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8"><span class="toc-text">设置快捷方式和开机启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE-LND"><span class="toc-text">安装和配置 LND</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-LND"><span class="toc-text">安装 LND</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-LND"><span class="toc-text">配置 LND</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LND-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">LND 的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Zap-%E2%80%9C%E8%BF%9C%E7%A8%8B%E2%80%9D-%E8%BF%9E%E6%8E%A5%E4%BD%A0%E7%9A%84%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C%E8%8A%82%E7%82%B9"><span class="toc-text">使用 Zap “远程” 连接你的闪电网络节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-lndconnect"><span class="toc-text">安装 lndconnect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-LND-1"><span class="toc-text">配置 LND</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Zap-%E8%BF%9E%E6%8E%A5%E4%BD%A0%E7%9A%84%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C%E8%8A%82%E7%82%B9"><span class="toc-text">使用 Zap 连接你的闪电网络节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#A-%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86"><span class="toc-text">A. 在终端中使用代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-%E9%AA%8C%E8%AF%81%E8%87%AA%E5%B7%B1%E4%B8%8B%E8%BD%BD%E7%9A%84%E8%BD%AF%E4%BB%B6"><span class="toc-text">B. 验证自己下载的软件</span></a></li></ol></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id="postTitle">如何在一台树莓派上运行比特币全节点 + 闪电节点</h1><div class="page-author"><div class="is-flex is-flex-direction-row page-data mr-6"><img class="mr-1" src="//res.btcstudy.org/btcstudy/images/default_avatar.png" alt="Anony"><div class="page-author-info"><strong>Anony</strong><time class="has-text-grey" datetime="2021-11-08T06:41:55.000Z">2021-11-08</time></div></div><div class="is-flex"><a href="/tags/%E5%AE%9E%E8%B7%B5"><i class="page-tag mr-1 px-1">实践<!-- 订正图片路径--></i></a></div></div><article class="mt-4 post-content"><blockquote>
<p><em>作者：Anony</em></p>
</blockquote>
<p>近日，笔者在一台树莓派小电脑上跑起了比特币全节点和闪电网络节点。由于笔者的计算机知识比较有限，这个过程可谓坎坷。也正因此，觉得自己的经历对大部分没有深入的计算机知识、但又希望以经济实惠的方法跑起节点的朋友来说，是有意义的。所以我准备把这个过程的一些经验总结出来分享给大家。</p>
<p>目前网络上能找到的教程，要么过于极客，包含了许多与主旨无关的指令；要么不完整，只在其中某个步骤上较为有效。有鉴于此，笔者准备给出一份全流程的教程，并在每一个环节上都提供笔者自己认为最有参考价值的文献。此外，还必须指出的是：</p>
<ul>
<li>读者需自行解决科学上网的问题，如果无法解决，你在模仿本教程的过程中有可能卡住（集中在教程最后一部分，只是安装比特币软件应该不会卡住）。这是一个本教程无能为力的问题。文末也会附录如何在运行时使用代理的教程。</li>
<li>本教程以文字信息为主，仅在少量时候提供图片，以帮助读者确定自己的进度。</li>
<li>本教程的许多参考文献都是英文的（因此读者有英文阅读能力会有所帮助），但对于关键的信息，教程本身会给出足够的说明。</li>
<li>本教程的操作以命令行为主。许多人可能看到这一条就退出了，但这是没必要的。首先本教程为树莓派安装的系统也是有图形界面的，其次命令行也无非就是在一个窗口中输入一些英文，甚至你可以复制粘贴教程中的代码，你也无需做到理解自己输入的所有内容。按照本教程来做，出错的概率是很低的（毕竟笔者亲自执行过一遍）。而且，遇到了问题，靠自己去克服它，不正是学习的意义吗？</li>
</ul>
<p>闲言少叙，直入正题。本教程将分为以下几个部分：（1）硬件选择；（2）系统准备；（3）安装及配置 Bitcoin Core 软件（比特币全节点）；（4）安装及配置 LND 软件（闪电网络节点）；（5）使用 Zap 远程连接闪电节点。（教程看起来很长，但实际上每个章节都只有关键的几个步骤）</p>
<h2 id="硬件准备和操作系统选择"><a href="#硬件准备和操作系统选择" class="headerlink" title="硬件准备和操作系统选择"></a>硬件准备和操作系统选择</h2><p><img src="//res.btcstudy.org/btcstudy/images/how-to-run-a-bitcoin-full-node-and-lightning-node-on-a-raspberry-pi/raspberr4b.jpg"></p>
<p>上图即是一台树莓派 Model 4B，实体也就巴掌大小，它是一块带有各种接口的电脑主板。选择它来跑节点，最重要的原因是便宜。树莓派本身最贵的不过 800 元，功耗更是只有 15 W；而其余的电脑主机，最便宜的也要上千元，功耗是 50 W 以上，所以树莓派是最经济的。</p>
<h3 id="硬件方案"><a href="#硬件方案" class="headerlink" title="硬件方案"></a><strong>硬件方案</strong></h3><ul>
<li>主板：树莓派 4B 8GB 版</li>
<li>系统盘 micro SD 卡：闪迪 Class10 64GB</li>
<li>硬盘：东芝移动硬盘 1TB</li>
<li>显示器（可不选）</li>
<li>散热：被动散热合金外壳</li>
</ul>
<h3 id="方案解释"><a href="#方案解释" class="headerlink" title="方案解释"></a><strong>方案解释</strong></h3><blockquote>
<p>（这种底色的内容与主旨无关，只是补充解释，如果你不感兴趣，可以跳过）</p>
<ul>
<li><p><strong>有关主板</strong>。主板和操作系统的选择要一起考虑。树莓派 Model 4B 有 2GB 内存、4GB 内存、8GB 内存三种，价格（性能）由低到高。操作系统有 32 位和 64 位的区别，如果硬件允许，那么理论上 64 位的系统会有更高的性能；但如果你要安装 64 位的系统，必须具备 4GB 以上的内存。</p>
<p>树莓派目前支持主流的 Linux 操作系统，比如 Ubuntu；也支持 Windows 操作系统；当然，树莓派官方也推出了一个基于 Linux 的系统，叫做 “Raspberry OS”，这个操作系统只有 32 位的版本。</p>
<p>笔者最终选择的是 8GB 的树莓派，安装 Raspberry OS 32 位版。从实际运行的结果看，树莓派的内存利用率从来没到达过 50%，所以 4GB 的树莓派也是可以接受的（我甚至觉得 2GB 版也没问题）。</p>
<p>由于 Raspberry OS 与 Ubuntu 系统算是同源（都源自 Linux），所以教程中的大部分操作都是通用的；如果你希望安装 Ubuntu 或者 Raspberry OS，不必另外下载，下文的 “系统准备” 一节会指导你用 Raspberry Imager 软件自动完成下载和烧录系统盘。</p>
<p>此外，网购树莓派时，店家肯定会提供一些套餐。mini-HDMI 线和带开关的电源线是必选项，一定要有；其余则不必，但店家一般都会提供塑料外壳和风扇。散热方案下文有述。套餐里面往往也包含 micro SD 卡，但这个可以另外买，如果不希望浪费或者担心赠卡的质量，可以找到不包含 micro SD 卡的套餐。</p>
</li>
<li><p><strong>有关 micro SD 卡</strong>。树莓派没有自带的存储空间，系统都是烧录到 micro SD 卡中，再插入树莓派的卡槽中。micro SD 的容量只要是 16GB 及以上都行。因为我们要预先在这张卡中写入操作系统，你还得有一个读卡器；网购时选择附赠读卡器的商家即可（读卡器有不同的类型，如果你现在用的电脑没有 SD 卡接口，请选择 USB 接口的读卡器）。</p>
</li>
<li><p><strong>有关硬盘</strong>。除了使用 micro SD 卡作为系统盘，我们还需要一块硬盘来储存比特币整条区块链的数据（目前在 500 GB 左右，还会继续增长），硬盘容量必须 1 TB 起步。树莓派只有 USB 接口，没有 STAT 接口。所以无论你选择 3.5 寸硬盘（台式机硬盘）还是 2.5 寸硬盘（笔记本硬盘），都要配备一个 USB-STAT 线，或者一个硬盘盒。笔者在这里就偷懒选了移动硬盘（自带 USB 接口线；算下来其实价格差不多）。可以选择固态硬盘（SSD），性能会更好，但不是必需。</p>
</li>
<li><p><strong>有关屏幕</strong>。如果你已经有带 HDMI 接口的显示器了，就不必另外买。但如果没有，那为了维护的方便，还是要配一个。这个屏幕不必追求性能（除非你还想用在别的地方），因为配置好树莓派之后需要用到屏幕的地方不多，而且，windows 系统的远程屏幕功能可以部分代替屏幕（但是开启这个功能还是需要用到屏幕，除非你现在用的不是 window 系统而是 linux 系统）。<strong>显示器必须有 HDMI 接口，否则你要买 miniHDMI 到你的显示器接口的转接线</strong>！</p>
</li>
<li><p><strong>有关散热</strong>。在网购树莓派套餐时，一般会附赠一个塑料外壳和小风扇，由于保护主板和散热。小风扇的散热效果是不错的，但问题是制造噪音，而且可能有光污染。如果你也讨厌噪音，笔者推荐使用合金的外壳，完全被动散热，或附带风扇的合金外壳。</p>
<p>合金外壳的介绍见此 B 站视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1JK4y1r7qf/">https://www.bilibili.com/video/BV1JK4y1r7qf/</a> 。淘宝上有同款，非常便宜。也有在此基础上加风扇的。笔者用下来，CPU 温度是没有超过 50 度的。</p>
<p>小风扇的接法：小风扇需要使用树莓派外侧的针脚来供电。将树莓派的网线接口对准自己，右边（也就是最外侧）一排针脚，<strong>从上到下数第二针、第三针</strong>可以为小风扇供电。将风扇插头插上这两个针脚即可。插错了树莓派会无法启动。可网上搜索教程。</p>
</li>
</ul>
<p>笔者方案的总成本：树莓派套餐 830 元；micro SD 卡 50 元；移动硬盘 280 元；散热外壳 20 元；合计 1180 元。树莓派还可选更低配置的。</p>
</blockquote>
<h2 id="系统准备"><a href="#系统准备" class="headerlink" title="系统准备"></a>系统准备</h2><p>系统准备分为烧录系统盘、初始化 Raspberry OS 系统、挂载硬盘三个步骤。</p>
<h3 id="烧录系统盘"><a href="#烧录系统盘" class="headerlink" title="烧录系统盘"></a><strong>烧录系统盘</strong></h3><p>先将 micro SD 卡插入你现在使用的电脑。笔者使用的是 Windows 系统的笔记本电脑。</p>
<p>在此处下载 Rapsberry Pi Imager 软件：<a target="_blank" rel="noopener" href="https://www.raspberrypi.com/software/">https://www.raspberrypi.com/software/</a> 。（如果你无法访问，可以用软件名搜索并下载。）（记得为你的电脑选择对应的版本。）</p>
<p><img src="//res.btcstudy.org/btcstudy/images/how-to-run-a-bitcoin-full-node-and-lightning-node-on-a-raspberry-pi/Raspberry-Pi-Imager-download.png"></p>
<p>下载后打开，页面如下所示：</p>
<p><img src="//res.btcstudy.org/btcstudy/images/how-to-run-a-bitcoin-full-node-and-lightning-node-on-a-raspberry-pi/Raspberry-Pi-Imager.png"></p>
<p>左边的选项选择你要给树莓派安装的系统，中间的按钮选择你要烧录到哪里（它会自动识别你的 micro SD 卡），最右边的按钮是启动。</p>
<p>在选择操作系统时，可以选择置顶的 “Raspberry Pi OS (32-bit)”，也可以选择 “Raspberry Pi OS (other)” 或 “Other general purpose OS” 中的其它选项。笔者自己选择的是 “Raspberry Pi OS (other)” 中的 “**Raspberry Pi OS Full (32-bit)**”，它会预装一些软件。如果想跟本教程保持完全一致，可以选择这个系统。如果你想安装 64 位的系统，到 “Other general purpose OS” 中选择 Ubuntu (64-bit)。</p>
<p>然后是等待软件自动下载镜像并写入 micro SD 卡。成功后即可从电脑上拔下 micro SD 卡，插入到树莓派的插口中（位于树莓派的背面，是网线接口的反方向）。</p>
<h3 id="初始化系统"><a href="#初始化系统" class="headerlink" title="初始化系统"></a><strong>初始化系统</strong></h3><p>给树莓派连接屏幕、移动硬盘、鼠标键盘之后，插电启动树莓派。你会在显示器上看到如下的一个画面：</p>
<p><img src="//res.btcstudy.org/btcstudy/images/how-to-run-a-bitcoin-full-node-and-lightning-node-on-a-raspberry-pi/pi-desktop.png"></p>
<p>左上角的几个图标对我们是最重要的，分别是系统菜单（相当于 windows 里面的开始按钮）、网络浏览器、文件管理器、LX 终端（下文简称 “终端”）。<strong>其中 LX 终端就是我们输入命令行的窗口，是我们最重要的工具</strong>。终端的界面如下图所示：</p>
<p><img src="//res.btcstudy.org/btcstudy/images/how-to-run-a-bitcoin-full-node-and-lightning-node-on-a-raspberry-pi/pi-terminal.png"></p>
<p>初次进入系统时，系统会要求你给当前的账户（用户名为 “pi”）安排一个登录口令，可任意设置。<strong>建议用纸笔把用户名和口令记下来，并用于记录其它关键口令</strong>。</p>
<p>设置完成后，为树莓派接通网线，或点击右上角的图标，为树莓派设置 wifi。</p>
<p>值得一提的是，Raspberry OS 本身不带中文输入法，如果你希望安装中文输入法，请自己在网上搜索教程。</p>
<p>如果你不想用 Windows 电脑来远程控制树莓派（两台电脑连入同一个路由器，就可以远程控制）、你可以全程使用键盘和屏幕来控制树莓派，那你初始化系统的这一步，到这里就结束了。但<strong>如果你希望用 windows 来远程控制树莓派（比如你只有一个显示器），那下面这部分关于远程控制的内容，你一定要看</strong>。</p>
<blockquote>
<p><strong>远程控制方法</strong></p>
<p>远程控制的方法既有完全命令行的，也有具备图形界面的。但无论哪种方法，都有两个前提：（1）Windows 电脑和树莓派连入同一个路由器，有线无线皆可；（2）知道树莓派在这个内网中的 IP 地址。</p>
<p>既然如此，<strong>我们先来学习如何获得树莓派的 IP 地址</strong>（两种方法，任一皆可）：</p>
<ul>
<li><p>在树莓派中打开 LX 终端，输入命令 <code>ifconfig</code> （注意是 if 不是 ip）然后按回车键。它会将你的树莓派的网卡信息显示给你。如果你是有线连接，找 “eth0” 开头的信息；如果你是无线连接，找 “wlan0” 开头的信息；内网的 IP 地址一般是 <code>192.168.x.xxx</code>，以下图为例（笔者这个时候的 IP 就是 <code>192.168.2.103</code>：</p>
<p><img src="//res.btcstudy.org/btcstudy/images/how-to-run-a-bitcoin-full-node-and-lightning-node-on-a-raspberry-pi/ifconfig.png"></p>
</li>
<li><p>确保你的 windows 电脑和树莓派处在同一个网络中（比如连接同一个 wifi），在 windows 电脑的网络浏览器中输入你的路由器地址并登录（路由器地址常常是 <code>192.168.1.1</code> 或 <code>192.168.0.1</code>，具体你可以在 “命令提示符（CMD）” 中输入 <code>ipconfig</code> （注意是 ip 不是 if），“默认网关” 的值一般就是你的路由器地址）。在路由器的后台中查找 “用户侧信息” 或者 “lan 口信息”，它会显示该路由器的所有用户及其内网 IP 地址，也包括你的树莓派的。树莓派的设备名很显眼，就是 “raspberrypi”。</p>
</li>
</ul>
<p>拿到这个 IP 地址是远程控制的第一步。第二步是选择一种控制方法，第一种方法只能输入命令行，第二种办法可以用图形界面操作树莓派。</p>
<ul>
<li><p><strong>SSH 方法</strong>。此方法是命令行方法。需要两方面的操作，一是在树莓派上打开 SSH 服务；二是在 Windows 电脑上使用 Putty 软件使用 SSH 服务。</p>
<ul>
<li><p>在树莓派的 “系统菜单” - “首选项” 中打开 “Raspberry Pi Configuration”，在 “Interfaces” 一栏中找到 SSH，勾选为 “enable”。</p>
<p><img src="//res.btcstudy.org/btcstudy/images/how-to-run-a-bitcoin-full-node-and-lightning-node-on-a-raspberry-pi/raspberry-pi-configuration.png"></p>
</li>
<li><p>在 Windows 电脑中下载 Putty 软件。下载页：<a target="_blank" rel="noopener" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</a> （如果无法访问请自行搜索下载）。安装 Putty 之后，在 Hostname 一栏输入树莓派的 IP 地址，即可用命令行控制树莓派。开始连接前它会要求你输入树莓派的用户名和登录口令。<strong>输入口令时你输了多少个字都是看不见的，这是命令行的特色</strong>。放心输入，不用担心。你可以认为，这种方式就是让你在 Windows 电脑上打开了一个树莓派上的终端，你在这个 SSH 窗口中输入命令与在树莓派的终端窗口中输入是一样的。</p>
<p><img src="//res.btcstudy.org/btcstudy/images/how-to-run-a-bitcoin-full-node-and-lightning-node-on-a-raspberry-pi/putty.png"></p>
</li>
</ul>
</li>
<li><p><strong>远程桌面方法</strong>。此方法也需要两个步骤。一是在树莓派上安装 xndp 服务，二是在 windows 上运行 “远程桌面连接” 软件。教程见此处：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/61405964">https://zhuanlan.zhihu.com/p/61405964</a> 。</p>
<ul>
<li><p>你需要在命令行中输入三行命令，每一行输入后按回车结束，系统会在后台下载或安装一些东西，也会给你下载成功或失败的反馈。</p>
<pre><code class="bash">sudo apt-get install xrdp
sudo apt-get install vnc4server tightvncserver
sudo /etc/init.d/xrdp restart
</code></pre>
</li>
<li><p>执行完这些命令后，在 Windows 电脑中搜索系统自带的 “远程桌面连接” 应用，打开后输入树莓派的 IP 地址即可连接。</p>
</li>
</ul>
</li>
</ul>
<p>两种远程控制方法都是有意义的，都推荐学习。</p>
</blockquote>
<h3 id="挂载硬盘"><a href="#挂载硬盘" class="headerlink" title="挂载硬盘"></a><strong>挂载硬盘</strong></h3><p><strong>挂载硬盘是很关键的，绕不过去的一个步骤</strong>！不论你的移动硬盘接入树莓派之后，树莓派能否读写它，都一定要执行挂载硬盘的步骤，否则你会发现，当要运行 bitcoin core 软件选择区块的存储位置时，将无法存储在你的硬盘上！</p>
<p>教程见此处：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/137711099">https://zhuanlan.zhihu.com/p/137711099</a> 。</p>
<p>注意：（1）<strong>如果你是移动硬盘，一定要先取消挂载，再手动挂载</strong>！（2）如果你想保证移动硬盘在 Windows 下仍然可读，不要执行参考教程中的第三步（格式化硬盘）。移动硬盘一般是 NTFS 文件系统，在 Windows 系统下和 Linux 系统下都是可读可写的。（考虑到你可能希望复制自己的比特币区块链数据，建议不格式化；或者，如果你的硬盘不是 NTFS 文件系统的，那就格式化为 NTFS 系统。）</p>
<h2 id="安装和配置-Bitcoin-Core"><a href="#安装和配置-Bitcoin-Core" class="headerlink" title="安装和配置 Bitcoin Core"></a>安装和配置 Bitcoin Core</h2><p>完成了系统准备之后，我们就要开始安装 Bitcoin Core 软件来运行比特币节点了。分为三个部分：安装 Bitcoin Core、配置 Bitcoin Core 和快捷方式创建。</p>
<h3 id="安装-Bitcoin-Core"><a href="#安装-Bitcoin-Core" class="headerlink" title="安装 Bitcoin Core"></a><strong>安装 Bitcoin Core</strong></h3><p>关于安装的过程，只推荐这个来自 bitcoin.org 的教程：<a target="_blank" rel="noopener" href="https://bitcoin.org/en/full-node#linux-instructions">https://bitcoin.org/en/full-node#linux-instructions</a> ，可惜只有英文。其命令行可以总结如下：</p>
<pre><code class="bash">wget https://bitcoin.org/bin/bitcoin-core-0.21.1/bitcoin-0.21.1-arm-linux-gnueabihf.tar.gz
tar xzf bitcoin-0.21.1-arm-linux-gnueabihf.tar.gz
sudo install -m 0755 -o root -g root -t /usr/local/bin bitcoin-0.21.1/bin/*
</code></pre>
<p>在桌面打开一个终端窗口，逐行输入、逐行回车、等待执行（<strong>每一步都必须执行，不能打折扣</strong>）。</p>
<p>第一行命令的意思是，使用 wget 软件（一种下载工具），从后面这个地址中下载内容。下载到的内容是 bitcoin core 软件 0.21.1 版（最新版）的 arm 架构 Linux 系统版本（树莓派的 cpu 是 arm 架构，raspberry pi os 是 Linux 系统）的压缩包。它会自动存储在用户的默认存储空间，在我们这里就是 <code>/home/pi</code>（如果你的用户名不是 pi，它就会存在 <code>/home/&lt;你的用户名&gt;</code> 下面）。你可以用 “文件管理器” 看到。</p>
<p>第二行命令的意思是用 tar 软件去解压缩这个文件包，获得 bitcoin core 的软件代码。跟压缩包存储在同一个位置。</p>
<p>第三行的意思是把解压出来的 bitcoin core 代码安装到一个系统可以自动识别的位置 <code>/usr/local/bin</code>（是环境变量位置之一）。<strong>第三步千万不能忘</strong>！</p>
<p><strong>运行完了这三个命令，Bitcoin Core 的软件就已经安装成功啦</strong>！是不是很方便！</p>
<p>如果你希望使用 Bitcoin Core 的图形界面，现在你只需打开一个终端，输入 <code>bitcoin-qt</code>，按下回车，就可以看到 Bitcoin Core 软件在前台执行。首次执行，它会询问你：比特币区块链数据存储在哪？是否在同步后修剪数据？有关前者，请安排在你的硬盘中（如果你发现无法将它存储在你的硬盘中，你肯定是跳步了，请回头看上文的 “挂载硬盘” 一节）；有关后者，请取消 “prun（修剪）” 的选项，这样它将下载和保存完整的比特币区块链。</p>
<p>初次同步区块链需要花一些时间，具体多久要看你的网络环境。可能需要两天到一周不等。</p>
<p><strong>如果你只是想运行 Bitcoin 节点，教程看到这一步就可以结束了</strong>。但如果你想用命令行运行比特币节点、想运行闪电网络节点，后面的配置过程也是绕不过去的。</p>
<blockquote>
<p>插一句话：</p>
<p>作为读者，你怎么知道我让你 wget 下载的正是比特币开发者们编写出来的软件呢？你怎么知道它没有被修改过？</p>
<p>你可能想到了，说这个网址不会骗人吧，它是 bitcoin.org 呀。</p>
<p>那你怎么知道 bitcoin.org 没有被劫持呢？</p>
<p>验证方法是有的，尽管并不完美。这部分技能与文章主旨无关，我把它放在文章末尾的附录中。（剧透一下，它也跟密码学有关）</p>
</blockquote>
<h3 id="配置比特币"><a href="#配置比特币" class="headerlink" title="配置比特币"></a><strong>配置比特币</strong></h3><p>这部分我们将学习用命令行来定制化地运行 Bitcoin Core 软件。使用命令行在后台启动 Bitcoin Core 很简单，输入：</p>
<pre><code class="bash">bitcoind
</code></pre>
<p>或者：</p>
<pre><code class="bash">bitcoind -daemon
</code></pre>
<p>然后你就可以看到它开始运行了。打开另一个终端，输入：</p>
<pre><code class="bash">bitcoin-cli -getinfo
</code></pre>
<p>可以看到 bitcoin core 运行的情形，比如同步了多少区块，有几个对等节点，等等（一般来说你需要等待一段时间才能看到结果，因为软件要在后台处理）。<code>bitcoind --help</code> 和 <code>bitcoin-cli --help</code> 会告诉你可以用命令行做的其它操作，包括生成新的钱包，发送交易，等等。这些命令的描述都是英文的，感兴趣的话你可以看看，但跟我们主要目的不大相关。相反，<code>bitcoin-cli -getinfo</code> 这个命令是一定要记住的。</p>
<blockquote>
<p>一个无用的小知识：bitcoind 的后缀 “d” 表示 “daemon”，后台程序；bitcoin-cli 的 “cli” 表示它是一个命令行工具，可以控制 bitcoind。</p>
</blockquote>
<p>用这种方式运行软件，你肯定会觉得很奇怪：它都不问我要把数据存在哪里，那它怎么知道要存在哪里呢？而且我的 micro SD 卡肯定是不够大的，它难道会自动存到硬盘上去？</p>
<p>答案是，软件的运行有一个默认配置，如果你不手动用命令告诉它该做什么，它就按默认配置运行。比如，你的 micro SD 卡（系统盘）不够大，软件会自动选择修剪数据模式，这样最终存在你的 micro SD 卡里的数据只有 8 GB 左右，不是完整的比特币区块链，也没有交易的索引。</p>
<p>如果你在一开始输入：</p>
<pre><code class="bash">bitcoind -datadir=&lt;你的硬盘挂载点&gt;
</code></pre>
<p>它就会把比特币区块链的数据存到你的硬盘上去，如果硬盘空间够大，它就会选择完整区块模式。</p>
<p>这些配置命令，可以用 <code>bitcoind -help</code> 看到。</p>
<p>但仔细想想又不对了。命令行一次只能输入一个命令，如果我想做多方面的配置，那一行一行输入，多麻烦呀，而且每次启动都要输入，不是人都要疯了吗。</p>
<p>这就要用到 “配置文件” 了：我们可以把需要额外执行的配置命令（比如存储在哪里）都写在一个文件中，让软件运行时就按照这个配置文件来运行，这就起到了定制化和便捷运行的效果。</p>
<p>打开你的文件管理器，它的默认位置是 <code>/home/pi</code>（或者 <code>/home/&lt;你的用户名&gt;</code>），在这里选择新建一个文件，命名为“xxx.conf”，XXX 可以是任意字符，比如是 “bitcoin”。对这个文件使用鼠标右键，可以用 text（文本模式）来编辑它，打开了就是像 Windows 的笔记本一样的界面。如果你想用命令行来偷懒，也可以直接打开一个终端，输入 <code>nano bitcoin.conf</code>，它会创建一个 bitcoin.conf 文件并自动进入编辑界面。在编辑界面输入以下内容：</p>
<pre><code class="bash"># 以 “#” 号开头表示这是一个注释行。软件会自动跳过这些行，开发人员使用这种格式来说明代码的含义
# 在我们这里也是如此。笔者用注释来说明这些配置命令的含义。你们不必复制，当然复制了也没啥问题。

# 这是笔者自己使用的配置文件，可以当作一个模板。

# datadir 命令用来安排比特币区块数据的存储位置。
# 比如这里，我把它安排到了 /home/pi/Toshiba-storage （我的移动硬盘）的 Bitcoin-blockchain 文件夹。
# 你可以安排为 &lt;你的硬盘挂载点&gt;/XXX 文件夹
datadir=/home/pi/Toshiba-storage/Bitcoin-blockchain

# 表示开启服务器，必须开启
servr=1

# 表示使用 bitcoin core 的钱包功能，可不复制
disablewallet=0

# 设置连接对等节点时候的超时时间，可不复制
timeout=6000
 
# 表示将存储完整的比特币区块链数据，不使用修剪数据的功能。建议复制
prune=0

# 表示在本地生成交易的索引。尽管不是必须，但使用了这个功能会方便闪电网络节点，建议复制
txindex=1

# 设置交易池的内存用量。这里我设置为 1000 MB，也即 1 GB
# 如果你不添加这一行，节点默认的交易池内存用量是 300 MB
datacache=1000

# 下面这两行是为闪电网络节点准备的，如果你想搭配闪电网络节点，就必须复制
# 两行的内容都可以随意设置，在配置闪电网络时原样复制过去即可
rpcuser=&lt;随意设置的用户名&gt;
rpcpassword=&lt;随意设置的口令&gt;

# 下面这两行也是为闪电网络节点准备的，闪电网络节点将使用 ZeroMQ 来与 bitcoind 通信
# 127.0.0.1 后面的是端口号，可以任意设置
# 可能你得额外安装 ZeroMQ。打开一个终端，使用命令 `sudo apt-get install libzmq3-dev` 即可
zmqpubrawblock=tcp://127.0.0.1:27500
zmqpubrawtx=tcp://127.0.0.1:27501
</code></pre>
<p>编辑好之后保存。<strong>如果你是使用 nano 命令来编辑的，窗口下方会有各种操作的快捷键</strong>。比如 “^X 离开” 表示你按 “ctrl + x” 会退出程序，而 “ctrl + s” 是保存，“ctrl + o” 是另存为，等等。</p>
<p>保存好之后，你就有一个比特币配置文件啦！在用命令行启动 bitcoin core 时使用 <code>-conf=</code> 标签接上你安排的配置文件路径即可。例如，我的配置文件路径是 <code>/home/pi/bitcoin.conf</code>，则我这样填写运行命令：</p>
<pre><code class="bash">bitcoind -conf=/home/pi/bitcoin.conf
</code></pre>
<p>在终端中输入这个命令后按回车，你会看到各种信息显示出来，表示 bitcoin core 软件开始按你在配置文件中的要求开始运行。</p>
<p><strong>当你为 bitcoind 使用这样的配置文件之后，也必须为 bitcoin-cli 安排一个相应的配置文件</strong>。步骤如下：</p>
<ul>
<li>用文件管理器打开 &#x2F;home&#x2F;pi&#x2F;.bitcoin 路径，这是一个隐藏文件夹，你需要在文件管理器的地址栏里面手动输入。</li>
<li>在这个文件夹里新建一个 “bitcoin.conf” 文件，并将你在上文中形成的比特币配置文件的 <code>rpcuser</code> 和 <code>rpcpassword</code> 两行复制到这个文件中。（这个文件夹里的配置文件名必须是 “bitcoin.conf”，但 bitcoind 的配置文件名可以任意安排；重点是，<strong>两个文件里面的 rpcuser 和 rpcpassword 两行内容必须完全一致</strong>）</li>
<li>（如果你只有 SSH 方法可用，也可以用命令 <code>nano /home/&lt;你的用户名&gt;/.bitcoin/bitcoin.conf</code> 来生成和写入信息）</li>
<li>（背后的原理是，bitcoin-cli 会自动读取 .bitcoin 文件夹里的 bitcoin.conf 文件，而只有其中的 rpc 信息与 bitcoind 所用的 rpc 配置完全一致，bitcoin-cli 才能正常访问 bitcoind）</li>
</ul>
<p>设置好之后，使用 <code>bitcoin-cli -getinfo</code> 来检查你配置对了没有。如果配置对了，这个命令将可以正常使用，否则你会看到消息，表示 bitcoind 拒绝 bitcoin-cli 的访问。</p>
<p>另外，当你要关闭后台运行的 bitcoin core 软件时，你需要用到命令：</p>
<pre><code class="bash">bitcoin-cli stop
</code></pre>
<p>这在你需要关机或重启时用到。</p>
<h3 id="设置快捷方式和开机启动"><a href="#设置快捷方式和开机启动" class="headerlink" title="设置快捷方式和开机启动"></a><strong>设置快捷方式和开机启动</strong></h3><p>使用 <code>-conf</code> 标签固然已经很简便了，但是，每次启动 bitcoind 都需要手动输入配置文件的路径，有没有更简单一点的办法呢？就像 windows 的快捷方式一样？有的，就是 alias。</p>
<p>alias 的介绍可见这个网站：<a target="_blank" rel="noopener" href="https://wangchujiang.com/linux-command/c/alias.html">https://wangchujiang.com/linux-command/c/alias.html</a> 。</p>
<p>设置 alias 和开机启动的方式参考这篇：<a target="_blank" rel="noopener" href="https://wangchujiang.com/linux-command/c/alias.html">https://wangchujiang.com/linux-command/c/alias.html</a> 。</p>
<p><strong>先来设置快捷方式</strong>。打开终端输入下列命令：</p>
<pre><code class="bash">sudo nano ~/.bashrc
</code></pre>
<p>打开编辑页面后，在最底部添加一行：</p>
<pre><code class="bash">alias bitcoind=&#39;bitcoind -conf=&lt;你的 bitcoind 配置文件的地址，比如 /home/pi/bitcoin.conf&gt;&#39;
</code></pre>
<p>它的意思是 “每当我运行 bitcoind 命令时，我都是在要求你运行 bitcoind -conf&#x3D;xxx”。注意前后的引号，另外就是路径和文件名要写对。</p>
<p>保存退出后，在终端运行下列命令：</p>
<pre><code class="bash">source ~/.bashrc
</code></pre>
<p>此后你在终端中运行 <code>bitcoind</code> 命令时，它都会自动使用你安排的配置文件。</p>
<p><strong>再来设置开机启动</strong>。用终端运行下列命令：</p>
<pre><code class="bash">crontab -e
</code></pre>
<p>在底部加入下列代码：</p>
<pre><code class="bash">@reboot /usr/local/bin/bitcoind -conf=&lt;你的 bitcoind 配置文件的地址，比如 /home/pi/bitcoin.conf&gt;
</code></pre>
<p>保存后退出。使用 <code>bitcoin-cli stop</code> 关闭 bitcoind 之后，重启树莓派系统，再用 <code>bitcoin-cli -getinfo</code> 或者任务管理器（在 “系统菜单” 的 “附件” 中）查看 bitcoind 是否在运行。</p>
<h2 id="安装和配置-LND"><a href="#安装和配置-LND" class="headerlink" title="安装和配置 LND"></a>安装和配置 LND</h2><p>闪电网络目前已经有多种实现，而 LND 是最多用户的一种，可能是因为 LND 最早出现了配套的图形界面 Zap（也即是在下一章我们要学习使用的一种软件）。笔者最早接触到的闪电网络钱包也就是 Zap，所以在树莓派上安装时路径依赖地选择了 Zap。相比比特币，LND 的安装和配置要更加复杂，需要更加细心。</p>
<p>本章节同样分成三个步骤：安装 LND、配置 LND 和使用简介。设置 alias 的方法与比特币的相同，我们就简单带过。</p>
<h3 id="安装-LND"><a href="#安装-LND" class="headerlink" title="安装 LND"></a><strong>安装 LND</strong></h3><p>安装 LND 的教程只推荐 LND 代码库里的说明：<a target="_blank" rel="noopener" href="https://github.com/lightningnetwork/lnd/blob/master/docs/INSTALL.md#installing-a-binary-release">https://github.com/lightningnetwork/lnd/blob/master/docs/INSTALL.md#installing-a-binary-release</a> 。它不仅说明了几种安装 LND 的方法，还介绍了 LND 的配置命令。</p>
<p>在这里，我们选择用 binary 方法安装 LND，这样最简单，还不用安装 go 语言。根据文档里面的说明，可以总结为三条命令：</p>
<pre><code class="bash">wget https://github.com/lightningnetwork/lnd/releases/download/v0.14.0-beta.rc2/lnd-linux-armv7-v0.14.0-beta.rc2.tar.gz
tar xzf lnd-linux-armv7-v0.14.0-beta.rc2.tar.gz
sudo mv /home/pi/lnd-linux-armv7-v0.14.0-beta.rc2/* /usr/bin/
</code></pre>
<p>第一行是下载压缩包；第二行是解压缩；第三行是把解压得到的文件移动到 &#x2F;usr&#x2F;bin&#x2F; 文件夹下。<strong>第三步必须做，但笔者已经不确定第三行命令是不是有效了，如果无效，读者可以自行搜索在 Linux 系统中移动文件的方法</strong>（就移到 <code>/usr/bin/</code>）。</p>
<p>好了，LND 装好了。</p>
<blockquote>
<p><strong>2022 年 10 月 22 日更新</strong>：</p>
<p>2022 年 10 月 10 日，比特币区块链上出现了一笔体积超大的多签名交易，导致一些版本的 LND 程序宕机，原因是该交易的 witness 数据超过了 btcd 客户端允许的限度，而 LND 复用了这部分代码，因此也宕机了。</p>
<p>LND v0.15.2 之后的版本应该修复了这个问题，在这里补上更新 LND 版本的代码，实际上重复上面三条命令，只不过下载的是新版本的 LND（这里是 v.015.3，笔者已亲测有效：</p>
<pre><code class="bash">wget https://github.com/lightningnetwork/lnd/releases/download/v0.15.3-beta/lnd-linux-armv7-v0.15.3-beta.tar.gz
tar xzf lnd-linux-armv7-v0.14.0-beta.rc2.tar.gz
sudo mv /home/pi/lnd-linux-armv7-v0.14.0-beta.rc2/* /usr/bin/
</code></pre>
<p><strong>2022 年 11 月 1 日更新</strong>：</p>
<p>btcd 客户端再次因为<a target="_blank" rel="noopener" href="https://github.com/btcsuite/btcd/issues/1906">主网上出现其无法解析的交易</a>而崩溃。请运行 LND 的读者立即将 LND 升级到 v0.15.4 及以上的版本，避免因客户端宕机而导致损失。</p>
</blockquote>
<h3 id="配置-LND"><a href="#配置-LND" class="headerlink" title="配置 LND"></a><strong>配置 LND</strong></h3><p>依样画葫芦，打开文件管理器，在 <code>/home/&lt;你的用户名&gt;</code> 新建一个文件，命名为 “YYY.conf”（比如 “lnd.conf”），用文本编辑器来编辑它（或者使用命令行 <code>nano /home/&lt;你的用户名&gt;/lnd.conf</code>），输入下列内容：</p>
<pre><code class="bash"># 这一行表示将 LND 的节点数据存在哪里
# 如果不手动设置，lnd 和 lncli 都会使用默认存储位置（/home/&lt;你的用户名&gt;/.lnd），实际上更为方便
# 若设置了，后面也会需要额外配置 lncli  的快捷方式
# 所以推荐不设置
datadir=/home/pi/Toshiba-storage/lnd-data

# 下面的三行定义你的闪电网络运行在哪个网络上
# 我们这里的设置表示运行在比特币的主网上，并使用 bitcoind 来作为节点的后台
bitcoin.active=true
bitcoin.mainnet=true
bitcoin.node=bitcoind

# 下面这四行定义 lnd 程序如何与 bitcoind 通信
# 必须与你一开始的 bitcoind 配置文件里面的相应内容完全一致
# 注意开头的前缀，是 bitcoind
bitcoind.rpcuser=&lt;你在 bitcoind 配置文件里设置的 rpc 用户名&gt;
bitcoind.rpcpass=&lt;你在 bitcoind 配置文件里设置的 rpc 口令&gt;
bitcoind.zmqpubrawblock=tcp://127.0.0.1:27500
bitcoind.zmqpubrawtx=tcp://127.0.0.1:27501

# 下面这两行表示使用 TLS 方法，从这个 IP 的端口接受 rpc 请求
# 暂且先加上，在下一个章节我们会说明它的用法
tlsextraip=0.0.0.0
rpclisten=0.0.0.0:10009

listen=0.0.0.0:9735  
listen=[::1]:9736
</code></pre>
<p>输入后保存。此后，我们就可以使用这个配置文件来运行 lnd 了，例如：</p>
<pre><code class="bash">lnd -C &lt;你的 lnd 配置文件的位置，比如笔者的 /home/pi/lnd.conf&gt;
</code></pre>
<p>如果你在 lnd.conf 中设置了 datadir，即安排了 LND 节点的数据存储位置，在你使用 lncli 时，还需加入一个参数，例如：</p>
<pre><code class="bash">lncli --macaroonpath &lt;datadir 参数&gt;/chain/bitcoin/mainnet/admin.macaroon
</code></pre>
<p>这是因为 lnd 使用 macaroon（直译为 “马卡龙”，一种饼干）文件来存储一些信息，lncli 要获得这些信息才可以访问 lnd。如果你不手动设置 lnd 的 datadir，它会默认存储在 <code>/home/&lt;你的用户名&gt;/.lnd</code> 文件夹中，而这个文件夹是 lnd 和 lncli 默认访问的。所以，<strong>如果你没有设置 datadir，就不必加这个参数</strong>。</p>
<p>我们先把这些命令设置为 alias，再介绍闪电网络节点的使用方法。</p>
<p>打开终端使用 <code>sudo nano ~/.bashrc</code> 命令，在文件最后面输入下面两行代码：</p>
<pre><code class="bash">alias lnd=&#39;lnd -C &lt;你的 lnd 配置文件的位置，比如笔者的 /home/pi/lnd.conf&gt;&#39;
alias lnlic=&#39;lncli --macaroonpath &lt;datadir 参数&gt;/chain/bitcoin/mainnet/admin.macaroon&#39;
</code></pre>
<p><strong>如果你并未设置 datadir，第二行不必输入</strong>。</p>
<p>保存后在终端运行 <code>source ~/.bashrc</code>。</p>
<p>此后，你就可以在命令行里直接运行 lnd 和 lncli 了，程序将读取你在配置文件中的设置。</p>
<h3 id="LND-的使用"><a href="#LND-的使用" class="headerlink" title="LND 的使用"></a><strong>LND 的使用</strong></h3><p>初次运行 <code>lnd</code> 时，它会提醒你，需要使用 lncli 来创建一个钱包：</p>
<ul>
<li>打开一个终端，输入 <code>licli create</code> 按下回车，终端窗口的信息会引导你生成一个闪电网络钱包</li>
<li>第一步是要求你设置一个 password（口令），<strong>请用纸币把这个口令写下来，此后每次你启动 lnd 都需要用到</strong></li>
<li>第二步是向你出示一套 24 个单词的助记词，<strong>请用纸币把助记词写下来，如果你忘了 password，会需要用它来恢复钱包</strong></li>
<li>第三步是询问你，是否要加上一个 passphase（密语），密语会跟助记词一起参与你的钱包私钥和地址的生成，可以在助记词之外提供额外的保护。<strong>如果你设置了，请用纸币把密语写下来</strong>（也可以不设置）</li>
</ul>
<p>生成钱包之后，就可以正常使用 <code>lncli getinfo</code> 来查看 lnd 的运行状况了。同样地，在终端使用 <code>lncli stop</code> 的命令会关闭 lnd 的运行。</p>
<p>此后，每当你使用 <code>lnd</code> 时，它都会要求你（在另一个终端窗口）使用 <code>lncli unlock</code> 来解锁钱包。解锁钱包需要你手动输入你上面设置的 password；必须解锁了钱包，lnd 才会继续运行，实际搭起一个节点（这也是为什么我们不必为 lnd 设置开机启动，设了也还是需要手动用 lncli 解锁）。</p>
<p>有关使用 lnd 来开设通道、发送支付的方法，见：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stopanddecrypt.medium.com/a-complete-beginners-guide-to-installing-a-lightning-node-on-linux-2021-edition-ece227cfc35d#675f">https://stopanddecrypt.medium.com/a-complete-beginners-guide-to-installing-a-lightning-node-on-linux-2021-edition-ece227cfc35d#675f</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/coinmonks/the-lightning-network-part-2-running-a-bitcoin-lightning-node-on-raspberry-pi-616e009529f2">https://medium.com/coinmonks/the-lightning-network-part-2-running-a-bitcoin-lightning-node-on-raspberry-pi-616e009529f2</a></li>
</ul>
<p>这两个教程也包含了其他内容，是我找到的最有用的教程之一。</p>
<h2 id="使用-Zap-“远程”-连接你的闪电网络节点"><a href="#使用-Zap-“远程”-连接你的闪电网络节点" class="headerlink" title="使用 Zap “远程” 连接你的闪电网络节点"></a>使用 Zap “远程” 连接你的闪电网络节点</h2><p><strong>说实在的，笔者非常怀疑，在大部分读者的网络环境下，学习这个章节有什么意义</strong>。在中国，公网 IP 是非常稀缺的，我们大部分人的家用宽带，使用的都是运营商的内网 IP，这意味着，虽然我们能上网，却不能指望家用宽带能让我们的电脑成为一个可以稳定运行、访问的服务端。</p>
<p>这也意味着，如果只使用家用宽带，不借助其他手段，本章节学习的最终成果就是，当你的手机和树莓派在同一个 wifi 下时，你的手机闪电网络钱包可以直接借助你的节点发起交易，也即自主托管。你仍然做不到可以随时随地使用自己的闪电网络钱包。</p>
<p>因此，本章节的性价比并不高，请读者自行判断是否要继续学习。</p>
<p>本章节分为三个步骤：安装 lndconnect、配置 lnd、手机连接。</p>
<h3 id="安装-lndconnect"><a href="#安装-lndconnect" class="headerlink" title="安装 lndconnect"></a><strong>安装 lndconnect</strong></h3><p>lndconnect 是 Zap 开发人员为 lnd 节点开发的一个暴露节点信息的工具，借助它我们可以获得让 Zap 钱包连接我们节点的信息。<strong>安装 lndconnect 是第一步，做不到这一步，后面的步骤就无从谈起了，而且安装过程强烈依赖于你有访问外国网站的手段</strong>。</p>
<p>安装 lndconnect 同样分两步。</p>
<p><strong>第一步是安装 go 语言</strong>。（这一步我们同样借鉴了上文参考的 stopanddecrypt 的文章。）</p>
<pre><code class="bash">wget https://studygolang.com/dl/golang/go1.17.3.linux-armv6l.tar.gz
sudo tar -C /usr/local -xzf go1.17.3.linux-armv6l.tar.gz
echo &quot;export PATH=$PATH:~/go/bin:/usr/local/go/bin&quot; &gt;&gt; ~/.bashrc
</code></pre>
<p>第一步是获得压缩包，第二步是解压缩，第三步是把 go 语言的文件夹设为环境变量，这样才能在终端里面直接使用 go 命令。</p>
<p><strong>第二步是安装 lndconnect</strong>。（<strong>请保证你开启了 https 代理以及你的代理确实有用</strong>。）（这一步我们参考了 <a target="_blank" rel="noopener" href="https://github.com/LN-Zap/lndconnect/issues/20#issuecomment-825211584">https://github.com/LN-Zap/lndconnect/issues/20#issuecomment-825211584</a> 。）</p>
<pre><code class="bash">git clone https://github.com/LN-Zap/lndconnect.git
</code></pre>
<p>这一步会把 lndconnect 的代码库下载到你的默认存储位置，也就是 <code>/home/&lt;你的用户名&gt;</code>。</p>
<p>使用命令：</p>
<pre><code class="bash">cd /home/&lt;你的用户名&gt;/lndconnect
go mod init github.com/lndconnect/v2
go mod edit -require github.com/lightningnetwork/lnd@v0.14.0-beta.rc2
go build
</code></pre>
<p>从笔者的个人经验来看，第二行和第三行的作用是不明确的，但我们姑且这么输入。<strong>go build 这一步一定会报错，但我们要的就是它报错</strong>！</p>
<p>执行 go build，它会打印出一些信息，告诉你缺少了哪些依赖，<strong>关键字是 “to add”</strong>。对于这些信息，我们不用管，直接看最后一行，最后一行往往是 <code>go mod download ...</code> 或者 <code>go get ...</code> 开头的命令，我们直接复制下来执行。</p>
<p>每次它执行完下载，我们就重新运行一次 go build，直到它成功为止！（如果笔者没记错，最后一个命令是 <code>go get lndconnect</code>）</p>
<p>build 成功之后，我们再运行：</p>
<pre><code class="bash">sudo cp lndconnect /usr/local/bin/lndconnect
</code></pre>
<p>它会把 lndconncet 整个文件夹搬到第二个地址上去。然后我们就可以直接在终端中使用 lndconnect 了。</p>
<h3 id="配置-LND-1"><a href="#配置-LND-1" class="headerlink" title="配置 LND"></a><strong>配置 LND</strong></h3><p>这一步的参考是：<a target="_blank" rel="noopener" href="https://docs.zaphq.io/docs-desktop-lnd-configure">https://docs.zaphq.io/docs-desktop-lnd-configure</a> 。</p>
<p>原理大意：Zap 钱包软件会使用 gRPC 方法与 lnd 通信，但是通信的端口要提前在配置文件里定义好，否则 lnd 会拒绝连接。</p>
<p>因为随时随地访问的目标暂时不可能实现了，<strong>我们这里的配置的目标是，让我们手机上的 Zap 钱包可以连接、使用我们的 lnd 节点</strong>。</p>
<ul>
<li><p>首先，在终端使用 <code>lncli stop</code> 命令关闭 lnd。</p>
</li>
<li><p>在终端使用 <code>ifconfig</code> 命令获得树莓派的内网 ip 地址（不懂怎么做的可以看本文 “系统准备” 的 “初始化系统” 一节）</p>
</li>
<li><p>编辑 lnd 的配置文件（例如，在笔者这里，就是 <code>nano /home/pi/lnd.conf</code>），在其中加入：</p>
<pre><code class="bash">tlsextraip=&lt;你的树莓派内网地址，比如 192.168.1.5&gt;
rpclisten=&lt;你的树莓派内网地址，比如 192.168.1.5&gt;:&lt;端口号，比如 5356，等等，不要跟其它软件的端口号重合&gt;

# 例子：
# tlsextraip=192.168.1.5
# rpclisten=192.168.1.5:3399
# 如果你设置错了，比如本地的 ip 写错了，lnd 会无法启动；端口号被占用也是如此，你改成一个可用的即可
</code></pre>
</li>
<li><p>保存退出后，访问 <code>/home/&lt;你的用户名&gt;/.lnd</code> 文件夹，把里面的 tls.cert 和 tls.key 两个文件删掉（命令行操作为 <code>rm /home/&lt;你的用户名&gt;/.lnd/tls.cert /home/&lt;你的用户名&gt;/.lnd/tls.key</code>）</p>
</li>
<li><p>（据我所知，上面这一步是为了重新生成这两个文件，但我们这种方法几乎不会用到这两个文件，所以我不确定这一步是不是非做不可，但是，让 lnd 与本地的 Zap 软件搭配使用的场景应该是会用到的，这里我们把它当成一个好习惯，学习一下。）</p>
</li>
<li><p>在终端用 <code>lnd</code> 命令重新启动 lnd 节点，看配置是否可行。不可行侧则重新配置一遍。</p>
</li>
</ul>
<h3 id="使用-Zap-连接你的闪电网络节点"><a href="#使用-Zap-连接你的闪电网络节点" class="headerlink" title="使用 Zap 连接你的闪电网络节点"></a><strong>使用 Zap 连接你的闪电网络节点</strong></h3><p>关键事实：（1）Zap 钱包没有 arm 架构的版本，所以我们没法在树莓派上直接使用 Zap 钱包，有就不用做上面这些事了；（2）<strong>不要尝试在 Windows 上使用桌面版 Zap 钱包连接你的闪电节点，桌面版的软件有逻辑问题，会陷入死循环，不可能真正用得上</strong>！</p>
<blockquote>
<p>2022 年 10 月 22 日更新：</p>
<p>Zap v0.7.6 beta 的桌面版已证实不再有这种陷入死循环的逻辑问题，所以下面的教程对桌面版的 Zap 将同样有用。</p>
<p>但是 Zap 似乎已经不再更新，开发人员开启了一个新的项目。请在网络上搜索他们的新闻，决定要不要使用更新的软件。</p>
</blockquote>
<p>开搞！</p>
<ul>
<li><p>在手机上下载 Zap 钱包：<a target="_blank" rel="noopener" href="https://www.zaphq.io/download">https://www.zaphq.io/download</a></p>
</li>
<li><p>确保手机和树莓派处在同一个 wifi 下</p>
</li>
<li><p>使用 <code>lncli unlock</code> 命令先解锁闪电钱包</p>
</li>
<li><p>使用以下命令：</p>
<pre><code class="bash">lndconnect --configfile=&lt;你的 lnd 配置文件的路径&gt; -i -o
</code></pre>
<p><code>-i</code> 表示使路由器下的 ip 地址；<code>-o</code> 会在你的默认存储位置（&#x2F;home&#x2F;&lt;你的用户名&gt;）生成一个二维码图片</p>
</li>
<li><p>如果你没有图形界面，可以不使用 <code>-o</code> 标签，它会把二维码直接打印在终端窗口中；又或者，你可以使用 <code>-j</code> 标签，它会在终端窗口打印出 url 信息（你要有方法把这段 url 信息发送到手机上才能用）</p>
</li>
<li><p>在手机上使用 Zap 钱包，打开扫描功能，扫描你在上一步生成的二维码。现在你可以用手机来操作自己放在 lnd 节点里的钱包啦！（即两者是完全同步的）</p>
</li>
</ul>
<p>（完）</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="A-在终端中使用代理"><a href="#A-在终端中使用代理" class="headerlink" title="A. 在终端中使用代理"></a>A. 在终端中使用代理</h3><ul>
<li>出于我们的目的，在终端中使用代理的方法，看这个就够了：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/46973701">https://zhuanlan.zhihu.com/p/46973701</a> 。（我们比较需要打开 https 代理）</li>
<li>这里的前提是你有一个科学上网的工具，然后你可以在 Windows 上用某个软件的 “允许其它设备连入” 功能，把 Windows 电脑的代理开放给同一路由器下的其它设备使用，比如在终端中使用 <code>export https_proxy=&#39;https://&lt;你的 windows 电脑的 ip 地址&gt;:&lt;你的代理软件打开的端口，比如 1080&gt;&#39;</code></li>
</ul>
<h3 id="B-验证自己下载的软件"><a href="#B-验证自己下载的软件" class="headerlink" title="B. 验证自己下载的软件"></a><strong>B. 验证自己下载的软件</strong></h3><p>简而言之，我们是用密码学方法来减少下载软件时需要信任的人和主体。</p>
<p>以比特币软件为例，比特币每次发布新版本时，都会提供代码的哈希值，以及比特币开发者对这些哈希值的签名。</p>
<p>哈希值我们知道，是哈希函数的输出。密码学哈希函数是抗原像攻击的和抗碰撞的：无法从哈希值反推出原像，而且原像只要改动了，哈希值几乎一定会变。那么好了，只要我们拿到了代码的哈希值，在本地验证代码的哈希值与之是否一致，就可以看出代码是否被改过（这就是校验数据的完整性）。</p>
<p>在比特币软件的发行页，它同时也发布了软件的哈希值：<a target="_blank" rel="noopener" href="https://bitcoin.org/bin/bitcoin-core-0.21.1/">https://bitcoin.org/bin/bitcoin-core-0.21.1/</a>，就是列表中的 .asc 文件。</p>
<p>你肯定又会说了，这没彻底解决问题呀，要是有个人把 bitcoin.org 黑了，发布一个篡改后的代码，他直接把 .asc 里面记载的哈希值都改过来，你们不就验证不出来了吗？</p>
<p>好问题。这问题大家也都想到了。所以我们使用密码学里面的数字签名方案：开发者先把自己的公钥公布出来，此后每次发布软件，都附上一个自己的私钥对哈希值的签名。只要有公钥，签名，就能验证一个哈希值是不是对应于这个签名的。即，签名绑定哈希值，哈希值绑定代码。</p>
<p>.asc 文件也附带了开发者的签名。</p>
<p>最后一个问题，我要在哪里获得开发者的公钥呢？（如果这个步骤不安全，我拿了个假公钥，不也验证不出来吗？）</p>
<p>也是一个好问题。笔者自己验证比特币软件用的公钥也是从 bitcoin.org 获得的，它的 run a full node 页面披露了开发者 W. J. van der Laan 的 PGP 指纹；在开发者个人的 GitHub 主页上也可以找到一个指纹（这个指纹已经过期）。</p>
<p>我们先用终端来验证一遍，再说点题外话：</p>
<p>先获得 bitcoin-core-0.21.1 软件各版本的哈希值、开发者签名，以及 Wladmimir J. van der Laan 的公钥：</p>
<pre><code class="bash">wget https://bitcoin.org/bin/bitcoin-core-0.21.1/SHA256SUMS.asc
wget https://bitcoin.org/laanwj-releases.asc
</code></pre>
<p>再来校验我们下载的软件的哈希值，以及开发者的签名：</p>
<pre><code class="bash">sha256sum bitcoin-0.21.1-arm-linux-gnueabihf.tar.gz
gpg --import laanwj-releases.asc
gpg --verify SHA256SUMS.asc
</code></pre>
<p>第一步是获得软件压缩包的哈希值。你可以把得到的哈希值，与 SHA256SUMS.asc 中提供的哈希值相比对。</p>
<p>第二步是加载开发者的公钥。第三步是验证签名。你应该会看到这样的信息：</p>
<pre><code class="bash">gpg: 签名建立于 2021年05月02日 星期日 03时33分58秒 CST
gpg:               使用 RSA 密钥 90C8019E36C2E964
gpg: 完好的签名，来自于 “Wladimir J. van der Laan (Bitcoin Core binary release signing key) &lt;laanwj@gmail.com&gt;” [未知]
gpg: 警告：此密钥未被受信任签名认证！
gpg:       没有证据表明此签名属于其声称的所有者。
主密钥指纹： 01EA 5486 DE18 A882 D4C2  6845 90C8 019E 36C2 E964
</code></pre>
<p>这个主密钥指纹，也会跟 <a target="_blank" rel="noopener" href="https://bitcoin.org/en/full-node#linux-instructions">https://bitcoin.org/en/full-node#linux-instructions</a> 上提供的一致。</p>
<p>直到这一步为止，我们仍然做不到无需信任。我们还是信任了 bitcoin.org。完全免信任是非常困难的。</p>
<p>gpg 的消息里有一句话，很有意思：“没有证据表明此签名属于其声称的所有者”。意思是说，没有机构验证过只有这个人能控制这笔私钥，签出这样的签名。</p>
<p>确实没有。</p>
<p>但聪明如你，肯定也想到了，如果我们安排一个受信任的第三方来做这件事，那接下来我们就会变成信任这个第三方。这也只是转移了信任需要，而没有消除信任需要。</p>
<p>实际上，我们每天浏览的网站，就是有这样的机构来为网站使用的公钥提供证书的，就是所谓的 KPI（公钥基础设施）。这样好不好呢？</p>
<p>推荐阅读：<a href="https://www.btcstudy.org/2021/09/10/trusted-third-parties/">受信任第三方与安全漏洞</a></p>
<p>想得越深，你将越理解比特币区块链结构的可贵，以及比特币总是选择软分叉（后向兼容升级方法）的可贵：它是在尽可能免除这个系统需要的信任。</p>
</article></div></div></main><script src="/js/post.js?v=1675838664010"></script><script src="/js/highlight.min.js?v=1675838664010"></script><script>var containerEl = document.querySelector('.post-container');
var postFontSize = localStorage.getItem('post-font-size') || '16';
var inputEl = document.querySelector('#size-change-input');
var inputEl2 = document.querySelector('#size-change-input2');
inputEl.value = postFontSize;
inputEl2.value = postFontSize;
containerEl.style.fontSize = postFontSize + 'px';
$(function(){
  function setSizeChangeInputValue(size) {
    $('.post-container').css('font-size', size + 'px');
    localStorage.setItem('post-font-size', size);
    $('#size-change-input').val(size);
    $('#size-change-input2').val(size);
  }
  $('#size-change-input').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
  $('#size-change-input2').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
});
</script><script>hljs.initHighlightingOnLoad();</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/btcstudy">Twitter</a><!-- Github--><!-- Ins--><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml">rss</a><!-- 知乎--><!-- 领英--><!-- 脸书--><!-- Telegram--><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/btcstudyorg">Telegram</a></section></footer><script async src="/js/buttons.js?v=1675838664010"></script><script async src="/js/index.js?v=1675838664010"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-JVCJ9XXG1Z');</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306";
  hm.async = true;
  hm.defer = true;
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
  </script></body></html>