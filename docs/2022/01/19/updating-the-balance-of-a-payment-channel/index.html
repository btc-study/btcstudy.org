<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>如何更新一个支付通道的余额</title><meta name="keywords" content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name="description" content="比特币思想的中文集结地"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css?v=1673504754531"><link rel="preload" as="style" onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1673504754531"><link rel="stylesheet" href="/style/base.css?v=1673504754531"><link rel="stylesheet" href="/style/common/helper.css?v=1673504754531"><link rel="stylesheet" href="/style/themes/animation.css?v=1673504754531"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1673504754531"></script><script src="/js/libs/zepto.min.js"></script><link rel="stylesheet" href="/style/post.css?v=1673504754531"><link rel="stylesheet" href="/style/themes/highlight.css?v=1673504754531"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="BTC Study" type="application/atom+xml"></head><body class="is-flex is-flex-direction-column" onload="initialTheme()"><div class="clip"></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id="header"><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href="/"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id="header-menu"><a class="is-inline-block header-activity mr-4" href="/">首页</a><a class="is-inline-block mr-4" href="/archives">全站目录</a><a class="is-inline-block mr-4" href="/tags">标签</a><a class="is-inline-block mr-4" href="/maps">地图</a><a class="is-inline-block mr-4" href="/mempool">mempool</a><a class="is-inline-block mr-4" target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input" type="range" min="12" max="32" step="2"></div></div></div><i class="iconfont icon-icon_dark mr-1" id="theme-btn"></i><div class="search-wrap"><input class="pl-3" id="search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search" id="search-input-btn"></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">如何更新一个支付通道的余额</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn2"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input2" type="range" min="12" max="32" step="2"></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id="mobile-header"><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id="mobile-header-logo"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopicMobile"><p class="is-full-height">如何更新一个支付通道的余额</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class="mobile-search-wrap"><div class="search-input"><input class="pl-3" id="mobile-search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class="mobile-search-input-btn">搜 索</button></div></div></header><div class="mobile-slide-menu"><a class="header-activity" href="/">首页</a><a href="/archives">全站目录</a><a href="/tags">标签</a><a href="/maps">地图</a><a href="/mempool">mempool</a><a target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class="slide-menu-fontsize"><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1673504754531"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BF%E8%AF%BA%E4%BA%8B%E5%8A%A1"><span class="toc-text">承诺事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%9C%E5%85%88%E7%BB%99%E8%87%AA%E5%B7%B1%E6%94%AF%E4%BB%98%E2%80%9D"><span class="toc-text">“先给自己支付”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%9C%E5%85%88%E7%BB%99%E5%AF%B9%E6%96%B9%E6%94%AF%E4%BB%98%E2%80%9D"><span class="toc-text">“先给对方支付”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E9%81%93%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0-%E2%80%94%E2%80%94-%E9%80%90%E6%AD%A5%E5%88%86%E8%A7%A3"><span class="toc-text">通道状态更新 —— 逐步分解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Alice-%E6%9E%84%E5%BB%BA%E5%92%8C%E7%AD%BE%E5%90%8D"><span class="toc-text">Alice 构建和签名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bob-%E6%A3%80%E6%9F%A5%E5%92%8C%E6%92%A4%E9%94%80"><span class="toc-text">Bob 检查和撤销</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bob-%E6%9E%84%E5%BB%BA%E5%92%8C%E7%AD%BE%E5%90%8D"><span class="toc-text">Bob 构建和签名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Alice-%E6%A3%80%E6%9F%A5%E5%92%8C%E4%BD%9C%E5%BA%9F"><span class="toc-text">Alice 检查和作废</span></a></li></ol></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id="postTitle">如何更新一个支付通道的余额</h1><div class="page-author"><div class="is-flex is-flex-direction-row page-data mr-6"><img class="mr-1" src="//res.btcstudy.org/btcstudy/images/default_avatar.png" alt="Vlad Stan"><div class="page-author-info"><strong>Vlad Stan</strong><time class="has-text-grey" datetime="2022-01-19T08:56:55.000Z">2022-01-19</time></div></div><div class="is-flex"><a href="/tags/%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C"><i class="page-tag mr-1 px-1">闪电网络</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Vlad Stan</em></p><p><em>来源：<a target="_blank" rel="noopener" href="https://motorina0.medium.com/updating-the-balance-of-a-payment-channel-944a713a8408">https://motorina0.medium.com/updating-the-balance-of-a-payment-channel-944a713a8408</a></em></p></blockquote><p>在本文中，我们会深入地探究，闪电网络通道是如何做到既能更新余额、又无需任何一方承担资金丢失风险的。</p><p>闪电网络是一个对抗性的网络，参与者们并不信任自己的对手。实际上，他们的 <em>假设</em> 是对方如有可能就会欺诈他们。参与者<strong>只有</strong>在知晓其操作的安全性时才会签名。而且，需要保证<strong>任何时候</strong>参与者都有拿着资金退出合约（离开通道）的选择。</p><p>在这篇文章中，我们假设<strong>支付通道已经开好了</strong>，当前的 Alice 有 0.10 BTC 的通道余额，Bob 只有 0.00 BTC 的余额。</p><h2 id="承诺事务"><a href="#承诺事务" class="headerlink" title="承诺事务"></a>承诺事务</h2><p>在支付通道打开之后，Alice 希望给 Bob 支付 0.02 BTC。双方之间的支付是使用一种特殊类型的交易来达成的，它叫做 “<strong>承诺事务</strong>（commitment transactions）”。</p><p>这种事务的特殊之处在于：</p><ul><li>它是可以撤销的，如果双方都同意的话</li><li>总是花费充值交易的那个 2-2 多签名输出</li></ul><p>承诺事务的初衷是放在支付通道里使用，而不是放到主链上，不过，它们是完全有效的比特币交易，任何一方，只要想的话，都可以将它广播到主链上。</p><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/GsV00ow.gif" alt="img"></p><p style="text-align:center">- 一个支付通道内部的多笔承诺事务 -</p><p>为了给 Bob 支付，Alice 必须创建两笔交易，<strong>两笔都会</strong>给 Bob 支付 0.02 BTC，但这两笔交易的输出有不同的花费条件。下文我们会管这两笔交易叫 “<strong>先给自己支付</strong>” 交易和 “<strong>先给对方支付</strong>” 交易。记住，<strong>两笔交易都由 Alice 来创建</strong>，无需使用来自 Bob 的输入。在 Bob 发送 <code>accept_channel</code> 消息时，Alice 就已经获得了所有的信息。</p><h2 id="“先给自己支付”"><a href="#“先给自己支付”" class="headerlink" title="“先给自己支付”"></a>“先给自己支付”</h2><p>在 “先给自己支付” 交易中，Alice 可以立即花用自己的输出，而 Bob 必须遵守 <a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8"><strong>RSM 合约</strong></a>。RSM 合约（Revocable Sequence Maturity Contract，可撤销的相对时间锁合约）对输出的花费作了以下限制：</p><ul><li>资金的受益者只能在一段时间的 “成熟期” 之后花费这些资金（不能立即花费）</li><li>合约可以（被受益者）撤销</li><li>如果受益者已经撤销了这个合约，但仍尝试花费这些资金，则有可能遭遇惩罚（丧失所有资金）</li></ul><p>更多关于 RSM 合约的细节可见<a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8">此处</a>。</p><p>这笔交易对 Alice 更有利，你可以在<a target="_blank" rel="noopener" href="https://bitcoincore.tech/apps/bitcoinjs-ui/index.html?&tx_note=Sample%20of%20a%20Commitment%20Transaction%20used%20in%20Lightning%20Network.&tx_input_0_note=Spend%20from%20the%20Funding%20Transaction&tx_input_0_script_note=This%20script%20unlocks%20a%20P2WSH.%20Click%20the%20%27Edit%27%20button%20and%20manually%20set%20the%20type%20to%20P2WSH%20in%20order%20to%20view%20the%202-of-2%20multisig%20script.&tx_output_0_note=%5BTo%20Local%5D%20Output%20sends%20funds%20back%20to%20the%20owner%20(Alice)%20of%20this%20commitment%20transaction%20and%20thus%20must%20be%20timelocked%20using%20%60OP_CHECKSEQUENCEVERIFY%60.%20It%20can%20be%20claimed,%20without%20delay,%20by%20the%20other%20party%20if%20they%20know%20the%20revocation%20private%20key.&tx_output_0_script_note=This%20is%20the%20%22naked%22%20unwrapped%20Revocable%20Sequence%20Maturity%20Contract%20(RSMC).%20In%20order%20to%20see%20the%20final%20form,%20click%20the%20%27Edit%27%20button%20and%20%27Wrap%20in%20P2WSH%27.&tx_output_1_note=%5BTo%20Remote%5D%20Output%20sends%20funds%20to%20the%20other%20party.%20If%20%60option_anchor_outputs%60%20applies%20to%20the%20commitment%20transaction,%20the%20%60to_remote%60%20output%20is%20encumbered%20by%20a%20one%20block%20csv%20lock.%20Otherwise,%20this%20output%20is%20a%20simple%20P2WPKH%20to%20remotepubkey.&tx_output_1_script_note=This%20is%20the%20%22naked%22%20unwrapped%20Contract%20that%20pays%20Bob%20with%20no%20restrictions.%20In%20order%20to%20see%20the%20final%20form,%20click%20the%20%27Edit%27%20button%20and%20%27Wrap%20in%20P2WSH%27.&tx_output_2_note=%5BLocal%20Anchor%5D%20Output%20can%20be%20spent%20by%20the%20local%20node%20to%20provide%20incentive%20to%20mine%20the%20transaction,%20using%20child-pays-for-parent.&tx_output_3_note=%5BRemote%20Anchor%5D%20Output%20can%20be%20spent%20by%20the%20remote%20node%20to%20provide%20incentive%20to%20mine%20the%20transaction,%20using%20child-pays-for-parent.&tx_hex=02000000000101bef67e4e2fb9ddeeb3461973cd4c62abb35050b1add772995b820b584a4884890000000000ffffffff04e48d6a00000000004d63210212a140cd0c6539d07cd08dfe09984dec3251ea808b892efeac3ede9402bf2b1967029000b2752103fd5960528dc152014952efdb702a88f71e3c1653b2314431701ec77e57fde83c68acc0c62d00000000002521032c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991ad51b24a010000000000002200202b1b5854183c12d3316565972c4668929d314d81c5dcdbb21cb45fe8a9a8114f4a01000000000000220020e9e86e4823faa62e222ebc858a226636856158f07e69898da3b0d1af0ddb39940340ca3e2b815f7bf548fa59a79002d8093ee786b38803704130a589f749c33552145a36440a0d7d407dee948c85c2f20e4892479075cf2f166e94c2e6309907971440f89034eba16b2be0e5581f750a0a6309192b75cce0f202f0ee2b4ec0cc39485076c65dc507fe42276152b7a3d90e961e678adbe966e916ecfe85e64d430e75f3475221023da092f6980e58d2c037173180e9a465476026ee50f96695963e8efe436f54eb21030e9f7b623d2ccc7c9bd44d66d5ce21ce504c0acf6385a132cec6d3c39fa711c152ae00000000">这里</a>看到这种交易的一个例子。</p><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/kwZ2zpg.png" alt="img"></p><p style="text-align:center">- Alice 创建的 <strong>“先给自己支付”</strong> 的交易 -</p><h2 id="“先给对方支付”"><a href="#“先给对方支付”" class="headerlink" title="“先给对方支付”"></a>“先给对方支付”</h2><p>在 “先给对方支付” 交易中，Bob 可以立即花费属于他的输出，但 Alice 受到 <a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8"><strong>RSM Contract</strong></a> 的约束。这种交易对 Bob 更有好处。你可以在<a target="_blank" rel="noopener" href="https://bitcoincore.tech/apps/bitcoinjs-ui/index.html?&tx_note=Sample%20of%20a%20Commitment%20Transaction%20used%20in%20Lightning%20Network.&tx_input_0_note=Spend%20from%20the%20Funding%20Transaction&tx_input_0_script_note=This%20script%20unlocks%20a%20P2WSH.%20Click%20the%20%27Edit%27%20button%20and%20manually%20set%20the%20type%20to%20P2WSH%20in%20order%20to%20view%20the%202-of-2%20multisig%20script.&tx_output_0_note=%5BTo%20Local%5D%20Output%20sends%20funds%20back%20to%20the%20owner%20(Bob)%20of%20this%20commitment%20transaction%20and%20thus%20must%20be%20timelocked%20using%20%60OP_CHECKSEQUENCEVERIFY%60.%20It%20can%20be%20claimed,%20without%20delay,%20by%20the%20other%20party%20if%20they%20know%20the%20revocation%20private%20key.&tx_output_0_script_note=This%20is%20the%20%22naked%22%20unwrapped%20Revocable%20Sequence%20Maturity%20Contract%20(RSMC).%20In%20order%20to%20see%20the%20final%20form,%20click%20the%20%27Edit%27%20button%20and%20%27Wrap%20in%20P2WSH%27.&tx_output_1_note=%5BTo%20Remote%5D%20Output%20sends%20funds%20to%20the%20other%20party.%20If%20%60option_anchor_outputs%60%20applies%20to%20the%20commitment%20transaction,%20the%20%60to_remote%60%20output%20is%20encumbered%20by%20a%20one%20block%20csv%20lock.%20Otherwise,%20this%20output%20is%20a%20simple%20P2WPKH%20to%20remotepubkey.&tx_output_1_script_note=This%20is%20the%20%22naked%22%20unwrapped%20Contract%20that%20pays%20Bob%20with%20no%20restrictions.%20In%20order%20to%20see%20the%20final%20form,%20click%20the%20%27Edit%27%20button%20and%20%27Wrap%20in%20P2WSH%27.&tx_output_2_note=%5BLocal%20Anchor%5D%20Output%20can%20be%20spent%20by%20the%20local%20node%20to%20provide%20incentive%20to%20mine%20the%20transaction,%20using%20child-pays-for-parent.&tx_output_3_note=%5BRemote%20Anchor%5D%20Output%20can%20be%20spent%20by%20the%20remote%20node%20to%20provide%20incentive%20to%20mine%20the%20transaction,%20using%20child-pays-for-parent.&tx_hex=02000000000101bef67e4e2fb9ddeeb3461973cd4c62abb35050b1add772995b820b584a4884890000000000ffffffff04e48d6a00000000004d632103f9b004476ef731bac15887882b99c8756d2451800674e4b9f42d2effde4bebc567029000b27521034e0ec6dc63301141448af127eb2d8eba26e8c2bb24d4bfdf8e29afa7bb02657b68acc0c62d00000000002521034f355bdcb7cc0af728ef3cceb9615d90684bb5b2ca5f859ab0f0b704075871aaad51b24a010000000000002200202b1b5854183c12d3316565972c4668929d314d81c5dcdbb21cb45fe8a9a8114f4a01000000000000220020e9e86e4823faa62e222ebc858a226636856158f07e69898da3b0d1af0ddb39940340ca3e2b815f7bf548fa59a79002d8093ee786b38803704130a589f749c33552145a36440a0d7d407dee948c85c2f20e4892479075cf2f166e94c2e6309907971440f89034eba16b2be0e5581f750a0a6309192b75cce0f202f0ee2b4ec0cc39485076c65dc507fe42276152b7a3d90e961e678adbe966e916ecfe85e64d430e75f3475221023da092f6980e58d2c037173180e9a465476026ee50f96695963e8efe436f54eb21030e9f7b623d2ccc7c9bd44d66d5ce21ce504c0acf6385a132cec6d3c39fa711c152ae00000000">这里</a>看到这种交易的一个例子。</p><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/FTV5tcQ.png" alt="The Pay-Other-First transaction created by Alice"></p><p style="text-align:center">- Alice 创建的 <strong>“先给对方支付”</strong> 的交易 -</p><p><strong>注意</strong>：交易的输出<a target="_blank" rel="noopener" href="https://github.com/bitcoin/bips/blob/master/bip-0069.mediawiki">按数额大小的升序排列</a>。</p><p>Alice <strong>只会</strong>给 Bob 发送 “先给自己（Alice）支付” 交易的签名，但<strong>不会</strong>给 Bob 提供 “先给对方支付” 交易的签名。</p><p>Alice 会给 “先给对方支付” 交易签名的<strong>唯一可能性</strong>，就是她自己想把这笔交易广播到比特币网络中（而不是发送给 Bob）。</p><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/nGsZsrw.gif" alt="img"></p><p>“给对方支付” 交易的两个输出也叫 “<a target="_blank" rel="noopener" href="https://github.com/lightningnetwork/lightning-rfc/blob/master/03-transactions.md#to_local-output"><strong>to_local</strong></a>（发给本地）”（即发回给 Alice 的） 和 “<a target="_blank" rel="noopener" href="https://github.com/lightningnetwork/lightning-rfc/blob/master/03-transactions.md#to_remote-output"><strong>to_remote</strong></a>（发给远端）”（即发给 Bob 的）。</p><p>类似地，Bob 也会创建一笔 “先给自己支付” 交易和一笔 “先给对方支付” 交易。</p><h2 id="通道状态更新-——-逐步分解"><a href="#通道状态更新-——-逐步分解" class="headerlink" title="通道状态更新 —— 逐步分解"></a>通道状态更新 —— 逐步分解</h2><p>现在我们来仔细看看在 Alice 要通过闪电网络支付通道给 Bob 支付 0.02 BTC 时，整个过程是什么样的。</p><p>下面就是 Alice 和 Bob 把余额状态从（Alice：0.10 BTC，Bob：0.0 BTC）转变成（Alice：0.08 BTC，Bob：0.02 BTC）的步骤。</p><p>由发起支付的一方先启动整个流程，在我们这个案例中就是 Alice。</p><h3 id="Alice-构建和签名"><a href="#Alice-构建和签名" class="headerlink" title="Alice 构建和签名"></a>Alice 构建和签名</h3><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/ZREN9PA.png" alt="Alice builds and signs her Pay-Me-First transaction"></p><p style="text-align:center">- Alice 创建和签名她的 “先给自己支付” 交易 -</p><ol><li><p><code>BuildPayMeFirstTx( alice)</code> —— Alice 构建一笔交易，<strong>不加任何限制</strong>地给自己支付 0.08 BTC、同时使用 <a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8"><strong>RSM 合约</strong></a> 给 Bob 支付 0.02 BTC。我们将这笔交易命名为 <code>payAliceFirstTx</code> 。</p></li><li><p><code>Sign(payAliceFirstTx)</code> —— Alice 签名 <code>payAliceFirstTx</code> 并创建一个相应的签名，我们把这个签名命名为 <code>payAliceFirstSignature</code> 。</p></li><li><p><code>Send(payAliceFirstSignature)</code> —— Alice 发送 <code>payAliceFirstSignature</code> 给 Bob。发送这个签名不会带来任何风险。最坏的情形也只是 Bob 会广播 <code>payAliceFirstTx</code>并关闭这个通道，这对 Alice 来说也没啥问题，因为她立即就能花费自己的输出，而 Bob 还必须等待。</p><p>在广播 <code>payAliceFirstTx</code> 的同时，Bob 也暴露了他从 Alice 处收到了 0.02 BTC 的事实。如果 Bob 并不把 <code>payAliceFirstTx</code> 广播出去，只是没有响应，那么 Alice 可以安全地把前一笔承诺事务广播（表示<strong>状态 01</strong>）（译者注：即通道原来的余额状态）出去，在那个状态中她拥有更多的余额，而且因为她还没有撤销那笔承诺交易，也没有被惩罚的风险。（译者注：如此操作即是不给 Bob 支付，以当前的状态退出合约）</p></li></ol><h3 id="Bob-检查和撤销"><a href="#Bob-检查和撤销" class="headerlink" title="Bob 检查和撤销"></a>Bob 检查和撤销</h3><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/ToHsj1w.png" alt="Bob checks the signature from Alice and revokes the previous state"></p><ol start="4"><li><p><code>Receive(payAliceFirstSignature)</code> —— Bob 收到了 <code>payAliceFirstSignature</code> 消息。注意，Alice 只发送了签名，没有发送完整的交易，因为 Bob 可以自己重构出完全相同的交易。</p></li><li><p><code>BuildPayOtherFirstTx(alice)</code> —— Bob 构建了使用 <a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8">RSM Contract</a> 给自己支付 0.02 BTC 以及不加限制给 Alice 支付 0.08 BTC 的交易。对 Bob 来说，这是 “先给对方支付” 交易，它跟 Alice 构建的 <code>payAliceFirstTx</code> 其实一模一样。</p></li><li><p><code>CheckSignature(payOtherFirstTx, payAliceFirstSignature)</code> —— Bob 检查从 Alice 处收到的签名（ <code>payAliceFirstSignature</code> ）对他刚刚构建的交易（也即 <code>payAliceFirstTx</code>）确实有效。如果来自 Alice 的签名是有效的，那就意味着 Bob 收到了一笔有效的承诺事务（表示<strong>状态 02</strong>）。他可以继续使用通道，也可以加上自己的签名并广播出去，从而关闭通道。</p></li><li><p><code>Store(payAliceFirstSignature)</code> —— Bob 将签名和让他能够重构 <code>payAliceFirstTx</code> 的数据一起持久化保存。如果 Alice 离线没有响应，Bob 可能会用上这些数据。</p></li><li><p><code>BuildRevokeCommitmentMsg()</code> —— Bob 不需要存储更旧的状态（因为在更旧的状态中他的余额更少）所以他希望让<strong>状态 02</strong>（ <code>payAliceFirstTx</code> ）变成当前的状态，并撤销（作废）旧的状态（<strong>状态 01</strong>）。他构建了一条 <code>revokeMessage</code> 来作废<strong>状态 01</strong>。</p></li><li><p><code>Send(revokeMessage)</code> —— Bob 发送 <code>revokeMessage</code> 给 Alice，这对他来说没有风险，因为他作废的是旧的状态（<strong>状态 01</strong>）。最糟糕的情况是 Alice 变得没有响应，而 Bob 不得不广播 <code>payAliceFirstTx</code> 交易。</p><p>通过作废旧的状态（<strong>状态 01</strong>），Bob 向 Alice 保证了做接下来的操作是没有问题的。</p></li></ol><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/4jLEywQ.png" alt="Alice receives the revocation message for State01"></p><p style="text-align:center">- Alice 收到了状态 01 的作废消息 -</p><ol start="10"><li><p><code>ReceiveRevokeMsg(revokeMessage)</code> —— Alice 收到了来自 Bob 的撤销消息。Alice 现在有了惩罚 Bob 的能力，如果 Bob 把旧的承诺事务（代表<strong>状态 01</strong>）广播出去的话。</p><p>她尚未作废自己的当前状态，因为她还没有收到 Bob 对<strong>状态 02</strong> 的签名。</p></li></ol><h3 id="Bob-构建和签名"><a href="#Bob-构建和签名" class="headerlink" title="Bob 构建和签名"></a>Bob 构建和签名</h3><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/cidRAdQ.png" alt="Bob builds and signs the Pay-Me-First transaction"></p><p style="text-align:center">- Bob 构建和签名 “先给自己支付” 交易 -</p><ol start="11"><li><code>BuildPayMeFirstTx(bob)</code> —— Bob <strong>不会签名</strong> <code>payAliceFirstTx</code> 交易并发送给 Alice，这笔交易对他是<strong>不利的</strong>，因为他必须遵守 <a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8">RSM 合约</a>但 Alice 可以立即把属于自己的钱拿走。更重要的是，如果签名了这笔交易，他就<strong>没有了惩罚 Alice 的能力</strong>，即使 Alice 在未来趁着 <code>payAliceFirstTx</code> 对自己有利（余额更多）的时候把它广播出去，Bob 也无能为力。因此，Bob 构建了一笔<strong>不设任何限制</strong>给自己支付，但使用 <a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8">RSM 合约</a>来给 Alice 支付的交易。这笔交易我们叫 <code>payBobFirstTx</code> 交易。</li><li><code>Sign(payBobFirstTx)</code> —— Bob 创建 <code>payBobFirstTx</code> 交易的签名，即 <code>payBobFirstSignature</code> 。</li><li><code>Send(payBobFirstSignature)</code> —— Bob 把 <code>payBobFirstSignature</code>消息发送给 Alice。</li></ol><h3 id="Alice-检查和作废"><a href="#Alice-检查和作废" class="headerlink" title="Alice 检查和作废"></a>Alice 检查和作废</h3><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/6gy0eFQ.png" alt="img"></p><ol start="14"><li><code>Receive(signatureBob)</code> —— Alice 收到 <code>payBobFirstSignature</code> 消息。注意 Bob 只需发送签名，无需发送完整的交易，因为 Alice 可以重构出完全相同的交易。</li><li><code>BuildPayOtherFirstTx(bob)</code> —— Alice 构建出使用 <a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8">RSM 合约</a>给自己支付 0.08 BTC、不设限制给 Bob 支付 0.02 BTC 的交易。对 Alice 来说，这是 “先给对方支付” 交易，它跟 Bob 构建的 <code>payBobFirstTx</code> 其实一模一样。</li><li><code>CheckSignature(payOtherFirstTx, signatureBob)</code> —— Alice 检查从 Bob 处收到的签名（ <code>payBobFirstSignature</code> ）对她刚刚构建的交易（也即 <code>payBobFirstTx</code>）确实有效。如果来自 Bob 的签名是有效的，那就意味着 Alice 收到了一笔有效的承诺事务（表示<strong>状态 02</strong>）。她可以继续使用通道，也可以加上自己的签名并广播出去，从而关闭通道。如果 Alice 选择广播出这笔交易，Bob 可以立即拿走属于自己的资金，而她只能等待 <a target="_blank" rel="noopener" href="https://motorina0.medium.com/rsm-contracts-f690cfdf04e8">RSM 合约</a>过时。</li><li><code>Store(signatureBob)</code> —— Alice 将签名和让她能够重构 <code>payBobFirstTx</code> 的数据一起持久化保存。如果 Bob 离线没有响应，Alice 可能会用上这些数据。</li><li><code>BuildRevokeCommitmentMsg()</code> —— Alice 构建 <code>revokeMessage</code>，如果她尝试广播旧状态（<strong>状态 01</strong>，也就是她还有 0.10 BTC 的状态），她就会受到惩罚。</li><li><code>Send(revokeMessage)</code> —— Alice 发送 <code>revokeMessage</code> 给 Bob。她现在可以认为支付已经完成了，支付通道的状态已经更新成<strong>状态 02</strong> 了。</li></ol><p><img src="//res.btcstudy.org/btcstudy/images/updating-the-balance-of-a-payment-channel/8kezLyA.png" alt="img"></p><ol start="20"><li><code>Receive(revokeMessage)</code> —— Bob 收到来自 Alice 的 <code>revocationMessage</code>。现在他可以认为支付已经完成了，支付通道的状态已经更新成<strong>状态 02</strong> 了。</li></ol><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1673504754531"></script><script src="/js/highlight.min.js?v=1673504754531"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/btcstudy">Twitter</a><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml">rss</a><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/btcstudyorg">Telegram</a></section></footer><script async src="/js/buttons.js?v=1673504754531"></script><script async src="/js/index.js?v=1673504754531"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script></body></html>