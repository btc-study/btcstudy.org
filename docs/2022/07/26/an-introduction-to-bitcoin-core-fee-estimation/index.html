<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>Bitcoin Core 手续费估计算法简介</title><meta name="keywords" content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name="description" content="比特币思想的中文集结地"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css?v=1676011583053"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/style/common/iconfont.css?v=1676011583053"><link rel="stylesheet" href="/style/base.css?v=1676011583053"><link rel="stylesheet" href="/style/common/helper.css?v=1676011583053"><link rel="stylesheet" href="/style/themes/animation.css?v=1676011583053"><script>function ready() {
  var bodyEl = document.querySelector('.body-container');
  var theme = localStorage.getItem('theme') || 'light';
  if (!['light', 'dark'].includes(theme)) {
    theme = 'light';
    localStorage.setItem('theme', 'light');
  }
  bodyEl.classList.remove('appearance-auto');
  bodyEl.classList.add('appearance-' + theme);
  quickInitialTheme();
}
function quickInitialTheme() {
  var theme = localStorage.getItem('theme') || 'light';
  var logoLightEl = document.querySelector('.logo-light');
  var logoDarkEl = document.querySelector('.logo-dark');
  
  var mLogoLightEl = document.querySelector('#mobile-header-logo > .logo-light');
  var mLogoDarkEl = document.querySelector('#mobile-header-logo > .logo-dark');
  var themeBtnEl = document.getElementById('theme-btn');
  
  var slideThemeLightEl = document.querySelector('.slide-theme-light');
  var slideThemeDarkEl = document.querySelector('.slide-theme-dark');
  
  document.body.classList.add(theme);
  if (theme === 'dark') {
    logoLightEl.classList.add('hidden');
    logoDarkEl.classList.remove('hidden');
    
    mLogoLightEl.classList.add('hidden');
    mLogoDarkEl.classList.remove('hidden');
    
    themeBtnEl.classList.remove('icon-icon_dark');
    themeBtnEl.classList.add('icon-icon_light');
    
    slideThemeLightEl.classList.remove('hidden');
  } else {
    slideThemeDarkEl.classList.remove('hidden');
  }
}
document.addEventListener("DOMContentLoaded", ready);</script><script src="/js/common.js?v=1676011583053"></script><script src="/js/libs/zepto.min.js"></script><link rel="stylesheet" href="/style/post.css?v=1676011583053"><link rel="stylesheet" href="/style/themes/highlight.css?v=1676011583053"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="BTC Study" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column" onload="initialTheme()"><div class="clip"></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id="header"><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href="/"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id="header-menu"><a class="is-inline-block header-activity mr-4" href="/">首页</a><a class="is-inline-block mr-4" href="/archives">全站目录</a><a class="is-inline-block mr-4" href="/tags">标签</a><a class="is-inline-block mr-4" href="/maps">地图</a><a class="is-inline-block mr-4" href="/mempool">mempool</a><a class="is-inline-block mr-4" target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input" type="range" min="12" max="32" step="2"></div></div></div><i class="iconfont icon-icon_dark mr-1" id="theme-btn"></i><div class="search-wrap"><input class="pl-3" id="search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search" id="search-input-btn"></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Bitcoin Core 手续费估计算法简介</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn2"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input2" type="range" min="12" max="32" step="2"></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id="mobile-header"><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id="mobile-header-logo"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopicMobile"><p class="is-full-height">Bitcoin Core 手续费估计算法简介</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class="mobile-search-wrap"><div class="search-input"><input class="pl-3" id="mobile-search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class="mobile-search-input-btn">搜 索</button></div></div></header><div class="mobile-slide-menu"><a class="header-activity" href="/">首页</a><a href="/archives">全站目录</a><a href="/tags">标签</a><a href="/maps">地图</a><a href="/mempool">mempool</a><a target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class="slide-menu-fontsize"><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1676011583053"> </script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89%E6%89%8B%E7%BB%AD%E8%B4%B9%EF%BC%9F"><span class="toc-text">为什么要有手续费？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BD%95%E6%89%8B%E7%BB%AD%E8%B4%B9%E4%BC%B0%E8%AE%A1%E6%98%AF%E4%B8%80%E4%B8%AA%E9%9A%BE%E9%A2%98"><span class="toc-text">为何手续费估计是一个难题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%8D%B3%E6%97%B6%E4%BA%A4%E6%98%93%E6%B1%A0%E7%9A%84%E6%89%8B%E7%BB%AD%E8%B4%B9%E4%BC%B0%E8%AE%A1"><span class="toc-text">基于即时交易池的手续费估计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%8E%86%E5%8F%B2%E5%8C%BA%E5%9D%97%E7%9A%84%E6%89%8B%E7%BB%AD%E8%B4%B9%E4%BC%B0%E8%AE%A1"><span class="toc-text">基于历史区块的手续费估计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%BA%A4%E6%98%93%E6%B1%A0%E5%8E%86%E5%8F%B2%E7%9A%84%E6%89%8B%E7%BB%AD%E8%B4%B9%E4%BC%B0%E8%AE%A1"><span class="toc-text">基于交易池历史的手续费估计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bitcoin-Core-%E5%A6%82%E4%BD%95%E4%BC%B0%E8%AE%A1%E6%89%8B%E7%BB%AD%E8%B4%B9%EF%BC%88v0-15-%E4%BB%A5%E5%89%8D%EF%BC%89"><span class="toc-text">Bitcoin Core 如何估计手续费（v0.15 以前）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9Abucket-%E5%92%8C-target"><span class="toc-text">概念：bucket 和 target</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%9F%E8%B8%AA"><span class="toc-text">跟踪</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E4%B8%BB%E6%B5%81%E6%89%8B%E7%BB%AD%E8%B4%B9%E7%8E%87%E7%9A%84%E5%8F%98%E6%9B%B4"><span class="toc-text">响应主流手续费率的变更</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#estimateSmartFee-%EF%BC%9A%E4%B8%80%E4%B8%AA%E6%9C%89%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-text">estimateSmartFee()：一个有用的接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-text">结论</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id="postTitle">Bitcoin Core 手续费估计算法简介</h1><div class="page-author"><div class="is-flex is-flex-direction-row page-data mr-6"><img class="mr-1" src="//res.btcstudy.org/btcstudy/images/default_avatar.png" alt="John Newbery"><div class="page-author-info"><strong>John Newbery</strong><time class="has-text-grey" datetime="2022-07-26T06:45:20.000Z">2022-07-26</time></div></div><div class="is-flex"><a href="/tags/%E5%BC%80%E5%8F%91"><i class="page-tag mr-1 px-1">开发<!-- 订正图片路径--></i></a></div></div><article class="mt-4 post-content"><blockquote>
<p><em>作者：John Newbery</em></p>
<p><em>来源：<a target="_blank" rel="noopener" href="https://bitcointechtalk.com/an-introduction-to-bitcoin-core-fee-estimation-27920880ad0">https://bitcointechtalk.com/an-introduction-to-bitcoin-core-fee-estimation-27920880ad0</a></em></p>
</blockquote>
<h2 id="为什么要有手续费？"><a href="#为什么要有手续费？" class="headerlink" title="为什么要有手续费？"></a>为什么要有手续费？</h2><p>比特币的区块空间是一种有限的资源，只要价格够低，需求量就一定会超过供给量。假如区块空间是免费的，人们会极尽利用之能事 —— 去中心化赌博啦、上传比特币白皮书的完整备份啦、带时间戳的个人文件啦，都是已经出现过的一些例子。</p>
<p>为了确保有限的区块空间被安排给对它评价最高的人（也就是愿意为之支付最高价格的人），比特币设置了一个手续费市场。实际上，交易池（mempool）就像一个去中心化的清算所（clearinghouse）—— 用户将对区块空间的竞标价格放到交易池中（形式是附加了手续费的交易），而矿工会基于交易所附加的手续费选择交易、放到下一个区块中。你给出的手续费越多，你的交易 “打败” 其他人的交易 —— 矿工选择在下一个区块中包含你的交易而非其他人的交易 —— 的几率也就越大。</p>
<h2 id="为何手续费估计是一个难题"><a href="#为何手续费估计是一个难题" class="headerlink" title="为何手续费估计是一个难题"></a>为何手续费估计是一个难题</h2><p>用户怎么知道给出多高的手续费是合适的呢？事实证明这是一个非常难的问题，原因如下：</p>
<ul>
<li><strong>供给是不可预测的</strong>。从较长的时间尺度看，供给是可以预测的。每 10 分钟就能供给大约 2 MB 的区块空间（更准确地来说，每 10 分钟供给 400 万的 block weight）（译者注：“weight” 是比特币在隔离见证升级后使用的度量交易体积的单位）。但因为区块出现的概率是泊松分布的（Poisson distribution），所以在较短的时间尺度上，供给是不稳定且不可预测的。每 100 个区块中，就有一个是在前一个区块挖出后的 7 秒内出现的，还有一个是花了 45 分钟才挖出的。也就是说，我们可能很 “幸运”，几分钟之内就挖出了好多个块，从而交易池内所有的高手续费交易都清空了。另一方面，也有可能一个半小时（甚至更长时间）都出不了一个块，这时候，交易池会逐渐塞满支付更高手续费的交易。</li>
<li><strong>需求也是不可预测的</strong>。我们确实可以在交易流中看到循环 —— 周末通常比工作日要更 “安静”，所以交易池会更空，手续费也更低。但是，就像供给端一样，短期内的需求也是不可预测的。举个例子，即使在周末，需求也会在比特币价格剧烈波动时突然高涨。</li>
<li><strong>不同的用户有不同的要求</strong>。就像任何市场一样，每个参与者都有不同的 “购买” 区块空间的理由。我可能由一笔非常紧急的交易，希望在接下来半个小时内确认，或者我希望在接下来 6 个小时内关闭一个过期的智能合约，又或者，我想要给一些东西打上时间戳，只要在接下来几周内确认就好。也许并没有一个手续费估计模型能够适应所有场景的需要。</li>
</ul>
<p>因此，为一个特定的场景估计合适的手续费，是非常困难的，但它又是一个可用的系统的非常重要的方面。要是为你估计的手续费太高，你每次发出比特币交易都会浪费一点钱。要是为你估计的手续费太低，你的交易可能就无法在你想要的时间内确认，这样的系统用起来也会很费劲。</p>
<p>我们可以根据多种数据点来估计手续费。现在我们回过头来看看它们。注意，这些手续费估计技术会被用于全验证节点。我们需要打开交易池、下载完整的区块链，以便基于网络中可以观测到的事件来估计手续费。</p>
<h3 id="基于即时交易池的手续费估计"><a href="#基于即时交易池的手续费估计" class="headerlink" title="基于即时交易池的手续费估计"></a>基于即时交易池的手续费估计</h3><p>一种简单的手续费估计算法会检查你的交易池，并将你的交易手续费设置成使你的交易位于支付最高手续费的前 2MB 交易队列的末尾。你可能会期待这样的策略足以使你的交易在下一个区块得到确认。然而，因为下面的原因，事情不会这么简单：</p>
<ul>
<li>最新的交易可能不会进入下一个区块链。在你提出你的交易的时候，矿工可能已经在挖掘下一个区块了。矿工会不会在下一个区块包含你的交易，取决于他们刷新所挖区块的内容的方式。、</li>
<li>无论你在什么时候把交易发到交易池中，你要等待下一个区块出现的时间的期望值都是 10 分钟。这是区块出现所遵循的泊松分布的一个基本（但经常被误解）的属性。即使你在上一个区块挖出的 8 分钟后将交易发到交易池中，预计你要等待的时间不是 2 分钟 —— 是 <em>另一个 10 分钟</em>。因此，你不是在跟现在位于交易池中交易相竞争，你是在跟接下来（大约）10 分钟内将出现在交易池中的交易相竞争。</li>
<li>仅观察交易池的瞬时状态并没有考虑到区块可能会很快出现或者很慢出现。它也许能告诉你，为使你的交易被打包到下一个（或再下一个）区块中，你应该给出多少的手续费；但它无法告诉你，如果你只需要在接下来 100 个或 200 个区块内打包交易，只需给出多少手续费。</li>
<li>实际上并没有 <em>统一的</em> 交易池。每个节点都维护着自己的交易池，池中的内容因为许多因素而有所不同，例如它运行的时间、它跟其它节点的联通性、它本地的交易池策略，等等。你在自己的交易池中看到的情形，未必是矿工交易池中的情形。</li>
</ul>
<p>因为这些原因，仅靠对交易池情形的瞬时捕捉，不足以给出估计手续费所需的充分信息。</p>
<h3 id="基于历史区块的手续费估计"><a href="#基于历史区块的手续费估计" class="headerlink" title="基于历史区块的手续费估计"></a>基于历史区块的手续费估计</h3><p>这种方法乍看起来似乎更加合理，因为区块链本身就是交易被纳入的不可篡改的记录。但是，如果我们只看历史区块，我们的手续费估计算法就可以轻易被矿工玩弄。矿工可以用私人的、高手续费的交易塞满区块。只看历史区块的算法将被欺骗、一直提高估计值，因为看起来只有更高的手续费才能被区块确认。</p>
<p>这对矿工来说是非常便宜的攻击，因为对他们来说，成本只是因此排除掉的真实交易所支付的手续费。如果我们的手续费估计算法只将先在交易池中出现、然后得到区块确认的交易纳入计算，则矿工的成本会大大提高，攻击也会变得更不可行。矿工将不得不先广播自己的高手续费率交易，因此将承担交易被其他矿工打包、自己真的支付手续费的风险。</p>
<h3 id="基于交易池历史的手续费估计"><a href="#基于交易池历史的手续费估计" class="headerlink" title="基于交易池历史的手续费估计"></a>基于交易池历史的手续费估计</h3><p>因此，Bitcoin Core 考虑交易池中交易的历史数据 <em>以及</em> 最新区块中的交易数据。只要我们拥有过去交易的足够大的样本，我们就可以精确地估计让交易在确定区块数量内上链所需的手续费。</p>
<h2 id="Bitcoin-Core-如何估计手续费（v0-15-以前）"><a href="#Bitcoin-Core-如何估计手续费（v0-15-以前）" class="headerlink" title="Bitcoin Core 如何估计手续费（v0.15 以前）"></a>Bitcoin Core 如何估计手续费（v0.15 以前）</h2><p><em>注 1：Bitcoin Core 的手续费估计法相当复杂。本文只能简单介绍该手续费估计算法背后的概念，也作出了一些简化。想了解更多细节，请看 Alex Morcos 的《<a target="_blank" rel="noopener" href="https://gist.github.com/morcos/d3637f015bc4e607e1fd10d8351e9f41">手续费估计算法的概要讲解</a>》 ；若想获得全部细节，请看<a target="_blank" rel="noopener" href="https://gist.github.com/morcos/d3637f015bc4e607e1fd10d8351e9f41">代码本身</a>。</em></p>
<p><em>注 2：本文仅介绍 Bitcoin Core v0.14 的手续费估计算法。从 v0.15 开始，这套算法有了许多更改，我会在下一篇文章中讲解。</em></p>
<h3 id="概念：bucket-和-target"><a href="#概念：bucket-和-target" class="headerlink" title="概念：bucket 和 target"></a>概念：bucket 和 target</h3><p>我们将从介绍该算法所用的一些概念开始：<em>bucket</em>（直译为 “桶”）和 <em>target</em>（直译为 “目标”）。</p>
<p>比特币交易的手续费率会落在一个从  <code>1 聪/字节</code> 到  <code>几百聪/字节 </code> 的区间中，一些异常值甚至会更大（见 <a target="_blank" rel="noopener" href="https://core.jochen-hoenicke.de/queue/#24h">Jochen Hoenicke 的当前交易池情形可视化</a>）。跟踪每一笔交易的手续费率会消耗大量的计算和存储空间，所以 Bitcoin Core 做的第一件事是根据手续费率将这些交易分组，分到 “桶” 里面，每个 “桶” 都对应着一个手续费率区间。有点像 Jochen 的可视化工具，按手续费高低将交易分组并标上不同的颜色。</p>
<p>Bitcoin Core 希望能够对非常大的手续费率区间作出估计，所以手续费最低的一个 “桶” 包含的是从 1 聪&#x2F;字节 到 1.1 聪&#x2F;字节的交易（1.1 比 1 高出 10%），下一个桶包含的是从 1.1 聪&#x2F;字节到 1.21 聪&#x2F;字节的交易（1.21 又比 1.1 高出 10%），再下一个桶是从 1.21 到比 1.21 高出 10% 的值，以此类推。这个指数上升的间隔一直延伸到 10000 聪&#x2F;字节。最后一个 “桶” 容纳高于 9400 聪&#x2F;字节 的交易。按照今天的汇率（4200 美元）计算，这么高的费率意味着一笔中等大小的交易（225 字节）需要支付 88 美元。</p>
<p>第二个概念是一笔交易进入交易池时候的区块号与被确认的区块号的差值。我们管它叫 “目标”（因为我们也会把这个值用在估计一笔交易需要附加多少的手续费才能在一定数量（<em>目标</em>）的区块内得到确认。</p>
<h3 id="跟踪"><a href="#跟踪" class="headerlink" title="跟踪"></a>跟踪</h3><p>为了估计一笔交易需要附加多少手续费，才能在一定数量的区块内得到确认，Bitcoin Core 存储着一个交易从进入交易池到进入区块的历史纪录。该记录跟踪：</p>
<p><strong>A</strong>. 每一个手续费率 “桶” 内的交易数量；以及</p>
<p><strong>B</strong>. 对任意的 “桶”-“目标” 对，成功在目标数量区块内进入区块链的交易数量</p>
<p>对任意的 “桶”-“目标” 对，Bitcoin Core 可以找出该桶内的一笔交易在目标个区块内加入区块链的概率，即以 B 除以 A。</p>
<h3 id="响应主流手续费率的变更"><a href="#响应主流手续费率的变更" class="headerlink" title="响应主流手续费率的变更"></a>响应主流手续费率的变更</h3><p>比特币网络是一个动态变化的系统，而且主流的手续费率会持续变化（若不是如此，我们也完全不需要估计手续费了！！）。我们希望手续费估计算法能响应主流手续费率的变化，并为近期发生的事件赋予更高的权重，因此它们更有可能暗示了未来的手续费率。</p>
<p>因此，Bitcoin Core 是有了一个 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Moving_average#Exponential_moving_average"><em>指数加权的移动平均值</em></a>，简单来说，就是更关注较新的区块而不是较老的区块。每次 Bitcoin Core 收到一个区块时，它就给旧区块的计数器乘以一个 0.998 的 <em>衰减值</em>（等价于设置了 346 个区块的 <em>半衰期</em>）。这意味着，当一个区块成为过去，它在我们的手续费估计算法中的权重会不断下降。2.4 天以前的一个区块，权重大概是最新区块的一半。而 4.8 天以前的区块的权重则是最新区块的 1&#x2F;4，7.2 天前的则是 1&#x2F;8，等等。</p>
<p>注意，这个移动平均值是独立于前面提到的 24 个区块的目标区间的。我们仅对小于等于 24 的交易上链目标数量感兴趣，但我们会使用往前追溯许多区块的历史数据。</p>
<h3 id="estimateSmartFee-：一个有用的接口"><a href="#estimateSmartFee-：一个有用的接口" class="headerlink" title="estimateSmartFee()：一个有用的接口"></a>estimateSmartFee()：一个有用的接口</h3><p>为了创建一个有用的接口，我们需要知道用户想问的问题是什么。比特币用户几乎肯定不会问：</p>
<blockquote>
<p>要是我为自己的交易附加一个位于 X 桶的手续费率，它在 Y 个区块内得到确认的概率是多少？</p>
</blockquote>
<p>相反，他们想知道的是：</p>
<blockquote>
<p>如果我想让自己的交易在 Y 个区块内确认，我该附加多少的手续费呢？</p>
</blockquote>
<p><strong>estimateSmartFee()</strong> 就是被设计用来干这件事的，其工作流程如下：</p>
<ol>
<li>用户提供一个期望交易能够确认的目标区块数量。</li>
<li>对该目标数量，检查手续费最高（高于 9400 聪&#x2F;字节）的桶，然后验证，若使用这个费率，则交易能在目标个区块内在确认的概率超过 95%（要是该验证出错，那我们的麻烦就大了 —— 这意味着我们甚至支付 9400 聪&#x2F;字节 的天文数字都不足以让交易上链。还记得吗，按当前的汇率这表示中等大小的交易需要支付约 88 美元）。</li>
<li>检查次高的桶（大约是 8600~9400 聪&#x2F;字节），然后验证，若使用这个费率，则交易能在目标个区块内在确认的概率超过 95% 。</li>
<li>以此类推，逐步往下检查，直到发现一个桶，其在目标个区块内确认的概率是低于 95% 的。</li>
<li>取上一个桶（即能以 95% 的概率让交易在目标个区块内确认的最低价格的桶），并返回桶内所有交易的手续费中位数。</li>
</ol>
<p>在计算每一个 目标-桶 对的概率时，算法都足够聪明，它可以确保有足够大的交易样本。这意味着，即使少数的高手续费交易因为某些理由而没有被确认，手续费估计算法也不会失效。</p>
<p>我们使用 95% 的高阈值，是因为我们希望估计算法可以告诉我们，使用哪一档的费率可以几乎保证交易能在目标区块内被确认。手续费估计算法并无为何一笔交易被打包的完美知识（举个例子，也许矿工为特定一族交易开了后门，使它们能比使用相同和更低费率的交易更快被确认），所以我们虽然设置了很高的标准，但没有设成 100%。</p>
<p><strong>estimateSmartFee()</strong> 被 <strong>estimatesmartfee</strong>、<strong>sendtoaddress</strong> 和 <strong>sendmany</strong> 三种 RPC 方法使用，也会在图形界面中发送交易时使用。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>手续费估计是一个难题。手续费估计算法，本质上是基于一个不完整的、关于过去的图片，来回答关于未来的问题。尚不清楚我们能如何度量不同手续费估计算法的性能，一部分原因是不同用户对系统有不同的要求。更进一步地说，比特币的手续费市场也是持续变化的，今天成功的算法未必能在更大的系统层变更之后依然成功（例如，出现了同样使用 SHA-256 挖矿的另一种币、隔离见证交易的出现、整体需求和交易池情形出现了长期变化，等等）。Bitcoin Core 提供了一种适合于大部分用户、适应于大部分手续费市场情形的估计算法。其它钱包软件可能使用不同的办法来估计手续费，在特定的一些场景下可能更加成功。</p>
<p>Bitcoin Core 的手续费估计算法并不想过度工程。它只记录和报告关于过去事件的有意义统计数据，并使用这些数据，为用户合理估计为使交易在一定数量的区块内确认应附加多少手续费。它并不尝试预见未来，而且也很容易解释一个估计是如何基于过去的统计数据产生出来的。它可以应对主流手续费市场的变化，并在广泛的条件下给出合理的估计。</p>
<p>更精巧的算法可能会尝试更前瞻一些。但是，算法越复杂，描述其操作和结果就越难，证明该算法可以抗操纵也越难。</p>
<p>有一些情况下，Bitcoin Core 的估计表型不是特别好，尤其是主流手续费市场出现剧烈变动的时候。Bitcoin Core v0.15 的手续费估计算法基于 v0.14 算法的框架，但做了许多优化，使之在剧烈变化的环境和异常事件中更加强健。我会在下一篇博文中介绍这些变更。【编辑：v0.15 的变化在此处可见：<a target="_blank" rel="noopener" href="https://bitcointechtalk.com/whats-new-in-bitcoin-core-v0-15-part-2-41b6d0493136%E3%80%91">https://bitcointechtalk.com/whats-new-in-bitcoin-core-v0-15-part-2-41b6d0493136】</a></p>
<p>感谢 David A. Harding 和 Jimmy Song。</p>
<p>（完）</p>
</article></div></div></main><script src="/js/post.js?v=1676011583053"></script><script src="/js/highlight.min.js?v=1676011583053"></script><script>var containerEl = document.querySelector('.post-container');
var postFontSize = localStorage.getItem('post-font-size') || '16';
var inputEl = document.querySelector('#size-change-input');
var inputEl2 = document.querySelector('#size-change-input2');
inputEl.value = postFontSize;
inputEl2.value = postFontSize;
containerEl.style.fontSize = postFontSize + 'px';
$(function(){
  function setSizeChangeInputValue(size) {
    $('.post-container').css('font-size', size + 'px');
    localStorage.setItem('post-font-size', size);
    $('#size-change-input').val(size);
    $('#size-change-input2').val(size);
  }
  $('#size-change-input').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
  $('#size-change-input2').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
});
</script><script>hljs.initHighlightingOnLoad();</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/btcstudy">Twitter</a><!-- Github--><!-- Ins--><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml">rss</a><!-- 知乎--><!-- 领英--><!-- 脸书--><!-- Telegram--><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/btcstudyorg">Telegram</a></section></footer><script async src="/js/buttons.js?v=1676011583053"></script><script async src="/js/index.js?v=1676011583053"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-JVCJ9XXG1Z');</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306";
  hm.async = true;
  hm.defer = true;
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
  </script></body></html>