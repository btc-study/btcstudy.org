<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>构造合约的元件与比特币的升级</title><meta name="keywords" content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name="description" content="比特币思想的中文集结地"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css?v=1675068536886"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/style/common/iconfont.css?v=1675068536886"><link rel="stylesheet" href="/style/base.css?v=1675068536886"><link rel="stylesheet" href="/style/common/helper.css?v=1675068536886"><link rel="stylesheet" href="/style/themes/animation.css?v=1675068536886"><script>function ready() {
  var bodyEl = document.querySelector('.body-container');
  var theme = localStorage.getItem('theme') || 'light';
  if (!['light', 'dark'].includes(theme)) {
    theme = 'light';
    localStorage.setItem('theme', 'light');
  }
  bodyEl.classList.remove('appearance-auto');
  bodyEl.classList.add('appearance-' + theme);
  quickInitialTheme();
}
function quickInitialTheme() {
  var theme = localStorage.getItem('theme') || 'light';
  var logoLightEl = document.querySelector('.logo-light');
  var logoDarkEl = document.querySelector('.logo-dark');
  
  var mLogoLightEl = document.querySelector('#mobile-header-logo > .logo-light');
  var mLogoDarkEl = document.querySelector('#mobile-header-logo > .logo-dark');
  var themeBtnEl = document.getElementById('theme-btn');
  
  var slideThemeLightEl = document.querySelector('.slide-theme-light');
  var slideThemeDarkEl = document.querySelector('.slide-theme-dark');
  
  document.body.classList.add(theme);
  if (theme === 'dark') {
    logoLightEl.classList.add('hidden');
    logoDarkEl.classList.remove('hidden');
    
    mLogoLightEl.classList.add('hidden');
    mLogoDarkEl.classList.remove('hidden');
    
    themeBtnEl.classList.remove('icon-icon_dark');
    themeBtnEl.classList.add('icon-icon_light');
    
    slideThemeLightEl.classList.remove('hidden');
  } else {
    slideThemeDarkEl.classList.remove('hidden');
  }
}
document.addEventListener("DOMContentLoaded", ready);</script><script src="/js/common.js?v=1675068536886"></script><script src="/js/libs/zepto.min.js"></script><link rel="stylesheet" href="/style/post.css?v=1675068536886"><link rel="stylesheet" href="/style/themes/highlight.css?v=1675068536886"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="BTC Study" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column" onload="initialTheme()"><div class="clip"></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id="header"><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href="/"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id="header-menu"><a class="is-inline-block header-activity mr-4" href="/">首页</a><a class="is-inline-block mr-4" href="/archives">全站目录</a><a class="is-inline-block mr-4" href="/tags">标签</a><a class="is-inline-block mr-4" href="/maps">地图</a><a class="is-inline-block mr-4" href="/mempool">mempool</a><a class="is-inline-block mr-4" target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input" type="range" min="12" max="32" step="2"></div></div></div><i class="iconfont icon-icon_dark mr-1" id="theme-btn"></i><div class="search-wrap"><input class="pl-3" id="search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search" id="search-input-btn"></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">构造合约的元件与比特币的升级</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn2"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input2" type="range" min="12" max="32" step="2"></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id="mobile-header"><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id="mobile-header-logo"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopicMobile"><p class="is-full-height">构造合约的元件与比特币的升级</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class="mobile-search-wrap"><div class="search-input"><input class="pl-3" id="mobile-search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class="mobile-search-input-btn">搜 索</button></div></div></header><div class="mobile-slide-menu"><a class="header-activity" href="/">首页</a><a href="/archives">全站目录</a><a href="/tags">标签</a><a href="/maps">地图</a><a href="/mempool">mempool</a><a target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class="slide-menu-fontsize"><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1675068536886"> </script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#BIP-119-CTV-CheckTemplateVerity"><span class="toc-text">BIP-119 CTV CheckTemplateVerity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BIP-118-APO-AnyPrevout"><span class="toc-text">BIP-118 APO AnyPrevout</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TLUV-TapLeafUpdateVerify"><span class="toc-text">TLUV TapLeafUpdateVerify</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSFS-CheckSigFromStack"><span class="toc-text">CSFS CheckSigFromStack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OP-AMOUNT"><span class="toc-text">OP_AMOUNT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SIGHASH-BUNDLE"><span class="toc-text">SIGHASH_BUNDLE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transaction-Sponsors"><span class="toc-text">Transaction Sponsors</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OP-CAT%EF%BC%88%E6%88%96%E8%80%85%E5%8F%AB-SHASTREAM%EF%BC%89"><span class="toc-text">OP_CAT（或者叫 SHASTREAM）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OP-TWEAK-x2F-ECMUL"><span class="toc-text">OP_TWEAK &#x2F; ECMUL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E7%AD%BE%E5%90%8D"><span class="toc-text">适配器签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A7%94%E6%89%98-x2F-Graftroot"><span class="toc-text">委托 &#x2F; Graftroot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BIP-300-DriveChain"><span class="toc-text">BIP-300 DriveChain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elements-%E6%93%8D%E4%BD%9C%E7%A0%81"><span class="toc-text">Elements 操作码</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id="postTitle">构造合约的元件与比特币的升级</h1><div class="page-author"><div class="is-flex is-flex-direction-row page-data mr-6"><img class="mr-1" src="//res.btcstudy.org/btcstudy/images/default_avatar.png" alt="Jeremy Rubin"><div class="page-author-info"><strong>Jeremy Rubin</strong><time class="has-text-grey" datetime="2022-05-25T10:22:25.000Z">2022-05-25</time></div></div><div class="is-flex"><a href="/tags/%E5%BC%80%E5%8F%91"><i class="page-tag mr-1 px-1">开发<!-- 订正图片路径--></i></a><a href="/tags/Eltoo"><i class="page-tag mr-1 px-1">Eltoo<!-- 订正图片路径--></i></a><a href="/tags/CTV"><i class="page-tag mr-1 px-1">CTV<!-- 订正图片路径--></i></a><a href="/tags/covenant"><i class="page-tag mr-1 px-1">covenant<!-- 订正图片路径--></i></a></div></div><article class="mt-4 post-content"><blockquote>
<p><em>作者：Jeremy Rubin</em></p>
<p><em>来源：<a target="_blank" rel="noopener" href="https://rubin.io/bitcoin/2021/12/05/advent-8/">https://rubin.io/bitcoin/2021/12/05/advent-8/</a></em></p>
</blockquote>
<p>在本文中，我们会快速浏览一些构造智能合约的元件，既包括现有的，也包括还在提议阶段的。若需要更透彻的解读，我在文内相关段落提供了链接。</p>
<h2 id="BIP-119-CTV-CheckTemplateVerity"><a href="#BIP-119-CTV-CheckTemplateVerity" class="headerlink" title="BIP-119 CTV CheckTemplateVerity"></a>BIP-119 CTV CheckTemplateVerity</h2><p>CTV 是一种通用的智能合约操作码，具有完整的枚举能力，没有动态的状态，没有递归，而且主要通过验证来工作。</p>
<p>本质上，CTV 只是让你选出一笔具体的交易作为下一笔可以发生的交易。网络仅仅检查花费交易的哈希值是否跟脚本中的 CTV 哈希值一致。</p>
<p>虽然这听起来功能非常有限，它可以用来跟模板元编程系统（比如 <a target="_blank" rel="noopener" href="https://rubin.io/bitcoin/2021/12/05/advent-8/learn.sapio-lang.org">Sapio</a>）创建出复杂的程序。</p>
<p>而且，功能有限不是个问题，是一个特性。CTV 被有意设计成能够跟整个比特币社区快速达成技术共识的样子，因为简单、安全的限制条款（covenant）系统不会出现更复杂的限制条款系统可能带有的问题。不过，自它出现以来，一些人希望开发更灵活的限制条款，而这需要更多时间来开发才能给用户带来实际的好处。</p>
<p>CTV 也被设计成能跟未来可能添加的其它操作码（比如 CSFS、OP_AMOUNT 和 OP_CAT）一起工作，所以，假设未来有更多特性被添加到比特币中，它也不会过时，反而会变得更加有用。</p>
<p>CTV 目前是一个得到了充分审核的 BIP，正在等待来自社区的更多支持以激活（见：<a target="_blank" rel="noopener" href="https://utxos.org/signals">社交信号</a>）。</p>
<p>声明：我是 BIP-119 的 作者&#x2F;支持者。</p>
<p>补充阅读：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://bitcoinops.org/en/newsletters/2019/05/29/#proposed-transaction-output-commitments">Optech</a></li>
<li><a target="_blank" rel="noopener" href="https://utxos.org/">utxos.org</a></li>
<li><a target="_blank" rel="noopener" href="https://rubin.io/blog/2021/07/02/covenants/">模板，Elstoo，限制条款，我的天！</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/block-digest-mempool/my-worries-about-too-generalized-covenants-5eff33affbb6">Shinobi 对通用限制条款的担忧</a>（<a href="https://www.btcstudy.org/2022/05/26/my-worries-about-too-generalized-covenants/">中文译本</a>）</li>
</ol>
<h2 id="BIP-118-APO-AnyPrevout"><a href="#BIP-118-APO-AnyPrevout" class="headerlink" title="BIP-118 APO AnyPrevout"></a>BIP-118 APO AnyPrevout</h2><p>AnyPrevout 是闪电网络研究的一个成果（回溯到其最初的白皮书），它可以创建一种 “可以重新绑定（rebindable）” 的比特币交易，可以极大地简化闪电网络的协议，因为它消除了围绕状态存储和单方关闭通道的许多复杂性。AnyPrevout 也让 “Decker 通道” 成为可能（为了避免跟 L2 相混淆，AnyPrevout 有时候也被称作 “Eltoo”，这真让人混淆）（译者注：两者发音相同）。</p>
<p>AnyPrevout 的基本工作原理是，它改变了签名所覆盖的部分，从而排除了交易要花费哪些币的细节。这在改变签名的当前不变量时有一些缺点，但总的来说是安全的。</p>
<p>APO 也可以用来实现类似 CTV 的东西，但两者之间的差异足够大（也包括效率方面的差异），所以两者并非竞争关系。</p>
<p>APO 当前也是经过充分审核的 BIP，正在等待来自社区的更多支持以激活。获得广泛支持的最大阻碍是缺乏一个用 Decker 通道建构的闪电网络的可靠功能原型，需要这样的原型来证明 APO 具有 “产品市场契合度”。有些开发者认为，需要其它的提议（比如 SIGHASH_BUNDLE）才能让 APO 完全可用。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://rubin.io/bitcoin/2021/07/09/bip-118-sighash-chart/">我对 BIP-118 的审核</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki">BIP-118</a></li>
<li><a target="_blank" rel="noopener" href="https://blockstream.com/eltoo.pdf">Eltoo&#x2F;Decker Channels 白皮书</a></li>
<li><a target="_blank" rel="noopener" href="https://rubin.io/blog/2021/07/02/covenants/">模板，Elstoo，限制条款，我的天！</a></li>
</ol>
<h2 id="TLUV-TapLeafUpdateVerify"><a href="#TLUV-TapLeafUpdateVerify" class="headerlink" title="TLUV TapLeafUpdateVerify"></a>TLUV TapLeafUpdateVerify</h2><p>TLUV 是一个还在提议阶段的通用智能合约操作码，它是开放的（open ended），具有动态的局部状态（dynamic local state），可以递归，甚至一定程度上是可以计算的。</p>
<p>本质上，TLUV 是让你可以通过改变顶层的密钥以及被花费的脚本路径，来改变正在被花费的输出。TLUV 只能读取和影响单个的 输入&#x2F;输出 对；其它的输出是不受影响的。TLUV 的功能与 Taproot 的实现细节高度 “关联”，因为 TLUV 必须修改一个输出背后的 taproot 数据结构。举个例子，你有一个 taproot 输出，面额为 10  btc，其脚本如下：</p>
<pre><code class="json">[&#123;&quot;amt&quot;: 10,
  &quot;key&quot;: &quot;multi(A,B,C)&quot;,
  &quot;scripts&quot;: [&quot;signed(A) with up to 2 coins&quot;,
              &quot;signed(B) with up to 5 coins&quot;,
              &quot;signed(C) with up to 3 coins&quot;]
 &#125;
]
</code></pre>
<p>而 TLUV 将允许你将它转变成下面的输出：</p>
<pre><code class="json">[&#123;&quot;amt&quot;: 9,
  &quot;key&quot;: &quot;multi(A,B,C)&quot;,
  &quot;scripts&quot;: [&quot;signed(A) with up to 1 coins&quot;,
              &quot;signed(B) with up to 5 coins&quot;,
              &quot;signed(C) with up to 3 coins&quot;]
 &#125;,
 &#123;&quot;amt&quot;: 0.25,
  &quot;address&quot;: &quot;someone paid by A&quot;
 &#125;,
 &#123;&quot;amt&quot;: 0.75,
  &quot;address&quot;: &quot;someone else paid by A&quot;
 &#125;
]
</code></pre>
<p>甚至是完全退出：</p>
<pre><code class="json">[&#123;&quot;amt&quot;: 9,
  &quot;key&quot;: &quot;multi(B,C)&quot;,
  &quot;scripts&quot;: [&quot;signed(B) with up to 5 coins&quot;,
              &quot;signed(C) with up to 3 coins&quot;]
 &#125;,
 &#123;&quot;amt&quot;: 0.25,
  &quot;address&quot;: &quot;someone paid by A&quot;
 &#125;,
 &#123;&quot;amt&quot;: 0.75,
  &quot;address&quot;: &quot;someone else paid by A&quot;
 &#125;
 &#123;&quot;amt&quot;: 1,
  &quot;address&quot;: &quot;A&#39;s key (exiting funds)&quot;
 &#125;
]
</code></pre>
<p>围绕修改顶层密钥的功能，TLUV 还有一些走火的危险，因为需要调整之后的密钥仍是有效的 Taproot 密钥。</p>
<p>TLUV 被设计成需要某种形式的 OP_AMOUNT 来启用上面所示递归共享型 UTXO，</p>
<p>TLUV 当前还没有稳定的提议（比如 BIP），现在还是一个开放的研究。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://bitcoinops.org/en/newsletters/2021/09/15/">Optech</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mail-archive.com/bitcoin-dev@lists.linuxfoundation.org/msg10437.html">邮件列表</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mail-archive.com/bitcoin-dev@lists.linuxfoundation.org/msg10442.html">我在邮件列表中的回应</a></li>
</ol>
<h2 id="CSFS-CheckSigFromStack"><a href="#CSFS-CheckSigFromStack" class="headerlink" title="CSFS CheckSigFromStack"></a>CSFS CheckSigFromStack</h2><p>CheckSigFromStack 或者说 CheckDataSig（给专家提醒：这是仅验证版本的简写，因为没必要检查某个东西没有被某人签名）是一个操作码，它可以检查任意信息是否被某个密钥签名。正常来说，当比特币脚本检查一个签名时，这个消息 <em>必须</em> 是当前正在被验证交易的哈希值，并注有签名的哈希模式。</p>
<p>CSFS 有许多 “基本” 的应用。举个例子，你可以写一个程序，要么是正常情况，密钥 K 签名了一笔交易；要么，是密钥 K 签名了另一个密钥，这个密钥再签名一笔交易。这使得币的持有者可以 “委托” 币的所有权给另一个密钥，而无需转移这笔资金。</p>
<p>CSFS 在比特币中可以说已经存在了：使用  Lamport 签名，可以做到检查一个超过 5 字节的数据的签名。它并不是非常有用，但你可以想象它的一些特定的用途，例如：在一段时间锁内，将签名权委托给某一个签名者。</p>
<p>CSFS 跟其它操作码相结合时，就变得非常强大。举个例子，CSFS 加上 CTV，就可以实现一些类似于 AnyPrevout 的东西。CSFA 加上 CAT，就可以在隔离见证 v0 中实现完全通用的限制条款，但不能在 Taproot 中使用（因为还没有某种形式的 OP_TWEAK）。欲知详情最好阅读这里补充的材料，但设想我先按照常规检查交易的签名，然后我把交易本身推入栈中并检查它，最后使用 CAT 将所有东西组装起来。这将允许我们对一个脚本的所有组件运行程序性检查。</p>
<p>虽然现在还没有 CSFS 的明文提议，它没有什么争议，设计也相对比较直接。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-July/019192.html">BIP 建议</a></li>
<li><a target="_blank" rel="noopener" href="https://rubin.io/blog/2021/07/02/covenants/">模板，Elstoo，限制条款，我的天！</a></li>
<li><a target="_blank" rel="noopener" href="https://rubin.io/blog/2021/07/02/signing-5-bytes/">CSFS from Math (5 bytes)</a></li>
</ol>
<h2 id="OP-AMOUNT"><a href="#OP-AMOUNT" class="headerlink" title="OP_AMOUNT"></a>OP_AMOUNT</h2><p>OP_AMOUNT 是在 2017 年由 Johnson Lau 提议的（这是我能追溯到的最早引用），它通过一个叫做 PUSHTXDATA 的脚本插件，让任何数据都可以被推入栈中。作为一个独立的插件，在栈中获得 被花费&#x2F;被创建 的数据（无论是使用 push 操作码还是带有验证语义的操作码）都将允许智能合约限制被花费的数量，或者根据数量来切换行为。</p>
<p>举个例子，OP_AMOUNT 加上 TLUV，一个 Taproot 分支就可以拥有一个独立的余额，并且这个余额还可以由分支的所有者更新。假设我有一个脚本树，说明 Alice 拥有 1 btc，而 Bob 拥有 20 Btc。当 Alice 花费的时候，脚本将要求对应的输出（例如：0 号输入对应的 0 号输出）最多只能减少 1 btc，而且脚本将被更新到改变 Alice 的脚本分支具有 1-（花费数额） 的余额。</p>
<p>另一个例子是，CTV 也可以跟 OP_AMOUT 一起使用，在花费的数额大于和小于 1 btc 时采取不同的安全措施。</p>
<p>当前没有 OP_AMOUT 的明确提议。加入这个功能的难度在于，比特币的脚本处理 32 比特的数学，而数额是 64 比特的值（准确来说是 51 比特）。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/jl2012/bips/blob/vault/bip-0ZZZ.mediawiki">OP_PUSHTXDATA</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mail-archive.com/bitcoin-dev@lists.linuxfoundation.org/msg10438.html">OP_IN_OUT_AMOUNT</a></li>
</ol>
<h2 id="SIGHASH-BUNDLE"><a href="#SIGHASH-BUNDLE" class="headerlink" title="SIGHASH_BUNDLE"></a>SIGHASH_BUNDLE</h2><p>Sighash Bundle 是让 “Sighash Flag” 变得更加通用的一种思路。Sighash 标签是一种迷你的 “编程语言”，可以描述签名者想签名一笔交易的哪些部分。而 Bundle 则允许签名者选出一组输入和输出来签名，并且交易包的描述可以重新绑定，从而允许一些形式的事后交易聚合。</p>
<p>提出 SIGHASH_BUNDLE 的主要目的是帮助 Decker 支付通道跟一种叫做 “分层承诺（layered commitment）” 的次级协议一起工作。它是有可能被激活的，但它跟 AnyPrevout 有一样的问题：我们需要看到一个使用它的端到端闪电网络实现，以确定这个技术真的解决了它希望解决的问题。</p>
<p>当前尚未有可靠的实现。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-April/015862.html">邮件组帖子</a></li>
</ol>
<h2 id="Transaction-Sponsors"><a href="#Transaction-Sponsors" class="headerlink" title="Transaction Sponsors"></a>Transaction Sponsors</h2><p>Transaction Sponsors（“交易赞助者”）是另一个由你们提出的提议。</p>
<p>交易赞助者的基本概念就是允许表达一个逻辑：仅当 A 交易在某个区块中时，该区块才能包含 B 交易。具体来说，这个提议认为，一笔产生 0 值输出且输出脚本为  <code>OP_VER &lt;txids&gt;</code> 的交易，将仅在 txids 所代表的交易也在同一个区块中时，才会有效。</p>
<p>这种表达依赖的能力，会影响基于这种依赖所实现的新型智能合约的设计，但这并不是交易赞助者这种面向交易池的提议的目标。</p>
<p>相反，赞助者提议的目标是使用这种功能来表达额外的依赖，从而产生一种在交易池中为交易动态追加手续费的方法，无需依赖 CPFG（子为父偿）和 RBF（交易费替换）。这个元件在驱动基于 CTV 或者 Decker 通道的智能合约流程时尤其有用，它无需依赖任何类型的交易变形性。</p>
<p>当前已经有了交易赞助者的实现和 BIP 草案，但这个 BIP 还没有被改进到可以正式纳入仓库。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2020-September/018168.html">邮件组帖子</a></li>
<li><a target="_blank" rel="noopener" href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-November/019614.html">追加手续费的难度</a></li>
</ol>
<h2 id="OP-CAT（或者叫-SHASTREAM）"><a href="#OP-CAT（或者叫-SHASTREAM）" class="headerlink" title="OP_CAT（或者叫 SHASTREAM）"></a>OP_CAT（或者叫 SHASTREAM）</h2><p>OP_CAT “看起来很简单”。它具有的功能只不过是获得一个参数 “hello” 和第二个参数 “world”，然后拼成 “hello world”。</p>
<p>CAT 从一开始就是比特币的一部分，但它有实现上的错误，后来被中本聪在比特币早期的一次紧急补丁中移除了。</p>
<p>虽然它很简单，事实证明，拼接字节串的能力给比特币加入了非常多样的功能，包括量子证据签名和限制条款这样的东西。CAT 有许多可能实现的变种，每一种都有自己的取舍，但大部分 CAT 提议在设计上都没有什么争议。有争议的是因为它会给比特币引入许多令人意外的行为，我们更倾向于先搞清楚这种可以编写高级智能合约的能力对用户造成的影响。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://rubin.io/blog/2021/07/06/quantum-bitcoin/">Quantum Proof Bitcoin</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/blockstream/cat-and-schnorr-tricks-i-faf1b59bd298">Poelstra CAT Blog I</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/blockstream/cat-and-schnorr-tricks-ii-2f6ede3d7bb5">Poelstra CAT Blog II</a></li>
</ol>
<h2 id="OP-TWEAK-x2F-ECMUL"><a href="#OP-TWEAK-x2F-ECMUL" class="headerlink" title="OP_TWEAK &#x2F; ECMUL"></a>OP_TWEAK &#x2F; ECMUL</h2><p>有两种操作码支持调整用在限制条款中的椭圆曲线点，或者计算出一个特定的私钥。</p>
<p>这两个操作码都没有稳定的提议，但其实现已经基本被 secp256k1 曲线的要求指定了。</p>
<h2 id="适配器签名"><a href="#适配器签名" class="headerlink" title="适配器签名"></a>适配器签名</h2><p>适配器签名是一种可以跟 Schhnorr 签名一起使用的技术，不要求比特币作额外的升级。</p>
<p>适配器的基本原理是一方（或者一群参与者）创建一个数据对象，该对象要么接受一个签名而揭示一个秘密值，要么接收一个秘密值然后揭示出一个签名。</p>
<p>适配器签名可以用在许多原来使用哈希原像锁的场景种。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://bitcoinops.org/en/topics/adaptor-signatures/">Optech</a></li>
</ol>
<h2 id="委托-x2F-Graftroot"><a href="#委托-x2F-Graftroot" class="headerlink" title="委托 &#x2F; Graftroot"></a>委托 &#x2F; Graftroot</h2><p>委托指的是，使用这种脚本后，你可以不直接签名交易，而是签名另一个脚本来执行。举个例子，假设有一笔资金，需要一个来自 Alice 和 Bob 的签名才能花费。假设 Alice 想要下线，但 Bob 想要转账。Alice 可以签名一个脚本，要求一个来自 Carol 的签名来 “替代” Alice 的签名。</p>
<p>目前我们可以通过资金的委托以较为迂回的方式实现委托。也就是另一个脚本的片段必须用一个 UTXO 来表示。</p>
<p>Graftroot 是 Taproot 的一个插件，可以让顶层的密钥花费路径签名者签名委托脚本，而不是其它 tapscript 分支。下面的链接展示了多种命名混乱的插件和替代方案。</p>
<p>委托也可以跟 Anyprevout 相结合，使得签名授权被限制在特定的一笔资金或者具体的一个脚本上。CSFS 也可以支持一种基本的委托。它跟 Graftoot 一起可以实现一种 Taproot，其树可以非交互地建构出来，而且没有任何搜索成本。</p>
<p>除了目前可以实现的情况，其它的委托协议还没有可靠的提案。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-March/018615.html">Coin Delegation</a></li>
<li><a target="_blank" rel="noopener" href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-February/015700.html">Graftroot</a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/sipa/ca1502f8465d0d5032d9dd2465f32603">Entroot</a></li>
<li><a target="_blank" rel="noopener" href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-July/016249.html">G’Root (not graftroot)</a></li>
</ol>
<h2 id="BIP-300-DriveChain"><a href="#BIP-300-DriveChain" class="headerlink" title="BIP-300 DriveChain"></a>BIP-300 DriveChain</h2><p>DriveChain 是一种为应用高度定制化的递归限制条款，它的设计是使用链上的矿工驱动型投票系统来跟踪侧链的存款和取款，从而帮助侧链运行。</p>
<p>这样的侧链将可以运行任意的智能合约（要看侧链运营者的选择）。矿工可以通过一种特殊的输出对取款投支持、反对或弃权票。</p>
<p>这个方法的一个主要缺点在于，BIP-300 要求加入新的全局状态数据库，而不是在限制条款交易自身中包含局部状态。</p>
<p>总体来说，DriveChian 的争议是比较大的；许多人表示感兴趣，也有许多人表达了严厉的批评，因为它改变了比特币共识的激励稳定性。把它放在这里是为了文章的完整。</p>
<p>我自己认为，虽然 Drivechain 的概念是很有用的，但它的实现并不需要把交易放在现有的区块空间内，可以通过一个额外的承诺来追踪（就像隔离见证一样）。如果 Drivechain 可以用一种更加通用的限制条款，而非为应用定制化的限制条款来实现的话，这是可以发生的。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/bitcoin/bips/blob/master/bip-0300.mediawiki">BIP-300</a></li>
<li><a target="_blank" rel="noopener" href="https://www.drivechain.info/">Drivechains</a></li>
</ol>
<h2 id="Elements-操作码"><a href="#Elements-操作码" class="headerlink" title="Elements 操作码"></a>Elements 操作码</h2><p>Elements 是 Blockstream 的比特币分叉，用在他们自己的 Liquid 侧链上。Elements 计划加入许多操作码，来帮助实现许多功能（包括上面提到的哪些），还有他们现有的插件。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://elementsproject.org/features/opcodes">Existing Opcodes</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ElementsProject/elements/blob/master/doc/tapscript_opcodes.md">Upgrade for Taproot</a></li>
</ol>
<p style="text-align:center">- - -</p>


<p>好了，这就差不多了！当然还有其它东西也跟这个主题有关，但以上是讲到为比特币带来更多可编程性时我脑海里最先浮现的东西。</p>
<p>接下来的文章将专注于 BIP-119 和 Sapio 的可能性，并帮助论证它是比特币升级历程中的绝佳步骤。我们会展示（而非断言）这个小巧而有限的操作码可以打开大大的可能性，以及我个人的升级路线图，以及其它升级的开发，作为比特币的连贯的叙事。</p>
<p>（完）</p>
</article></div></div></main><script src="/js/post.js?v=1675068536886"></script><script src="/js/highlight.min.js?v=1675068536886"></script><script>var containerEl = document.querySelector('.post-container');
var postFontSize = localStorage.getItem('post-font-size') || '16';
var inputEl = document.querySelector('#size-change-input');
var inputEl2 = document.querySelector('#size-change-input2');
inputEl.value = postFontSize;
inputEl2.value = postFontSize;
containerEl.style.fontSize = postFontSize + 'px';
$(function(){
  function setSizeChangeInputValue(size) {
    $('.post-container').css('font-size', size + 'px');
    localStorage.setItem('post-font-size', size);
    $('#size-change-input').val(size);
    $('#size-change-input2').val(size);
  }
  $('#size-change-input').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
  $('#size-change-input2').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
});
</script><script>hljs.initHighlightingOnLoad();</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/btcstudy">Twitter</a><!-- Github--><!-- Ins--><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml">rss</a><!-- 知乎--><!-- 领英--><!-- 脸书--><!-- Telegram--><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/btcstudyorg">Telegram</a></section></footer><script async src="/js/buttons.js?v=1675068536886"></script><script async src="/js/index.js?v=1675068536886"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-JVCJ9XXG1Z');</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306";
  hm.async = true;
  hm.defer = true;
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
  </script></body></html>