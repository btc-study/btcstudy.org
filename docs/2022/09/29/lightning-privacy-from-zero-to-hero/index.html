<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>闪电网络隐私性：从局限到超越</title><meta name="keywords" content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name="description" content="比特币思想的中文集结地"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css?v=1673504754311"><link rel="preload" as="style" onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1673504754311"><link rel="stylesheet" href="/style/base.css?v=1673504754311"><link rel="stylesheet" href="/style/common/helper.css?v=1673504754311"><link rel="stylesheet" href="/style/themes/animation.css?v=1673504754311"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1673504754311"></script><script src="/js/libs/zepto.min.js"></script><link rel="stylesheet" href="/style/post.css?v=1673504754311"><link rel="stylesheet" href="/style/themes/highlight.css?v=1673504754311"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="BTC Study" type="application/atom+xml"></head><body class="is-flex is-flex-direction-column" onload="initialTheme()"><div class="clip"></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id="header"><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href="/"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id="header-menu"><a class="is-inline-block header-activity mr-4" href="/">首页</a><a class="is-inline-block mr-4" href="/archives">全站目录</a><a class="is-inline-block mr-4" href="/tags">标签</a><a class="is-inline-block mr-4" href="/maps">地图</a><a class="is-inline-block mr-4" href="/mempool">mempool</a><a class="is-inline-block mr-4" target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input" type="range" min="12" max="32" step="2"></div></div></div><i class="iconfont icon-icon_dark mr-1" id="theme-btn"></i><div class="search-wrap"><input class="pl-3" id="search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search" id="search-input-btn"></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">闪电网络隐私性：从局限到超越</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn2"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input2" type="range" min="12" max="32" step="2"></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id="mobile-header"><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id="mobile-header-logo"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopicMobile"><p class="is-full-height">闪电网络隐私性：从局限到超越</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class="mobile-search-wrap"><div class="search-input"><input class="pl-3" id="mobile-search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class="mobile-search-input-btn">搜 索</button></div></div></header><div class="mobile-slide-menu"><a class="header-activity" href="/">首页</a><a href="/archives">全站目录</a><a href="/tags">标签</a><a href="/maps">地图</a><a href="/mempool">mempool</a><a target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class="slide-menu-fontsize"><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1673504754311"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E4%B8%8A%E5%88%B0%E9%93%BE%E4%B8%8B%E9%9A%90%E7%A7%81%E6%80%A7"><span class="toc-text">链上到链下隐私性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%86%E5%88%AB%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C%E9%80%9A%E9%81%93%E5%85%85%E5%80%BC%E8%84%9A%E6%9C%AC"><span class="toc-text">识别闪电网络通道充值脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%BC%80%E9%80%9A%E9%81%93"><span class="toc-text">公开通道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%85%AC%E5%BC%80%E7%9A%84%E9%80%9A%E9%81%93"><span class="toc-text">不公开的通道</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E4%B8%8B%E5%88%B0%E9%93%BE%E4%B8%8B%E9%9A%90%E7%A7%81%E6%80%A7"><span class="toc-text">链下到链下隐私性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%98%E6%AC%BE%E5%85%B3%E8%81%94"><span class="toc-text">付款关联</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E9%92%B1%E5%8C%85%E8%AF%86%E5%88%AB"><span class="toc-text">移动钱包识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%AF%BB%E6%89%BE%E6%96%B9%E6%A1%88"><span class="toc-text">路径寻找方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trampoline%EF%BC%88%E8%B9%A6%E5%BA%8A%EF%BC%89"><span class="toc-text">Trampoline（蹦床）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99"><span class="toc-text">相关资料</span></a></li></ol></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id="postTitle">闪电网络隐私性：从局限到超越</h1><div class="page-author"><div class="is-flex is-flex-direction-row page-data mr-6"><img class="mr-1" src="//res.btcstudy.org/btcstudy/images/default_avatar.png" alt="Bastien"><div class="page-author-info"><strong>Bastien</strong><time class="has-text-grey" datetime="2022-09-29T14:38:54.000Z">2022-09-29</time></div></div><div class="is-flex"><a href="/tags/%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C"><i class="page-tag mr-1 px-1">闪电网络</i></a><a href="/tags/%E9%9A%90%E7%A7%81%E6%80%A7"><i class="page-tag mr-1 px-1">隐私性</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Bastien Teinturier</em></p><p><em>来源：<a target="_blank" rel="noopener" href="https://github.com/t-bast/lightning-docs/blob/master/lightning-privacy.md">https://github.com/t-bast/lightning-docs/blob/master/lightning-privacy.md</a></em></p><p><em>作者使用代码块提供了很有帮助的图示，如果在网站上无法正常显示（有些图示很长，需要横向滚动条才能正常阅读），请跳转到原文对照观看。</em></p></blockquote><p>本文阐述了闪电网络在隐私性方面的缺陷、普通用户如何规避它们带来的影响，以及我们准备采用哪些手段来解决它们。</p><h2 id="链上到链下隐私性"><a href="#链上到链下隐私性" class="headerlink" title="链上到链下隐私性"></a>链上到链下隐私性</h2><p>无论你何时使用闪电网络，都会留下链上足迹：你需要开启和关闭支付通道。因此，确保链上足迹不会泄露太多信息很重要。</p><h3 id="识别闪电网络通道充值脚本"><a href="#识别闪电网络通道充值脚本" class="headerlink" title="识别闪电网络通道充值脚本"></a>识别闪电网络通道充值脚本</h3><p>正如我们在介绍<a target="_blank" rel="noopener" href="https://github.com/t-bast/lightning-docs/blob/master/lightning-txs.md">闪电网络交易</a>的文章中指出的那样，通道充值交易使用的是 p2wsh 2/2 多签。当通道处于开启状态时，一切都很好：攻击者在区块链上看到的只是一个 p2wsh 输出，无法获得里面包含的信息。但是，关闭通道时，我们必须自曝它使用的是 2/2 多签，强烈暗示了它可能是闪电网络通道。</p><p>幸而这个问题被 Taproot 轻松化解了。我们使用的不再是 p2wsh 输出，而是带有密钥路径花费的 <a target="_blank" rel="noopener" href="https://github.com/t-bast/lightning-docs/blob/master/schnorr.md">Musig2</a>，看起来与一个正常的签名输出没有区别。</p><p>但是，关闭支付通道的方式有两种：在双方配合的情况下，二人共同创建一笔交易将最终余额发送给彼此；如果一方不配合，将由另一方单方面创建交易。</p><p>在第二种情况下，被广播的交易就是我们在<a target="_blank" rel="noopener" href="https://github.com/t-bast/lightning-docs/blob/master/lightning-txs.md">关于闪电网络交易</a>的文章中介绍的承诺交易。该交易利用闪电网络独有的专门脚本，让参与者能够拿回自己的资金。这些脚本在链上可见，显然会暴露背后的闪电网络通道。遗憾的是，或许没有办法能在保证资金安全性的情况下解决这一问题。节点运营者应该尽量避免单方面关闭通道：只在对等节点作恶或失联的情况下采用这种方式。</p><h3 id="公开通道"><a href="#公开通道" class="headerlink" title="公开通道"></a>公开通道</h3><p>闪电网络节点目前通过向对等节点发送 <code>channel_announcement</code> 消息在闪电网络中广播自己的通道。对等节点会将这个消息转发给网络中的其它对等节点。该消息包含充值交易的详细信息，可以让所有运行闪电网络节点的人知道哪些 UTXO 用于闪电网络通道。</p><p>闪电网络通道之所以会在网络中公开，是因为我们使用源路由（source routing）来确保付款隐私性：假设 Alice 想要向 Bob 发送一笔付款，Alice 必须根据现有通道找到一条触达 Bob 的路径。如果 Alice 可以获取完整的网络拓扑图，她就能自己找出路径，不向任何人透露自己要向 Bob 付款的事。</p><pre><code>                  +------+          +-----+
                  | Node |          | Bob |
                  +------+          +-----+
                      |                |
                      |                |
+-------+         +------+         +------+
| Alice |---------| Node |---------| Node |
+-------+         +------+         +------+
    |                                  |
    |             +------+             |
    +-------------| Node |-------------+
                  +------+
</code></pre><p>若想保证付款匿名性，我们便无法彻底摆脱这一机制，但是我们可以改进它。我们无需公开通道的所有信息，只需让全网知道有一个给定金额的链上交易在两个节点之间创建了一条通道。我们的实现方案还有部分细节没有完全敲定，但是可能会用到一些密码学技术（例如，环签名或零知识证明）。</p><h3 id="不公开的通道"><a href="#不公开的通道" class="headerlink" title="不公开的通道"></a>不公开的通道</h3><p>可喜的是，不想路由付款的节点（例如，移动钱包和商家）可以选择不向全网公开其通道。</p><pre><code>                  +------+         +------+
                  | Node |---------| Node |
                  +------+         +------+
                      |                |
                      |                |
+-------+         +------+         +------+         +------+         +-----+
| Alice |ooooooooo| Node |---------| Node |---------| Node |ooooooooo| Bob |
+-------+         +------+         +------+         +------+         +-----+
    o                                  |
    o             +------+             |
    oooooooooooooo| Node |-------------+
                  +------+

注意：不公开的通道使用 “oooooooo” 来表示
</code></pre><p>但是，节点若想接收付款，必须要让收款方找到路径。为此，节点需要公开通道的部分信息。目前，节点采用的解决方案是，将部分未公开通道的全部信息放到 Bolt 11 发票中。这个方案的缺点是，发票有时会被拿来公开分享（比如被放上推特），这会泄露未公开通道的信息。</p><p>我们即将推出两个功能来解决这个问题：</p><ul><li><p>利用 “<a target="_blank" rel="noopener" href="https://github.com/lightning/bolts/pull/798">Offer</a>” 提供一个公开分享时不会泄露通道信息的静态“地址”</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/lightning/bolts/pull/765">Route Blinding</a>（路由盲化）可以让收款方向付款方完全隐藏其 <code>node_id</code> 和通道</p></li></ul><p>请注意，路由节点也可以利用未公开通道来保护 UTXO 隐私性。如果两个节点之间开启了多条通道，它们可以选择只向全网公开其中一条通道，将其余通道保密。当它们收到一笔付款需要转发时，它们可以使用未公开通道，这样就没人知道它们转发了这笔交易。参见下面这则例子，其中未公开通道用 <code>oooo</code> 表示：</p><pre><code>          0.4 btc                                  1.2 btc
   oooooooooooooooooooo                    oooooooooooooooooooooo
   o                  o                    o                    o
+------+   1 btc   +------+   1.5 btc   +------+   0.8 btc   +------+
| Node |-----------| Node |-------------| Node |-------------| Node |
+------+           +------+             +------+             +------+
   o      0.6 btc     o
   oooooooooooooooooooo
</code></pre><p>但是，这里面也有个小小的缺陷：寻路启发法根据节点之间的通道容量来对通道进行排名。一旦路由节点隐藏了自己的容量，会影响其路由评分。</p><h2 id="链下到链下隐私性"><a href="#链下到链下隐私性" class="headerlink" title="链下到链下隐私性"></a>链下到链下隐私性</h2><p>一旦你开启了通道，闪电网络会为你的付款带来更高的匿名性，因为已开启的通道不会产生任何链上足迹。我们在下文探索一些细节和不足。</p><h3 id="付款关联"><a href="#付款关联" class="headerlink" title="付款关联"></a>付款关联</h3><p>闪电网络付款使用一个叫作 <a target="_blank" rel="noopener" href="https://github.com/t-bast/lightning-docs/blob/master/sphinx.md">Sphinx</a> 的洋葱路由方案，可以确保中间节点只知道所在路径上的前一个节点和后一个节点，但是不知道是否还有其它跳。</p><p>例如，如果 Alice 使用下方付款路径向 Dave 付款：</p><pre><code>+-------+           +-----+           +-------+           +------+
| Alice |----------&gt;| Bob |----------&gt;| Carol |----------&gt;| Dave |
+-------+           +-----+           +-------+           +------+
</code></pre><p>当 Bob 收到将付款转发给 Carol 的请求时，Bob 只知道：</p><ul><li><p>付款可能来自 Alice 或 Alice 上游的某个未知节点</p></li><li><p>付款要发送给 Carol 或 Carol 下游的某个未知节点</p></li></ul><p>同样地，Carol 只知道：</p><ul><li><p>付款可能来自 Bob 或 Bob 上游的某个未知节点</p></li><li><p>付款要发送给 Dave 或 Dave 下游的某个未知节点</p></li></ul><p>该机制极大地提高了付款隐私性。但是，它也会泄露部分数据：由于 HTLC 的工作原理，路径上的所有节点都被赋予了相同的付款标识符 <code>payment_hash</code>。如果这条路径上有两个节点由同一个实体控制，它们就能发现自己转发的是同一笔付款。</p><pre><code>                                                 +---------------------------+
                                                 | Well well well...         |
                                                 | I know that payment hash! |
                                                 +---------------------------+
                                                             |
                                                             |
+-------+           +-----+           +-------+           +------+           +------+
| Alice |----------&gt;| Bob |----------&gt;| Carol |----------&gt;| Bob2 |----------&gt;| Dave |
+-------+     |     +-----+     |     +-------+     |     +------+     |     +------+
              |                 |                   |                  |
       +--------------+  +--------------+    +--------------+   +--------------+
       | payment_hash |  | payment_hash |    | payment_hash |   | payment_hash |
       |   0x123456   |  |   0x123456   |    |   0x123456   |   |   0x123456   |
       +--------------+  +--------------+    +--------------+   +--------------+
</code></pre><p>我们将在下一节中解释这种付款关联会如何破坏移动钱包付款的隐私性。</p><p>幸好，Taproot 可以让我们使用 PTLC 代替 HTLC。其一大优点是，能够彻底避免付款关联攻击：有了 PTLC，路径中的每个节点会看到不同的随机付款标识符。</p><pre><code>                                                 +-------------------------+
                                                 | Never seen that payment |
                                                 | point before...         |
                                                 +-------------------------+
                                                             |
                                                             |
+-------+           +-----+           +-------+           +------+           +------+
| Alice |----------&gt;| Bob |----------&gt;| Carol |----------&gt;| Bob2 |----------&gt;| Dave |
+-------+     |     +-----+     |     +-------+     |     +------+     |     +------+
              |                 |                   |                  |
      +---------------+  +---------------+  +---------------+  +---------------+
      | payment_point |  | payment_point |  | payment_point |  | payment_point |
      |   0x02123456  |  |   0x03ff0123  |  |   0x03abcdef  |  |   0x026bcad3  |
      +---------------+  +---------------+  +---------------+  +---------------+
</code></pre><h3 id="移动钱包识别"><a href="#移动钱包识别" class="headerlink" title="移动钱包识别"></a>移动钱包识别</h3><p>大多数用户会使用移动钱包进行闪电网络付款。移动钱包本质上有别于服务器节点：移动钱包无法向其直接对等节点隐瞒自己是移动钱包的事实。它们没有稳定的 IP 地址，大多数时间都不在线，而且不参与付款路由，因此很容易被识破。</p><p>这会导致一个后果，只要移动钱包请求其对等节点转发付款，对等节点就知道移动钱包是付款方。同样地，将付款转发给移动钱包时，节点也知道移动钱包就是收款方。</p><p>再结合上一节中提到的付款关联问题，攻击者能够发现是谁在向谁付款：</p><pre><code>                                                 +-----------------------+
                                                 | Well well well...     |
                                                 | Alice is paying Dave! |
                                                 +-----------------------+
                                                             |
 mobile                                                      |                mobile
+-------+           +-----+           +-------+           +------+           +------+
| Alice |----------&gt;| Bob |----------&gt;| Carol |----------&gt;| Bob2 |----------&gt;| Dave |
+-------+     |     +-----+     |     +-------+     |     +------+     |     +------+
              |                 |                   |                  |
       +--------------+  +--------------+    +--------------+   +--------------+
       | payment_hash |  | payment_hash |    | payment_hash |   | payment_hash |
       |   0x123456   |  |   0x123456   |    |   0x123456   |   |   0x123456   |
       +--------------+  +--------------+    +--------------+   +--------------+
</code></pre><p>一旦闪电网络转向 PTLC，中间节点就只能知道付款方或收款方是谁，无法同时知道两个人的身份。正如我们所知，移动钱包无法隐藏该信息。但是，这还不算太糟糕，因为：</p><ul><li><p>移动钱包可以使用 Tor 或 VPN 隐藏其真正的 IP 地址：<code>node_id</code> 是它们在闪电网络上的唯一身份，而且可以定期更换（代价是开启新的通道）</p></li><li><p>对等节点只能知道移动钱包在付款或收款，无法知道它们在向谁付款或从谁那里收款</p></li><li><p>移动钱包可以向自己付款，以此伪造流量，抵御链下分析启发法</p></li><li><p>移动钱包可以有多个对等节点，这样每个对等节点都只能窥知钱包的部分付款</p></li></ul><p>请注意，本小节内容只适用于连接到由他人运行的节点的移动钱包。如果你自己运行闪电网络节点，你的移动钱包又只连接到这个节点，上述问题便不存在了：网络甚至看不到你的移动钱包，因为一切都将由你的闪电网络节点处理。</p><h3 id="路径寻找方案"><a href="#路径寻找方案" class="headerlink" title="路径寻找方案"></a>路径寻找方案</h3><p>攻击者还可以利用路径寻找方案发起更高级的付款隐私性攻击。我们来探索以下两个方案：</p><ol><li>多路径付款的交叉点（multi-part payment path intersection）</li><li>路径图过滤（graph filtering）</li></ol><p>我们首先探索交叉的多路径付款。多路径付款可以提高针对中间节点的付款隐私性（因为它们只能看到部分付款额），但是会向收款方节点泄露更多数据（因为收款方节点会看到多部分付款从不同通道送达）。以下方的多部分付款为例：</p><pre><code>+-------+          +------+          +------+
| Alice |----------| Node |----------| Node |------------------+
+-------+          +------+          +------+                  |
                      |                                        | MPP part #1
   +------------------+                                        |
   |                                                           |
+-----+            +------+          +------+  MPP part #2  +------+
| Bob |------------| Node |----------| Node |---------------| Dave |
+-----+            +------+          +------+               +------+
                      |                                        |
                      |                                        |
                      |                                        | MPP part #3
+-------+          +------+          +------+                  |
| Carol |----------| Node |----------| Node |------------------+
+-------+          +------+          +------+
</code></pre><p>Dave 可以回溯所有可能的路径，并找到它们之间的交叉点。对上图进行简单的分析之后，我们显然可以看出付款方最有可能是 Bob。在这种分析下，发送方的匿名性无法得到保证。</p><p>但是，请注意图中只是理论上的例子。如果对象是公共路径图上的真实付款，这种分析可能无法奏效，但我认为还是值得一提。</p><p>路径图过滤攻击甚至更为复杂，而且需要更多资源。但是其攻击思路很有意思，值得我们探究。</p><p>我们来想象一个只连接了一个节点（Eve）的用户（Alice）：</p><pre><code>+-------+          +-----+
| Alice |----------| Eve |
+-------+          +-----+
</code></pre><p>Alice 以为她的付款是私密的，因为付款路径是她自己计算的。但是，由于她只有一个对等节点 Eve，Alice 只能通过 Eve 获得公共路径图的更新。Eve 可以利用这一事实过滤掉一些通道，给 Alice 一个被裁剪后的路径图，让 Alice 不得不通过 Eve 控制的节点触达网络中的大部分节点。</p><pre><code>                                    +------+          +------+          +------+
                      +-------------| Node |----------| Node |----------| Eve2 |-------------+
                      |             +------+          +------+          +------+             |
                      |                                  |                                   |
                      |                +-----------------+                                   |
                      |                |                                                     |
+-------+          +-----+          +------+          +------+          +------+          +------+
| Alice |----------| Eve |----------| Node |xxxxxxxxxx| Node |----------| Node |----------| Dave |
+-------+          +-----+          +------+          +------+          +------+          +------+
                      |                                   |                                  |
                      |                                   |                                  |
                      |                                   |                                  |
                      |             +------+          +------+          +------+             |
                      +-------------| Node |xxxxxxxxxx| Node |----------| Node |-------------+
                                    +------+          +------+          +------+
</code></pre><p>以上图为例，Eve 过滤了被标记 <code>xxxxx</code> 的通道。如果 Alice 想要向 Dave 付款，她只能找到经过 Eve 的第二个节点的路径，让 Eve 可以对付款进行去匿名化。</p><p>再强调一遍，这种攻击只对特定情况有效，而且大概率只有理论意义。</p><h3 id="Trampoline（蹦床）"><a href="#Trampoline（蹦床）" class="headerlink" title="Trampoline（蹦床）"></a>Trampoline（蹦床）</h3><p><a target="_blank" rel="noopener" href="https://github.com/lightning/bolts/pull/829">Trampoline 路由</a>可以让移动钱包将部分付款路径计算交由中间节点负责。此处需要强调的是，钱包只是将部分而非全部付款路径计算交由中间节点负责，从而保障付款隐私性。</p><p>我们来看下图：</p><pre><code>         Alice&#39;s local neighborhood                                                                                      Dave&#39;s local neighorhood
+--------------------------------------------------+                                                       +--------------------------------------------------+
|                                                  |                                                       |                                                  |
|                    +------+                      |      +------+          +------+          +------+     |                      +------+                    |
|     +--------------| Node |-----------------------------|  N2  |----------|  N3  |----------|  N4  |-------------+ +------------| Node |                    |
|     |              +------+                      |      +------+          +------+          +------+     |       | |            +------+                    |
|     |                 |                          |          |                 |                          |       | |                                        |
|     |                 +------------------+       |          |                 |                          |       | |                                        |
|     |                                    |       |          |                 |                          |       | |                                        |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
| | Alice |----------| Bob |-----------| Terry |----------|  N1  |----------| Node |----------| Node |----------| Ted  |----------| Carol |----------| Dave | |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
|     |                                    |       |                                                       |                                                  |
|     |                 +------------------+       |                                                       |                                                  |
|     |                 |                          |                                                       |                                                  |
|     |              +------+                      |                                                       |                                                  |
|     +--------------| Node |                      |                                                       |                                                  |
|                    +------+                      |                                                       |                                                  |
|                                                  |                                                       |                                                  |
+--------------------------------------------------+                                                       +--------------------------------------------------+
</code></pre><p>Alice 和 Dave 无需同步完整的路径图，只需同步与自己相邻的部分路径。这样不仅节省了大量带宽，而且极大地提高了运行路径寻找算法的速度。</p><p>我们来看一个典型的 trampoline 付款例子。</p><p>第一步是收款方（Dave）创建一个支票。发票内包含与 Dave 相邻的一些 trampoline 节点，能够将付款路由给 Dave。Dave 通过对其周边路径图进行简单搜索来寻找 trampoline 节点。为简单起见，Dave 的发票中只包含了一个 trampoline 节点（Ted）。</p><p>Alice 查看了 Dave 的发票，得知自己必须触达 Ted。Alice 就近选择了 trampoline 节点 Terry。然后，Alice 创建了一条 trampoline 路径：</p><pre><code>Alice -----&gt; Terry -----&gt; Ted -----&gt; Dave
</code></pre><p>Alice 将这条 trampoline 路径加密到一个付款洋葱内。该付款洋葱在结构上与普通付款相同，但是体积更小一些。</p><p>然后，Alice 就近寻找一条触达 Terry 的路径：</p><pre><code>Alice -----&gt; Bob -----&gt; Terry
</code></pre><p>Alice 为这条路径创建了一个普通付款洋葱，trampoline 洋葱被放进了给 Terry 的负载。整体来看，这个洋葱如下所示：</p><pre><code>+---------------------------------+
| encrypted payload for Bob       |
+---------------------------------+
| encrypted payload for Terry     |
| +-----------------------------+ |
| | encrypted payload for Terry | |
| +-----------------------------+ |
| | encrypted payload for Ted   | |
| +-----------------------------+ |
| | encrypted payload for Dave  | |
| +-----------------------------+ |
| | padding                     | |
| +-----------------------------+ |
+---------------------------------+
| padding                         |
+---------------------------------+
</code></pre><p>Alice 将这笔付款发送出去：</p><pre><code>         Alice&#39;s local neighborhood                                                                                      Dave&#39;s local neighorhood
+--------------------------------------------------+                                                       +--------------------------------------------------+
|                                                  |                                                       |                                                  |
|                    +------+                      |      +------+          +------+          +------+     |                      +------+                    |
|     +--------------| Node |-----------------------------|  N2  |----------|  N3  |----------|  N4  |-------------+ +------------| Node |                    |
|     |              +------+                      |      +------+          +------+          +------+     |       | |            +------+                    |
|     |                 |                          |          |                 |                          |       | |                                        |
|     |                 +------------------+       |          |                 |                          |       | |                                        |
|     |                                    |       |          |                 |                          |       | |                                        |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
| | Alice |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| Bob |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| Terry |----------|  N1  |----------| Node |----------| Node |----------| Ted  |----------| Carol |----------| Dave | |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
|     |                                    |       |                                                       |                                                  |
|     |                 +------------------+       |                                                       |                                                  |
|     |                 |                          |                                                       |                                                  |
|     |              +------+                      |                                                       |                                                  |
|     +--------------| Node |                      |                                                       |                                                  |
|                    +------+                      |                                                       |                                                  |
|                                                  |                                                       |                                                  |
+--------------------------------------------------+                                                       +--------------------------------------------------+
</code></pre><p>对于中间节点 Bob 来说，这笔付款看起来与普通付款无异。Bob 只知道：</p><ul><li><p>这笔付款可能来自 Alice 或 Alice 之前的某个未知节点</p></li><li><p>这笔付款要发送给 Terry 或 Terry 之后的某个未知节点</p></li><li><p>Bob 并不知道这笔付款使用了 trampoline</p></li></ul><p>当 Terry 收到付款时，他得知自己必须找到通往 Ted 的路径，并将付款转发给 Ted。Terry 只知道：</p><ul><li><p>这笔付款可能来自 Bob 或 Bob 之前的某个未知节点</p></li><li><p>这笔付款要发送给 Ted 或 Ted 之后的某个未知节点</p></li></ul><p>Terry 找到一条触达 Ted 的路径，并为这条路径创建一个普通洋葱，trampoline 洋葱被放进了给 Ted 的负载（这个洋葱的最上面一层未封装）。整体来看，这个洋葱如下所示：</p><pre><code>+--------------------------------+
| encrypted payload for N1       |
+--------------------------------+
| encrypted payload for N2       |
+--------------------------------+
| encrypted payload for N3       |
+--------------------------------+
| encrypted payload for N4       |
+--------------------------------+
| encrypted payload for Ted      |
| +----------------------------+ |
| | encrypted payload for Ted  | |
| +----------------------------+ |
| | encrypted payload for Dave | |
| +----------------------------+ |
| | padding                    | |
| +----------------------------+ |
+--------------------------------+
| padding                        |
+--------------------------------+
</code></pre><p>Terry 将付款转发给下一个节点：</p><pre><code>         Alice&#39;s local neighborhood                                                                                      Dave&#39;s local neighorhood
+--------------------------------------------------+                                                       +--------------------------------------------------+
|                                                  |                                                       |                                                  |
|                    +------+                      |      +------+          +------+          +------+     |                      +------+                    |
|     +--------------| Node |-----------------------------|  N2  |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;|  N3  |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;|  N4  |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; +------------| Node |                    |
|     |              +------+                      |      +------+          +------+          +------+     |       v |            +------+                    |
|     |                 |                          |          ^                 |                          |       v |                                        |
|     |                 +------------------+       |          ^                 |                          |       v |                                        |
|     |                                    |       |          ^                 |                          |       v |                                        |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
| | Alice |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| Bob |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| Terry |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;|  N1  |----------| Node |----------| Node |----------| Ted  |----------| Carol |----------| Dave | |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
|     |                                    |       |                                                       |                                                  |
|     |                 +------------------+       |                                                       |                                                  |
|     |                 |                          |                                                       |                                                  |
|     |              +------+                      |                                                       |                                                  |
|     +--------------| Node |                      |                                                       |                                                  |
|                    +------+                      |                                                       |                                                  |
|                                                  |                                                       |                                                  |
+--------------------------------------------------+                                                       +--------------------------------------------------+
</code></pre><p>对于 N1、N2、N3 和 N4 这些中间节点来说，这笔付款看起来与普通付款无异。它们只知道：</p><ul><li><p>这笔付款可能来自前一个节点或更前面的某个节点</p></li><li><p>这笔付款要发送给后一个节点或更后面的某个节点</p></li><li><p>它们不知道这笔付款使用了 trampoline</p></li></ul><p>当 Ted 收到付款时，他得知自己必须找到一条触发 Dave 的路径，并将付款转发给 Dave。Ted 只知道：</p><ul><li><p>这笔付款可能来自 N4 或 N4 之前的某个节点</p></li><li><p>这笔付款要发送给 Dave 或 Dave 之后的某个节点</p></li><li><p>如果 Dave 是移动钱包，Ted 就会知道 Dave 是最终收款方</p></li><li><p>但是 Dave 可以在他和 Ted 之间使用路由盲化（route blinding）来向 Ted 隐藏自己的身份！</p></li></ul><p>Ted 找到通往 Dave 的路径并为该路径创建了一个普通洋葱，trampoline 洋葱被放进了给 Dave 的负载（这个洋葱的最上面一层未封装）。整体来看，这个洋葱如下所示：</p><pre><code>+--------------------------------+
| encrypted payload for Carol    |
+--------------------------------+
| encrypted payload for Dave     |
| +----------------------------+ |
| | encrypted payload for Dave | |
| +----------------------------+ |
| | padding                    | |
| +----------------------------+ |
+--------------------------------+
| padding                        |
+--------------------------------+
</code></pre><p>Ted 将这笔付款发送出去：</p><pre><code>         Alice&#39;s local neighborhood                                                                                      Dave&#39;s local neighorhood
+--------------------------------------------------+                                                       +--------------------------------------------------+
|                                                  |                                                       |                                                  |
|                    +------+                      |      +------+          +------+          +------+     |                      +------+                    |
|     +--------------| Node |-----------------------------|  N2  |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;|  N3  |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;|  N4  |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; +------------| Node |                    |
|     |              +------+                      |      +------+          +------+          +------+     |       v |            +------+                    |
|     |                 |                          |          ^                 |                          |       v |                                        |
|     |                 +------------------+       |          ^                 |                          |       v |                                        |
|     |                                    |       |          ^                 |                          |       v |                                        |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
| | Alice |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| Bob |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| Terry |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;|  N1  |----------| Node |----------| Node |----------| Ted  |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| Carol |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| Dave | |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
|     |                                    |       |                                                       |                                                  |
|     |                 +------------------+       |                                                       |                                                  |
|     |                 |                          |                                                       |                                                  |
|     |              +------+                      |                                                       |                                                  |
|     +--------------| Node |                      |                                                       |                                                  |
|                    +------+                      |                                                       |                                                  |
|                                                  |                                                       |                                                  |
+--------------------------------------------------+                                                       +--------------------------------------------------+
</code></pre><p>对于中间节点 Carol 来说，这笔付款看起来与普通付款无异。Carol 只知道：</p><ul><li><p>这笔付款可能来自 Ted 或 Ted 之前的某个节点</p></li><li><p>这笔付款要发送给 Dave 或 Dave 之后的某个节点</p></li><li><p>如果 Dave 是移动钱包，Carol 就会知道 Dave 是最终收款方（非 trampoline 付款同样如此）</p></li><li><p>Carol 并不知道这笔付款使用了 trampoline</p></li></ul><p>由于 Alice 和 Dave 看不见绝大部分路径图，他们使用的大概率不是最佳的路由路径。例如，整个网络的实际情况可能是这样的：</p><pre><code>         Alice&#39;s local neighborhood                                                                                      Dave&#39;s local neighorhood
+--------------------------------------------------+                                                       +--------------------------------------------------+
|                                                  |                                                       |                                                  |
|                    +------+                      |      +------+          +------+          +------+     |                      +------+                    |
|     +--------------| Node |-----------------------------|  N2  |----------|  N3  |----------|  N4  |-------------+ +------------| Node |                    |
|     |              +------+                      |      +------+          +------+          +------+     |       | |            +------+                    |
|     |                 |                          |          |                 |                          |       | |                                        |
|     |                 +------------------+       |          |                 |                          |       | |                                        |
|     |                                    |       |          |                 |                          |       | |                                        |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
| | Alice |----------| Bob |-----------| Terry |----------|  N1  |----------| Node |----------| Node |----------| Ted  |----------| Carol |----------| Dave | |
| +-------+          +-----+           +-------+   |      +------+          +------+          +------+     |    +------+          +-------+          +------+ |
|     |                                    |       |                                                       |                          |                       |
|     |                 +------------------+       |                                                       |                          |                       |
|     |                 |                          |                                                       |                          |                       |
|     |              +------+                      |                                                       |                          |                       |
|     +--------------| Node |----------------------|-------------------------------------------------------|--------------------------+                       |
|                    +------+                      |                                                       |                                                  |
|                                                  |                                                       |                                                  |
+--------------------------------------------------+                                                       +--------------------------------------------------+
</code></pre><p>虽然存在更高效的路径，但是 Alice 和 Dave 并不知道。这实际上有助于隐私保护，因为它增加了路径的不可预测性和随机性，可以防范攻击者利用启发法进行逆向工程。</p><p>在本例中，我们只使用了两个中间 trampoline 节点，因为这是最高效的做法，但是注重隐私的用户可能会在路径中间再随机增加一个 trampoline 节点，确保最终路径与最优路径大相径庭。</p><p>除此之外，trampoline 可与多路径付款完美结合，提高后者的可靠性和隐私性。每个 trampoline 节点都可以将自己收到的多个付款部分聚合起来，然后重新拆分成不同的部分转发出去：</p><pre><code>       150k sat   +------+  250k sat        300k sat   +------+  200k sat
    +-------------| Node |-------------+ +-------------| Node |--------------+
    |             +------+             | |             +------+              |
    |                                  | |                                   |
    |                                  | |                                   |
    |                                  | |                                   |
+-------+         250k sat          +------+           400k sat          +-------+        500k sat         +------+
| Alice |---------------------------| Bob  |-----------------------------| Carol |-------------------------| Dave |
+-------+                           +------+                             +-------+                         +------+
    |                                  |
    |                                  |
    |                                  |
    |             +------+             |
    +-------------| Node |-------------+
       150k sat   +------+  300k sat
</code></pre><p>由于 trampoline 节点知道自己的本地余额（远程节点并不知道），它们能够更高效地决定如何拆分需要转发的付款。</p><p>此外，这样也能解决我们上文提到的多路径付款交叉问题。路径中的每个 trampoline 节点（包括最终收款方）都能进行路径交叉分析，但是只能推断出上一个 trampoline 节点，无法找出真正的付款方。</p><h3 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h3><ul><li><p><a target="_blank" rel="noopener" href="https://stephanlivera.com/episode/319/">SLP 319：闪电网络协议隐私性探索</a></p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/lightning/bolts/pull/798">Offers 规范</a></p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/lightning/bolts/pull/765">Route Blinding 路由盲化规范</a></p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/lightning/bolts/pull/829">Trampoline 规范</a></p></li></ul><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1673504754311"></script><script src="/js/highlight.min.js?v=1673504754311"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/btcstudy">Twitter</a><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml">rss</a><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/btcstudyorg">Telegram</a></section></footer><script async src="/js/buttons.js?v=1673504754311"></script><script async src="/js/index.js?v=1673504754311"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script></body></html>