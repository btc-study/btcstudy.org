<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>比特币限制条款研究汇总</title><meta name="keywords" content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name="description" content="比特币思想的中文集结地"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css?v=1676085091298"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/style/common/iconfont.css?v=1676085091298"><link rel="stylesheet" href="/style/base.css?v=1676085091298"><link rel="stylesheet" href="/style/common/helper.css?v=1676085091298"><link rel="stylesheet" href="/style/themes/animation.css?v=1676085091298"><script>function ready() {
  var bodyEl = document.querySelector('.body-container');
  var theme = localStorage.getItem('theme') || 'light';
  if (!['light', 'dark'].includes(theme)) {
    theme = 'light';
    localStorage.setItem('theme', 'light');
  }
  bodyEl.classList.remove('appearance-auto');
  bodyEl.classList.add('appearance-' + theme);
  quickInitialTheme();
}
function quickInitialTheme() {
  var theme = localStorage.getItem('theme') || 'light';
  var logoLightEl = document.querySelector('.logo-light');
  var logoDarkEl = document.querySelector('.logo-dark');
  
  var mLogoLightEl = document.querySelector('#mobile-header-logo > .logo-light');
  var mLogoDarkEl = document.querySelector('#mobile-header-logo > .logo-dark');
  var themeBtnEl = document.getElementById('theme-btn');
  
  var slideThemeLightEl = document.querySelector('.slide-theme-light');
  var slideThemeDarkEl = document.querySelector('.slide-theme-dark');
  
  document.body.classList.add(theme);
  if (theme === 'dark') {
    logoLightEl.classList.add('hidden');
    logoDarkEl.classList.remove('hidden');
    
    mLogoLightEl.classList.add('hidden');
    mLogoDarkEl.classList.remove('hidden');
    
    themeBtnEl.classList.remove('icon-icon_dark');
    themeBtnEl.classList.add('icon-icon_light');
    
    slideThemeLightEl.classList.remove('hidden');
  } else {
    slideThemeDarkEl.classList.remove('hidden');
  }
}
document.addEventListener("DOMContentLoaded", ready);</script><script src="/js/common.js?v=1676085091298"></script><script src="/js/libs/zepto.min.js"></script><link rel="stylesheet" href="/style/post.css?v=1676085091299"><link rel="stylesheet" href="/style/themes/highlight.css?v=1676085091299"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="BTC Study" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column" onload="initialTheme()"><div class="clip"></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id="header"><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href="/"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id="header-menu"><a class="is-inline-block header-activity mr-4" href="/">首页</a><a class="is-inline-block mr-4" href="/archives">全站目录</a><a class="is-inline-block mr-4" href="/tags">标签</a><a class="is-inline-block mr-4" href="/maps">地图</a><a class="is-inline-block mr-4" href="/mempool">mempool</a><a class="is-inline-block mr-4" target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input" type="range" min="12" max="32" step="2"></div></div></div><i class="iconfont icon-icon_dark mr-1" id="theme-btn"></i><div class="search-wrap"><input class="pl-3" id="search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search" id="search-input-btn"></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">比特币限制条款研究汇总</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id="change-size-btn2"></i><div class="size-input-wrap"><div class="input-wrap"><input id="size-change-input2" type="range" min="12" max="32" step="2"></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id="mobile-header"><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id="mobile-header-logo"><svg class="logo-light" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#000000"></path></g></g></g></svg><svg class="logo-dark hidden" width="125px" height="23px" viewBox="0 0 125 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>BTCStudy</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="首页-响应式" transform="translate(-249.000000, -23.000000)" fill-rule="nonzero"><g id="BTCStudy" transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id="BTC" fill="#F2A900"></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id="Study" fill-opacity="0.85" fill="#FFFFFF"></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id="postTopicMobile"><p class="is-full-height">比特币限制条款研究汇总</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class="mobile-search-wrap"><div class="search-input"><input class="pl-3" id="mobile-search-input" placeholder="请输入搜索关键词"><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class="mobile-search-input-btn">搜 索</button></div></div></header><div class="mobile-slide-menu"><a class="header-activity" href="/">首页</a><a href="/archives">全站目录</a><a href="/tags">标签</a><a href="/maps">地图</a><a href="/mempool">mempool</a><a target="_blank" rel="noopener" href="https://123btc.org/">123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class="slide-menu-fontsize"><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1676085091299"> </script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%99%90%E5%88%B6%E6%9D%A1%E6%AC%BE%EF%BC%88covenant%EF%BC%89%EF%BC%9F"><span class="toc-text">什么是限制条款（covenant）？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E6%9D%A1%E6%AC%BE%E6%9C%89%E8%B6%A3%E5%9C%A8%E5%93%AA%EF%BC%9F"><span class="toc-text">限制条款有趣在哪？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E8%A6%81%E5%88%9B%E5%BB%BA%E8%BF%99%E4%B8%AA%E7%BD%91%E9%A1%B5%E5%91%A2%EF%BC%9F"><span class="toc-text">为什么我要创建这个网页呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%91%98%E8%A6%81"><span class="toc-text">摘要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%93%8D%E4%BD%9C%E7%A0%81%E7%9A%84%E9%99%90%E5%88%B6%E6%9D%A1%E6%AC%BE"><span class="toc-text">基于操作码的限制条款</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OP-CHECKOUTPUTVERIFY"><span class="toc-text">OP_CHECKOUTPUTVERIFY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OP-CHECKOUTPUTSHASHVERIFY"><span class="toc-text">OP_CHECKOUTPUTSHASHVERIFY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OP-CHECKTEMPLATEVERIFY"><span class="toc-text">OP_CHECKTEMPLATEVERIFY</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%AD%BE%E5%90%8D%E7%9A%84%E9%99%90%E5%88%B6%E6%9D%A1%E6%AC%BE"><span class="toc-text">基于签名的限制条款</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E7%AD%BE%E5%90%8D%E7%9A%84%E5%AF%BC%E8%AE%BA"><span class="toc-text">关于签名的导论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OP-CHECKSIGFROMSTACK"><span class="toc-text">OP_CHECKSIGFROMSTACK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SIGHASH-NOINPUT-x2F-ANYPREOUTS"><span class="toc-text">SIGHASH_NOINPUT&#x2F;ANYPREOUTS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E7%9A%84%E6%9E%84%E9%80%A0"><span class="toc-text">签名的构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%AD%BE%E5%90%8D%E7%9A%84%E5%8F%98%E7%A7%8D"><span class="toc-text">多签名的变种</span></a></li></ol></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id="postTitle">比特币限制条款研究汇总</h1><div class="page-author"><div class="is-flex is-flex-direction-row page-data mr-6"><img class="mr-1" src="//res.btcstudy.org/btcstudy/images/default_avatar.png" alt="corollari"><div class="page-author-info"><strong>corollari</strong><time class="has-text-grey" datetime="2023-02-10T06:43:50.000Z">2023-02-10</time></div></div><div class="is-flex"><a href="/tags/covenant"><i class="page-tag mr-1 px-1">covenant<!-- 订正图片路径--></i></a></div></div><article class="mt-4 post-content"><blockquote>
<p><em>作者：corollari</em></p>
<p><em>来源：<a target="_blank" rel="noopener" href="https://bitcoincovenants.com/">https://bitcoincovenants.com/</a></em></p>
</blockquote>
<p>原文出版于 2020 年。</p>
<h2 id="什么是限制条款（covenant）？"><a href="#什么是限制条款（covenant）？" class="headerlink" title="什么是限制条款（covenant）？"></a>什么是限制条款（covenant）？</h2><p>限制条款也叫做 “花费限制”，是人们给一类理论上的比特币脚本的命名；这种脚本附着于 UTXO，但会限制这些 UTXO 的花费方式，比如限制资金转移的目的地。</p>
<p>会将自身复制到接收资金的 UTXO 中的限制条款，就叫做 “递归型限制条款”。</p>
<h2 id="限制条款有趣在哪？"><a href="#限制条款有趣在哪？" class="headerlink" title="限制条款有趣在哪？"></a>限制条款有趣在哪？</h2><p>通用的限制条款（generalized covenants）可以开启非常多的新应用，例如：</p>
<ul>
<li>长度不受限制的脚本（包括任意大小的多签名）</li>
<li>图灵完备的合约</li>
<li>交易层面的 “默克尔抽象语法树（MAST）”（MAST 的一个粗粒度的版本，可以在 脚本&#x2F;交易 层皮分割代码路径）</li>
<li>类似于 Drivechain 的双向锚定侧链</li>
</ul>
<p>还有一些应用可在 <a target="_blank" rel="noopener" href="https://utxos.org/uses/">OP_CTV 宣传网页</a>中了解。</p>
<p><strong>注意</strong>：本页中介绍的限制条款方案并非都是通用的；许多方案受到了严格的限制，因此每种限制条款方案所提供的应用并不完全相同。</p>
<h2 id="为什么我要创建这个网页呢？"><a href="#为什么我要创建这个网页呢？" class="headerlink" title="为什么我要创建这个网页呢？"></a>为什么我要创建这个网页呢？</h2><p>我花了一整个月来研究在当前的比特币脚本的局限下创建限制条款，就在我以为自己找到一个突破口后，我发现我所设想的系统在几个月前就已经在 bitcoin 邮件组的一篇帖子中出现了。</p>
<p>这个网站的目标就是提供关于比特币限制条款技术的信息，这样其他人就不会像我一样浪费时间了。</p>
<p>换句话说：</p>
<blockquote>
<p>忘记历史，便会重蹈覆辙。</p>
</blockquote>
<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>Bitcoin Cash 和 Liquid 侧链都已经有了构建通用型限制条款的能力。</p>
<p>比特币脚本无法使用通用型限制条款，但可以通过受信任的启动设置，开发出一种非常局限的限制条款。</p>
<p>不仅如此，现在有许多的协议升级提议，可以启用更加灵活的限制条款（但依然不是通用的），而最活活跃的当属 SIGHASH_ANYPREVOUT&#x2F;NOINPUT 和 OP_CHECKTEMPLATEVERIFY 。</p>
<h2 id="基于操作码的限制条款"><a href="#基于操作码的限制条款" class="headerlink" title="基于操作码的限制条款"></a>基于操作码的限制条款</h2><h3 id="OP-CHECKOUTPUTVERIFY"><a href="#OP-CHECKOUTPUTVERIFY" class="headerlink" title="OP_CHECKOUTPUTVERIFY"></a>OP_CHECKOUTPUTVERIFY</h3><p>最早出现的限制条款提议之一。<a target="_blank" rel="noopener" href="https://maltemoeser.de/paper/covenants.pdf">这篇论文</a>介绍了一种可以加入比特币协议的的新操作码，它取三个参数<code>(index, value, pattern)</code> ，当且仅当尝试花费这笔资金的交易的第 <code>index</code> 个输出符合以下条件时，该操作码会返回 True ：</p>
<ul>
<li>该输出的面值等于 <code>value</code></li>
<li>该输出中的脚本，除了公钥和哈希值之类的东西（在 <code>pattern</code> 中表示为占位符），跟 <code>pattern</code> 相同</li>
</ul>
<p>一种在技术上有误，但可以作为实例的 python 代码如下：</p>
<pre><code class="python">def CheckOutputVerify(tx, index, value, pattern):
    output = tx.outputs[index]
    if value != 0:
        if output.value != value:
            return False
    if pattern != &quot;&quot;:
        sanitizedPattern = pattern.replace(&quot;PubKeyPlaceholder&quot;, &quot;00000000&quot;).replace(&quot;HashPlaceholder&quot;, &quot;00000000&quot;)
        mask = replaceLocationsOfPlaceholdersWithZeroes(&quot;1&quot;*len(sanitizedPattern), [&quot;PubKeyPlaceholder&quot;, &quot;HashPlaceholder&quot;])
        if (output.script &amp; mask) != sanitizedPattern:
            return False    
    return True
</code></pre>
<p><strong>注意</strong>：这种实现时错的，因为二进制操作被替换成了字符串操作，而这些字符串操作也有许多地方时错的（字节的伪装并没有被构造成由 1 组成的字符串），但作为一段伪代码案例，它可以帮助理解。</p>
<p>这种操作码可以启动所有类型的限制条款，但现在，它已经被其它方案取代了，得到部署的概率已经下降到了零。</p>
<h3 id="OP-CHECKOUTPUTSHASHVERIFY"><a href="#OP-CHECKOUTPUTSHASHVERIFY" class="headerlink" title="OP_CHECKOUTPUTSHASHVERIFY"></a>OP_CHECKOUTPUTSHASHVERIFY</h3><p>这个操作码是作为 tapscript 的一个插件而提出来的，并且目标是尽可能简单，仅仅是序列化一笔交易的输出、对结果哈希两次、跟传入的参数相比较：</p>
<pre><code class="python">def CheckOutputsHashVerify(tx, outputsHash):
    if sha256(sha256(tx.outputs)) == outputsHash:
        return True
    else:
        return False
</code></pre>
<p>关于这个操作码，少有人知晓的是，在脚本中，它所需要的参数是在OP_CHECKOUTPUTSHASHVERIFY 之后提供的，而不是先提供参数再提供操作码。这种行为跟其它的操作码大相径庭：它们一般是从栈中获得参数（即参数先进入堆栈）；这样做是为了防止输出的哈希值在脚本中构建。</p>
<p>这个提议后来被 OP_CHECKTEMPLATEVERIFY 取代了，后者修改了操作码的行为，以便在花费嵌入了这种限制条款的 UTXO 的交易中执行 “抗变形性（non-mallability）”，并且回归了使用 NOP 操作码来部署的方式（而不是作为 tapscript 的插件）。</p>
<p>这份 <a target="_blank" rel="noopener" href="https://github.com/JeremyRubin/bips/blob/op-checkoutputshashverify/bip-coshv.mediawiki">BIP</a> 提供了细节。</p>
<h3 id="OP-CHECKTEMPLATEVERIFY"><a href="#OP-CHECKTEMPLATEVERIFY" class="headerlink" title="OP_CHECKTEMPLATEVERIFY"></a>OP_CHECKTEMPLATEVERIFY</h3><p>曾用名 “OP_SECURETHEBAG”，是一种新版的 OP_CHECKOUTPUTSHASHVERIFY，它通过让哈希值覆盖交易的多个部分，实现了抗变形性（OP_CHECKOUTPUTSHASHVERIFY 中的哈希值仅包含了输出，所以不具有抗变形性）。</p>
<p>具体来说，这个操作码还会读取下列字段：</p>
<ul>
<li>Version bits（交易的版本位）</li>
<li>nLockTime（时间锁字段）</li>
<li>输入的签名脚本</li>
<li>输入的数量</li>
<li>nSequence</li>
<li>输出的数量</li>
<li>输出</li>
<li>当前被验证的输入的索引号</li>
</ul>
<p>将它们全部序列化，然后计算哈希值、跟栈顶的元素相比对，以此验证交易。</p>
<p>要了解更多信息，请看 <a target="_blank" rel="noopener" href="https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki">BIP119</a> 以及<a target="_blank" rel="noopener" href="https://utxos.org/">这个网页</a>。</p>
<h2 id="基于签名的限制条款"><a href="#基于签名的限制条款" class="headerlink" title="基于签名的限制条款"></a>基于签名的限制条款</h2><h3 id="关于签名的导论"><a href="#关于签名的导论" class="headerlink" title="关于签名的导论"></a>关于签名的导论</h3><p>下面是一份对 Schnorr 签名的简单解释；现在的比特币并不使用这种签名，但它们在概念上是相似的：</p>
<p>这种签名背后的主要想法是：假定你在某一条椭圆曲线上有一个点 <em>G</em>，以及一个数字 <em>n</em>，并且你可以很容易将它们相乘、得出同一条曲线上的另一个点 <em>N &#x3D; n·G</em> ，使得从 <em>N</em> 猜测出 <em>n</em> 是非常困难的、几乎不可能的。</p>
<p>那么，我们可以拿 <em>p</em> 当成我们的私钥，计算 <em>p·G &#x3D; P</em>，这就是我们的公钥 <em>P</em>（<em>G</em> 只是我们在曲线上选出来的一个点）。给定一笔交易 <em>tx</em> ，我们可以选出一个随机数 <em>k</em>，计算 <em>s &#x3D; k + hash(tx)·p</em> 以及 <em>K &#x3D; k·G</em> ，以 <em>(s, K)</em> 作为我们对这笔交易 <em>tx</em> 的签名（译者注：这里的算式是简化过的，跟实际使用的 Schnorr 签名不同）。</p>
<p>拿到这些数值，任何人都可以验证这个签名出自我手，他们只需检查 <em>s·G &#x3D; K + hash(tx)·P</em> 是否相等；因为只有知道 <em>p</em> 的人才能建构出这样的签名，而不知道 <em>p</em> 的人如果想计算出 s，就要通过点 <em>S &#x3D; K - hash(tx)·P</em> 来找出一个乘以 <em>G</em> 可以等于 <em>S</em> 的数字，这跟通过 N 来寻找 n 是一样的，这在我们解释的第一段里就已经假设是不可能的了。</p>
<p>基于签名的限制条款背后的想法是，虽然交易的信息对脚本来说并不能直接获得，但这些信息也被用来建构 OP_CHECKSIG（签名检查操作码）所用的 *hash(tx)*，因此，可以通过改造传递给 OP_CHECKSIG 的签名，间接地对比（交易的内容）。</p>
<h3 id="OP-CHECKSIGFROMSTACK"><a href="#OP-CHECKSIGFROMSTACK" class="headerlink" title="OP_CHECKSIGFROMSTACK"></a>OP_CHECKSIGFROMSTACK</h3><p>从内核上来说，这个操作码很简单，它取一条消息、一个公钥和一个签名，然后检查签名是否有效。有趣的地方在于，你可以使用这个操作码，将脚本内部建构的交易与触发调用的交易相比较、检查它们是否相等，因此它等于是可以访问被 OP_CHECKSIG 签名所用的哈希值覆盖的所有交易数据。</p>
<p>更具体来说，它的工作流程是：让一个 UTXO 的验证脚本（脚本公钥）构建（或者说验证）一笔序列化的交易，确保该交易具有特定属性（例如输出等同于提前建构好的一些输出），然后哈希这样的交易并对结果哈希值、来自赎回脚本（脚本签名）的 <em>(s, K, P)</em> 运行 OP_CHECKSIGFROMSTACK （赎回脚本中的数据是用户在链下计算好的）。</p>
<p>如果签名是有效的，那么 OP_CHECKSIG 将对相同的数值运行，也就是前面用过的数值 *(s, K, P)*（不包括那个哈希值）。如果其它操作码也返回了 True，那么我们就可以确定花费这个 UTXO 的交易，正是我们构造过的（因此执行了我们希望的任意条件）。这是因为 <em>s·G &#x3D; K + hash(tx<sub>构造交易</sub>)·P</em> 在且仅在 <em>s·G &#x3D; K + hash(tx<sub>真实交易</sub>)·P</em> 成立时，才成立。</p>
<p>要了解更多信息，请看<a target="_blank" rel="noopener" href="https://fc17.ifca.ai/bitcoin/papers/bitcoin17-final28.pdf">这篇论文</a>和<a target="_blank" rel="noopener" href="https://blockstream.com/2016/11/02/en-covenants-in-elements-alpha/">这篇文章</a>。</p>
<p><strong>注意</strong>：这个操作码已经在 Elements 上实现了，这是 Blockstream 的 Liquid 侧链赖以建立的区块链层。此外，一种非常类似的，叫做 <a target="_blank" rel="noopener" href="https://github.com/bitcoincashorg/bitcoincash.org/blob/master/spec/op_checkdatasig.md">OP_CHECKDATASIG</a> 的操作码，也已经在 Bitcoin Cash 上实现了。</p>
<h3 id="SIGHASH-NOINPUT-x2F-ANYPREOUTS"><a href="#SIGHASH-NOINPUT-x2F-ANYPREOUTS" class="headerlink" title="SIGHASH_NOINPUT&#x2F;ANYPREOUTS"></a>SIGHASH_NOINPUT&#x2F;ANYPREOUTS</h3><p>如果 SIGHASH_NOINPUT（ANYPREVOUTS）得到部署，也能创造一种有点局限的限制条款。这些限制条款基于提前创建多笔交易，然后构造出只能计算出一种签名的公钥，使得任何发送给这个公钥的资金都只能通过提前创建的交易来花费。</p>
<p>换句话说，你可以使用下列协议创建一种限制条款：</p>
<ol>
<li>构造一笔交易 <em>tx</em>，它会花费一些资金</li>
<li>选出一个数字 <em>s</em> 和一个点 <em>K</em>，必须是确定性的、可验证的（也可以是常数）</li>
<li>通过等式 <em>s·G &#x3D;  K + hash(tx)·P</em> 求解 P（公钥），即计算 <em>P &#x3D; hash(tx)<sup>-1</sup>(K - s·G)</em></li>
<li>把钱发送到一个只能用 <em>P</em> 的签名来解锁的地址</li>
</ol>
<p>因为 <em>P</em> 背后的私钥是未知的，所以除了一开始选定的 <em>s</em>，根本就不可能计算出别的签名；而这个 <em>s</em> 是对交易 <em>tx</em> 的签名。因此 <em>tx</em> 将是唯一一笔可以花费被 <em>P</em> 锁定的资金的交易。</p>
<p>但是，这套方案的一个大问题在于，为了构造交易 <em>tx</em> ，以及相应的 <em>P</em>，你需要把钱发给 <em>P</em> 的交易的 <em>txid</em>，但是为了构造出这样的交易，又必须先知道 <em>P</em>，这就成了一个死循环。</p>
<p>SIGHASH_NOINPUT 通过让 <em>hash(tx)</em> 可以不承诺交易的 txid，从而计算 <em>P</em> 也只需要对 <em>tx</em> 的输出的知识，解决了这个问题。</p>
<p>请看<a target="_blank" rel="noopener" href="https://blockstream.com/2016/11/02/en-covenants-in-elements-alpha/">首次介绍这套方案的 bitcoin-dev 帖子</a>，了解更多细节。</p>
<h3 id="签名的构造"><a href="#签名的构造" class="headerlink" title="签名的构造"></a>签名的构造</h3><p>另一种类似的方案没有选择依赖于 SIGHASH_NOINPUT，转而依赖任一种可以对堆栈中的一个元素的一部分执行检查的操作码（例如：OP_AND、OP_SUBSTR、OP_CAT……），从而启用了通用的限制条款，并且是基于直接在脚本内构造某一笔交易的签名的：</p>
<ol>
<li>在脚本内部，获得一笔交易 <em>tx</em> 并验证所有的属性都符合限制条款的要求</li>
<li>在脚本内部，计算 <em>hash(tx)</em> + 1，然后以 <em>-G</em> 为公钥（<em>P</em>）、G 为 nonce（<em>K</em>）、刚刚计算出的值为 <em>s</em>，执行 OP_CHECKSIG 。另一种理解这种操作的角度是，将私钥 <em>p</em> 设为 -1，nonce（k）设为 1。</li>
<li>如果 OP_CHECKSIG 检查通过，则被花费的交易就是 <em>tx</em>。</li>
</ol>
<p>这个方案的重点是，OP_CHECKSIG 变成了检查 *s·G &#x3D; G + hash(tx)·(-G)*，该等式仅在 <em>s &#x3D; hash(tx) + 1</em> 时才为真，因此，通过构造 <em>s &#x3D; hash(tx<sub>构造交易</sub>) + 1</em>，我们让 <em>hash(tx<sub>构造交易</sub>) + 1</em> &#x3D; <em>hash(tx<sub>真实交易</sub>) +1</em>，这就是直接检查在脚本内构造的交易与花费这笔输出的交易是一样的。</p>
<p>你可能会好奇为什么要让 <em>k &#x3D; 1</em> 而不是让 <em>k &#x3D; 0</em>，这样可以在计算的时候省去一个烦人的 “+1”。原因很简单，签名标准不允许我们将 k 设为 0。</p>
<h3 id="多签名的变种"><a href="#多签名的变种" class="headerlink" title="多签名的变种"></a>多签名的变种</h3><p>另一种可以在当前的比特币协议中创造限制条款的方案需要一个受信任的启动设置：一次性的密钥。主要的想法就是你可以创建一个新的私钥，使用它签名一组交易，然后毁掉这个私钥，仅保留签好名的交易，从而这个密钥名下的钱将只能通过这些交易来花费。</p>
<p>这种想法还可以延伸成多签名的启动设置：受信任的启动设置为所有的参与者一起构造一个 n-of-n 的多签名，以及所有需要的交易，然后，每一位参与者都将自己的私钥销毁，只要至少一个人诚实地销毁了自己的私钥，即可保证不再能构造出有效的签名，实际上就变成了一种限制条款。也就是说，如果没有人销毁自己的私钥，并且所有的参与者会串谋，就能创造出新的任意签名，让限制作用完全消失。因此，这种方案需要信任（假设参与初始化设置的人中至少有一个是诚实的）。</p>
<p style="text-align:center">- - -</p>


<p>本文是开源的（MIT 许可），并且可以在 <a target="_blank" rel="noopener" href="https://github.com/corollari/bitcoin-covenants">Github</a> 上获得。欢迎贡献。</p>
<p>（完）</p>
</article></div></div></main><script src="/js/post.js?v=1676085091299"></script><script src="/js/highlight.min.js?v=1676085091299"></script><script>var containerEl = document.querySelector('.post-container');
var postFontSize = localStorage.getItem('post-font-size') || '16';
var inputEl = document.querySelector('#size-change-input');
var inputEl2 = document.querySelector('#size-change-input2');
inputEl.value = postFontSize;
inputEl2.value = postFontSize;
containerEl.style.fontSize = postFontSize + 'px';
$(function(){
  function setSizeChangeInputValue(size) {
    $('.post-container').css('font-size', size + 'px');
    localStorage.setItem('post-font-size', size);
    $('#size-change-input').val(size);
    $('#size-change-input2').val(size);
  }
  $('#size-change-input').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
  $('#size-change-input2').on('input propertychange', function(e) {
    const size = e.target.value;
    setSizeChangeInputValue(size);
  });
});
</script><script>hljs.initHighlightingOnLoad();</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com/btcstudy">Twitter</a><!-- Github--><!-- Ins--><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml">rss</a><!-- 知乎--><!-- 领英--><!-- 脸书--><!-- Telegram--><a title="telegram" target="_blank" rel="noopener nofollow" href="//t.me/btcstudyorg">Telegram</a></section></footer><script async src="/js/buttons.js?v=1676085091299"></script><script async src="/js/index.js?v=1676085091299"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-JVCJ9XXG1Z');</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306";
  hm.async = true;
  hm.defer = true;
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
  </script></body></html>