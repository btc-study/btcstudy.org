<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>交易包的交易池把关规则</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/tools>工具</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">交易包的交易池把关规则</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>交易包的交易池把关规则</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/tools>工具</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%83%8C%E6%99%AF><span class=toc-text>背景</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%9C%AF%E8%AF%AD%E6%B8%85%E7%90%86><span class=toc-text>术语清理</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%A7%84%E5%88%99><span class=toc-text>规则</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BA%A4%E6%98%93%E5%8C%85%E8%BD%AC%E5%8F%91%E5%92%8C%E4%BA%A4%E6%98%93%E6%B1%A0%E6%8A%8A%E5%85%B3><span class=toc-text>交易包转发和交易池把关</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B9%8B%E5%89%8D%E7%9A%84%E5%B7%A5%E4%BD%9C><span class=toc-text>之前的工作</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%8E%B0%E6%9C%89%E7%9A%84%E4%BA%A4%E6%98%93%E5%8C%85%E8%A7%84%E5%88%99><span class=toc-text>现有的交易包规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%89%80%E6%8F%90%E8%AE%AE%E7%9A%84%E5%8F%98%E6%9B%B4><span class=toc-text>所提议的变更</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-text>总结</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BB%86%E8%8A%82><span class=toc-text>细节</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%80%BB%E6%98%AF%E5%B0%9D%E8%AF%95%E5%85%88%E6%8F%90%E4%BA%A4%E4%BA%A4%E6%98%93%E5%8D%95%E4%BD%93><span class=toc-text>总是尝试先提交交易单体</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%A2%84%E6%9C%9F-FAQ><span class=toc-text>预期 FAQ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%87%B4%E8%B0%A2><span class=toc-text>致谢</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>交易包的交易池把关规则</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Gloria Zhao"><div class=page-author-info><strong>Gloria Zhao</strong><time class=has-text-grey datetime=2023-08-15T07:21:13.000Z>2023-08-15</time></div></div><div class=is-flex><a href=/tags/%E4%BA%A4%E6%98%93%E5%8C%85><i class="page-tag mr-1 px-1">交易包</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Gloria Zhao</em></p><p><em>来源：<a target=_blank rel=noopener href=https://gist.github.com/glozow/dc4e9d5c5b14ade7cdfac40f43adb18a>https://gist.github.com/glozow/dc4e9d5c5b14ade7cdfac40f43adb18a</a></em></p></blockquote><p>我正在提议改变 <code>Bitcoin Core</code> 的一组交易池规则（policy，策略），以开启基于交易包的交易池验证（作为 “交易包转发” 特性的准备工作）。这不是共识层的改变，也不是 P2P 协议层的改变。但是，因为交易池规则将极大地影响交易的传播，所以我认为在邮件组里公开也是有意义的。</p><p>我的提案将允许多笔父交易和一笔子交易形成一个交易包并在网络中传播。如果你所开发的软件依赖于特定的交易转发假设 以及&#x2F;或者 将在未来使用 “交易包转发（package relay）” 特性，我很希望能听到你对交易包规则在你的应用中的效用和局限性的反馈。</p><p>这份提议的一个草案实现可以在 <a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/22290>Bitcoin Core PR#22290</a> 找到。</p><h2 id=背景><a href=#背景 class=headerlink title=背景></a>背景</h2><p>如果你已经熟悉交易池规则和交易包相关的术语，尽可以跳过这部分。</p><h3 id=术语清理><a href=#术语清理 class=headerlink title=术语清理></a>术语清理</h3><ul><li>交易包（package）：相关交易的一个有序列表，可以用一个 “有向无环图（directed acyclic graph）” 来表示</li><li>交易包手续费率：包内所有交易的修正后总费用（total modified fees）除以总虚拟体积<ul><li>修正后费用：一笔交易的基础费用（base fees）加上用户使用 <code>prioritisetransaction</code> 指定的手续费偏移量。因此，我们预计这个值在不同交易中各不相同</li><li>虚拟体积：使用 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/1f0b563738199ca60d32b4ba779797fc97d040fe/bip-0141.mediawiki#transaction-size-calculations>BIP141 虚拟体积</a>规则和 sigop 重量计算出来的虚拟体积最大值。<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/blob/94f83534e4b771944af7d9ed0f40746f392eb75e/src/policy/policy.cpp#L282>在 <code>Bitcoin Core</code> 的这里实现</a></li></ul></li><li>手续费追加（fee bumping）：用户&#x2F;钱包 的动作，利用矿工的激励加速一笔交易进入区块的优先级，包括 “子为父偿（CPFP）” 和 “<a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki>BIP125</a> 手续费替换”。在交易池规则中，我们的目标是，判断出一笔新进入的交易是否比池内原来的交易更加经济，但不会开启 DoS 界面，所以也需要一些限制。</li></ul><h3 id=规则><a href=#规则 class=headerlink title=规则></a>规则</h3><p>交易池的目标是存储最好的（跟矿工的激励最相容的、手续费率最高的）区块内容候选。矿工使用交易池来构建挖矿区块模板。交易池也是一个有用缓存，可以加速区块转发、提高验证性能、协助交易转发，以及声称手续费率估计。</p><p>理想情况下，所有在共识上有效、支付了足够多手续费的交易，都应该能够通过常规的交易转发特性传递给矿工，而不需要专门的连接和矿工私人关系。但另一方面，节点没有无限的资源，而且一个设计上允许诚实节点广播自己的交易的点对点网络，也将交易验证引擎暴露在恶意对等节点的 DoS 攻击下。</p><p>因此，在考虑让我们的交易池接纳哪些未确认交易时，我们在共识规则之上增设了一组验证规则，主要是为了保护自己的资源不要耗尽，以及协助我们保存最高手续费的交易的工作。我们将这些规则称为交易池的 “policy”：一组（可配置的、各节点不同的）规则，用于限制哪些交易能进入我们的交易池。交易的 “标准化” 规则以及交易池限制（例如 “too-long-mempool-chain”）都是交易池规则的例子。</p><h3 id=交易包转发和交易池把关><a href=#交易包转发和交易池把关 class=headerlink title=交易包转发和交易池把关></a>交易包转发和交易池把关</h3><p>当前，在 “交易转发（transaction relay）”中，我们把交易提交给交易池的时候，一次只考虑一笔交易。这就限制了节点确定具有最高手续费率交易的能力，因为我们无法考虑后代交易的影响（即，无法使用 CPFP），除非所有的交易都在交易池中。类似地，在考虑 RBF 时，我们也无法使用一笔交易的后代。当一笔交易的单体费率达不到交易池的手续费率门槛、用户又无法直接创建一笔替代交易时，用户的交易就不会被这个交易池接受。</p><p>这种局限性对依赖于时间敏感型交易的应用和用户来说，成了一个安全问题。举个例子，闪电网络和其它协议创建了带有多种花费路径的 UTXO，其中一方的花费路径是在一个时间锁之后开放的，而另一方保护自己免受欺诈的办法就是及时在链上赎回资金。一个关键的安全假设是，各方都能广播交易并让自己的交易及时得到确认。如果手续费追加的方法无法按照预期工作，这种假设就会被打破。</p><p>交易包转发的终极目标是，同时考虑多笔交易，例如，一笔交易及其高手续费的子交易。这可以帮助我们更好地确定一笔交易是否应被交易池接纳，尤其是该交易本身够不上手续费门槛的时候；以及，该交易是不是一个交易包的更好的 RBF 候选。结合交易池验证逻辑、交易池规则和交易转发协议上的改变，我们将可以更好地传播最高费率的交易包给矿工，并让手续费追加的工具为用户发挥更大的作用。</p><p>交易包转发的 “转发” 部分需要点对点协议的消息的变更，但大部分只要求交易池的交易包验证逻辑变更。我们称之为 “交易包的交易池把关（package memool accept）”。</p><h3 id=之前的工作><a href=#之前的工作 class=headerlink title=之前的工作></a>之前的工作</h3><ul><li>给定交易池验证是 DoS 敏感而且复杂的，随意添加交易包验证逻辑是危险的。人们已经做了许多工作，让交易池验证变得更清晰（见 <a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/16400>#16400</a>、<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/21062>#21062</a>、<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/22675>#22675</a>、<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/22796>#22796</a>）。</li><li><a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/20833>#20833</a> 加入了基本的交易包验证功能，但只接受测试（不能提交到交易池）</li><li><a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/21800>#21800</a> 实现了对任意交易包的 祖先&#x2F;后代 限制检查。依然只接受测试。</li><li>以前的交易包转发提议（见 <a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/16401>#16401</a>、<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/19621>#19621</a>）。</li></ul><h3 id=现有的交易包规则><a href=#现有的交易包规则 class=headerlink title=现有的交易包规则></a>现有的交易包规则</h3><p><a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/20833>#20833</a> 和 <a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/21800>#21800</a> 已经将交易包的验证引入到 <code>Bitcoin Core</code> 的 master 分支。在本文剩下的章节中，我会将它们视为 “给定的”，虽然它们也可能会变化，因此交易包验证现在只接受测试。</p><ol><li><p>交易包的交易笔数不能超过 <code>MAX_PACKAGE_COUNT=25</code>，总体积不能超过 <code>MAX_PACKAGE_SIZE=101KvB</code>。（#20833）</p><p><em>理由</em>：这是已经由交易池强制执行的 祖先&#x2F;后代 数量限制。可以假设，一个包内的交易都是有关联的，所以超过这个限制也就意味着要么交易包会被分拆，要么它无法通过交易池规则的检查</p></li><li><p>交易包必须是拓扑有序的：如果一笔交易依赖于另一笔交易，那么在列表上，父母交易必须出现在子交易以前的位置。（#20833）</p></li><li><p>交易包内不能出现相互冲突的交易，即，没有任意两笔交易花费了相同的输入。这也意味着不能有重复的交易。（#20833）</p></li><li><p>测试中的交易包在接受 祖先&#x2F;后代 数量检查时，所有祖先和后代的结合都会被一起考虑。这本质上就是一个 “最坏情形” 的线索分析，也就是交易包内的每一笔交易都是其它交易的祖先和后代的时候。（#21800）</p></li></ol><p>超过 祖先&#x2F;后代 限制的交易包会被这种线索分析准确捕捉到：</p><p><img src=/images/package-mempool-accept-post-gist-by-glozow/133456219-0bb447cb-dcb4-4a31-b9c1-7d86205b68bc.png alt=image></p><p>还有一些限制，例如 CPFP carve out 规则不适用于交易包的交易。#20833 还禁用了交易包验证中的 RBF；本提案覆盖了这些限制，以允许交易包使用 RBF。</p><h2 id=所提议的变更><a href=#所提议的变更 class=headerlink title=所提议的变更></a>所提议的变更</h2><p>交易包的交易池把关项目的下一个步骤是实现给交易池提交交易包，一开始只允许通过 PRC 方法。这将允许我们在将入口暴露给 P2P 网络之前测试提交的逻辑。</p><h3 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h3><ul><li><a target=_blank rel=noopener href=https://gist.github.com/glozow/dc4e9d5c5b14ade7cdfac40f43adb18a#packages-may-contain-already-in-mempool-transactions>交易包可能会包含已经在交易池中的交易</a>。</li><li><a target=_blank rel=noopener href=https://gist.github.com/glozow/dc4e9d5c5b14ade7cdfac40f43adb18a#packages-are-multi-parent-1-child>交易包包含两代交易，允许多笔父交易和一笔子交易</a>。</li><li><a target=_blank rel=noopener href=https://gist.github.com/glozow/dc4e9d5c5b14ade7cdfac40f43adb18a#fee-related-checks-use-package-feerate>手续费相关的检查将使用交易包的费率</a>。这意味着钱包将可以创建一个交易包来使用 CPFP。</li><li><a target=_blank rel=noopener href=https://gist.github.com/glozow/dc4e9d5c5b14ade7cdfac40f43adb18a#package-rbf>父交易可以在类似于 BIP125 的一套规则下凭手续费（RBF）替换交易池内的交易</a>。这开启了 CPFP 和 RBF 的结合，让一笔交易的后代可以支付手续费以击败其在交易池内的冲突交易。</li></ul><p>一个实现草稿见 <a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/22290>#22290</a> 。它还没有完工，但欢迎一切反馈。</p><h3 id=细节><a href=#细节 class=headerlink title=细节></a>细节</h3><p><strong>交易包可能包含已经在交易池中的交易</strong></p><p>一个交易包可能包含已经在交易池中的交易；出于交易池把关的目的，我们会从交易包中移除这些交易（称为 “消除复制”）。如果在消除复制之后，交易包成了空的，那就不做任何事。</p><p><em>理由</em>：网络上的每个交易池都有所不同。所以，完全有可能某些节点的交易池已经接受了交易（因为其交易池规则的差异和手续费市场的波动）。我们不应该因为一笔交易而拒绝或惩罚整个交易包，因为这可能变成一个审查攻击界面。</p><p><strong>交易包是 多笔父交易 + 一笔子交易</strong></p><p>只允许特定拓扑类型的包。也即，一笔交易包就是一笔子交易加上其所有未确认的父交易。在去除复制之后，交易包可能：不变、变成空的、只剩一笔子交易、一笔子交易加上部分未确认的父交易，等等。注意，父交易可能是彼此间的间接后代，或者说，某一个父交易会跟子交易共享另一个父交易，所以我们无法再作其它任何拓扑上的假设。</p><p><em>理由</em>：这允许使用 CPFP 来追加手续费。允许多笔父交易，使得我们可以为一批交易追加手续费。限制交易包的拓扑类型，也使得交易包更容易分析，可以极大地减价验证逻辑。多笔父交易 + 一笔子交易 的模式，允许我们将整个包理解为一笔体积巨大的交易，其特性是：</p><ul><li>输入 &#x3D; 所有父交易的输入 + 子交易中来自于已经确认的 UTXO 的输入</li><li>输出 &#x3D; 子交易的所有输出 + 所有父交易的未被交易包内交易花费的输出</li></ul><p>遵循此规则的包的示例（示例 A 的变体展示了消除复制之后的可能结果）：</p><p><img src=/../images/package-mempool-accept-post-gist-by-glozow/132856734-fc17da75-f875-44bb-b954-cb7a1725cc0d.png alt=image></p><p><strong>手续费相关的检查使用交易包手续费率</strong></p><p>交易包手续费率 &#x3D; 包内所有交易的修正后总费用（total modified fees）除以总虚拟体积</p><p>为了够得上交易池的两种手续费率门槛：预先配置的最低手续费率（<code>minRelayTxFee</code>）以及动态的交易池最低费率，我们使用整个交易包的手续费率（而不是某一笔交易的手续费率）。交易的单体手续费率可以低于这个门槛，只要交易包可以够得上这个门槛就行。举个例子：交易包内的父母交易可以使用 0 手续费率，而由子交易来支付手续费。</p><p><em>理由</em>：这可以认为是 “交易包内的 CPFP”，解决了一笔父交易无法凭自身满足手续费率要求的问题。这使得 L2 应用可以在广播的时候调整自己的手续费，而不是只能高估手续费（不高估就要担心交易 卡住&#x2F;被钉死 的风险）。</p><p>我们使用交易包 <em>消除复制</em> 之后的手续费率。</p><p><em>理由</em>：使用已经在交易池内的交易的手续费是不正确的，因为我们不希望一笔交易的手续费被重复统计（在自身的 RBF 中被统计一次、在交易包 RBF 中又被统计一次）。</p><p>下图的案例 F 和 G 实际上相同的交易包；但在 G 中，P1 在交易包广播之前就已经提交了。在案例 F 中，我们可以看到，300vB 的交易包额外支付了 200 从的手续费，这不足以支付自身的带宽（根据 BIP125#4 规则）。而在案例 G 中，可以看到 P1 支付了足够多的手续费来取代 M1，但如果在交易包提交时再次使用 P1 的手续费，则看起来就像一个 200 vB 的交易包额外支付了 300 聪手续费。尽管在案例 F 中，考虑其手续费和体积的结果就是手续费是不够的，但 300 聪看起来足以为 300 vB 的交易包支付手续费。在消除复制之后，可以得出这个 200 vB 的交易包只额外支付了 100 聪的手续费，所以根据 BIP125#4 ，它会正确地传出失败。假设所有交易的体积都是 100 vB。</p><p><img src=/../images/package-mempool-accept-post-gist-by-glozow/133567078-075a971c-0619-4339-9168-b41fd2b90c28.png alt=image></p><p><strong>交易包 RBF</strong></p><p>如果交易包满足了手续费率的要求，这个交易包就可以替代交易池内的交易，只要任何一笔父交易跟交易池内的交易相互冲突的话。子交易不能跟交易池内的任何交易冲突。多笔父交易可以替代同一笔交易，但为了交易包是有效的，不能有任何任何交易尝试替代另一笔交易的祖先（这会让某一些交易的输入不可用）。</p><p><em>理由</em>：即使我们使用了交易包的手续费率，如果 RBF 依然要求每一笔交易都满足手续费率要求，那么交易包就依然不会按照我们的预期传播。</p><p>我们使用一组几乎跟 BIP125 一样的规则，如下：</p><ul><li><p><strong>信号（规则 #1）</strong></p><p>所有可被替换的交易池交易，都必须用信号表明可替换性。</p><p><em>理由</em>：交易包的 RBF 信号逻辑，应该跟交易包 RBF 和单体交易 RBF 相同。如果单体交易的验证迁移到了完全 RBF，那么这一点也会升级。</p></li><li><p><strong>新的未确认输出（规则 #2）</strong></p><p>交易包内的所有交易，包括并不与任何交易池内交易直接冲突的交易，都只能包含一个未确认的输入，如果该输入已经被包含在另一笔直接冲突的交易池内交易中、或者来自交易包内的另一笔交易的话。</p></li><li><p><strong>绝对手续费（规则#3）</strong></p><p>交易包必须提高交易池的绝对手续费，即，交易包的总手续费，必须比它要替换的交易池内交易的绝对手续费更高。结合上述的 CPFP 规则，它跟 BIP125 规则 #3 不同：交易包内的某一笔交易的单体手续费可能比它要替换的交易的手续费更低。实际上，交易包内的父交易可能只有 0 手续费，是由子交易来为 RBF 支付手续费的。</p></li><li><p><strong>手续费率（规则 #4）</strong></p><p>交易包必须为自己的带宽支付费用；交易包的手续费率必须比被替换的交易高出转发手续费率的最小值（<code>incrementalRelayFee</code>）。结合上面待 CPFP 规则，它跟 BIP125 规则 #4 有所不同：交易包内的某一笔交易的单体手续费可能比它要替换的交易的手续费更低。实际上，交易包内的父交易可能只有 0 手续费，是由子交易来为 RBF 支付手续费的。</p></li><li><p><strong>被替换的交易的总数量（规则 #5）</strong></p><p>交易包不能替换超过 100 笔交易池内的交易。这跟 BIP 125 规则 #5 是一样的。</p></li></ul><h3 id=总是尝试先提交交易单体><a href=#总是尝试先提交交易单体 class=headerlink title=总是尝试先提交交易单体></a>总是尝试先提交交易单体</h3><p>我们应该总是先尝试提交交易单体，再对剩余的交易使用交易包验证逻辑。不这样做不会打破交易包验证，只是可能产生激励不兼容。</p><p><em>理由</em>：交易包的用意是产生激励兼容的手续费追加操作。也就是说，仅当交易 A 是交易 B 的后代并且具有更高的手续费率时，A 才是 B 的合法的手续费追加交易。检查这一点的一种办法是分析交易包内的所有交易的手续费和关系，但先单笔单笔地提交它们会简单得多。</p><p>案例 Q1 和 Q2 展示了交易包手续费率的粗心应用可能导致 “父为子偿” 的行为。假设所有交易都是 100 vB；两个的交易包手续费率都是 2.5 聪&#x2F;vB，但子交易的贡献都非常小。在 Q1 中，只接受 P1 就可以获得所有的手续费，而不必再接受 P2 的额外 100 vB，所以 P2 应被拒绝。而在 Q2 中，P3 贡献了 50 聪，但体积是 100 vB，所以它也应该被拒绝。注意 Q2 的一个临界情形：单独提交每一笔交易并无帮助，因为 P1 的手续费是 0 聪，而 P2 依赖于 P1。幸好，P1 + P2 也是一个有效的交易包，因此可以得到广播。</p><p><img src=/../images/package-mempool-accept-post-gist-by-glozow/135247630-9532aa5c-3d8e-4491-935c-a4f6ab8cfdbf.png alt=image></p><p>R1 和 R2 展示了交易包手续费率的粗心应用可能导致 “兄为弟偿” 的行为。假设所有交易都是 100vB 的体积。R1 勉强跨国手续费率的门槛，交易包手续费率为 1 聪&#x2F;vB；我们会就这样接受这个交易包，但 P2+P3 会很快从交易池中逐出（P2 有一个后代交易，费率为 0.5 聪&#x2F;vB）。</p><p>在 R2 中，交易包手续费率足以替代 M1 和 M2，但 P1 支付了绝大部分手续费。矿工挖掘 P1+M2 跟挖掘 P1+P2 所得的手续费是相同的。挖掘 P1+P2+P3 可以额外得到 100 聪，但需要路由额外的 200vB 体积的交易 —— 它们没有为自己的带宽付费。通过先接受 P1，然后再以交易包的形式验证 P2+P3，我们很容易贯彻交易包的规则。</p><p><img src=/../images/package-mempool-accept-post-gist-by-glozow/135249173-56517b91-4e3d-4b3a-bde2-f4877e043b12.png alt=image></p><p><em>理由</em>：我们可以更快检查出错误。如果第一笔交易都没有通过签名检查，那就不需要运行交易包验证了。</p><p><em>理由</em>：交易包验证仅仅应该在能够 <em>提升</em> 交易被交易池接纳的可能时运用；我们希望防止一些微妙的 bug：单体交易和交易包的规则上的少许不一致，使得交易包转发变成了单体交易的审查攻击界面。</p><h3 id=预期-FAQ><a href=#预期-FAQ class=headerlink title="预期 FAQ"></a>预期 FAQ</h3><blockquote><p>问：是否可以仅接纳部分交易包到交易池中？</p></blockquote><p>答：可以。如果接受某一些交易而不接受另一些会更经济的话，我们就会这样做。如果人们使用交易包来追加手续费（即，子交易为否则就不能进入交易池的父交易资助手续费），那么最常见的情况应该是：要么全部接受，要么全部拒绝。</p><blockquote><p>问：我们应该允许交易包包含已经确认的交易吗？</p></blockquote><p>答：出于实用的利用，不应该。在交易池验证中，实际上我们不能 100% 确认我们是不是在检查一笔已经确认的交易，因为我们要使用一个 UTXO 集来检查输入。如果我们有历史区块数据，可以在区块中搜索它，但这样做很低效，而且对剪枝节点来说也并不总是可行的，而且也是不必要的，因为我们也不能拿这样的交易做什么。因此，我们已经有一个预期，交易转发在一定程度上是 “带状态的”，即，没有人应该转发已经被确认的交易。类似地，我们不应该转发包含已经确认的交易的交易包。</p><h2 id=致谢><a href=#致谢 class=headerlink title=致谢></a>致谢</h2><p>感谢 John Newbery、Dave Harding 和 Mark Erhardt 在撰写本文中提供的帮助。</p><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>