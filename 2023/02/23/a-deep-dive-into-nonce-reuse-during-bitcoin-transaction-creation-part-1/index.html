<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>深入探究比特币交易中的 nonce 复用，Part-1</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">深入探究比特币交易中的 nonce 复用，Part-1</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>深入探究比特币交易中的 nonce 复用，Part-1</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BF%AB%E9%80%9F%E5%9B%9E%E9%A1%BE%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%AD%E7%9A%84%E7%AD%BE%E5%90%8D%E6%9E%84%E9%80%A0><span class=toc-text>快速回顾比特币中的签名构造</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%82%A3%E4%B9%88-nonce-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E5%90%8C%E4%B8%80%E4%B8%AA%E7%A7%81%E9%92%A5%E4%B8%8D%E8%83%BD%E9%87%8D%E5%A4%8D%E4%BD%BF%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA-nonce%EF%BC%9F><span class=toc-text>那么 nonce 是什么？为什么不能同一个私钥不能重复使用同一个 nonce？</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#nonce-%E5%A4%8D%E7%94%A8%E5%9C%A8%E6%AF%94%E7%89%B9%E5%B8%81%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E5%8F%91%E7%94%9F%E8%BF%87%E5%90%97%EF%BC%9F><span class=toc-text>nonce 复用在比特币区块链上发生过吗？</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%9C%80%E8%A6%81%E8%AE%B0%E4%BD%8F%E7%9A%84%E7%BD%95%E8%A7%81%E6%83%85%E5%BD%A2><span class=toc-text>需要记住的罕见情形</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9C%89%E8%B6%A3%E7%9A%84%E6%95%B0%E6%8D%AE><span class=toc-text>有趣的数据</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%A7%81%E9%92%A5%E6%B3%84%E9%9C%B2%E7%9A%84%E6%95%B0%E9%87%8F%E4%B8%8E%E5%8C%BA%E5%9D%97%E9%AB%98%E5%BA%A6%E7%9A%84%E5%85%B3%E7%B3%BB><span class=toc-text>私钥泄露的数量与区块高度的关系</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%A4%9A%E6%AC%A1%E6%B3%84%E9%9C%B2%E5%90%8C%E4%B8%80%E4%B8%AA%E7%A7%81%E9%92%A5><span class=toc-text>多次泄露同一个私钥</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BC%A0%E7%BB%9F%E8%BE%93%E5%85%A5-vs-%E9%9A%94%E7%A6%BB%E8%A7%81%E8%AF%81-v0-%E8%BE%93%E5%85%A5%E7%9A%84%E5%9C%B0%E5%9D%80%E5%A4%8D%E7%94%A8><span class=toc-text>传统输入 vs. 隔离见证 v0 输入的地址复用</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%8D%E5%90%8C%E7%A7%81%E9%92%A5%EF%BC%8C%E4%BD%86%E7%94%A8%E4%B8%8A%E4%BA%86%E5%90%8C%E4%B8%80%E4%B8%AA-nonce-%E5%80%BC><span class=toc-text>不同私钥，但用上了同一个 nonce 值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%AF%86%E5%88%AB%E6%95%85%E6%84%8F%E7%9A%84%E7%A7%81%E9%92%A5%E6%B3%84%E9%9C%B2%E7%9A%84%E5%8F%AF%E8%83%BD%E7%BA%BF%E7%B4%A2><span class=toc-text>识别故意的私钥泄露的可能线索</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%9E%E7%8E%B0%E4%B8%80%E7%A7%8D-nonce-%E5%A4%8D%E7%94%A8%E6%89%AB%E6%8F%8F%E4%BB%AA><span class=toc-text>实现一种 nonce 复用扫描仪</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%88%9D%E6%AD%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BB%A5%E5%8F%8A%E8%A7%82%E5%AF%9F%E5%88%B0%E7%9A%84%E6%A8%A1%E5%BC%8F><span class=toc-text>初步的数据以及观察到的模式</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88><span class=toc-text>问题的解决方案</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>深入探究比特币交易中的 nonce 复用，Part-1</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Ishaana Misra"><div class=page-author-info><strong>Ishaana Misra</strong><time class=has-text-grey datetime=2023-02-23T08:07:32.000Z>2023-02-23</time></div></div><div class=is-flex><a href=/tags/%E5%AF%86%E7%A0%81%E5%AD%A6><i class="page-tag mr-1 px-1">密码学</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Ishaana Misra</em></p><p><em>来源：<a target=_blank rel=noopener href=https://ishaana.com/blog/nonce_reuse/ >https://ishaana.com/blog/nonce_reuse/</a></em></p></blockquote><p>在我刚开始了解怎么创建比特币交易的时候，我记得我读到过几段话，讲的是创建签名的时候复用 nonce 对资金安全是致命的。那时候我还不太理解，只是把它当成编写钱包软件时需要记住的额外事项。几个月以前，我决定重新检查一下我编写的测试网钱包是怎么构建交易的，尤其是签名的流程。我因此开始检查我的钱包是如何生成 nonce 的，以及我的钱包用来保证每个 nonce 都只用一次的技术。这一次，我准备再深入一点。</p><p>比特币交易中的 Nonce 不可以复用，因为这会导致资金损失。<a target=_blank rel=noopener href=https://bitcoin.stackexchange.com/ >Bitcoin Stack Exchange</a> 网站上有许多关于 nonce 复用的提问，还有人问如何从犯了这个错误的人手上盗取比特币（没错，不是所有的问题都是善意的）。<a target=_blank rel=noopener href=https://bitcointalk.org/ >Bitcoin Talk</a> 论坛上也有一些帖子，提到了现在有一些机器人会从那些复用了 nonce 的地址中盗窃资金。</p><p>那么，如果这是一个由来已久的问题，并且有众所周知的解决方案（我在上面也暗示了我编写的钱包软件就使用了其中一种），为什么我还要花时间写这篇文章呢？Nonce 复用经常被列为 “绝对不要这样做” 的事项，而且现在因为 nonce 复用而丢失资金的情况也越来越少（因为钱包软件相比以往有了很大的进步）。但是，很少有关于这个主题的历史分析。我找到了一些关于这个主题的文章，但没有很多，而且这些文章要么已经过时了，要么不像我希望的那么详细。</p><p>所以，我决定自己尝试一下，使用来自我的比特币节点的信息、看看 nonce 复用在以往的流行程度。我决定分成多篇文章来发表，因为首先扫描区块链以发现 nonce 复用就需要时间，而分析这些数据以找出异常、模式以及某些数据出现的原因，可能需要更长时间。分成多篇文章可以让我每一篇文章都集中在一个主题上。</p><p>本文（第一篇）介绍的是 nonce 是怎么用在签名创建中的、我的 nonce 复用扫描仪的初步实现、我认为可能会有趣的特定数据，以及我迄今已经收集的一些初步数据。</p><h2 id=快速回顾比特币中的签名构造><a href=#快速回顾比特币中的签名构造 class=headerlink title=快速回顾比特币中的签名构造></a>快速回顾比特币中的签名构造</h2><blockquote><p>注：如果你完全不了解 ECDSA（椭圆曲线数字签名算法）和比特币中的数字签名，我会建议你读读 Jimmy Song 的《<a target=_blank rel=noopener href=https://github.com/jimmysong/programmingbitcoin>Programming Bitcoin</a>》一书的前三章。</p></blockquote><p>定义如下（注意，小写字母表示标量，而大写字母表示椭圆曲线上的点）：</p><ul><li>G 为 <em>椭圆曲线上的生成器点</em></li><li>e 为 <em>私钥</em></li><li>P &#x3D; e * G 为 <em>公钥</em></li><li>k 为 <em>秘密的 nonce 值</em></li><li>R &#x3D; k * G</li><li>r 为 <em>R 的 x 坐标</em></li><li>z 为 <em>被签名的消息，也即 sighash</em></li></ul><p>计算 s：</p><ul><li><a target=_blank rel=noopener href=https://bitcoin.stackexchange.com/a/73624/131112>s &#x3D; (h + re)&#x2F;k（都要对 N 求模）</a></li></ul><p>所以，完整的签名是：</p><ul><li>{r, s}</li></ul><h2 id=那么-nonce-是什么？为什么不能同一个私钥不能重复使用同一个-nonce？><a href=#那么-nonce-是什么？为什么不能同一个私钥不能重复使用同一个-nonce？ class=headerlink title="那么 nonce 是什么？为什么不能同一个私钥不能重复使用同一个 nonce？"></a>那么 nonce 是什么？为什么不能同一个私钥不能重复使用同一个 nonce？</h2><p>Nonce 的全部意义就是为上面的签名等式引入随机性。因此，如果同一个私钥对两条不同的消息签名时居然使用了相同的 nonce，那它就完全没有意义了。以下是详细解释：</p><p>给定两个签名 {r, s1} 和 {r, s2} 是同一个私钥对两条不同的消息 z1 和 z2 的签名，并且使用了相同的 nonce（也就是两个签名的 k、r 和 e 是相同的），那么：</p><ul><li>s1 &#x3D; (z1 + re)&#x2F;k</li><li>s2 &#x3D; (z2 + re)&#x2F;k</li></ul><p>把它们都乘以 k 之后：</p><ul><li>s1 * k &#x3D; z1 + re</li><li>s2 * k &#x3D; z2 + re</li></ul><p>…… 只要联立这两个方程，我们就能从中抽取出被重复使用的 nonce：</p><ul><li>k(s1 - s2) &#x3D; z1 - z2<ul><li>即：k &#x3D; (z1 - z2)&#x2F;(s1 - s2)</li></ul></li></ul><p>一旦我们知道了 nonce，就可以计算出私钥 e：</p><ul><li>k * s1 &#x3D; z1 + re<ul><li>re &#x3D; k * s1 - z1<ul><li>e &#x3D; (k * s1 - z1)&#x2F;r</li></ul></li></ul></li></ul><p>这就是为什么 nonce 复用是非常危险的。</p><p>（译者注：原文使用了 “nonce private key” 和 “actual private key” 这样的表述，这是有道理的。因为 nonce 也是不能暴露。也有人将 nonce 称为 “一次性私钥”。）</p><h2 id=nonce-复用在比特币区块链上发生过吗？><a href=#nonce-复用在比特币区块链上发生过吗？ class=headerlink title="nonce 复用在比特币区块链上发生过吗？"></a>nonce 复用在比特币区块链上发生过吗？</h2><p>理想状况下，偶然发生这种事情的概率是微乎其微的，但因为糟糕的熵源和有问题的钱包实现，有非常多同一个 nonce 值被用在多个签名中的例子。举个例子，看看这篇 bitcointalk 的<a target=_blank rel=noopener href="https://bitcointalk.org/index.php?topic=271486.0">帖子</a>，它就介绍了许多跟 nonce 复用相关的致命 bug 之一。</p><h2 id=需要记住的罕见情形><a href=#需要记住的罕见情形 class=headerlink title=需要记住的罕见情形></a>需要记住的罕见情形</h2><p>虽然在我撰写这篇文章的时候，一直记住这些罕见的情形让我觉得很烦，但我也意识到，使用我收集到的数据来探究这些情形可能也是非常有趣的，我会在下一节详细介绍。</p><ul><li>一个 nonce 值可能被同一个私钥多次使用（不止两次）</li><li>同一个私钥可能重复使用过不止一个 nonce 值</li><li>同一个 nonce 值可以被多个私钥使用过</li></ul><h2 id=有趣的数据><a href=#有趣的数据 class=headerlink title=有趣的数据></a>有趣的数据</h2><h3 id=私钥泄露的数量与区块高度的关系><a href=#私钥泄露的数量与区块高度的关系 class=headerlink title=私钥泄露的数量与区块高度的关系></a>私钥泄露的数量与区块高度的关系</h3><p>我最开始希望扫描 nonce 复用的动机是好奇：nonce 复用的频次在历史上是怎么变化的？注意，“私钥泄露的数量” 并不等于 “被复用的 nonce 的数量”，因为相同的 nonce 可能被多个私钥使用过。举例说明：如果某三个私钥使用过同一个 nonce 值两次，那么这会导致 3 个私钥泄露，但被复用的 nonce 值只有一个。</p><p>同样重要的是计算给定时间被泄露的私钥在所有服役私钥中的百分比，而不只是统计被泄露的私钥数量。因为较新的区块本身就比较旧的区块包含更多的交易。</p><h3 id=多次泄露同一个私钥><a href=#多次泄露同一个私钥 class=headerlink title=多次泄露同一个私钥></a>多次泄露同一个私钥</h3><p>同一个私钥可能多次泄露。比如说，某一个私钥可能重复使用了某一个 nonce 值，然后又重复使用了另一个 nonce 值。这将在被泄露的私钥的图谱中显示为两个数据点（带有不同的 nonce 值）。我编写了一个短脚本，以检查同一个私钥多次泄露的频次。这很重要，因为如果许多私钥都经历过多次泄露，那么数据的含义就可能跟它表面上看起来的不一样（在探究因为 nonce 复用而泄露的私钥数量的变迁的时候）。</p><h3 id=传统输入-vs-隔离见证-v0-输入的地址复用><a href=#传统输入-vs-隔离见证-v0-输入的地址复用 class=headerlink title="传统输入 vs. 隔离见证 v0 输入的地址复用"></a>传统输入 vs. 隔离见证 v0 输入的地址复用</h3><p>我会期待隔离见证 v0 输入的 nonce 复用更少，有两个原因：</p><ol><li>隔离见证 v0 输入是从 2017 年开始使用的。而 2017 年的时候，钱包软件已经比原来高级很多了。</li><li>至少在因为 过时&#x2F;差劲 的钱包软件而导致的 nonce 复用情形中，我会认为，即使钱包可能在实现隔离见证输入的花费中遇到麻烦，它们的签名构造也会符合行业标准（即：它们会使用一种技术来保证 nonce 不会复用）。我也很好奇，会不会有某个 nonce，在传统输入和隔离见证输入中都被使用过。我非常怀疑，但我还是编写了一个检查。看看某一个公钥会不会既用来创建了隔离见证 v0 地址，又用来创建了传统地址，也是很有意思的。</li></ol><h3 id=不同私钥，但用上了同一个-nonce-值><a href=#不同私钥，但用上了同一个-nonce-值 class=headerlink title="不同私钥，但用上了同一个 nonce 值"></a>不同私钥，但用上了同一个 nonce 值</h3><p>这项检查研究的是有没有某一个 nonce 被多个私钥使用过。这种情况是不会出现我们上面说的（同一个私钥多次使用同一个 nonce 值）问题的，因为外部的观察者无法计算出私钥。但是，假设这两个私钥属于两个人，那么使用相同的 nonce 会导致他们可以计算出对方的私钥。</p><p>我们把第一个地址的主人称为 Alice，第二个地址的主任称为 Bob。如上所述，如果 k 值是已知的，那么下面的方程就可以用来计算私钥：</p><ul><li>e &#x3D; (k × s - z)&#x2F;r</li></ul><p>那么，如果他们使用了相同的 nonce，Alice 如何能计算出 Bob 所用的 k 值呢？Bob 的签名包含了 r，就是点 rG 的 x坐标。如果 Alice 和 Bob 使用了相同的 r，那么他们的 k 必定相同。那么 Alice 就可以使用下面这个式子计算出 k：</p><ul><li><a target=_blank rel=noopener href=https://bitcoin.stackexchange.com/a/116826/131112>k &#x3D; (d × r + z)&#x2F;s</a></li></ul><p>她可以这样做是因为她知道自己的私钥，也知道来自签名的 r 值，也知道被签名的消息（交易），也知道 Bob 对消息的签名。Alice 需要计算 k 值是因为她不存储自己的 k 值。有了这个 k 值，Alice 就可以计算出 Bob 的私钥并盗走他的资金。但是，两个不相关的人用到了同一个 nonce 的概率是非常非常低的，除非这个 nonce 根本就不是随机选出来的。不是随机选出来的 nonce 意味着用到了糟糕的熵源，或者这个 nonce 此前被分享过。</p><p>再说一遍，因为这个原因而导致资金被盗的概率是极小的，我只是认为这很有趣，因为这种情况对我来说构成了一个没有显而易见问题的答案。</p><h2 id=识别故意的私钥泄露的可能线索><a href=#识别故意的私钥泄露的可能线索 class=headerlink title=识别故意的私钥泄露的可能线索></a>识别故意的私钥泄露的可能线索</h2><p>不能排除一些人会故意泄露私钥，尤其是在比特币的早期，许多实验在主链上开展。我们不能截然确定某一个 nonce 是不是被有意复用的，但这无疑是一种很棒的方法。了解跟某一次复用相关的更多信息将带来更多启发。</p><ul><li>使用一个会导致非常短的 r 值的 nonce（这是为了节约手续费）</li><li>非常高的复用次数（尤其是在多个交易中）</li><li>在同一笔交易中不同的 nonce 都被使用了正好两次</li><li>在即将把比特币烧掉（例如，使用 OP_RETURN 输出）的时候</li></ul><h2 id=实现一种-nonce-复用扫描仪><a href=#实现一种-nonce-复用扫描仪 class=headerlink title="实现一种 nonce 复用扫描仪"></a>实现一种 nonce 复用扫描仪</h2><p>虽然我还在修改和优化我的扫描仪实现，但我的总体方法一直没变。为了辨明 nonce 复用在不同年代的频次，我需要扫描区块链，跟踪 nonce 以及使用这些 nonce 的公钥，然后跟踪 nonce 复用发生的区块高度。为此，我决定修改 Bitcoin Core 自身，而不是使用 RPC 来获得这些信息，因为我已经熟悉它的代码了。因此，我不需要编写额外的代码来处理交易的索引、检查输出的类型，等等；而且使用 Bitcoin Core 可能速度还更快。我用了一个 <a target=_blank rel=noopener href=https://github.com/google/leveldb>leveldb</a> 数据库来跟踪相关的信息。</p><h2 id=初步的数据以及观察到的模式><a href=#初步的数据以及观察到的模式 class=headerlink title=初步的数据以及观察到的模式></a>初步的数据以及观察到的模式</h2><p>下面就是我从扫描创世区块到区块高度 301102 的区块（在 2014 年 5 月 挖出），找出的 nonce 复用情况。本系列的后续篇章会提供更近的数据，以及对特定 nonce 复用案例的更透彻的分析。</p><p>第一个发生 nonce 复用的是一笔 P2PKH 交易，发生在区块高度 121487 处，交易的 id 为：<a target=_blank rel=noopener href=https://mempool.space/tx/19edfbf79bca8d11b133e1b52e310bdf20a86135bb87fbbce2e5318a1b1791b4>19edfbf79bca8d11b133e1b52e310bdf20a86135bb87fbbce2e5318a1b1791b4</a>，泄露了地址 <a target=_blank rel=noopener href=https://mempool.space/address/1A8TY7dxURcsRtPBs7fP6bDVzAgpgP4962>1A8TY7dxURcsRtPBs7fP6bDVzAgpgP4962</a> 的私钥。</p><p>下图就是在不同时期因为不同 nonce 的复用而导致泄露的私钥的数量。值得一提的是，这里面包括了同一个私钥因为复用多个 nonce 而导致多次泄露的情形。</p><p><img src=/images/a-deep-dive-into-nonce-reuse-during-bitcoin-transaction-creation-part-1/eight_0.png alt="alt text"></p><p>我非常惊讶，居然有这么多私钥重复使用了不止一个 nonce。数据表明，在 2014 年以前，发生过 nonce 复用的私钥中有 40% 都复用过不止一个 nonce。很难确定有多少是故意的，因为计算楚一个地址的私钥之后，任何人都可以让这个地址重复使用任意多个 nonce。</p><p><img src=/../images/a-deep-dive-into-nonce-reuse-during-bitcoin-transaction-creation-part-1/reuse_0.png alt="alt text"></p><p>多个公钥使用过同一个 nonce 的情况如下图，这个就没那么令人惊讶了。</p><p><img src=/../images/a-deep-dive-into-nonce-reuse-during-bitcoin-transaction-creation-part-1/keys_0.png alt="alt text"></p><p>那个曾被不同公钥使用了 31 次的 nonce 的 r 值为 <code>79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798</code>。这实际上是椭圆曲线 sepc256k1 上的生成器点的 x 坐标。使用这个 r，意味着相应的 k 值为 1。使用 1 作为 k 值没有什么意义，因为它跟使用别的 k 得出的 r 的长度是相同的，但显然很多人都这么做了。</p><h2 id=问题的解决方案><a href=#问题的解决方案 class=headerlink title=问题的解决方案></a>问题的解决方案</h2><p>到目前为止，我的研究在很大程度上都主要是（并且将继续是）历史分析，因为事实上已经出现了防止 nonce 复用的简单办法了，不论是作为用户还是作为钱包软件的生产者，办法都有了。这些版本，在现在已经成为行业标准了。第一种办法，也是最简单的办法，是用户可以做的，就是不要复用公钥（也就意味着不要重复使用一个地址）。只要你不多次使用同一个公钥，就算你重复使用了同一个 nonce，也不会泄露你的私钥。不要重复使用地址在隐私性上也有好处，只要稍微了解比特币的工作原理的人都会明白这其中的道理。</p><p>另一种解决方案，是必须在钱包软件层面实现的，叫做 “确定性的 nonce 生成”。简单来说，它就是拿需要被签名的消息以及私钥来生成 nonce，结果是每次花费一个新的输入时，都会产生一个唯一的 nonce。这是因为即使私钥没变，被签名的消息也一定会变。我估计今天每一种主流的、有声誉的钱包，都已经用上了确定性的 nonce 生成技术。</p><p style=text-align:center>- - -</p><p>虽然我已经在这篇文章中发现了一些有趣的数据，但这仅仅是所有需要获取的数据的表面。本系列的下一篇文章将提供更多细节：我是如何获得这些数据的、我用来理解这些数据和获得特点统计数据的脚本、关于更近的区块的一般化数据，以及关于某一些非常有趣的 nonce 复用案例的信息。</p><blockquote><p>感谢 Murch 评审这篇文章并跟我讨论了这些概念。文中所有的错误和观点，都属于我自己。</p></blockquote></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>