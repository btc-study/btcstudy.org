<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>有趣的比特币脚本（二）：多签名</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/tools>工具</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">有趣的比特币脚本（二）：多签名</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>有趣的比特币脚本（二）：多签名</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/tools>工具</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E2%80%9C%E5%A4%9A%E7%AD%BE%E5%90%8D%E2%80%9D-%E7%AE%80%E4%BB%8B><span class=toc-text>“多签名” 简介</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A4%9A%E7%AD%BE%E5%90%8D%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B><span class=toc-text>多签名脚本示例</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A4%9A%E7%AD%BE%E5%90%8D%E8%84%9A%E6%9C%AC%E7%9A%84%E7%94%A8%E9%80%94><span class=toc-text>多签名脚本的用途</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%AA%E4%BA%BA%E4%BF%9D%E9%99%A9%E6%9F%9C><span class=toc-text>个人保险柜</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BC%81%E4%B8%9A%E8%B4%A2%E5%8A%A1><span class=toc-text>企业财务</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%81%94%E7%9B%9F%E4%BE%A7%E9%93%BE><span class=toc-text>联盟侧链</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1-%E5%85%8D%E4%BF%A1%E4%BB%BB%E7%9A%84%E4%BB%B2%E8%A3%81><span class=toc-text>电子商务&#x2F;免信任的仲裁</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%8D%E4%BF%A1%E4%BB%BB%E7%9A%84%E6%89%98%E7%AE%A1%E6%96%B9><span class=toc-text>免信任的托管方</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%82%B9%E5%AF%B9%E7%82%B9%E5%90%88%E7%BA%A6><span class=toc-text>点对点合约</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%B0%8F%E7%BB%93><span class=toc-text>小结</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%A2%98%E5%A4%96%E8%AF%9D><span class=toc-text>题外话</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE><span class=toc-text>参考文献</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>有趣的比特币脚本（二）：多签名</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt=Anony><div class=page-author-info><strong>Anony</strong><time class=has-text-grey datetime=2023-04-19T05:58:38.000Z>2023-04-19</time></div></div><div class=is-flex><a href=/tags/%E5%BC%80%E5%8F%91><i class="page-tag mr-1 px-1">开发</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Anony</em></p><p><em>前篇文章<a href=https://www.btcstudy.org/2023/04/18/interesting-bitcoin-scripts-and-its-use-cases-part-1-introduction/ >见此处</a>。</em></p></blockquote><p>在本系列的上一篇文章中，我们介绍了比特币系统的基本概念。本章，我们正式进入最常被使用的比特币复杂脚本模块：多签名。</p><h2 id=“多签名”-简介><a href=#“多签名”-简介 class=headerlink title="“多签名” 简介"></a>“多签名” 简介</h2><p>如前文所述，比特币中没有账户，有的只是输出 <sup><a href=#note1 id=jump-1>1</a></sup>。普通用户最常使用的个人钱包（单签名钱包），实际上是使用单个公钥锁定的输出（资金）。</p><p>而 “多签名（multisig）”，顾名思义，就是需要多个签名来解锁的脚本。一般我们使用 “m-of-n” 来描述一个多签名脚本的设置：它记录了 n 个公钥，需要提供其中 m 个公钥的签名来解锁。例如，“2-of-3” 意味着脚本预先设定了 3 个公钥，需要提供其中 2 个公钥的签名才能解锁这个脚本。</p><p>由此可见，比特币世界里常用的 “多签名（multisig）” 与密码学里的 “多签名技术（multi signature）” 并不完全等同。因为前者泛指一切使用多个签名来解锁的技术，而后者单指 n 个公钥中的每一个都需要提供签名的方案，用上面的术语来说，就是 “n-of-n” 多签。某种程度上说，比特币 multisig 兼有 “门限签名” 的一些特性，即需要提供的签名数量可以小于公钥的数量。详见此文 <sup><a href=#note2 id=jump-2>2</a></sup>。</p><p>接下来，我们来看看具体的 multisig 脚本长什么样。</p><h2 id=多签名脚本示例><a href=#多签名脚本示例 class=headerlink title=多签名脚本示例></a>多签名脚本示例</h2><p>假定我们要编写一个比特币脚本，其花费条件是，Alice、Bob 和 Carol 三人（或者说三个公钥）中的两个的签名，即可花费这个脚本；这个花费条件用 policy 语言表达出来是这样的：</p><pre><code>thresh(2,pk(Alice),pk(Bob),pk(Carol))
</code></pre><p>它就像函数式子一样，前面的 <code>thresh()</code> 表示使用门限条件，而以 <code>pk()</code> 括起的是公钥，表示依据这个公钥检查签名；综合起来，表示花费条件是 3 个公钥中的 <code>2</code> 个提供了签名。Policy 语言可以使用函数一共有 7 种 <sup><a href=#note3 id=jump-3>3</a></sup>（这里我们已经接触到了两种），理解起来都很简单。</p><p>上面这个网站还提供了将 Policy 语句编程成 Miniscript 代码和 Script 的编译器，我们来看看它的 Miniscript 代码：</p><pre><code>multi(2,Alice,Bob,Carol)
</code></pre><p>而它的 Script 代码是：</p><pre><code>2 &lt;Alice&gt; &lt;Bob&gt; &lt;Carol&gt; 3 OP_CHECKMULTISIG
</code></pre><p>对于了解比特币脚本的读者来说，最后这段代码会更亲切。但是，对于不了解脚本操作码和堆栈结构的人来说，前面两段看起来像函数的式子无疑简单很多。而且，这只是我们接触的第一种脚本，往后，我们还会看到 Policy 和 Miniscript 如何让脚本的编写变得更加简单。（提醒：编写脚本的难度可不仅仅体现在编写赎回脚本的时候，根据脚本提供 witness 也不是那么简单！）</p><blockquote><p>上述 Miniscript 代码可以翻译成符合 P2SH 和 P2WSH 规则的赎回脚本，但是，它无法翻译成符合 P2TR（taproot 地址）的赎回脚本，因为 tapscript（P2TR 的脚本规则）改变了实现多签名的操作码。如果需要翻译成 tapscript，你需要使用这样的 Miniscript 代码：<code>multi_a(k,key1,...,keyn)</code>。</p><p>此外，因为 Taproot 升级引入了 Schnorr 签名，基于 Schnorr 签名交互协议而非比特币脚本来实现 n-of-n 签名和门限签名的技术也因此成为可能，例如 MuSig <sup><a href=#note4 id=jump-4>4</a></sup> 和 FROST <sup><a href=#note5 id=jump-5>5</a></sup>。因为这些技术并不基于比特币脚本，因此不在本系列文章的范围之内。但它们代表了进一步隐藏链上足迹（从而提高隐私性）的方向。</p></blockquote><p>接下来，我们看看这么简单的东西，有哪些用场！</p><h2 id=多签名脚本的用途><a href=#多签名脚本的用途 class=headerlink title=多签名脚本的用途></a>多签名脚本的用途</h2><h3 id=个人保险柜><a href=#个人保险柜 class=headerlink title=个人保险柜></a>个人保险柜</h3><p>假设一人设置了一个 2-of-3 的多签名钱包，那么，TA 就不怕这三个私钥中的其中一个失盗、丢失、损坏。用行话来说，这就是消除了其中任何一个私钥的 “单点故障”。比如，用户可以设置分别放在手机、工作电脑和硬件钱包里的私钥，这三台设备任何两台一起，都可以签名、花费资金；当用户发觉某一台设备失盗或信息已经泄露的时候，可以从容使用另外两台设备转移资金。</p><p>这样的多签名脚本还可以帮助用户消除对签名设备的硬件制造商的信任：如果你使用单签名的钱包，把私钥放在手机里面，如果手机厂商安装了后门，你就完了；而如果你使用了多签名签名，必须有 m 个设备的制造商串谋，才能拿走你的资金。</p><p>这样的个人保险柜对用户提出的唯一要求是：不要将这些私钥的备份都放在一起，即不能让这些私钥一起暴露。</p><p>已有的应用：Blue Wallet 的 Vault 功能 <sup><a href=#note6 id=jump-6>6</a></sup>；用户也可以自己使用一些软件钱包配置出相同功能的钱包。</p><p>关于个人用户的多签实践，这里有一份很好的指南 <sup><a href=#note7 id=jump-7>7</a></sup>。</p><p>同类应用：家庭保险柜；压岁钱。</p><h3 id=企业财务><a href=#企业财务 class=headerlink title=企业财务></a>企业财务</h3><p>在企业财务中，为避免单点故障、不受约束的大权独揽，我们也可以使用多签名。在这里，多签名的用途除了避免单点故障，还有赋予权限、约束参与者的作用。只要（n - m + 1）个公钥是诚实的，资金就不会被任意挪用。</p><h3 id=联盟侧链><a href=#联盟侧链 class=headerlink title=联盟侧链></a>联盟侧链</h3><p>与企业财务有相通之处。一个足够大的多签名团体（例如 11-of-15），这个团体可以成为一条联盟侧链的运营者；这条侧链可以接收比特币，让用户的比特币在另一个环境中使用比特币系统无法提供的功能；当用户想要退出这个环境时，15 位成员中的 11 位集体响应，就可以帮助用户的资金离开侧链、回到用户自己控制的钱包中。</p><p>在这里，用户不需要信任任何一位联盟成员，但必须有至少 5 位成员是诚实的，才能保证侧链资金不会被任意挪用、形成亏空；此外，至少 11 位成员是诚实的，才能保证用户的资金不会被审查、总能回到自己的钱包中。</p><p>已有的应用：Liquid Network <sup><a href=#note8 id=jump-8>8</a></sup>。实际上，当前几乎所有的比特币侧链，都使用这种方式来托管进入侧链的资金。</p><p>此外，Liquid Network 以及类似的侧链往往不会只使用一个多签名设置，也就是说，同一笔资金实际上<strong>有不止一套多签名的锁附加在上面</strong>；这些多签名锁是相互独立的，而且都可以独自解锁资金。这是怎么做到的呢？我们文末揭晓。</p><h3 id=电子商务-免信任的仲裁><a href=#电子商务-免信任的仲裁 class=headerlink title=电子商务&#x2F;免信任的仲裁></a>电子商务&#x2F;免信任的仲裁</h3><p>假定 Alice 和 Bob 要做一笔买卖，但无法做到一手交钱一手交货，于是他们约定，把钱锁入一个多签名输出中，当 Bob 收到 Alice 发出的货时，再把钱完整支付给 Alice。但是，如果 Bob 明明收到了货，却不愿意给钱怎么办？</p><p>他们可以引入一个第三方（例如 Carol），形成一个 2-of-3 的多签名输出；当交易发生争议时，比如 Bob 拒不付款，可以请求第三方来主持公道。如果第三方认为 Alice 确实已经履行了责任，就可以跟 Alice 联手将资金转走。</p><p>但是，问题又来了，如何避免这个第三方与其中一方勾结呢？答案很简单，这是一场买卖，所以双方约定一个（实际上可以做到多个，但涉及到至此还未介绍到的脚本知识）双方都认为公正的仲裁方即可。</p><p>那么如何防止第三方主动寻租（主动找到其中一个参与方，引诱 TA 诈骗对手）呢？答案是，<strong>第三方可以根本不知道自己参与了这样的合约</strong>！假定愿意当仲裁方的人都主动公开自己的公钥，参与电子商务的人就可以在 2-of-3 多签名脚本中使用他们的公钥，从而加入仲裁者，这完全可以在仲裁方不知情的情况下做到（因为链上输出上记录的是脚本的哈希值，所以他们观察区块链也不知道其中的内容）。</p><p>实际上，这就是现实世界中 “仲裁” 的通行用法。国际贸易（跟我们这里的电子商务一样，做不到钱货两讫）的合同基本都指定了仲裁庭作为争议的裁决方法，这样的合同只需得到参与双方的同意，无需在发生争议前知会仲裁庭。而仲裁庭的存在也显然约束了双方的行为。</p><p>这样的做法，可以创造出一个 “公正服务的市场”，即各仲裁者相互竞争，提供准则而公正的仲裁服务，以争取人们的使用并获得服务费。</p><p>这样的带仲裁服务的合约，理论上可以相当普遍，商务合同、打赌，都可以使用这样的结构。</p><p>暂无这样的服务。</p><h3 id=免信任的托管方><a href=#免信任的托管方 class=headerlink title=免信任的托管方></a>免信任的托管方</h3><p>个人用户可以选择让托管方提供一把公钥，放入 2-of-3 多签名输出中，作为应对单私钥故障（丢失、失盗、损坏）的应急措施。托管方承诺在用户面临这样的情况时检查用户身份、提供签名、解锁资金。</p><p>这样的托管方是无法单方面取走你的资金的。</p><p>已有的服务：Casa <sup><a href=#note9 id=jump-9>9</a></sup>。</p><h3 id=点对点合约><a href=#点对点合约 class=headerlink title=点对点合约></a>点对点合约</h3><p>基于 2-of-2 多签名，我们可以制作出多种点对点的合约。例如：支付通道，仅基于我们已经学习的脚本技术，可以允许单方多次向另一方支付，而不必让每一次支付都广播到比特币区块链上（在本系列的后续文章中，我们将逐渐学习实现闪电支付通道 —— 双向无限次相互支付的通道—— 的脚本模块）。</p><p>这样的单向支付通道的实现方式是：每当 A 要给 B 支付时，就给 B 一笔新的、花费他们的 2-of-2 输出的交易，B 无需让这笔交易得到区块确认，就知道这样的支付是真实、安全的，因为 A 无法独自将资金卷走（需要 B 的签名才可以转移其中的资金）。由于这些交易花费的是同一个输出，所以它们无法都得到区块确认 —— 对 B 来说，当需要广播这些交易（也就是关闭支付通道）的时候，最好的当然是广播 A 支付了最多资金的那一笔，也就是最新的那一笔交易。</p><blockquote><p>一个有趣而重要的问题是：在 2-of-2 多签名这样的输出中，任何一方如果拒绝签名，就会使资金在其中锁死，那么用户要如何防止对方的有意欺诈和无意的故障（比如下线了，无法响应）呢？</p><p>这就涉及到一个重要的概念，也是比特币合约式编程的基本工具：<strong>承诺交易</strong>。意思是说，给定我们知晓 A 交易将形成 A-0 输出，此输出为 Alice 和 Bob 的 2-of-2 多签名输出，为了防止资金在其中锁死，我们可以在 A 交易实际广播到比特币网络之前，<strong>提前签名花费 A-0 输出的交易</strong>，比如签名一笔将资金原路退回给双方的交易，作为双方的安全保障措施；如果一方拒绝签名这样的交易，另一方可以直接离开，不会有任何损失（因为资金还未实际存入这个 2-of-2 多签名输出）。一旦签名了这样的交易，就可以放心将资金锁入这样的 2-of-2 输出（这就是为什么 “输出点”、交易索引号如此重要，也是为什么我们需要隔离见证升级）。即，如果资金进入多签名输出之后，对方没有响应，则另一方可以向网络广播这笔承诺交易，从而拿回自己的资金。</p></blockquote><p>点对点合约有非常多的应用，如谨慎日志合约、Statechain，但这些应用往往都用到了其它的脚本模块或非脚本的密码学技术，我们在此就不展开了。往后我们会慢慢接触到。</p><h2 id=小结><a href=#小结 class=headerlink title=小结></a>小结</h2><p>如上，我们了解了多签名输出的许多用途。在这些应用场景中，多签名的用途包括：消除单点故障、消除对单一参与者的信任、赋予参与权限、分散资金的控制权。重复我们在本系列的上一篇文章中讲过的话：比特币脚本的作用，不是将需要做的事情全部计算一遍，而是为参与者的互动提供密码学锚，凭借这些锚，参与者就可以预期一些事情在自己的控制之下。比特币的 UTXO 结构以及多签名支持，非常好地体现了这一点。</p><h2 id=题外话><a href=#题外话 class=headerlink title=题外话></a>题外话</h2><p>我们在上文介绍联盟侧链的时候，提到 Liquid Network 为自己保管的资金设置了不止一套多签名的锁。这是怎么实现的呢？</p><p>答案是，它涉及到比特币脚本的一类操作码，称为 “流程控制操作码”，它可以设置 <code>IF...ELIF...</code>（如果……，那么……；不然，就 ……）这样的条件式语句，从而形成<strong>并列的多个解锁条件</strong>。</p><p>它看起来毫不起眼，实际上非常强大。比如，我们可以在小孩子的压岁钱上设置两套多签名，一套是爸爸妈妈和小孩的 2-of-3 多签名，一套是爷爷奶奶和小孩的 2-of-3 多签名，从而小孩子只要说服任何一个人，就可以花费自己的压岁钱。（这个例子比较差劲，因为如果需要实现类似的效果，只需要拿到 4 位家长的公钥，制作一个 1-of-4 多签名即可。）</p><p>同理，我们也可以形成设置多个托管方或多个仲裁方的合约。假设某个托管方想趁火打劫，用户可以使用另一个托管方。</p><p>这样的流程控制，是真正发挥比特币脚本强大功能的必要条件。往后我们会不断遇到它。</p><h2 id=参考文献><a href=#参考文献 class=headerlink title=参考文献></a>参考文献</h2><p>1.<a id=note1> </a><a href=https://www.btcstudy.org/2023/04/18/interesting-bitcoin-scripts-and-its-use-cases-part-1-introduction/#%E8%BE%93%E5%87%BA>https://www.btcstudy.org/2023/04/18/interesting-bitcoin-scripts-and-its-use-cases-part-1-introduction/#%E8%BE%93%E5%87%BA</a> <a href=#jump-1>↩</a></p><p>2.<a id=note2> </a><a href=https://www.btcstudy.org/2022/02/14/aggregate-threshold-multisig-and-multisignatures/#%E5%A4%9A%E7%AD%BE%E5%90%8D%EF%BC%88Multisignatures%EF%BC%89>https://www.btcstudy.org/2022/02/14/aggregate-threshold-multisig-and-multisignatures/#%E5%A4%9A%E7%AD%BE%E5%90%8D%EF%BC%88Multisignatures%EF%BC%89</a> <a href=#jump-2>↩</a></p><p>3.<a id=note3> </a><a target=_blank rel=noopener href=https://bitcoin.sipa.be/miniscript/ >https://bitcoin.sipa.be/miniscript/</a> <a href=#jump-3>↩</a></p><p>4.<a id=note4> </a><a href=https://www.btcstudy.org/2021/11/29/schnorr-applications-musig/ >https://www.btcstudy.org/2021/11/29/schnorr-applications-musig/</a> <a href=#jump-4>↩</a></p><p>5.<a id=note5> </a><a href=https://www.btcstudy.org/2021/12/09/schnorr-applications-frost/ >https://www.btcstudy.org/2021/12/09/schnorr-applications-frost/</a> <a href=#jump-5>↩</a></p><p>6.<a id=note6> </a><a target=_blank rel=noopener href=https://bluewallet.io/multisig-wallet/ >https://bluewallet.io/multisig-wallet/</a> <a href=#jump-6>↩</a></p><p>7.<a id=note7> </a><a href=https://www.btcstudy.org/2022/12/09/a-guide-for-bitcoin-multi-sig-wallets-by-mi-zeng/ >https://www.btcstudy.org/2022/12/09/a-guide-for-bitcoin-multi-sig-wallets-by-mi-zeng/</a> <a href=#jump-7>↩</a></p><p>8.<a id=note8> </a><a href=https://www.btcstudy.org/2022/10/18/exploring-liquid-sidechain/ >https://www.btcstudy.org/2022/10/18/exploring-liquid-sidechain/</a> <a href=#jump-8>↩</a></p><p>9.<a id=note9> </a><a target=_blank rel=noopener href=https://keys.casa/ >https://keys.casa/</a> <a href=#jump-9>↩</a></p><blockquote><p><em>续篇见<a href=https://www.btcstudy.org/2023/04/21/interesting-bitcoin-scripts-and-its-use-cases-part-3-time-locks/ >此处</a>。</em></p></blockquote></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>