<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>实现闪电网络上的非托管式交易</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">实现闪电网络上的非托管式交易</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>实现闪电网络上的非托管式交易</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%9E%E6%89%98%E7%AE%A1%E5%BC%8F%E4%BA%A4%E6%98%93%EF%BC%9F><span class=toc-text>什么是非托管式交易？</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#DLC-%E7%AE%80%E4%BB%8B><span class=toc-text>DLC 简介</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C%E4%B8%8A%E7%9A%84-DLC><span class=toc-text>闪电网络上的 DLC</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%BA%E9%97%AA%E7%94%B5%E6%89%BF%E8%AF%BA%E4%BA%A4%E6%98%93%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA-DLC><span class=toc-text>为闪电承诺交易添加一个 DLC</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#DLC-%E7%9A%84%E5%90%88%E4%BD%9C%E5%BC%8F%E7%BB%93%E7%AE%97><span class=toc-text>DLC 的合作式结算</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%BC%BA%E5%88%B6%E5%85%B3%E9%97%AD%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB-DLC-%E7%9A%84%E9%80%9A%E9%81%93><span class=toc-text>强制关闭一个包含 DLC 的通道</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B7%9F%E6%99%AE%E9%80%9A%E9%97%AA%E7%94%B5%E8%8A%82%E7%82%B9%E4%BF%9D%E6%8C%81%E5%85%BC%E5%AE%B9><span class=toc-text>跟普通闪电节点保持兼容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BE%97%E5%88%B0%E7%9A%84%E6%95%99%E8%AE%AD%E4%B8%8E%E6%9C%AA%E6%9D%A5%E7%9A%84%E5%B7%A5%E4%BD%9C><span class=toc-text>得到的教训与未来的工作</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%9B%B4%E6%96%B0%E5%8C%85%E5%90%AB%E4%BA%86%E5%A4%96%E9%83%A8%E7%AE%A1%E7%90%86%E7%9A%84%E5%AE%9A%E5%88%B6%E5%8C%96%E8%BE%93%E5%87%BA%E7%9A%84%E9%80%9A%E9%81%93%E5%BE%88%E9%BA%BB%E7%83%A6><span class=toc-text>更新包含了外部管理的定制化输出的通道很麻烦</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%8C%E5%90%91%E6%B3%A8%E8%B5%84%E9%80%9A%E9%81%93><span class=toc-text>双向注资通道</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8F%82%E4%B8%8E%E8%BF%9B%E6%9D%A5%EF%BC%81><span class=toc-text>参与进来！</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%84%9A%E6%B3%A8><span class=toc-text>脚注</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>实现闪电网络上的非托管式交易</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Lucas Soriano"><div class=page-author-info><strong>Lucas Soriano</strong><time class=has-text-grey datetime=2023-04-14T09:32:03.000Z>2023-04-14</time></div></div><div class=is-flex><a href=/tags/Discreet-Log-Contract><i class="page-tag mr-1 px-1">Discreet Log Contract</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Lucas Soriano 及 Philipp Hoenisch</em></p><p><em>来源：<a target=_blank rel=noopener href=https://10101.substack.com/p/noncustodial-trading-with-10101>https://10101.substack.com/p/noncustodial-trading-with-10101</a></em></p></blockquote><p>我们一直在开发 <a target=_blank rel=noopener href=https://10101.finance/ >10101</a>，让你可以 <em>使用</em> 你的比特币。毋庸置疑，你可以发送和接收比特币支付，链上可以收比特币，链下可以收闪电支付。但是，我们最感兴趣的，还是给闪电网络加入非托管的交易功能（non-custodial trading）。</p><p>使用比特币作为标的资产、参与交易，是极为常见的事，但是，几乎所有的选项，都必须接受交易平台卷款跑路的风险。就我们所知，只有我们最新的产品 <a target=_blank rel=noopener href=https://www.itchysats.network/ >ItchySats</a>，提供了非托管的比特币交易功能。</p><p>在 10101，我们进一步加码，将非托管式交易带入了闪电网络、带到了你的手机上。在这篇文章中，我会解释我们是怎么做到的。</p><h2 id=什么是非托管式交易？><a href=#什么是非托管式交易？ class=headerlink title=什么是非托管式交易？></a>什么是非托管式交易？</h2><p>如果你曾经在 <em>托管式</em> 交易平台上交易过，那么某些时候，你会不得不放弃自己的资金的保管权。一些平台会强制你存入比特币；还有一些会在你下订单或者说开仓位的时候要求你存入。</p><p>而 <em>非托管式</em> 交易就是说，你<strong>永远</strong>无需放弃你的资金的完整保管权。为了实现这一点，我们起码要做到三件事情：</p><ol><li>在开启仓位之前，你的资金存储在由你自己控制的钱包里。</li><li>在开启仓位之后，你的保证金存储在比特币链上的一个多签名输出中，这个输出是你部分拥有的。</li><li>在仓位关闭之后，你的资金将返回你自己的钱包。</li></ol><p>10101 的关键创新就在第2 步中。其他平台会托管你的资金，以保证可以强制执行合约的规则，而 10101 则依赖于一种密码学协议，来保证你的资金总在你的掌控之下。此外，上述的多签名输出也保管着你的对手方所提供的保证金，因此在 10101 上交易<strong>没有对手方风险</strong>。</p><p>这种保证合约条款总是能得到执行的机制叫做 “谨慎日志合约（<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/discreet-log-contracts/ >Discreet Log Contract</a>，DLC）”。</p><h2 id=DLC-简介><a href=#DLC-简介 class=headerlink title="DLC 简介"></a>DLC 简介</h2><p>一个 DLC 就是一个 2-of-2 的多签名输出，其花费条件基于在比特币区块链 <em>之外</em> 发生的事件。它非常强大，因为在这种范式提出之前，我们只能基于（1）在比特币链上发生的事件、（2）其它链上发生的事件，以及（3）纯粹时间事件 表达可编程的条件式支付。</p><p>为了让 DLC 运行，我们还需要引入一个受信任的第三方，叫做 “<em>断言机（oracle）</em>”。断言机见证真实世界里发生的事件。这样的见证消息会被用来（密码学意义上的）解锁 DLC 输出中的资金。这是通过参与 DLC 的双方在将 DLC 上链（形成多签名输出）之前、签名多笔花费该 DLC 输出的 “合约执行交易（CET）”来实现的；这些合约执行交易，每一笔都在只能在所用断言机见证了某一个结果的时候激活。</p><p>关键在于，断言机根本 <em>无法意识到</em> 任何 DLC 的存在。你没法通过观察区块链来知晓哪个 DLC 正在使用哪个断言机。</p><p>这无法防止断言机跟参与 DLC 的某一方勾结。但是，作为公开的实体，行为不轨的断言机将被识别为不值得信任的，无法再得到任何人的使用。</p><p>此外，在单个断言机上投注太多信任是不推荐的，尤其在合约的体量较大的时候。因此，你可以创建使用多个断言机的 DLC，仅在某个子集（例如 2-of-3 或 5-of-9）都同意一个事件结果时，资金才会以特定的方式分配。</p><h2 id=闪电网络上的-DLC><a href=#闪电网络上的-DLC class=headerlink title="闪电网络上的 DLC"></a>闪电网络上的 DLC</h2><p>如前所述，ItchySats 已经提供了非托管式交易功能。你可以在 <a target=_blank rel=noopener href=https://umbrel.com/ >Umbrel</a>、<a target=_blank rel=noopener href=https://raspiblitz.org/ >RaspiBlitz</a> 和<a target=_blank rel=noopener href=https://github.com/get10101/itchysats/releases/tag/0.7.0>桌面</a>系统上安装这款应用，享受比特币主网上的 DLC 所提供的差价合约（CFD）交易。现在就可以！</p><p>作为一款闪电网络至上钱包，10101 将，<em>在闪电网络上</em>，提供由 DLC 赋能的非托管式交易。这意味着，这样的 DLC 是嵌在通道中的，就像其它闪电交易输出一样。结合闪电网络和 DLC 的主要好处在于，你可以在闪电通道中结算，无需在链上结算。</p><p>闪电网络当前并不能开箱即用地支持 DLC。这意味着，我们需要改造常规的闪电节点以支持 DLC 。这正是我们在由 <a target=_blank rel=noopener href=https://makers.bolt.fun/ >BOLT.FUN</a> 组织的 Legends of Lightning 锦标赛中起步时为我们的<a target=_blank rel=noopener href=https://makers.bolt.fun/project/10101>项目</a>做的事。以 10101 为名，我们开发了一个用于概念验证的手机闪电钱包，CFD 交易是其主打功能。</p><p>有许多方式可以解决这个问题，与闪电网络的集成程度和难度各不相同。回到 10 月份，我们在开始开发之前思考了其中几种：</p><ol><li>在创建闪电通道之后创建一条 DLC 通道，将两者都关联到同一笔父承诺交易中 <sup><a href=#note1 id=jump-1>1</a></sup>。</li><li>在 ItchySats 中实现必要的 BOLT，使得创建一个 DLC 的同时会同步开启一条闪电通道。</li><li>直接在闪电承诺交易中添加 DLC 输出。</li></ol><p>我们最终选择了最后一个，因为它是三者中最大胆的一个。我们的愿景是创造一种闪电通道，它可以闪电般加入、修改了移除 DLC。这种方法不会给闪电网络添加任何新的交易，而且它允许你将 DLC 的收益直接用于支付。</p><h3 id=为闪电承诺交易添加一个-DLC><a href=#为闪电承诺交易添加一个-DLC class=headerlink title="为闪电承诺交易添加一个 DLC"></a>为闪电承诺交易添加一个 DLC</h3><p>一笔闪电承诺交易代表了你的某一条闪电通道中的一个状态，它只能包含三种输出：</p><ul><li>支付给某一方的简单输出。</li><li>支付给某一方的可撤销的输出，得到支付的一方只能在时间锁过期后拿走其中的价值。</li><li>可撤销的 HTLC 输出，用来在网络中转发支付。</li></ul><p>这意味着，我们需要延伸承诺交易所支持的输出，以引入 DLC。</p><p>我们当前的设计是加入一个可以带有任意花费条件的可撤销输出，我们称之为 “<em>定制化输出</em>”。我们将管理这种定制化输出的责任交给了闪电节点之上的层级。但闪电节点依然负责在通道状态改变时撤销这样的输出。</p><p><img src=/images/noncustodial-trading-with-10101/dlc-in-lightning-ct-1.png alt="Transaction diagram for the add-custom-output Lightning protocol"></p><p style=text-align:center>- 为闪电协议添加定制化输出 -</p><p>除了任意脚本，这种定制化输出也有别于标准的闪电输出，它是用来自通道双方的资金创造的（而不只来自某一方）。它的重要性在于，DLC 通常会锁定来自两方的资金。</p><h3 id=DLC-的合作式结算><a href=#DLC-的合作式结算 class=headerlink title="DLC 的合作式结算"></a>DLC 的合作式结算</h3><p>在结算一个 DLC 时，闪电节点不需要知道其中的细节。它只需要被指示以合作的方式移除一个定制化输出、并以特定的方式分割其中的资金。</p><p><img src=/../images/noncustodial-trading-with-10101/dlc-in-lightning-ct-2.png alt="Transaction diagram for the remove-custom-output Lightning protocol"></p><p style=text-align:center>- 在闪电协议中移除定制化输出 -</p><p>这就类似于在一笔支付被申领之后移除一个 HTLC 输出的操作。</p><h3 id=强制关闭一个包含-DLC-的通道><a href=#强制关闭一个包含-DLC-的通道 class=headerlink title="强制关闭一个包含 DLC 的通道"></a>强制关闭一个包含 DLC 的通道</h3><p>技术必须支持强制关闭功能，这样你才不必信任你的 DLC 对手。你必须能够单方面关闭通道，并在这个过程中将 DLC 承诺到区块链。</p><p>一旦那个断言机（或者断言机们）见证了相关事件的特定结果，某一笔 CET 就会变成可花费的；它广播到链上，就可以根据合约的初始条款分割资金。</p><p>因为闪电节点不理解 DLC 协议，这也要由闪电节点之上的层级来完成，在 DLC 可以退款之前 <sup><a href=#note2 id=jump-2>2</a></sup> 将正确的 CET 发布到链上。</p><h3 id=跟普通闪电节点保持兼容><a href=#跟普通闪电节点保持兼容 class=headerlink title=跟普通闪电节点保持兼容></a>跟普通闪电节点保持兼容</h3><p>在提出这种设计的时候，我们知道，我们修改之后的闪电节点必须依然跟其它常规的闪电节点兼容。与闪电网络集成的一个主要吸引力在于成为网络的一部分，利用它正在快速成长的用户基础。</p><p>因为我们现在只制作了增量式变更，这种兼容 DLC 的闪电节点依然能跟网络上的其他人收取和发送交易。</p><h2 id=得到的教训与未来的工作><a href=#得到的教训与未来的工作 class=headerlink title=得到的教训与未来的工作></a>得到的教训与未来的工作</h2><p>在花费几个月的事件开发这个课题之后，我们学到了一些可能影响我们 10101 走向下一步的东西。</p><h3 id=更新包含了外部管理的定制化输出的通道很麻烦><a href=#更新包含了外部管理的定制化输出的通道很麻烦 class=headerlink title=更新包含了外部管理的定制化输出的通道很麻烦></a>更新包含了外部管理的定制化输出的通道很麻烦</h3><p>能在闪电节点层面忽略 DLC 的详情当然很好，但它也让通道状态的更新变得非常复杂。比如，每次要路由一笔新的支付时，都需要在闪电节点、DLC 管理层和对手方之间做大量的通信。</p><p>我们还没有解决这部分的实现，所以我们应该在继续之前重新思考闪电节点对 DLC 的理解。</p><h3 id=双向注资通道><a href=#双向注资通道 class=headerlink title=双向注资通道></a>双向注资通道</h3><p>如上所述，DLC 是来自双方的资金所形成的共享输出。因为当前的闪电网络仅支持开启单方注资的通道 <sup><a href=#note3 id=jump-3>3</a></sup>，希望在创建通道时就能开启 DLC 是不现实的。</p><p>用户可以使用 “<a target=_blank rel=noopener href=https://docs.lightning.engineering/the-lightning-network/multihop-payments/understanding-submarine-swaps>潜水艇互换</a>” 来绕过这个问题，但对闪电网络规范的修改将可以启用双向注资通道，而且这样就的提议已经被<a target=_blank rel=noopener href=https://github.com/lightning/bolts/pull/851>提交</a>了，正在接受审核。</p><h2 id=参与进来！><a href=#参与进来！ class=headerlink title=参与进来！></a>参与进来！</h2><p>如果你也像我们一样，为非托管式交易以及所有这些使用 DLC 的东西（免信任的稳定币，对不对！）感到激动，你可以：</p><ul><li>如果你喜欢尖端科技，请加入 <a target=_blank rel=noopener href=https://notionforms.io/forms/10101-beta-signup/ >10101 的封闭测试</a>。</li><li>如果你想 <em>现在</em> 就在比特币上交易，请在 <a target=_blank rel=noopener href=https://umbrel.com/ >Umbrel</a>、<a target=_blank rel=noopener href=https://raspiblitz.org/ >RaspiBlitz</a> 或桌面系统上下载 ItchySats。</li><li>如果你跟我们一样，是精神上的骇客，请看看我们的 GitHub 库：<a target=_blank rel=noopener href=https://github.com/get10101/10101>10101</a>、我们的 <a target=_blank rel=noopener href=https://github.com/get10101/rust-lightning>rust-lightning fork</a>、<a target=_blank rel=noopener href=https://github.com/get10101/itchysats/releases/tag/0.7.0>ItchySats</a> 还有<a target=_blank rel=noopener href=https://github.com/get10101/ >其它</a>。</li><li>如果你想跟我们一起工作，请联系 <a href=mailto:hello@10101.finance>hello@10101.finance</a> 。</li><li>如果你想加入聊天，请加入我们的 <a target=_blank rel=noopener href=https://t.me/get10101>Telegram 频道</a>或关注我们的 <a target=_blank rel=noopener href=https://twitter.com/get10101>Twitter</a>。</li></ul><h2 id=脚注><a href=#脚注 class=headerlink title=脚注></a>脚注</h2><p>1.<a id=note1> </a>我们在 Crypto Garage 的同行最近<a target=_blank rel=noopener href=https://medium.com/crypto-garage/dlc-on-lightning-cb5d191f6e64>发表</a>了他们在闪电网络上开发 DLC 的经验。我们正在联系他们，看看我们是否能在这个主题上合作。 <a href=#jump-1>↩</a></p><p>2.<a id=note2> </a>纯理论上来说，如果参与的双方不同意结算且断言机没有为相关事件见证结果，DLC 也可能变得无法花费。因此，我们必须给 DLC 增加一个退款路径，让所有的资金在一个足够长的超时事件后退还给参与者。 <a href=#jump-2>↩</a></p><p>3.<a id=note3> </a>特定的闪电实现（例如 Core Lightning，前身为 C-Lightning）支持双向注资通道。 <a href=#jump-3>↩</a></p><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>