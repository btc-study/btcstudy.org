<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>使用 “分层通道”，在链下调整闪电网络通道容量</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">使用 “分层通道”，在链下调整闪电网络通道容量</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>使用 “分层通道”，在链下调整闪电网络通道容量</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A6%82%E8%BF%B0><span class=toc-text>概述</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%88%86%E5%B1%82%E9%80%9A%E9%81%93><span class=toc-text>分层通道</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A6%82%E4%BD%95%E5%9C%A8%E9%93%BE%E4%B8%8B%E8%B0%83%E6%95%B4%E8%B7%AF%E7%94%B1%E9%80%9A%E9%81%93><span class=toc-text>如何在链下调整路由通道</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%80%BB%E8%BE%91%E9%80%9A%E9%81%93%E4%B8%8E%E7%89%A9%E7%90%86%E9%80%9A%E9%81%93><span class=toc-text>逻辑通道与物理通道</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%B8%AE%E5%8A%A9%E4%B8%B4%E6%97%B6%E7%94%A8%E6%88%B7%E8%A7%A3%E5%86%B3%E5%AE%B9%E9%87%8F%E6%BB%9E%E7%95%99%E9%97%AE%E9%A2%98><span class=toc-text>帮助临时用户解决容量滞留问题</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%88%86%E5%B1%82%E9%80%9A%E9%81%93%E5%8D%8F%E8%AE%AE><span class=toc-text>分层通道协议</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-text>总结</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>使用 “分层通道”，在链下调整闪电网络通道容量</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt=jlspc><div class=page-author-info><strong>jlspc</strong><time class=has-text-grey datetime=2023-04-17T07:54:47.000Z>2023-04-17</time></div></div><div class=is-flex><a href=/tags/joinpool><i class="page-tag mr-1 px-1">joinpool</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：jlspc</em></p><p><em>来源：<a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-March/003886.html>https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-March/003886.html</a></em></p></blockquote><p><strong>太长不看：</strong></p><ul><li>需要动态管理闪电网络通道容量以支持高效的闪电网络（LN）付款<ul><li>链上通道容量会带来延迟，增加成本并限制可扩展性</li><li>临时用户需要快捷低成本的通道容量调整方法来实现无需瞭望塔的闪电网络付款</li><li>通道工厂支持在链下调整通道容量，但是容量交换只能发生在工厂内部</li></ul></li><li>分层通道支持灵活的链下通道容量调整<ul><li>它们无需在有限的用户池内交换容量</li><li>它们还可以帮助无瞭望塔的临时用户避免通道容量滞留问题</li></ul></li><li>分层通道之于通道容量如同，闪电网络之于比特币</li><li>无需改变底层比特币协议</li></ul><h2 id=概述><a href=#概述 class=headerlink title=概述></a>概述</h2><p>就确保闪电网络的高效运行而言，能否按需转移闪电网络通道容量起到举足轻重的作用。</p><p>事实上，有句话说得好，闪电网络常驻用户的“主要（可能也是唯一的）工作就是高效分配他们的流动性”[10]。</p><p>使用链上交易调整闪电网络通道容量会限制闪电网络的可扩展性，导致交易费上涨。</p><p>另外，在链上调整通道容量会产生较高的延迟。</p><p>事实上，如果有临时用户未启用瞭望塔，可能会出现长达几个月的延迟，造成资金滞留。因此，在当前环境下，这类用户无法在不启用瞭望塔的情况下运行节点 [10]。</p><p>一个现有链下通道容量调整方案是，创建一个通道工厂[1] 或 CoinPool [7] 并在同一个 工厂&#x2F;池子 内的通道之间交换容量。但是，在所有闪电网络的支付通道中，属于同一个工厂或池子[8] 的只有很少一部分。因此，用户在容量不足与容量过剩的通道配对上十分受限。</p><p>本文利用分层闪电网络通道解决了两大问题。</p><p>第一，只要是在分层通道内创建的闪电网络通道，就有可能在链下即时灵活地调整它们的容量。</p><p>因此，分层通道之于通道容量就如同闪电网络之于比特币。事实上，这不仅仅是一个类比，因为通道容量就是在闪电网络上发生转移的。</p><p>第二，分层通道可由一个临时用户和一对常驻用户创建，临时用户无需启用瞭望塔即可发送并接收比特币，常驻用户可以使用所有通道容量路由付款，即使是当临时用户处于非活跃状态时。</p><p>如此一来，临时用户在运行节点时即使不启用瞭望塔，也不会导致任何资金滞留。</p><p>我们将在下文介绍分层通道是什么以及如何使用它们。如果你想查看更完整的介绍以及相关数据，可以阅读这篇文章 [6]。</p><h2 id=分层通道><a href=#分层通道 class=headerlink title=分层通道></a>分层通道</h2><p>在分层通道中，参与方可以是单个用户，也可以是一群用户。</p><p>分层通道由两个参与方组成，生成两个主要输出（一方生成一个），另外还有 0 个及以上 HTLC 输出。</p><p>每个支付给多用户方的分层通道输出都是为另一个（可能同样是分层）通道提供资金。</p><p>因此，每个分层通道输出（包括解析后得到的 HTLC 输出）都可以被视为一个链下输出树的根，叶子为不同用户所有。</p><p>更新分层通道时，一方通过 HTLC 将资金提供给另一方。HTLC 提供方的一名用户被指定为 <em>付款者</em>，得到 HTLC 的一方的一名用户被指定为 <em>收款者</em>。</p><p>HTLC 的所有资金都由付款方提供。如果 HTLC 成功，大部分资金都会交给收款方（HTLC 收取方中除收款者之外的用户也会得到路由费）。</p><p>在通道状态更新为包含新的 HTLC 输出之前，通道中的所有用户会签署新的交易来花费新的通道状态的主要输出、已有 HTLC 输出以及新的 HTLC 输出。</p><p>接着，用户签署实现新的通道状态的交易（包括新的 HTLC 输出）并撤销之前的通道状态。</p><p>一旦 HTLC 被解决，通道状态将会更新，将 HTLC 的资金包含到接收方的主要输出中（如果 HTLC 成功的话），或提供方的主要输出中（如果 HTLC 失败的话）。</p><p>由于同一个分层通道内的两方可以使用 HTLC 来交换比特币，他们可以将自己的 HTLC 关联至其它（可能同样是分层）通道中的 HTLC，从而通过闪电网络进行付款。</p><p>需要强调的是，（可能是分层）通道中的各方都是闪电网络通道图中的一个节点，每个（可能是分层）通道则是一对连接通道内两方的单向边。</p><p>就像在当前的闪电网络中那样，付款包含一条路径：在上一跳中得到了 HTLC 的节点在下一跳中提供 HTLC（在上一跳中作为收款方的用户成为下一跳的付款方）。</p><h2 id=如何在链下调整路由通道><a href=#如何在链下调整路由通道 class=headerlink title=如何在链下调整路由通道></a>如何在链下调整路由通道</h2><p>提供路由服务的常驻用户可以使用分层通道在链下调整其闪电网络通道的大小。</p><p>假设常驻用户 A、B、C 和 D 之间创建了一个分层通道，其中 AB 为一方，CD 为另一方。此分层通道的主要输出为 AB 和 CD 所有的（非分层）通道提供资金。另外，假设 CD 方与（单用户）E 方之间另外有一个分层通道。</p><p>如果 AB 想要减少其（非分层）通道的容量，可以通过闪电网络创建一笔付款，由 AB 方（用户 A 是付款方）支付给 A 方（用户），付款路径是 AB -&gt; CD -&gt; E -&gt; F -&gt; G -&gt; A。</p><p>由于此付款来自 AB 方与 CD 方共有的分层通道中的 AB 方，由该分层通道支付给 AB 方的主要输出的值会随之减少。</p><p>由于 A 和 B 所有的（非分层）通道的资金来源于上述分层通道支付给 AB 方的主要输出，此付款缩减了 A 和 B 所有的通道的容量。</p><p>最后，由于此付款由 A（此付款第一跳中提供方 AB 的付款方）支付给 A 自己（此付款的终点），用户 A 的资金既没有增多，也没有减少（如果不考虑支付给用户 C、D、E、F 和 G 的路由费的话）。</p><p>此外，就像任何闪电网络付款那样，无论每个路由节点在上一跳中收到多少资金，到了下一跳都会在扣除路由费后，将剩余资金全部发送出去。因此，路由节点的余额大体不变（会因收取路由费而略有增加）。</p><p>此处的路由节点 E、F 和 G 跟当前闪电网络中的没有区别。但是，我们需要多加关注路由节点 CD，因为多用户节点是分层通道会为闪电网络带来的新特性。</p><p>就像其它路由节点那样，CD 方经由与 AB 方的分层通道收到了资金，并经由与 E 的分层通道将等量资金扣除路由费后发送给 E。</p><p>请注意，C 和 D 在闪电网络通道图中同样显示为节点。由 CD-AB 分层通道提供资金的 C-D 通道显示为 C 和 D 之间的一对单向边。由 CD-E 分层通道提供资金的 C-D 通道显示为 C 和 D 之间的一对单向边。</p><p>因此，C 和 D 之间两条通道的容量之和基本不变，会因路由费而略有增加。</p><p>由 AB 方支付给 A 的付款对闪电网络通道图局部的影响如下所示。</p><p>各参与方显示为方块，各通道显示为参与双方之间的一对有向边。</p><p>通道容量在有向边对之间显示，参与双方的余额在有向边对上方或下方显示。</p><pre><code>                                                                  200
     PHYSICAL CHANNELS                                       +--+ -&gt;  +--+
  BEFORE AB -&gt; A PAYMENT                                     |C | 500 |D |
  OF 100 UNITS PLUS FEES                                     |  |  &lt;- |  |
                                                             |  | 300 |  |
                                                             |  |     |  |
     800      800      400      200      500      500        |  | 700 |  |
+--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+   |  | -&gt;  |  |
|AB|1300 |CD|1000 |E |1000 |F | 400 |G | 700 |A | 800 |B |   |  | 800 |  |
+--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+   +--+  &lt;- +--+
     500      200      600      200      200      300             100

                                                                  308
     PHYSICAL CHANNELS                                       +--+ -&gt;  +--+
   AFTER AB -&gt; A PAYMENT                                     |C | 609 |D |
  OF 100 UNITS PLUS FEES                                     |  |  &lt;- |  |
                                                             |  | 301 |  |
                                                             |  |     |  |
     691      694      296       98      400      391        |  | 594 |  |
+--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+   |  | -&gt;  |  |
|AB|1300 |CD|1000 |E |1000 |F | 400 |G | 700 |A | 691 |B |   |  | 694 |  |
+--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+   +--+  &lt;- +--+
     609      306      704      302      300      300             100
</code></pre><h2 id=逻辑通道与物理通道><a href=#逻辑通道与物理通道 class=headerlink title=逻辑通道与物理通道></a>逻辑通道与物理通道</h2><p>由于 C 和 D 之间存在两条通道（一条由 CD-AB 分层通道提供资金，另一条由 CD-E 分层通道提供资金），理所当然要用两对有向边来分别表示两条通道（如上方所示）。</p><p>但是，如果我们在逻辑上将 C 和 D 之间的两条物理通道合并成一条容量为两条物理通道容量之和的逻辑通道，会得到更好的启发。</p><p>事实上，只要在连接 C 和 D 的两条物理通道中使用并行 HTLC，就能在 C 和 D 之间路由大额付款。</p><p>此外，将逻辑 （而非物理）通道公开给闪电网络对等节点有利于增加通道容量的稳定性，因为逻辑通道的所有方参与付款路由后基本不会改变通道容量（会因路由费而略有增加）。</p><p>以上述付款为例，A 和 B 之间的通道容量会因 AB 方支付给 A 的付款（另外还有路由费）而减少，而其它逻辑通道（包括 C 和 D 之间的逻辑通道）的容量基本不变（会因路由费而略有增加）。</p><pre><code>     LOGICAL CHANNELS
  BEFORE AB -&gt; A PAYMENT
  OF 100 UNITS PLUS FEES

     800      800      400      200      500      500             900
+--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+   +--+ -&gt;  +--+
|AB|1300 |CD|1000 |E |1000 |F | 400 |G | 700 |A | 800 |B |   |C |1300 |D |
+--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+   +--+  &lt;- +--+
     500      200      600      200      200      300             400

     LOGICAL CHANNELS
   AFTER AB -&gt; A PAYMENT
  OF 100 UNITS PLUS FEES

     691      694      296       98      400      391             902
+--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+ -&gt;  +--+   +--+ -&gt;  +--+
|AB|1300 |CD|1000 |E |1000 |F | 400 |G | 700 |A | 691 |B |   |C |1303 |D |
+--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+  &lt;- +--+   +--+  &lt;- +--+
     609      306      704      302      300      300             401
</code></pre><p>当然了，上述例子也可以被逆转（由 A 向 AB 方付款），在链下增加 A 和 B 之间的通道容量。</p><h2 id=帮助临时用户解决容量滞留问题><a href=#帮助临时用户解决容量滞留问题 class=headerlink title=帮助临时用户解决容量滞留问题></a>帮助临时用户解决容量滞留问题</h2><p>分层通道还可以用来帮助无瞭望塔的临时用户解决容量滞留问题。</p><p>假设无瞭望塔的临时用户 A 与常驻用户 B 和 C 共同创建了一条分层通道，其中 A 是一方，BC 是另一方。</p><p>假设 A 想要付款给 G，BC 方与用户 D 之间另有一条分层通道，D 与 E 之间有一条通道，E 与 F 之间有一条通道，F 与 G 之间有一条通道。</p><p>在此场景下，A 可以通过包含路径 A -&gt; BC -&gt; D -&gt; E -&gt; F -&gt; G 的闪电网络创建一笔付款。</p><p>当然了，上述例子也可以被逆转：由 G 向临时用户 A 付款。</p><p>重点是，只要是在 A 没有进行收付款的情况下，常驻用户 B 和 C 就可以使用通道内的所有容量来路由闪电网络付款。这里还要强调的一点是，只要 B 和 C 将他们的两条物理通道（一条由 BC-A 分层通道提供资金，另一条由 BC-D 分层通道提供资金）合并成一条逻辑通道对外公开，BC 在向为 A 提供付款路由服务时，此逻辑通道的容量基本不变（会因路由费而略有增加）。</p><h2 id=分层通道协议><a href=#分层通道协议 class=headerlink title=分层通道协议></a>分层通道协议</h2><p>创建分层通道协议需要解决几个问题。</p><p>第一，来自分层通道的每个主要输出（或已解决的 HTLC 输出）必须要能够支付给交易树，由交易树通过叶子将输出的资金分配给用户个人。</p><p>为了解决该问题，我们可以要求分层通道中的用户在签署承诺交易之前互换签名，让交易树能够花费此承诺交易的每个输出。</p><p>第二，闪电网络通道目前通过 channel_announcement 消息公布。此消息引用了链上 UTXO 为通道提供资金。通道的容量是静态的。</p><p>这类 channel_announcement 消息不适用于由链下 UTXO 提供资金且拥有动态容量的分层通道。</p><p>Russell 关于 channel_update_v2 消息的提议 [9] 非常适用于分层通道，因为它不仅合并了通道公告和通道更新的概念，还包含了通道容量，因此支持动态容量。</p><p>此提议还支持链下充值通道，让用户在公布容量最多为链上 UTXO 值的固定倍数的通道时能够引用链上 UTXO。</p><p>第三，分层通道必须具备支持两名以上用户的能力。</p><p>当前的闪电网络通道协议只支持双用户通道，因为它对于欺诈行为的惩罚方式是：如果有一方试图将非最新承诺交易上链，另一方就可以拿走通道内的所有资金。</p><p>如果通道内有超过两名用户，且其中至少有两名用户作恶，上述方式就无法发挥作用。</p><p>在这种情况下，两名恶意用户可能会串谋：一方将承诺交易上链，另一方以“惩罚”的名义拿走通道内的所有资金，包括那些属于诚实用户的资金。即使恶意用户无法确保自己一定能够拿走通道内的资金，高收益预期也有可能诱使用户作恶。</p><p>相较之下，通道工厂协议旨在让两名以上用户能够在链下更新工厂状态，每个工厂状态都包含工厂内用户的资金归属情况。</p><p>因此，如果我们将分层通道状态定义为包含两个主要输出以及任何 HTLC 输出，就可以使用通道工厂协议在链下更新通道状态。</p><p>尤其值得一提的是，我们还可以使用 Invalidation Tree protocol（失效树协议）[2]、Tunable-Penalty Factory protocol（可调惩罚工厂协议）[5] 或 Single-Commitment Factory protocol（单一承诺工厂协议）[5]。</p><p>其中，Tunable-Penalty Factory protocol 看起来最具吸引力，因为它只需要花费 O(1) 时长和 O(1) 链上字节即可完成单边通道关闭。</p><p>最后，除了维护通道的当前输出集，每个 HTLC 输出都要根据对应 HTLC 的条款解决。</p><p>一种基于当前闪电网络协议的简单方法是让 HTLC 输出能够通过以下两种方式之一花费：</p><ul><li><p>由收款方将提供 HTLC 所需原像的 HTLC-success 交易上链</p></li><li><p>HTLC 到期后，由提供方中的任意用户将 HTLC-timeout 交易上链</p></li></ul><p>此方法虽然可行，却存在两个严重的性能问题：</p><p>1）在链上解决 HTLC 需要关闭分层通道</p><p>2）将 HTLC 输出上链所造成的延迟可能会显著推后 HTLC 的到期时间</p><p>幸运的是，只要我们使用单独的控制交易来解决 HTLC，就像 FFO 和 FFO-WF 通道协议所做的那样 [4]，上述性能问题便可迎刃而解。</p><p>具体来说，我们可以扩展 FFO 协议的用途，利用它来解决由两名以上常驻用户所有的分层通道中的 HTLC。FFO-WF 协议也可以用来解决由两名以上用户（包含一名临时用户）所有的分层通道中的 HTLC。欲知详情，请阅读论文 [6]。</p><h2 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h2><p>用户可以在链上互相发送比特币。但是，将比特币存入闪电网络可以在链下实现近乎即时的比特币转移，不仅费用低得多，可扩展性也更强。</p><p>同样地，闪电网络通道容量能够按需在链上转移。但是，在分层通道中分配闪电网络通道容量能够在链下近乎即时调整通道大小，不仅费用低得多，可扩展性也更强。</p><p>此外，分层通道还可以用来帮助无瞭望塔的临时用户避免闪电网络通道容量滞留的问题。因此，帮助临时用户实现瞭望塔自由看起来颇具成本效益。</p><p>鉴于上述优点都可以在不改变底层比特币协议的情况下实现，我们希望分层通道最终能实现并应用于 BOLT，以提高闪电网络的可扩展性、效率和易用性。</p><p>[1] Burchert, Decker and Wattenhofer, <a target=_blank rel=noopener href=http://dx.doi.org/10.1098/rsos.180089>http://dx.doi.org/10.1098/rsos.180089</a></p><p>[2] Decker and Wattenhofer, <a target=_blank rel=noopener href=https://tik-old.ee.ethz.ch/file/716b955c130e6c703fac336ea17b1670/duplex-micropayment-channels.pdf>https://tik-old.ee.ethz.ch/file/716b955c130e6c703fac336ea17b1670/duplex-micropayment-channels.pdf</a></p><p>[3] Law, <a target=_blank rel=noopener href=https://github.com/JohnLaw2/ln-watchtower-free>https://github.com/JohnLaw2/ln-watchtower-free</a></p><p>[4] Law, <a target=_blank rel=noopener href=https://github.com/JohnLaw2/ln-factory-optimized>https://github.com/JohnLaw2/ln-factory-optimized</a></p><p>[5] Law, <a target=_blank rel=noopener href=https://github.com/JohnLaw2/ln-efficient-factories>https://github.com/JohnLaw2/ln-efficient-factories</a></p><p>[6] Law, <a target=_blank rel=noopener href=https://github.com/JohnLaw2/ln-hierarchical-channels>https://github.com/JohnLaw2/ln-hierarchical-channels</a></p><p>[7] Naumenko and Riard, <a target=_blank rel=noopener href=https://coinpool.dev/ >https://coinpool.dev/</a></p><p>[8] Riard, <a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-April/020370.html>https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-April/020370.html</a></p><p>[9] Russell, <a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/lightning-dev/2022-February/003470.html>https://lists.linuxfoundation.org/pipermail/lightning-dev/2022-February/003470.html</a></p><p>[10] Teinturier, <a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/lightning-dev/2022-October/003712.html>https://lists.linuxfoundation.org/pipermail/lightning-dev/2022-October/003712.html</a></p><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>