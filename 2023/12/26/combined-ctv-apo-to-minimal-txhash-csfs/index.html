<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>最小化的 TXHASH 和 CSFS：结合 CTV + APO</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/tools>工具</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">最小化的 TXHASH 和 CSFS：结合 CTV + APO</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>最小化的 TXHASH 和 CSFS：结合 CTV + APO</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/tools>工具</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%91%98%E8%A6%81><span class=toc-text>摘要</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-text>总结</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8A%A8%E6%9C%BA><span class=toc-text>动机</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AF%B9-CTV-%E7%9A%84%E6%89%B9%E8%AF%84><span class=toc-text>对 CTV 的批评</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AF%B9-APO-%E7%9A%84%E6%89%B9%E8%AF%84><span class=toc-text>对 APO 的批评</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88><span class=toc-text>解决方案</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%AF%A6%E8%BF%B0><span class=toc-text>详述</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#OP-TXHASH><span class=toc-text>OP_TXHASH</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#OP-CHECKSIGFROMSTACK-VERIFY><span class=toc-text>OP_CHECKSIGFROMSTACK(VERIFY)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%AE%A8%E8%AE%BA><span class=toc-text>讨论</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%83%E7%9A%84%E6%95%88%E7%8E%87%E4%B8%8E-bip118-%E7%9B%B8%E6%AF%94%E5%A6%82%E4%BD%95%EF%BC%9F><span class=toc-text>它的效率与 bip118 相比如何？</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%83%E7%9A%84%E6%95%88%E7%8E%87%E4%B8%8E-bip119-%E7%9B%B8%E6%AF%94%E5%A6%82%E4%BD%95%EF%BC%9F><span class=toc-text>它的效率与 bip119 相比如何？</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%8A%A0%E5%85%A5-bip118-%E7%9A%84-0x42-%E5%92%8C-0xc2-%E7%B1%BB%E5%9E%8B%EF%BC%9F-4><span class=toc-text>为什么不加入 bip118 的 0x42 和 0xc2 类型？ 4</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BF%99%E4%B8%AA%E6%8F%90%E8%AE%AE%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%9C%A8-LN-Symmetry-%E4%B8%AD%E5%90%97%EF%BC%9F><span class=toc-text>这个提议可以用在 LN-Symmetry 中吗？</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BF%99%E4%B8%AA%E6%8F%90%E8%AE%AE%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%9C%A8-PTLC-%E4%B8%AD%E5%90%97%EF%BC%9F><span class=toc-text>这个提议可以用在 PTLC 中吗？</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BF%99%E4%B8%AA%E6%8F%90%E8%AE%AE%E5%8F%AF%E4%BB%A5%E8%B7%9F-OP-VAULT-%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%E5%90%97%EF%BC%9F><span class=toc-text>这个提议可以跟 OP_VAULT 一起使用吗？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%A2%AB%E5%93%88%E5%B8%8C%E7%9A%84%E6%9C%89%E4%BB%80%E4%B9%88%EF%BC%9F><span class=toc-text>被哈希的有什么？</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%84%9A%E6%B3%A8><span class=toc-text>脚注</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>最小化的 TXHASH 和 CSFS：结合 CTV + APO</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Brandon Black"><div class=page-author-info><strong>Brandon Black</strong><time class=has-text-grey datetime=2023-12-26T09:35:20.000Z>2023-12-26</time></div></div><div class=is-flex><a href=/tags/CSFS><i class="page-tag mr-1 px-1">CSFS</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Brandon Black</em></p><p><em>来源：<a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-August/021907.html>https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-August/021907.html</a></em></p></blockquote><p>我正在为<a target=_blank rel=noopener href=https://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781>这份提议</a>（下附全文）征求反馈。该提议以综合的方式实现了 BIP118 和 BIP119 的支持者们希望的功能，同时保持了跟它俩任意一个提议同样的低风险。创建这个提议的部分目的跟我提出 BIP <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/pull/1472>PR#1472</a> 以及我的 “<a target=_blank rel=noopener href=https://docs.google.com/spreadsheets/d/1YL5ttNb6-SHS6-C8-1tHwao1_19zNQ-31YWPAHDZgfo/edit>限制条款比较表</a>” 的目的相似，是帮助进一步讨论这些提议，并让它们的相似性和区别变得更加明显。</p><p>对我来说，显然的是，两种提议的支持者之间的分歧很大程度上都来自于对提议的特性缺乏全面的理解。我们希望这个工作可以帮助厘清我们对它们两者（单个也好，一起也好）的思考，并对启用更好的闪电网络、保险柜以及其它类似的使用比特币的神奇方式的道路达成共识。</p><h2 id=摘要><a href=#摘要 class=headerlink title=摘要></a>摘要</h2><p>本提议是对 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a> 和 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 的替代；它提供了这两种提议的功能，而且在<a href=#compared-to-non-tapscript-ctv>大部分场景</a>下没有额外的开销；同时，它能辩驳对上述两种提议的某些反对意见，从而开启清晰的升级的路径。</p><p>实质上，本提议是 Russel O’Connor 的 <a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-January/019813.html>OP_TXHASH+OP_CSFS 提议</a>的一个初级的、受限的版本。</p><p>我们定义了三种新的专属于 Tapscript 的操作码，将 <code>OP_SUCCESS80</code>、<code>OP_SUCCESS187</code> 和 <code>OP_SUCCESS188</code> 分别替换成 <code>OP_TXHASH</code>、<code>OP_CHECKSIGFROMSTACK</code> 和 <code>OP_CHECKSIGFROMSTACKVERIFY</code>。</p><h2 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h2><p>对 <code>OP_TXHASH</code>，我们定义了 5 种哈希交易的方法，取决于从堆栈中弹出的、最小化编码的数字参数：</p><table><thead><tr><th>参数</th><th>行为</th></tr></thead><tbody><tr><td>0</td><td>如同 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a></td></tr><tr><td>1</td><td>如同使用 sighash 标签 <code>0x41</code> 的 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a></td></tr><tr><td>2</td><td>如同使用 sighash 标签 <code>0xc1</code> 的 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a></td></tr><tr><td>3</td><td>如同使用 sighash 标签 <code>0x43</code> 的 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a></td></tr><tr><td>4</td><td>如同使用 sighash 标签 <code>0xc3</code> 的 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a></td></tr></tbody></table><p><code>OP_CHECKSIGFROMSTACK(VERIFY)</code> 的定义类似于它<a target=_blank rel=noopener href=https://github.com/ElementsProject/elements/blob/f08447909101bfbbcaf89e382f55c87b2086198a/src/script/interpreter.cpp#L1399>在 Elements 项目中的实现</a>，但在内部求 SHA256 哈希值时并不包含数据参数。因为 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki>bip340</a> 定义了对任意长度的消息的签名，而且<code>OP_CHECKSIGFROMSTACK(VERIFY)</code> 仅可用于 Tapscript，内部哈希是没有必要的限制。用户可能希望使用预先哈希的数值（就像在本提议中一样），或者可以在脚本中使用非 SHA256 的哈希值。</p><h2 id=动机><a href=#动机 class=headerlink title=动机></a>动机</h2><p>人们花了很多笔墨在讨论比特币脚本编程的未来上。两个最接近于取得共识的提议是 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 和 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a>，但两个协议的支持者在两者的相对优先级和对方的优点上存在分歧。这里，我们会简要列举这样的一些反对意见，并展示本提议如何避免这些批评。我们不会讨论对引入限制条款或者 “递归限制条款” 的担忧。</p><h3 id=对-CTV-的批评><a href=#对-CTV-的批评 class=headerlink title="对 CTV 的批评"></a>对 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>CTV</a> 的批评</h3><ul><li>不够通用</li><li>在不仅需要验证哈希值的场景中不够高效（例如，跟 <code>OP_CHECKSIGFROMSTACK</code> 结合的时候）</li><li>使用 <code>OP_NOPx</code> 的语义（尽管 <code>OP_SUCCESSx</code> 已经可用）</li></ul><h2 id=对-APO-的批评><a href=#对-APO-的批评 class=headerlink title="对 APO 的批评"></a>对 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>APO</a> 的批评</h2><ul><li>不够通用</li><li>意外地启用了低效、难以使用的限制条款</li><li>使用新的 Tapscript 公钥版本以避免以外</li></ul><h2 id=解决方案><a href=#解决方案 class=headerlink title=解决方案></a>解决方案</h2><ul><li>通过提供 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 以及 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a> 的行为，本提议相比它们任何一个都更加通用。本提议也提供了显式的升级钩子，以备进一步增加通用性（例如，启用<a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-January/019813.html>全面的 OP_TXHASH</a>）</li><li>通过将哈希运算从 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a> 的验证中分离出来，哈希值就可以单独用在别的地方（而不是只能用在 <code>OP_EQUALVERIFY</code>中）</li><li>我们使用 <code>OP_SUCCESSx</code> 升级语义</li><li>我们显式地启用部分 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 意外启用的基于 sighash 的限制条款</li><li>通过使用新的签名检查操作码，我们不需要新的 Tapscript 密钥版本来保证安全性</li></ul><h2 id=详述><a href=#详述 class=headerlink title=详述></a>详述</h2><h3 id=OP-TXHASH><a href=#OP-TXHASH class=headerlink title=OP_TXHASH></a><code>OP_TXHASH</code></h3><p>在验证 Tapscript 的时候，<code>OP_SUCCESS80</code> 的行为修改如下：</p><ul><li>如果堆栈中 1 个元素也没有，那么执行失败 <sup><a href=#note1 id=jump-1>1</a></sup></li><li>如果栈顶的元素不是最小编码的 <code>OP_0</code>、<code>OP_1</code> 或者 <code>OP_2</code>，那么立即成功退出 <sup><a href=#note2 id=jump-2>2</a></sup></li><li>弹出栈顶的元素，并命名为 <code>哈希模式</code></li><li>如果 <code>哈希模式</code> 为 0：<ul><li>求交易的哈希值，如 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a> 的定义</li><li>将结果哈希值推入堆栈</li></ul></li><li>如果 <code>哈希模式</code> 为 1：<ul><li>求交易的哈希值，如 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 内使用 <code>sighash_type=0x41</code> 的定义</li><li>将结果哈希值推入堆栈</li></ul></li><li>如果 <code>哈希模式</code> 为 2：<ul><li>求交易的哈希值，如 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 内使用 <code>sighash_type=0xc1</code> 的定义</li><li>将结果哈希值推入堆栈</li></ul></li><li>如果 <code>哈希模式</code> 为 3：<ul><li>求交易的哈希值，如 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 内使用 <code>sighash_type=0x43</code> 的定义</li><li>将结果哈希值推入堆栈</li></ul></li><li>如果 <code>哈希模式</code> 为 4：<ul><li>求交易的哈希值，如 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 内使用 <code>sighash_type=0xc3</code> 的定义</li><li>将结果哈希值推入堆栈</li></ul></li></ul><h3 id=OP-CHECKSIGFROMSTACK-VERIFY><a href=#OP-CHECKSIGFROMSTACK-VERIFY class=headerlink title=OP_CHECKSIGFROMSTACK(VERIFY)></a><code>OP_CHECKSIGFROMSTACK(VERIFY)</code></h3><p>在验证 Tapscript 时，<code>OP_SUCCESS187</code> 和 <code>OP_SUCCESS188</code> 的行为修改如下：</p><ul><li>如果堆栈中不足 3 个元素，执行失败 <sup><a href=#note1 id=jump-1-1>1</a></sup></li><li>如果栈顶的（top-minus-0）元素的长度不是 32 字节，立即成功并退出 <sup><a href=#note2 id=jump-2-1>2</a></sup></li><li>如果栈顶往下数第三个（top-minus-2）元素的长度不是 64 字节，执行失败 <sup><a href=#note3 id=jump-3>3</a></sup></li><li>从堆栈中弹出三个元素，分别是 <code>公钥</code>、<code>消息</code> 和 <code>签名</code></li><li>令 <code>结果</code> 等于根据 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki>bip340</a> 验证 <code>签名</code> 对 <code>消息</code> 和 <code>公钥</code> 有效的结果</li><li>如果 <code>结果</code> 为 <code>true</code>，则推入堆栈，否则将 <code>false</code> 推入堆栈</li><li>如果验证的是 <code>OP_CHECKSIGFROMSTACKVERIFY</code><ul><li>将栈顶的元素弹出，作为 <code>检查值</code></li><li>如果 <code>检查值</code> 不是 <code>true</code>，则执行失败</li></ul></li></ul><h2 id=讨论><a href=#讨论 class=headerlink title=讨论></a>讨论</h2><h3 id=它的效率与-bip118-相比如何？><a href=#它的效率与-bip118-相比如何？ class=headerlink title="它的效率与 bip118 相比如何？"></a>它的效率与 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 相比如何？</h3><p><code>SIGHASH_ANYPREVOUT</code>：</p><pre><code>&lt;64 字节的签名&gt;||&lt;1 字节的 sighash 类型&gt; &lt;33 字节的公钥&gt; OP_CHECKSIG(VERIFY)
加上 PUSH 操作符： 64+1+1 + 33+1 + 1 = 101 witness bytes (25.25vBytes)
</code></pre><p>本提议：</p><pre><code>&lt;64 字节的签名&gt; &lt;1 字节的参数&gt; OP_TXHASH &lt;32 字节的公钥&gt; OP_CHECKSIGFROMSTACK(VERIFY)
加上 PUSH 操作符： 64+1 + 1 + 1 + 32+1 + 1 = 101 witness bytes (25.25vBytes)
</code></pre><h3 id=它的效率与-bip119-相比如何？><a href=#它的效率与-bip119-相比如何？ class=headerlink title="它的效率与 bip119 相比如何？"></a>它的效率与 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a> 相比如何？</h3><p><strong>都放在 Tapscript 内</strong></p><p>单独使用 <code>OP_CHECKTEMPLATEVERIFY</code>：</p><pre><code>&lt;32 字节的哈希值&gt; OP_CHECKTEMPLATEVERIFY OP_DROP OP_TRUE
加上 PUSH 操作符： 32+1 + 1 + 1 + 1 = 36 witness bytes (9vBytes)
</code></pre><p><code>OP_CHECKTEMPLATEVERIFY</code> 加上后续的检查：</p><pre><code>&lt;32 字节的哈希值&gt; OP_CHECKTEMPLATEVERIFY OP_DROP &lt;...&gt;
加上 PUSH 操作符： 32+1 + 1 + 1 = 35 witness bytes (8.75vBytes)
</code></pre><p>本提议：</p><pre><code>&lt;1 字节的参数&gt; OP_TXHASH &lt;32 字节的哈希值&gt; OP_EQUAL(VERIFY)
加上 PUSH 操作符： 1 + 1 + 32+1 + 1 = 36 witness bytes (9 vBytes)
</code></pre><p><strong>与非 Tapscript 的 CTV 比较</strong></p><p>裸的 <code>OP_CHECKTEMPLATEVERIFY</code>：</p><pre><code>锁定： &lt;32 字节的哈希值&gt; OP_CHECKTEMPLATEVERIFY OP_DROP OP_TRUE
加上 PUSH 操作符： 32+1 + 1 + 1 + 1 = 36 bytes (36vBytes)

解锁： &lt;empty&gt;

总计： 36 + 0 = 36vBytes
</code></pre><p>Witness v0 CTV：</p><pre><code>锁定： OP_0 &lt;32 字节的哈希值&gt;
加上 PUSH 操作符： 1 + 32+1 = 34 bytes (34 vBytes)

解锁：
&lt;36 字节的见证脚本&gt;
加上大小： 36+1 = 37 witness bytes (9.25vBytes)

总计： 34 + 9.25 = 43.25vBytes
</code></pre><p>本提议：</p><pre><code>锁定： OP_1 &lt;32 字节的哈希值&gt;
加上 PUSH 操作符： 1 + 32+1 = 34 bytes (34 vBytes)

解锁：
&lt;36 字节的叶子脚本&gt; &lt;33 字节的控制块&gt;
加上大小： 36+1 + 33+1 = 71 witness bytes (17.75vBytes)

总计： 34 + 17.75 = 51.75vBytes
</code></pre><p>相比于裸 CTV，本提议要贵 15.75 个虚拟字节。如果 CTV 的用例得到流行，可能需要为裸 CTV 专门安排一个升级，无论是像 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a> 定义的那样作为一个单独的见证版本，还是别的方法。</p><p>考虑 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a> 提到的风险，手续费敏感的用户可以在使用 <code>OP_TXHASH</code> 和 <code>OP_EQUAL(VERIFY)</code> 时加入 <code>OP_RIPEMD160</code> 以节约 2.75 虚拟字节，这将让本提议相比裸 CTV 的额外开销降低到 13 虚拟字节。</p><h3 id=为什么不加入-bip118-的-0x42-和-0xc2-类型？-4><a href=#为什么不加入-bip118-的-0x42-和-0xc2-类型？-4 class=headerlink title="为什么不加入 bip118 的 0x42 和 0xc2 类型？ 4"></a>为什么不加入 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 的 0x42 和 0xc2 类型？ <sup><a href=#note4 id=jump-4>4</a></sup></h3><p>可能由于我们缺乏想象力，我们看不到它在不签名任何输入以及任何输出（或者只签名一个输入脚本而不签名任何输出）时候的用途。</p><h3 id=这个提议可以用在-LN-Symmetry-中吗？><a href=#这个提议可以用在-LN-Symmetry-中吗？ class=headerlink title="这个提议可以用在 LN-Symmetry 中吗？"></a>这个提议可以用在 LN-Symmetry 中吗？</h3><p>可以，它完全兼容 N-Symmetry。它使用了另一种脚本，但跟出于这个目的而使用 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 时的体积和行为都是相同的。</p><h3 id=这个提议可以用在-PTLC-中吗？><a href=#这个提议可以用在-PTLC-中吗？ class=headerlink title="这个提议可以用在 PTLC 中吗？"></a>这个提议可以用在 PTLC 中吗？</h3><p>可以，它完全兼容 PTLC。它使用了另一种脚本，但跟出于这个目的而使用 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 时的体积和行为都是相同的。</p><h3 id=这个提议可以跟-OP-VAULT-一起使用吗？><a href=#这个提议可以跟-OP-VAULT-一起使用吗？ class=headerlink title="这个提议可以跟 OP_VAULT 一起使用吗？"></a>这个提议可以跟 OP_VAULT 一起使用吗？</h3><p>可以，也完全兼容 OP_VAULT。它使用了另一种脚本，但跟出于这个目的而使用 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>bip119</a> 时的体积和行为都是相同的。</p><h2 id=被哈希的有什么？><a href=#被哈希的有什么？ class=headerlink title=被哈希的有什么？></a>被哈希的有什么？</h2><table><thead><tr><th>字段模式</th><th>CTV(0)</th><th>APO&#x2F;ALL(1)</th><th>APOAS&#x2F;ALL(2)</th><th>APO&#x2F;SINGLE(3)</th><th>APOAS&#x2F;SINGLE(4)</th></tr></thead><tbody><tr><td>哈希类型</td><td></td><td>x</td><td>x</td><td>x</td><td>x</td></tr><tr><td>交易版本号&#x2F;锁定时间</td><td>x</td><td>x</td><td>x</td><td>x</td><td>x</td></tr><tr><td>本输入 UTXO</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>其它输入 UTXOs</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>本脚本公钥&#x2F;面额</td><td></td><td>x</td><td></td><td>x</td><td></td></tr><tr><td>其它脚本公钥&#x2F;面额</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>本脚本签名</td><td>x</td><td></td><td></td><td></td><td></td></tr><tr><td>其它脚本签名</td><td>x</td><td></td><td></td><td></td><td></td></tr><tr><td>输入的个数</td><td>x</td><td></td><td></td><td></td><td></td></tr><tr><td>本输入的 sequence</td><td>x</td><td>x</td><td>x</td><td>x</td><td>x</td></tr><tr><td>其它输入的 sequences</td><td>x</td><td></td><td></td><td></td><td></td></tr><tr><td>花费类型&#x2F;annex</td><td></td><td>x</td><td>x</td><td>x</td><td>x</td></tr><tr><td>叶子脚本</td><td></td><td>x</td><td></td><td>x</td><td></td></tr><tr><td>公钥版本&#x2F;codesep pos</td><td></td><td>x</td><td>x</td><td>x</td><td>x</td></tr><tr><td>tap 默克尔路径</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>对应输出的脚本&#x2F;面额</td><td>x</td><td>x</td><td>x</td><td>x</td><td>x</td></tr><tr><td>其它输出的脚本&#x2F;面额</td><td>x</td><td>x</td><td>x</td><td></td><td></td></tr><tr><td>输出的个数</td><td>x</td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id=脚注><a href=#脚注 class=headerlink title=脚注></a>脚注</h2><p>1.<a id=note1> </a>在堆栈元素的长度无效时执行失败，可以保证攻击者无法跳过验证。 <a href=#jump-1>↩</a> <a href=#jump-1-1>↩</a></p><p>2.<a id=note2> </a>我们在遇到未定义的 TXHASH 模式或公钥长度时执行成功，是为了允许未来的插件。 <a href=#jump-2>↩</a> <a href=#jump-2-1>↩</a></p><p>3.<a id=note3> </a>我们在公钥长度检查 <em>之后</em> 遇到无效的签名长度时失败，就可以让 64 字节的签名仅能使用 32 字节的公钥，但允许未来的公钥类型也能使用另一种长度的签名。 <a href=#jump-3>↩</a></p><p>4.<a id=note4> </a>迄今为止，就我们所知，除了在 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>bip118</a> 中定义的 sighash 类型， 其它类型在本提议中没有用处，因为其它类型要么会使操作降格为 <code>OP_CHECKSIG(VERIFY)</code>，要么会创建无限的哈希循环。 <a href=#jump-4>↩</a></p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>