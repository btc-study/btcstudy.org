<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>OP_EVICT：OP_TLUV 的一种替代</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/tools>工具</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">OP_EVICT：OP_TLUV 的一种替代</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>OP_EVICT：OP_TLUV 的一种替代</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/tools>工具</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%A2%84%E5%85%88%E6%89%BF%E8%AF%BA%E7%9A%84%E8%BE%93%E5%87%BA><span class=toc-text>预先承诺的输出</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%A2%98%E5%A4%96%E8%AF%9D%EF%BC%9A%E5%B8%A6%E6%9C%89%E9%80%90%E5%87%BA%E6%9C%BA%E5%88%B6%E7%9A%84-N-of-N><span class=toc-text>题外话：带有逐出机制的 N-of-N</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%89%BF%E8%AF%BA%E4%B8%80%E4%B8%AA%E6%97%A0%E6%8E%92%E5%BA%8F%E7%9A%84%E9%9B%86%E5%90%88><span class=toc-text>承诺一个无排序的集合</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#OP-EVICT><span class=toc-text>OP_EVICT</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%89%E5%85%A8%E6%80%A7><span class=toc-text>安全性</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%A2%9D%E5%A4%96%E8%AE%A8%E8%AE%BA><span class=toc-text>额外讨论</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%A9%B1%E9%80%90%E6%96%B9%E6%A1%88><span class=toc-text>驱逐方案</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BA%AF%E7%B2%B9%E7%9A%84-SCRIPT-%E5%90%88%E7%BA%A6><span class=toc-text>纯粹的 SCRIPT 合约</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%AD%BE%E5%90%8D%E7%9A%84%E5%87%8F%E5%8D%8A%E8%81%9A%E5%90%88><span class=toc-text>签名的减半聚合</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C%E7%A0%81%E7%9A%84%E5%85%B3%E7%B3%BB><span class=toc-text>与其他操作码的关系</span></a></li></ol></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>OP_EVICT：OP_TLUV 的一种替代</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt=ZmnSCPxj><div class=page-author-info><strong>ZmnSCPxj</strong><time class=has-text-grey datetime=2023-11-28T09:24:08.000Z>2023-11-28</time></div></div><div class=is-flex><a href=/tags/TLUV><i class="page-tag mr-1 px-1">TLUV</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：ZmnSCPxj</em></p><p><em>来源：<a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-February/019926.html>https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-February/019926.html</a></em></p></blockquote><p>在 2021 年末，aj 提出了 <code>OP_TAPLEAFUPDATEVERIFY</code>，以实现 CoinPool 及类似的构造。</p><p>Jeremy 观察到，由于使用了默克尔树路径，一个 <code>OP_TLUV</code>将需要揭晓 O(log N) 个哈希值，以触达某个 tapleaf ；在 CoinPool 的案例中，这个叶子将会在花费由它指定的数额之后删除自身。Jeremy 还观察到，<code>OP_CTV</code> 也类似，也需要揭晓 O(log N) 笔交易，但有个好处：一旦被揭晓，这笔交易就可以被复用，因此整体期望上看，链上的总字节数会比 <code>OP_TLUV</code> 少。</p><p>思索一番之后，我意识到，这是因为使用了默克尔树来表示 CoinPool 的预先承诺但放在链下（promised-but-offchain）的输出，从而导致了 O(log N) 的链上空间使用。然后我开始思考对预先承诺的输出集合的另一种表示方案，通过避免使用树结构来回避 O(log N) 次揭晓。</p><p>（译者注：“promised output” 在下文中会译成 “预先承诺的输出” 或者 “得到承诺的输出”。）</p><h2 id=预先承诺的输出><a href=#预先承诺的输出 class=headerlink title=预先承诺的输出></a>预先承诺的输出</h2><p>最根本来说，我们可以将扩容比特币的解决方案理解成 <em>承诺</em> 某些输出在未来 <em>可以</em> 出现在链上，而不要求这样的输出 <em>立即</em> 出现在链上。然后，我们可以执行在这些被承诺的输出上执行交易层面的 cut-through，而不需要链上的活动（这正是 “链下” 的含义）（译者注：“cut-through” 在比特币世界里，可以算是一个专有名词，它意味着可以省略中间的过程，仅发布起点状态和终局状态）。仅在一些糟糕而错误的事情发生的时候，我们才需要真的将预先承诺的输出的最新集合发布到链上、接受所有全节点的全局验证（并因此付出扩容和隐私性上的代价）。</p><p>作为上述范式的一个例子，我们先来看看闪电网络。代表一条通道内各方资金的输出得到预先的承诺，而且 <em>可以</em> 出现在链上（通过单方面关闭通道的机制）。与此同时，有一种机制可以执行交易的 cut-through，允许在通道参与者之间转移资金；任意数量的交易都可以发生，并仅在未来某一天 “固化” 下来，不需要昂贵的链上活动。</p><p>因此：</p><ul><li><p>CoinPool 也是一种承诺这样的输出的方式。为了改变这些预先承诺的输出的分布，coinpool 的运营者需要在链上发布一笔交易，但这是一笔只有 1 个输入和 1 个输出的交易；而且，有了 Schnorr 签名，这个输入只需要 1 个签名就可以了。但在一些糟糕的情况发生时，任何参与者都可以单方面关闭 CoinPool、从而将预先承诺的输出实例化。</p></li><li><p>Statechain 实际上也只是一种托管在 Decker-Wattenhofer 或者 Decker-Russell-Osuntokun 构造内的 coinpool。它允许不使用链上交易来改变这些预先承诺的输出的分布 —— 相反，它是在 Decker-Wattenhofer&#x2F;Decker-Russell-Osuntokun 构造内创建一个新状态（代表新的分布）、作废掉所有的旧状态。</p><p>同样地，任何参与者都可以单方面叫停，将这样的 coinpool 的内部状态暴露到链上。</p></li><li><p>Channel factory（通道工厂）也只是一种 statechain，只不过其中被承诺的输出不是简单的 1-of-1 的单个所有者的输出，而是 2-of-2 的通道。</p><p>这允许优雅的 “降级”：即使 statechain 层（通道工厂层）缺失了参与者，单条的 2-of-2 通道依然可以继续运行，只要他们的活动不影响不在场的参与者，所以大量的交易都不要求所有参与者在线。</p></li></ul><p>因此，我们只需考虑基本的 coinpool 的用法就够了，因为其它机制（<code>OP_CTV</code>+<code>OP_CSFS</code>、<code>SIGHASH_NOINPUT</code>）可以用来实现状态链、通道和通道工厂。</p><p>因此，我得出结论，我们需要的 “只是” 一种办法，向我们承诺能够暴露一组预先承诺的输出，而且只要我们都同意，我们就可以改变这个集合（无需暴露当前的集合或者下一个集合，不论是为了扩容还是为了隐私）。</p><p>（写给 Bitcoin Cash 的支持者：它们不是一种 IOU（借条），而是 <em>得到了承诺的</em>、可以在链上强制执行的，这就足以威慑你的链下对手、让他们规矩行事。否认自己承诺过的输出不能给他们带来任何好处，因为这些输出总是可以发布到链上并强制执行。所以，它不仅仅是一种 IOU，因为 IOU 并不必然可以执行，但这种机制 <em>可以</em>。区块链是 法官+陪审团+侩子手，不是一个吵闹的市场。）</p><p>重要的是，<code>OP_CTV</code> 和 <code>OP_TLUV</code> 都迫使用户为被承诺的输出决定一个特定、但最终来说是任意的排序。原则上来说，一组被承诺的输出，如果这些输出的主人都是平等的，那就没有 <em>任何</em> 内部排序。</p><p>因此，我开始思考一种承诺方案，在承诺中不强加任何排序。</p><h2 id=题外话：带有逐出机制的-N-of-N><a href=#题外话：带有逐出机制的-N-of-N class=headerlink title="题外话：带有逐出机制的 N-of-N"></a>题外话：带有逐出机制的 N-of-N</h2><p>使用一种 N-of-N 构造的一个问题在于，只要任何一个参与者离线，这种构造就无法推进状态了。</p><p>这使得一些人提议转为在 coinpool&#x2F;statechain&#x2F;通道工厂 中使用 K-of-N 机制，只要 N 大于 2 。</p><p>然而，即使如此，K-of-N 依然要求 K 个参与者保持在线，而且 K 成了一个安全参数。如果少于 K 个参与者在线，那么这种构造就 <em>还是</em> 无法推进状态。</p><p>更糟糕的是，因为 K &lt; N，某个参与者的资金可能会被另外 K 个参与者联手偷走。没有办法证明同一构造中的其他参与者不是同一个人的木偶，因此，有可能这 K 个成员实际上都是同一个人，现在 TA 有办法偷走其他所有人的钱了。避免这个问题的唯一办法就是使用 N-of-N：N-of-N 要求 <em>你的</em> 私钥参与，因此可以保证那些钱是 <em>你的</em> 钱。简而言之，K-of-N，正因为它无需你的密钥就可以更新状态（以 “尽管您离线了，我们也需要更新状态” 为借口），违反了 “无钥即无币” 的法则。</p><p>K-of-N 应该仅用在所有 N 个公钥都是你的木偶，而你想要保住自己的资金的情况。这也是共识（“每个人都必须同意”）与投票（“只需足够多的木偶就可以给你带来权力”）的区别。</p><p>不过，有了 <code>OP_TLUV</code>，我们可以创建一种 “带有逐出机制的 N-of-N” 构造。当 N-of-N 构造中的某个参与者离线、但其他参与者都想更新状态时，他们可以逐出这个离线的参与者、创建一个更小的 N-of-N 构造，在这个新构造中 <em>所有</em> 参与者都在线，可以继续运行。</p><p>这避免了 K-of-N 的 “无钥即无币” 问题，同时提供了一种办法，无需所有参与者都在线就可以更新状态。</p><p>使用 <code>OP_TLUV</code> 的唯一问题在于，它要揭露 O(log N) 个哈希值，以逐出一个参与者；而每逐出一个参与者都需要一笔单独的交易。</p><p>相比之下，K-of-N 有个 “优势”：即使你离线了，也可以在不逐出你的前提下更新状态。不过，如前所述，因为资金无需你的密钥就可以花费，这些钱也就不是你的钱，因此这种好处是可疑的 —— 无论你在线还是离线，K 个人总可以联手偷走你的资金。而逐出机制会让你的资金回到你的控制中。</p><h2 id=承诺一个无排序的集合><a href=#承诺一个无排序的集合 class=headerlink title=承诺一个无排序的集合></a>承诺一个无排序的集合</h2><p>在一个 N-of-N 的 coinpool&#x2F;statechain&#x2F;通道工厂 中，链上的单个 UTXO 的所有权是在 N 个参与者之间分享的。也就是说，有 N 个得到承诺的输出，并未暴露在链上，是这 N 个参与者都同意的、是这个构造的 “真实的” 最新状态。不过，这 N 个参与者也可以一致同意改变最新状态，只要所有人都签名这次变更。</p><p>每一个得到承诺的输出都有一个面额（价值），而所有得到承诺的输出的面额之和，就是链上 UTXO 的面额。有趣的是，每一个预先承诺的输出也都有一个 SPEC256K1 点，可以用作一个公钥；而所有预先承诺的点的总和，也正是链上 UTXO 的点。（译者注：这似乎是说，链上 UTXO 的公钥是各参与者的聚合公钥，而参与者们也将自己的原公钥用在获得承诺的输出中。）</p><p>因此，链上的 UTXO 可以视为承诺了预先承诺的输出的总和。问题在于，如何承诺每一个单体的输出？</p><p>我们可以观察到，一个数字签名不仅证明了对某个一私钥的知识，也承诺了一条具体的消息。因此，我们可以让每一个签名者签名符合自己预期的、属于自己的输出，并为这些输出分享签名。</p><p>当某个参与者要被逐出时，其他参与者就取得这个参与者为自己的得到承诺的输出的签名，并在链上展示，作为这个输出的见证。然后，链上机制会将剩余的资金发给减去了被逐出的参与者的 N-of-N 群组。</p><h2 id=OP-EVICT><a href=#OP-EVICT class=headerlink title=OP_EVICT></a><code>OP_EVICT</code></h2><p>基于上述所有，我现在提议一种 <code>OP_EVICT</code> 操作码。</p><p><code>OP_EVICT</code> 接受可变数量的参数。</p><ul><li><p>栈顶要么是常数 <code>1</code>，要么是一个 <code>SECP256K1</code> 点。</p><ul><li>如果是 <code>1</code>，那就意味着 “使用 Taproot 内部公钥”，就像 <code>OP_CHECKSIG</code> 那样。</li></ul></li><li><p>堆栈的下一个元素是一个数字，等于被承诺的输出（也即要被逐出的）输出的面额。</p></li><li><p>接下来的堆栈元素会两两交替出现：</p><ul><li><p>一个数字，指明一个输出的索引号。</p></li><li><p>对该输出的一个签名。</p></li><li><p>输出的索引不能重复，而且被索引的输出必须是 SegWit v1（“Taproot”）输出。这个输出的公钥将被用于验证对应的签名，而且签名仅涵盖输出自身（即，面额以及 <code>scriptPubKey</code>）。</p><p>这也意味着，这个签名没有 <code>SIGHASH</code>。</p></li><li><p>因为签名也涵盖了公钥，这可以防止使用某个公钥的签名被熔铸成使用另一个公钥的签名。</p></li></ul></li><li><p>然后是另一个签名。</p><ul><li>这个签名是使用 <code>OP_CHECKSIG</code> 的语义（以及 <code>SIGHASH</code> 支持）来检查的。</li><li>这个公钥是输入的点（即栈顶元素）<strong>减去</strong>得到索引的输出的所有公钥。</li></ul></li></ul><p>举一个具体的例子，假设 A、B、C 和 D 想建立一个 CoinPool（或是某个链下的变种），他们的初始状态如下：</p><ul><li>A :&#x3D; 10</li><li>B :&#x3D; 6</li><li>C :&#x3D; 4</li><li>D :&#x3D; 22</li></ul><p>假定 A、B、C、D 以一种可以避免 “密钥取消（key cancellation）”（译者注：此处指的应该是 Schnorr 公钥的 “Rogue Key 攻击”）的方式（例如预承诺或者 MuSig 方案）生成了公钥。</p><p>然后，参与者们为上述面额生成预先承诺的输出，然后各自分享这些预先承诺的输入的签名：</p><ul><li>sign(a, “A :&#x3D; 10”)</li><li>sign(b, “B :&#x3D; 6”)</li><li>sign(c, “C :&#x3D; 4”)</li><li>sign(d, “D :&#x3D; 22”)</li></ul><p>完成之后，他们就生成：</p><ul><li>Q &#x3D; A + B + C + D</li><li>P &#x3D; h(Q|<code>&lt;1&gt; OP_EVICT</code>) * Q</li></ul><p>然后他们汇集资金，形成一个 Taproot 输出：</p><ul><li>P :&#x3D; 42</li></ul><p>如果所有参与者都在线，他们可以通过合作签名在彼此之间转移资金（或者移动到另一个地址）；这时候使用的公钥是 P，taproot 的魔法意味着 <code>OP_EVICT</code> 是不可见的。</p><p>然而，假设 B 掉线了。那么 A、C、D 就决定驱逐 B。为此，他们创建了一个交易，带有一个输出 <code>B := 6</code>，然后他们揭晓 <code>OP_EVICT</code> Tapscript 以及签名 <code>(b, &quot;B:=6&quot;)</code>。这使他们能改变状态、花费自己的钱，而无需 B 在线。而且 B 也是安全的，因为他们要逐出 B 的时候就必须使用这个预先签名的输出，而这个输出是 B 自己认证了可以接受的。</p><p>注意，上述的操作码允许在一笔交易中逐出多个成员。如果 B 和 C 都离线了，那么剩余的参与者只需在同一笔交易中暴露多个输出即可。</p><h2 id=安全性><a href=#安全性 class=headerlink title=安全性></a>安全性</h2><p>我不是一个密码学家。因此，这个方案的安全性是不确定的。</p><p>只要不出现密钥取消，应该就是安全的。合并在一起的资金必须所有人都同意才能花费。仅在逐出一个参与者的时候才能创建一个更小的参与者集合，而驱逐又只能将被驱逐的参与者的资金实例化。其他参与者，在不知道被逐出的参与者的私钥的情况下，无法生成签名另一个值的签名。</p><p>为了放置签名重放（replay），像 CoinPool 这样的可以更新的方案的每一次更新，都需要每个参与者使用一个不同的公钥。因为签名涵盖了公钥，所以使用一种非强化的派生方案应该也是安全的，因此只需要一个根私钥。</p><h2 id=额外讨论><a href=#额外讨论 class=headerlink title=额外讨论></a>额外讨论</h2><h3 id=驱逐方案><a href=#驱逐方案 class=headerlink title=驱逐方案></a>驱逐方案</h3><p>我们可以将这里提议的驱逐方案视为下列合约：</p><ul><li>要么，所有人都同意转移资金，或者</li><li>让我拿回我的钱，然后剩下的人你们爱怎么玩就怎么玩。</li></ul><p>而涵盖了一个得到承诺的输出的签名，就是一个协议，让这个参与者可以想象自己能够拿回具体的数额。</p><p>我们可以想象一个参与者可以用另一个数额重新签名自己的输出，但这就是为什么 <code>OP_EVICT</code> 需要其他参与者一起合作签名。如果其他参与者合作式签名，这就表示他们都同意这个人重新签名一个不同的数额，因此属于 “所有人都同意转移”。</p><h3 id=纯粹的-SCRIPT-合约><a href=#纯粹的-SCRIPT-合约 class=headerlink title="纯粹的 SCRIPT 合约"></a>纯粹的 SCRIPT 合约</h3><p>一个 “纯粹的 SCRIPT 合约” 是一个 Taproot 合约，其 keysend 路径是人们不想要的，它纯粹由 Tapscript 分支组成。</p><p>在这种情况下，预计合约的参与者需要一种技术，对一个 NUMS 点达成一致：没有任何一个参与者知道这个点背后的标量（私钥），并将这个点用作 Taproot 输出的内部公钥 <code>Q</code>。对于整个协议，NUMS 点可以是一个协议定义的常数。</p><p>因为 <code>OP_EVICT</code> 要求每一个预先承诺的输出都要得到签名；从表面上看，这种技术是无法用在 <code>OP_EVICT</code> 预先承诺输出中的，因为不可能使用 NUMS 点来签名。</p><p>但是，我们注意到，一个 “纯粹 SCRIPT 合约” 的要求是没有任何一个参与者可以单方面签名另一种花费行为。使用参与者的 N-of-N 公钥作为 Taproot 内部公钥，已经足以保证这一点。</p><p>一个具体的例子：假设我们想要一个 HTLC，其哈希锁分支要求参与者 A，而时间锁分支要求参与者 B。这样一种简单的方案不需要 A 和 B 能够合作式花费这个交易，因此我们会倾向于使用一个 NUMS 点作为Taproot 内部公钥。但使用 NUMS 点将不允许任何签名，即使是 <code>OP_EVICT</code> 要求的、对预先承诺的输出的签名。</p><p>预期使用一个 NUMS 点作为 Taproot 内部公钥，我们可以使用 <code>A[tmp] + B[tmp]</code> 的和（需要适当地防止密钥取消）。然后，A 和 B 可以合作签名预先承诺的输出，并将在一个可以强制执行 <code>OP_EVICT</code> 的 UTXO 中保存预先承诺的输出。在为预先承诺的输出创建好签名后，A 和 B 可以通过安全地删除自己的临时私钥 <code>A[tmp]</code> 或 <code>B[tmp]</code> 来保证密钥分支无法被使用。</p><h3 id=签名的减半聚合><a href=#签名的减半聚合 class=headerlink title=签名的减半聚合></a>签名的减半聚合</h3><p>可以实现批量验证，而且因为 <code>OP_EVICT</code> 必须验证至少两个签名（一个驱逐签名和一个剩余参与者的签名），所以为 <code>OP_EVICT</code> 使用批量验证是有意义的。</p><p>要指出的是，Schnorr 签名允许第三方的减半聚合，其中多个签名的 <code>s</code> 值被加在一起，但 <code>R</code> 值不加总。</p><p>（警告：我还不知道减半聚合的安全性证明！而且，BIP-340 没有定义减半聚合，而且，根据我的直觉，它的批量验证算法不能扩展到减半聚合。）</p><p>基本上，如果我们要批量验证两个签名（两条消息 <code>m[0]</code> 和 <code>m[1]</code> 的签名 <code>(R[0], s[0])</code> 和 <code>(R[1], s[1])</code>，分别来自公钥 <code>A[0]</code> 和 <code>A[1]</code>），我们需要：</p><ul><li>对 <code>i = 0, 1</code>，<code>e[i] = h(R[i]|m[i])</code></li><li>检查：<code>(s[0] + s[1]) * G</code> 等于 <code>R[0] + e[0] * A[0] + R[1] + e[1] * A[1]</code></li></ul><p>如我们所见，<code>s</code> 可以在发布到区块链之前加总，因为验证者并不需要知道每一个 <code>s[i]</code>。但是 <code>R</code> 不能加总，因为每一个 <code>R</code> 都要分别哈希。</p><p>减半聚合可以由第三方来做，即，不需要知道任何私钥，也可以直接加总多个签名的 <code>s</code>。</p><p>因为 <code>OP_EVICT</code> 总是至少要验证两个签名，所以使用减半聚合算法可以减少至少 32 个重量单位，而且每多一个被逐出的输出，就多一个可以加入到总和中的 <code>s</code>。当然，<strong>这一切都依赖于减半聚合真的安全</strong>。</p><blockquote><p>Jonas Nick 在<a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-February/019935.html>回帖</a>中指出：</p><p>关于减半聚合的安全性，Chalkias 等人已经在去年给出了一份有说服力的安全性证明：</p><p><a target=_blank rel=noopener href=https://eprint.iacr.org/2021/350>https://eprint.iacr.org/2021/350</a></p><p>此外，减半聚合不可以使用本帖子中的方案，因为这是不安全的。这不影响 Zmn 的结论，而且在最初的减半聚合帖子中就已经指出了：</p><p><a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014306.html>https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014306.html</a></p><p>需要每一个 <code>s</code> 值都各自乘以一个不同的、不可预测的值，举例：</p><p><a target=_blank rel=noopener href=https://github.com/ElementsProject/cross-input-aggregation/blob/master/slides/2021-Q2-halfagg-impl.org#schnorr-signature-half-aggregation-1>https://github.com/ElementsProject/cross-input-aggregation/blob/master/slides/2021-Q2-halfagg-impl.org#schnorr-signature-half-aggregation-1</a></p></blockquote><h3 id=与其他操作码的关系><a href=#与其他操作码的关系 class=headerlink title=与其他操作码的关系></a>与其他操作码的关系</h3><p><code>OP_CTV</code> 的功能与本操作码不同，而且无法用作本操作码的直接替代。具体来说，虽然 <code>OP_CTV</code> <em>可以</em> 承诺一组得到承诺的输出，但如果需要发布某一个预先承诺的输出，剩余的资金会分散到一组 UTXO 中。因此，“复苏” 一个 CoinPool（或者其链下变体）需要花费多个 UTXO，而花费多个 UTXO 是危险的，除非进行专门的设计。（尤其是，如果 UTXO 有不同的签名者集合，一群签名者可以一开始合作复苏一个 CoinPool，然后再另一笔交易中花费自己的 UTXO；一旦这另外的交易得到确认，复苏交易就会作废。）</p><p>本操作码似乎在很大程度上跟 <code>OP_TLUV</code> 直接竞争，因为设计目标在很大程度上是相同的。其优势在于，在需要逐出多个成员时，需要的交易数量较少，而且 CoinPool 的复苏可以放在同一笔交易中。而它的劣势（相对于 <code>OP_TLUV</code>）在于，它需要点运算。我还未彻底研究，但我的直觉认为，<code>OP_TLUV</code> 也需要至少一次签名验证。</p><p>也许可以用 <code>OP_TX</code>&#x2F;<code>OP_TXHASH</code>、<code>OP_CSFS</code> 以及一种点减法运算实现 <code>OP_EVICT</code>。但是 <code>OP_EVICT</code> 允许批量验证的简单实现（而且，如果减半聚合是安全的，可以转而使用减半聚合），相反，我们预计需要多次 <code>OP_CSFS</code> 才能实现同样的通道，而且没有任何批量验证的可能。也许有可能设计一种 <code>OP_CSFS</code> 的变体以允许批量验证，例如通过一种待处理的签名验证的累加器来延展虚拟机。</p><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>