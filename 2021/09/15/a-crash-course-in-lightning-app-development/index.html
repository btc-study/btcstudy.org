<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>闪电网络应用开发速成指南</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">闪电网络应用开发速成指南</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>闪电网络应用开发速成指南</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C%E7%9A%84%E6%9E%B6%E6%9E%84><span class=toc-text>闪电网络的架构</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%9E%E7%8E%B0><span class=toc-text>实现</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BD%A0%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83><span class=toc-text>你的开发环境</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%AE%BE%E7%BD%AE-Polar><span class=toc-text>设置 Polar</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%94%AF%E4%BB%98%E6%B5%81%E7%A8%8B><span class=toc-text>支付流程</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BC%80%E5%A7%8B%E4%BD%A0%E7%9A%84%E5%86%92%E9%99%A9%E5%BE%81%E7%A8%8B><span class=toc-text>开始你的冒险征程</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>闪电网络应用开发速成指南</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Michael Rhee"><div class=page-author-info><strong>Michael Rhee</strong><time class=has-text-grey datetime=2021-09-15T11:59:13.000Z>2021-09-15</time></div></div><div class=is-flex><a href=/tags/%E5%BC%80%E5%8F%91><i class="page-tag mr-1 px-1">开发</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Michael Rhee</em></p><p><em>来源：<a target=_blank rel=noopener href=https://medium.com/@rheedio/a-crash-course-in-lightning-app-development-5be5b8d2d558>https://medium.com/@rheedio/a-crash-course-in-lightning-app-development-5be5b8d2d558</a></em></p></blockquote><p>如果你想要入门闪电网络编程，又不在乎所谓正确、最佳的做法，这篇文很适合你。换言之，这篇指南具有很强的 <em>主观性</em>。如果你偏好 O’Reilly 式的权威文本，这篇文章可能不对你的胃口。但是，如果你想要了解闪电网络的最小开发环境及其基本内容，不妨读一读。我写本文的目的是提炼出创建闪电网络应用的基础知识点，让新手能够快速构建和实验。</p><p>我相信，只要掌握了基础知识点，你就能编写出更加复杂安全的应用。但是，每个人都得有个开始，我个人的感受是万事开头难，我认为将这些思想整合到一起可以帮助一些迷途羔羊缓解痛苦。</p><p>在深入介绍细节之前，请允许我简单介绍一下自己的背景：</p><p>大约一个月之前，我辞去了原本稳定的数据架构师工作，开始研究日新月异的比特币生态。你会找到这篇文章，表明你已经迈出了这一步（或者正在考虑这么做）。</p><p>简单来说，我认为比特币是我所见过最有趣的技术创新。我越了解比特币，就越被它吸引。比特币技术有希望改变乃至重塑如今的交互方式，使之脱胎换骨。我希望贡献自己的一份力量。</p><p>这就是为什么我会选择在比特币上开发。我希望这篇文章能够让不熟悉闪电网络生态及其潜力的开发者受益，鼓励更多开发者为比特币领域注入创造力。</p><p>老实说，关于比特币生态，我想写的实在太多了（其中，“<a target=_blank rel=noopener href=https://research.satoshienergy.com/special-report-energy-backed-money/ >由能源支持的货币</a>”这一概念排在第一位），但是只能择日再谈了。现在开始进入正题：</p><p><img src=/images/a-crash-course-in-lightning-app-development/f083597079ca4df6a044a0f9ab8aee75.png alt=1></p><h2 id=闪电网络的架构><a href=#闪电网络的架构 class=headerlink title=闪电网络的架构></a>闪电网络的架构</h2><p><img src=/../images/a-crash-course-in-lightning-app-development/800b44d013204564b545df7bb03d5635.png alt=2></p><p style=text-align:center>-图源：<a target=_blank rel=noopener href=http://lnrouter.app/graph>lnrouter.app</a>-</p><p>闪电网络的基础设计是利用通道实现节点间的一对一连接。开通通道需要存入一定数量的比特币，该事务会记录在比特币区块链上。然后，用户可以使用特殊的链下合约在节点之间转移通道内的比特币，无需提交新的事务到区块链上。</p><p>实际做法是实时追踪通道内的余额变化。例如，你在与 Alice 开通的通道内存入 100 satoshi，你有大约 100 satoshi （减去链上交易手续费）的转账额度，既可以直接转给 Alice ，也可通过 Alice 间接转给其他人。这些转账几乎是即时的，因为我们只需根据每笔交易调整通道的余额。这种调整是通过在付款方和收款方之间传递加密消息实现的。</p><p>闪电应用是在闪电网络（所谓的比特币二层）上运行的。闪电应用同样以比特币作为支付方式，但是结算速度更快、交易费更低。</p><p>虽然我只是非常简略地概括了闪电网络协议，但是知道这些已经足够入门了。如果你想更详细地了解闪电网络是如何运作的，<a target=_blank rel=noopener href=https://www.lopp.net/lightning-information.html>这里有一些很好的阅读材料</a>。小心不要沉溺在知识的海洋里，坐在电脑前读到很晚，却一行代码都没有敲。也不是说这样一定不好，只是我们的目的还是在于实践。另外，保证充足的睡眠也很重要。</p><p>我认为，若想了解闪电网络及其节点的运作方式，更好的办法是自己运行一个节点并弄清楚如何通过节点路由付款。虽然这个办法需要付出更多时间和金钱，但是既有趣又长知识。<sup>1</sup></p><h2 id=实现><a href=#实现 class=headerlink title=实现></a>实现</h2><p>闪电网络是<a target=_blank rel=noopener href=https://github.com/lightningnetwork/lightning-rfc/blob/master/00-introduction.md>开放式协议</a>。这就意味着，闪电网络有标准的消息通信和解释方式。就像 HTTPS 和 TCP&#x2F;IP 不归任何人所有那样，闪电网络协议也是如此。任何人只要遵守标准都可以参与闪电网络。不仅如此，随着开发者不断加固协议并增加新功能，这一标准也会持续发展。</p><p>目前有四家公司在闪电网络协议开发中处于核心地位：Lightning Labs、Blockstream、ACINQ 和 Square Crypto，而且都有自己的实现：</p><p>Lightning Labs —<a target=_blank rel=noopener href=https://github.com/LightningNetwork/lnd> lnd</a> (Go)</p><p>Blockstream — <a target=_blank rel=noopener href=https://github.com/ElementsProject/lightning>c-lighting</a> (C)</p><p>ACINQ — <a target=_blank rel=noopener href=https://github.com/ACINQ/eclair>eclair</a> (Scala)</p><p>Square Crypto — <a target=_blank rel=noopener href=https://github.com/rust-bitcoin/rust-lightning>Rust Lightning</a> (Rust)</p><p>上述所有实现都能通过闪电网络进行通信。区别在于这些实现的 API。本文只聚焦于 Lightning Labs 的 lnd，因为这是我最先接触、也是了解最多的。虽然我最终选择 Ind 有偶然成分在里面，但是不得不夸一下，Lightning Labs 的 Ind 文档写得很好，而且开发者能够通过官方 Slack 频道获得很多帮助和支持。</p><p>请注意，下文将围绕 Ind 展开讨论，但是基本概念适用于所有闪电网络实现。</p><h2 id=你的开发环境><a href=#你的开发环境 class=headerlink title=你的开发环境></a>你的开发环境</h2><p>不废话，使用 <a target=_blank rel=noopener href=https://lightningpolar.com/ >Polar</a> 就行了。</p><p>好吧，再多说两句。无论你是开发者还是用户，在闪电网络上进行构建的最大障碍是如何创建后端。我说的不只是一个钱包，因为有很多简单快速的托管解决方案可以用。我指的是真正的后端 —— 运行比特币和闪电网络的节点。</p><p><img src=/../images/a-crash-course-in-lightning-app-development/0d4befe1acb84185b945ceae446f5976.png alt=3></p><p>我之所以这么说，是因为你的应用需要拥有节点的某些权限，才能完成一些重要操作，例如，通过 API&#x2F;gRPC 调用创建发票和监控付款。如果有节点运营者授予你节点的访问权限，你同样可以完成这些操作，但还是自己运营一个节点比较好。</p><p>能够用于闪电网络开发的节点必须运行两个进程：（1）同步到比特币区块链最新区块的比特币客户端；（2）已开启通道（可以收发支付）的闪电网络客户端。</p><p>如果你使用的是普通的家用宽带，光是同步区块链就需要花费至少几天的时间。你可以试一下 Neutrino（一款轻量级比特币钱包），但是我听说用它在闪电网络上开发可能会导致一些问题。我没有亲身尝试过。不管怎样，如果你才刚开始接触这类工具，我想最好去除那些可能会产生负面影响的变量。因此，如果你负担得起，我建议你同步完整的区块链就好。</p><p>如果我们对比特币的分层进行排序，闪电网络层就是比特币的二层。正如我上文提到的，我们需要在闪电网络上开启通道来进行交易。虽然在闪电网络上开启通道不是很难，但是你需要一些计划和协调，还要付出比特币。你当然可以质押比特币来开启通道，然后开始交易。但是，你没必要承担这种金融风险。<sup>2</sup></p><p>暂时先别管这些。<a target=_blank rel=noopener href=https://lightningpolar.com/ >Polar</a> 是一个<strong>很棒</strong>的工具，可以让你在笔记本电脑上的 Docker 容器内模拟运行这些进程。另外，它还提供一个精美的 UI 界面，为你展示网络可视化效果。</p><p><img src=/../images/a-crash-course-in-lightning-app-development/3654e1e885bb4eb2a266334c4ca489e1.png alt=4></p><p style=text-align:center>-你看！是不是等不及想同步了！（Polar 界面）-</p><p>Polar 的优点在于，当你准备好将应用转移到测试网或主网后端时，你只需要更新一些配置即可。我已经可以做到在本地、测试网和主网后端之间轻松切换，只需在应用中添加或注释掉几行代码即可。（我最后会得到 .env 文件。当然了，测评工具不是本文的目的。）</p><p>Polar 也支持 lnd、c-lighting 和 eclair 节点。这就意味着你可以灵活尝试其它实现。</p><p>再重申一遍：使用<a target=_blank rel=noopener href=https://lightningpolar.com/ > Polar</a> 就好。这是一种快速且简单的入门方法。再者说，万一你根本不喜欢在闪电网络上开发呢？早日发现这一点，总好过在一个你不一定会使用的系统上浪费过多时间和金钱。话说回来，如果你发现自己沉迷于 <a target=_blank rel=noopener href=https://stephanlivera.com/episode/204/ >Stephan Livera</a>（知名比特币主播）的播客，每晚收听不可自拔，可以搭建一个更严肃的开发环境。</p><h2 id=设置-Polar><a href=#设置-Polar class=headerlink title="设置 Polar"></a>设置 Polar</h2><p><img src=/../images/a-crash-course-in-lightning-app-development/caa4cb5328b249489a1137949f1eeca2.png alt=5></p><p>点击 “Create Network（创建网络）”，即可在 Polar 中轻松创建模拟闪电网络环境。你可以随意命名这个网络（我个人认为 “test（测试）” 是个聪明的选择）并添加两个 lnd 节点和一个 Bitcoin Core 节点。实际上，对于刚入门的人来说，这些只是最低配，之后还可以添加更多节点。你创建好网络后就可以启动它。首次启动网络时需要的时间可能会长一些，因为你必须下载所有 Docker 镜像。顺带一提，你需要在自己的设备上运行 Docker。就像我之前说的，这里还是得靠自己摸索。</p><p>最后，你会看到一个类似下图的 Polar 界面：</p><p><img src=/../images/a-crash-course-in-lightning-app-development/870fed08b5c24d71a4728847e58053ae.png alt=6></p><p>在上图所示界面中，我们可以看到 Alice 和 Bob 的 Ind 节点，而且这两个节点都与 Bitcoin Core 后端进程相连。另外还要注意的是，这时的区块高度是 1。这是我们的创世块！不同于实时区块链，Polar 只有在开发和测试过程中提交交易时才会出块。</p><p>下一步是在 Alice 和 Bob 之间创建一条通道，用来进行闪电付款。点击 Alice 的节点，右侧控制面板会显示我们可以与该节点交互的不同方式。点击 “Actions（操作）” ，我们就会看到向 Alice 的钱包充值模拟比特币以及在 Alice 和 Bob 之间开启通道所需的一切工具。接下来，我们先向 Alice 的钱包充值一些资金，再开启 Alice 与 Bob 的通道吧。</p><p>点击 “Deposit（充值）” ，接着将 100 万 satoshi 充值进 Alice 的钱包。</p><p><img src=/../images/a-crash-course-in-lightning-app-development/73404c726796429188d474aabe6e293f.png alt=7></p><p>如果一切按计划进行，你就会看到区块高度和 Alice 的钱包余额发生了变化。如果没有，请寻求帮助。这不是你的错。<sup>3</sup></p><p>现在，我们可以在 Alice 和 Bob 之间开启通道。现在，Alice 已经有钱了，我们可以让她开启一个与 Bob 的 “Outgoing（转出）” 通道。所谓的转出通道，就是 Alice 可以通过该通道转给 Bob 一定数量的比特币。Alice 和 Bob 之间可以进行多笔转账交易，只要通道内有余额即可。但是，请注意，该通道刚开启时，只有 Alice 可以向 Bob 转账，因为可用余额都在她那里。当然了，等到 Alice 向 Bob 转过账之后，Bob 就可以向 Alice 转账了。</p><p>这种通道内资金管理方式是为了保证双方都具备交易能力，这就是我们所说的闪电网络的 <em>流动性</em>。实际上，用户只能使用通道内的余额。更深入一点来讲，只有当付款方和收款方之间的通道内有足够的余额（且资金流向正确）时，付款才能成功。否则付款就会失败。如何管理闪电网络中有限的流动性以及如何找到变通之法本身就是一个值得探讨的<a target=_blank rel=noopener href=https://github.com/alexbosworth/run-lnd/blob/master/LIQUIDITY.md>话题</a>。</p><p>坦白来说，我在使用 Polar 开启通道时遇到过一些问题。我怀疑这是 UI 和后端之间的状态差异导致的，但是我并不确定。有时，关闭并重启节点（或整个网络）会有帮助。完全退出并重启 Polar 同样有效。另外，遇到这类情况时，出门晃悠 10 分钟可以让你的头脑和精神得到很好的放松。</p><p>不管是什么原因，我发现进行这些节点操作的最佳方式是通过 Polar 提供的 CLI。虽然 UI 不一定会显示出变化，但是我们可以直接查询数据库（可以这么说<sup>4</sup>）来确定 UI 是否如实反映变化。Polar 让这一切变得简单了。我们现在就上手做吧。</p><p>首选选中 Alice 的 Ind 节点，进入 “Actions” 界面，点击 “Terminal（终端）” 下面的 “Launch（启动）”，接着会出现一个命令提示符，如下图所示：</p><p><img src=/../images/a-crash-course-in-lightning-app-development/03c7dd9c893747adbcecf6350af27c02.png alt=8></p><p>现在，我们可以使用该 Ind 节点的 lncli 工具开启通道、创建发票和付款了。首先，运行下方命令来了解大致情况：</p><pre><code class=bash>lncli --help
</code></pre><p>我们可以运行下方命令在 Alice 和 Bob 之间开启一条余额为 10 万 satoshi 的通道：</p><pre><code class=bash>lncli openchannel --node_key &lt;bob&#39;s public node key&gt; --local_amt 100000
</code></pre><p>你会看到一个带有 “funding_txid” 的响应，对应的是 Alice 和 Bob 广播到我们的模拟比特币区块链上的充值交易。<br>运行下方命令查看我们新创建的通道：</p><pre><code class=bash>lncli listchannels
</code></pre><p>如果该命令返回的列表为空，请尝试使用（ “Actions” 界面下的）比特币节点挖几个区块。这样做应该有助于确认交易并开启通道。</p><p>现在，我们可以通过 listchannels 响应看到 Alice 和 Bob 之间已经成功开启通道，且通道余额约为 10 万 satoshi（减去交易费）。这 10 万不到的 satoshi 就是 Alice 可以通过闪电网络支付给 Bob 的可用余额。</p><h2 id=支付流程><a href=#支付流程 class=headerlink title=支付流程></a>支付流程</h2><p>迄今为止，闪电网络上最简单（我相信也是最常见的）支付流程是通过发票（invoice）。发票本质上是一组带有 “金额” 和 “收款方” 的支付指令。还有其它参数和变体可以帮助支付指令解锁更多有趣的可能性（例如，<a target=_blank rel=noopener href=https://wiki.ion.radar.tech/tech/research/hodl-invoice>hodl 发票</a>和 <a target=_blank rel=noopener href=http://bolt12.org/ >BOLT12</a> 提案），但是本文只关注最基本的模式。</p><p>继续设置我们的 Polar，我们先创建一个发票，但是这回要用 Bob 的节点。因此，我们要启动 Bob 的终端并运行以下命令：</p><pre><code class=bash>lncli addinvoice --amt 100
</code></pre><p>以上命令创建了一个价值 100 satoshi 的发票（实际上，我在执行这些步骤时遇到了连接错误。如果你也遇到同样的问题，请停止并重启 Bob 的节点）。我们可以通过返回的响应看到这个发票的信息：</p><pre><code class=json>&#123;
    &quot;r_hash&quot;: &quot;7d91cafaba85b6086924142dfd890f350eb53b17b80e2993d0a2ce5ccc7252f1&quot;,
    &quot;payment_request&quot;: &quot;lnbcrt1u1ps3lu04pp50kgu4746skmqs6fyzsklmzg0x58t2wchhq8zny7s5t89enrj2tcsdqqcqzpgsp55rtlzlf5rt0z5zg34nc2rlcm9mw6nd77x45r85z6zp07qumphr7q9qyyssqzrvxdlsluaeu7esscvv8skcmaly4794j7pg9ytapmn50uukezf4xpqma9758s39wpn4pwk475dztezg4tff8xpylksl4mww57q8hj7cq7s7222&quot;,
    &quot;add_index&quot;: &quot;1&quot;,
    &quot;payment_addr&quot;: &quot;a0d7f17d341ade2a0911acf0a1ff1b2edda9b7de356833d05a105fe07361b8fc&quot;
&#125;
</code></pre><p>现在，我们只关注 “payment_request” 部分，因为这部分数据包含 Alice 向 Bob 付款所需的一切信息，即，付款金额和收款方地址<sup>5</sup>。</p><p>如果我们切回 Alice 的节点终端，就可以得到付款请求并将它作为参数传递给下方命令：</p><pre><code class=bash>lncli sendpayment --pay_req &lt;payment_request&gt;
</code></pre><p>结果得到：</p><p><img src=/../images/a-crash-course-in-lightning-app-development/2eedaeafc05c4493aa8d8f4b3a05304b.png alt=9></p><p>成功。</p><h2 id=开始你的冒险征程><a href=#开始你的冒险征程 class=headerlink title=开始你的冒险征程></a>开始你的冒险征程</h2><p><img src=/../images/a-crash-course-in-lightning-app-development/b23a0ee2bc4d47f591252efaaf8d34bb.png alt=10></p><p>这时，你应该已经具备了足够的基础知识和工具，可以开始构建应用了。上图概述了一个简单的示例应用，使用的正是我们在 Polar 中用来创建并支付发票的 API 调用。这就是搭建一个最基础的应用架构所需的一切。当然了，这只是一个例子，我们在开发过程中还会遇到许多其它问题（目前还只是开始），但是你会慢慢弄清楚自己需要什么以及如何解决这些问题。</p><p>一些额外的建议和参考：</p><ul><li>有很多库可以帮助开发者少写些样板代码、直奔主题。就我本人而言，学习如何使用这些库带给我的更多是挫败感，而非更高的效率。问题主要出在我身上。抽象确实很棒，但前提是你要对被抽象的内容有基本了解。我在起步时还没有领悟到这一点。我觉得 Ind 的 <a target=_blank rel=noopener href=https://api.lightning.community/ >API 文档</a>学起来最容易。当我按照这个<a target=_blank rel=noopener href=https://github.com/lightningnetwork/lnd/blob/master/docs/grpc/javascript.md>指南</a>使用 Javascript 编写 gRPC 客户端时，我就已经步入正轨了。</li><li>如果你想看一个更具体的应用示例，不妨看看 Lightning Labs 构建者指南的<a target=_blank rel=noopener href=https://docs.lightning.engineering/lapps/guides/polar-lapps>教程</a>。如果你熟悉教程中用到的工具 express、mobx 和 React，那么我很推荐这个教程。如果你不熟悉这些工具，你可能不会从这篇教程中得到很大帮助，但还是能够学到一些东西。我喜欢这个教程的一个原因是，它展示了利用闪电网络（和密码学证明）构建应用可以实现的一些有趣功能。</li></ul><p>最后，如果你认为本文有任何写的不清楚或不准确之处，欢迎向我提出反馈或问题。</p><p>感谢阅读。</p><p>加油。</p><ol><li>如果你想运行节点，<a target=_blank rel=noopener href=https://getumbrel.com/ >Umbrel</a> 很适合初学者。我听说 <a target=_blank rel=noopener href=https://mynodebtc.com/ >MyNode</a>、<a target=_blank rel=noopener href=https://stadicus.github.io/RaspiBolt/ >RaspiBolt</a> 和 <a target=_blank rel=noopener href=https://raspiblitz.org/ >RaspiBlitz</a> 也不错。如果你喜欢修补软件系统（或 SimCity（模拟城市游戏）），那么运行节点往坏了说是一种有趣的消遣，往好了说是一场高成本且无休止的优化游戏（需要付出真金白银的那种）。</li><li>你还可以在测试网上进行实验，通过比特币<a target=_blank rel=noopener href=https://faucet.lightning.community/ >水龙头</a>获得一些实验用比特币。这些币一文不值，但是当个守财奴的体验会很有趣。如果你对自己配置和管理节点不感兴趣，可以使用 <a target=_blank rel=noopener href=https://app.voltage.cloud/ >Voltage</a> 之类的服务。<a target=_blank rel=noopener href=https://app.voltage.cloud/ >Voltage</a> 是即用即付的云上服务，支持测试网和主网节点。</li><li>好吧，我们不能百分之百确定。谨慎起见，请查看 <a target=_blank rel=noopener href=https://lightningcommunity.slack.com/ >lnd Slack</a> 的开发者频道。我在这里遇到过很多构建并维护这些工具的开发者。你可能会看到我！有人可能经历过你正在面临的问题。如果没有，那就太棒了 —— 大家都能从你的问题中有所收获。</li><li>区块链是一个公共数据库，每个人都有 root 权限。如需了解更多信息，请查看：<a target=_blank rel=noopener href=https://balajis.com/yes-you-may-need-a-blockchain/ >https://balajis.com/yes-you-may-need-a-blockchain/</a></li><li>关于发票中其它字段的详细解释，可以查看这篇<a target=_blank rel=noopener href=https://wiki.ion.radar.tech/tech/lightning/invoice>总结</a>。如需了解更多关于底层合约的信息，请阅读<a target=_blank rel=noopener href=https://medium.com/softblocks/lightning-network-in-depth-part-2-htlc-and-payment-routing-db46aea445a8>这篇文章</a>。</li></ol><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>