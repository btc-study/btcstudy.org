<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>Taproot、CoinJoin 和跨输入的签名</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Taproot、CoinJoin 和跨输入的签名</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>Taproot、CoinJoin 和跨输入的签名</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%AD%89%E9%9D%A2%E9%A2%9D%E8%BE%93%E5%87%BA%E7%9A%84-CoinJoin><span class=toc-text>等面额输出的 CoinJoin</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%9A%90%E7%A7%81%E6%80%A7><span class=toc-text>隐私性</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%A6%81%E6%AD%A2-CoinJoin><span class=toc-text>禁止 CoinJoin</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#Taproot><span class=toc-text>Taproot</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#Taproot-%E6%97%A0%E6%B3%95%E5%B8%AE%E5%8A%A9-CoinJoin><span class=toc-text>Taproot 无法帮助 CoinJoin</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BD%86%E6%9C%89%E4%BA%BA%E8%BF%99%E4%B9%88%E8%AF%B4%E4%BA%86%EF%BC%81><span class=toc-text>但有人这么说了！</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%8E%B0%E5%9C%A8%E4%B8%8D%E5%8A%A0%E4%B8%8A%E8%B7%A8%E8%BE%93%E5%85%A5%E7%9A%84%E7%AD%BE%E5%90%8D%E8%81%9A%E5%90%88%EF%BC%9F><span class=toc-text>为什么现在不加上跨输入的签名聚合？</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>Taproot、CoinJoin 和跨输入的签名</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt=almkglor><div class=page-author-info><strong>almkglor</strong><time class=has-text-grey datetime=2021-12-29T14:07:40.000Z>2021-12-29</time></div></div><div class=is-flex><a href=/tags/CoinJoin><i class="page-tag mr-1 px-1">CoinJoin</i></a><a href=/tags/Taproot><i class="page-tag mr-1 px-1">Taproot</i></a><a href=/tags/CISA><i class="page-tag mr-1 px-1">CISA</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：almkglor</em></p><p><em>来源：<a target=_blank rel=noopener href=https://www.reddit.com/r/Bitcoin/comments/ibcnsv/taproot_coinjoins_and_crossinput_signature/ >https://www.reddit.com/r/Bitcoin/comments/ibcnsv/taproot_coinjoins_and_crossinput_signature/</a></em></p><p><em>原文撰写于 2020 年 8 月 17 日；翻译之时，Taproot 升级已经激活。</em></p></blockquote><p>有一种常见的误解是，即将到来的 Taproot 升级可以帮助 CoinJoin 提高隐私性。</p><p>摘要：<strong>即将到来的 Taproot 升级完全无法帮助等面额输出的 CoinJoin 交易</strong>，虽然它有可能可以提高其它协议的的隐私性，比如闪电网络和托管合约。</p><p>如果你想了解详情，那就读下去！</p><h2 id=等面额输出的-CoinJoin><a href=#等面额输出的-CoinJoin class=headerlink title="等面额输出的 CoinJoin"></a>等面额输出的 CoinJoin</h2><p>我们先来讲讲等面额输出的 CoinJoin，这是 JoinMarket 和 Wasabi 钱包使用的 CoinJoin 类型。它的流程第一步是，一些参与者先集体同意一个公共值。在 JoinMarket 中，由 taker 来定义这个值，并给 maker 支付来取得他们的同意；而在 Wasabi 中，服务器会定义一个大致等于 0.1 BTC 的数值。</p><p>然后，每个参与者都提供自己单方面控制的输入，每个人提供的输入总面额都要等于或大于公共值。一般来说，因为每个输入都是单方面控制的，所以每个输入都需要一个单签名。每个参与者也都提供自己控制的两个地址，一个地址会得到面额为公共值的支付；另一个则用来接收其所提供的输入中大于公共值的部分（也即找零输出）。</p><p>再然后，这组参与者共同生成一笔交易，该交易花费所有参与者提供的输出，并支付给合适的输出。输入和输出都以一些安全的模式混淆一通。然后这笔伪签名的交易又发回给每个参与者。</p><p>最后，每个参与者检查这笔交易花费了自己提供的输入（更重要的是它 <em>没有</em> 花费自己 <em>不想</em> 提供的其它资金！）以及支付给了合适的地址。验证完了之后，每个人都为自己提供的输入补充签名。</p><p>每个人都为自己约定的所有输入提供签名之后，该交易就有了完整的签名，这笔 CoinJoin 就是有效的，可以打包上链了。</p><p>CoinJoin 原理上很简单但有直接的隐私提升效果，它不需要脚本编程，它只需要每个人都提供签名。</p><h2 id=隐私性><a href=#隐私性 class=headerlink title=隐私性></a>隐私性</h2><p>假设我们有两个参与者，同意加入一个公共值为 0.1 BTC 的 CoinJoin 交易。甲提供了一个面额为 0.105 的输入，乙提供了一个面额为 0.114 的输入。结果是，该 CoinJoin 交易有两个输入，面额分别为 0.105、0.114，而输出则是 0.1、0.005、0.014 以及 0.1 BTC.</p><p>现在，很显然这个 0.005 的输出是从 0.105 的输入中来的，而 0.014 的输出是从 0.114 的输入中来的。</p><p>但两个 0.1 BTC 的输出无法断言是从哪个输入中来的。没有能够关联起来的信息，因为两个输出都从两个输入中来。这就是常见的 CoinJoin 实现，比如 Wasabi 和 JoinMarket 如何提高隐私性的。</p><h2 id=禁止-CoinJoin><a href=#禁止-CoinJoin class=headerlink title="禁止 CoinJoin"></a>禁止 CoinJoin</h2><p>不走运的是，Wasabi 和 JoinMarket 的模式下，大规模的 CoinJoin 是非常显眼的。</p><p>你只要看到一笔交易有（比如）超过 3 个相等面额的输出，而输入的数量等于或大于等面额输出的数量，那它大概率就是 CoinJoin 交易。因此，很容易找出 Wasabi 和 JoinMarket 做的等面额输出 CoinJoin。甚至你可以很容易地区分它们：Wasabi 的等面额输出 CoinJoin 可能有多于 100 个输入，而输出的面额在 0.1 BTC 左右；JoinMarket 的等面额输出数量一般小于 10 个（通常在 4 ~ 6 个），但公共值变化很大，低至 0.001 BTC，高至几个比特币甚至更多。</p><p>这导致了一些反隐私的交易所拒绝为托管账户入账，如果存入的资金上溯一定步数会遇到等面额 CoinJoin 交易的话，通常是以监管上的考虑为理由。致命的是，这些交易所会继续持有那些 “被禁止” 的存款的私钥，所以也可以花费它们，本质上这与盗窃无异。如果你的交易所对你做了这样的事，你<strong>应该</strong>曝光该交易所从客户手上盗窃资金。此外，谨记，无私钥，即无币。</p><p>因此，CoinJoin 表现为隐私上的一种取舍：</p><ul><li>其他人很难确定哪个输出来源于哪个输入</li><li>对于其他人来说，某个输出是从一个混币操作中出来的，这无可隐瞒</li></ul><h2 id=Taproot><a href=#Taproot class=headerlink title=Taproot></a>Taproot</h2><p>现在我们来讨论一下叫做 “Taproot” 的新奇有趣事物。</p><p>Taproot 包含两个部分：</p><ul><li>使用了基于 Schnorr 的签名方案，支持多签名。使用 Schnorr 公钥来花费的方法被称为 “密钥路径”。</li><li>可以秘密地承诺一组脚本，在需要时暴露其中一个并提供正确的输入来花费资金。以隐藏的脚本来花费的方法被称为 “脚本路径”。</li></ul><p>它有一些很棒的属性：</p><ul><li>直接的多签名支持，意味着所有的签名看起来都一个样。在当前的比特币中，一个 2-2 的 “多签名” 实际上是一个脚本，它要求提供预先指定的两个不同公钥的签名。而对密码学家来说，严格意义上的多签名是 <strong>一个</strong> 由多方共同创建的签名。<ul><li>一般来说，最小的 “多签名” 设置就是 2-3 多签，这样即使你弄丢了一个签名设备，也还控制着你的资金；相比单签名，它还提供了额外的安全性，因为 2-3 的多签要求窃贼拿走至少两个签名设备。在当前的比特币中，一个 2-3 的多签是一个包含 3 个公钥的脚本，它要求提供这 3 个公钥中任意 2 个的签名。</li><li>但是一个闪电网络通道有两名参与者。因此，它使用了 2-2 的多签名，也即是一个包含 2 个公钥的脚本，需要提供这两个公钥的签名才能解锁。如果你在闪电网络开始流行之后的区块链上寻找 2-2 的花费，你随机看到的 2-2 花费行为有很大的概率是闪电网络通道关闭的交易，因为除此之外很少有什么地方是用到 2-2 多签名的。</li><li>因此，你可以很容易地区分最常见的囤币者的 2-3 多签名（包含 3 个公钥）和闪电网络通道（2-2 多签名，包含 2 个公钥）。</li><li>幸运的是，有了 Taproot，2-3 和 2-2 的多签名（以及任意的 k-n 多签名）都可以长得一模一样，因为 Schnorr 允许密码学家严格定义的 “多签名”：由多方共同生成的<strong>单个</strong>签名。</li></ul></li><li>复杂的脚本，比如哈希时间锁合约（HTLC），可以隐藏到一个 Taproot 输出里面。<ul><li>举个例子，一个输出可以有一条密钥花费路径，是所有参与者 n-n 共同花费的；还可以用隐藏的脚本来编码该输出可以被花费的其它条件</li><li>这些隐藏的脚本保证了这 n 个参与者会遵守协议。如果某个参与者背弃了协议，其余人可以揭示隐藏的脚本并根据这些条件把钱转走</li><li>如果每个人都合理遵守协议，并一致同意结果，他们可以一起使用 n-n 的签名（密钥路径）来花费资金。他们可以一致同意结果，并签名一条实现该结果的交易，而无需公开任何脚本。因为所有人都同意这个结果，应该没有人会抱怨（如果其中一个认为这个结果是不合理的，TA 可以拒绝签名，迫使其他人把脚本公开在链上并据此花费）。</li><li>只要每个人都同意，他们就可以得到隐私性：他们遵循的任何脚本都不会暴露在链上，而且花费行为跟其他人看起来没有区别。</li></ul></li></ul><h2 id=Taproot-无法帮助-CoinJoin><a href=#Taproot-无法帮助-CoinJoin class=headerlink title="Taproot 无法帮助 CoinJoin"></a>Taproot 无法帮助 CoinJoin</h2><p>来回顾一下！</p><p>CoinJoin：</p><ul><li>CoinJoin 的输入是单签名</li><li>CoinJoin 没有用到脚本</li></ul><p>Taproot：</p><ul><li>提升了多签名的隐私性</li><li>提升了脚本的隐私性</li></ul><p>完全没有交集。Taproot 帮助的是 CoinJoin <strong>不会用到</strong>的东西。CoinJoin 用到的是 Taproot <strong>无法提升</strong>的东西。</p><h2 id=但有人这么说了！><a href=#但有人这么说了！ class=headerlink title=但有人这么说了！></a>但有人这么说了！</h2><p>许多对 Taproot 的早期介绍都声称 Taproot 有益于 CoinJoin。</p><p>让他们搞混的地方在于，早期的 Taproot 草案包含一个叫做 “<strong>跨输入的签名聚合</strong>” 的功能。</p><p>在当前的比特币上，每一个输入，在花费时，都需要独立的签名。而有了跨输入的签名聚合，所有支持这个特性的输入可以用一个签名来覆盖。所以，举个例子，如果你想花费两个输入，当前的比特币协议需要你为每个输入提供一个签名，但有了跨输入的签名聚合，你可以用一个签名来解锁这两个输入。甚至即使输入是属于不同公钥的也可以：两个输入的跨输入签名聚合本质上是定义了一个 2-2 的公钥，而你只能在知道这两个输入的私钥时才能给它们签名；或者你能跟其他知道相应输入的私钥的人合作也可以。</p><p>它才能帮助 CoinJoin 节省成本。因为 CoinJoin 会有很多输入（每个参与者都会提供至少一个输入，有时会更多；而参与者集合越大，CoinJoin 的隐私性就越强），如果所有输入都启用了跨输入的签名聚合，这样大型的 CoinJoin 也可以只用一个签名。</p><p>它会让 CoinJoin 的签名流程变得更复杂（签名者现在要合作签名），但这也是值得的，它可以减少签名的体积，因此降低手续费。</p><p>但要注意，虽然跨输入的签名聚合提高了 CoinJoin 的经济性，它并不能提升隐私性！等面额输出的 CoinJoin 仍然是非常显眼的，仍然很容易被憎恨隐私性的交易所禁止。它不能提高 CoinJoin 的隐私性。另外，见：<a target=_blank rel=noopener href=https://old.reddit.com/r/Bitcoin/comments/gqb3ur/design_for_a_coinswap_implementation_for/ >https://old.reddit.com/r/Bitcoin/comments/gqb3ur/design_for_a_coinswap_implementation_for/</a></p><h2 id=为什么现在不加上跨输入的签名聚合？><a href=#为什么现在不加上跨输入的签名聚合？ class=headerlink title=为什么现在不加上跨输入的签名聚合？></a>为什么现在不加上跨输入的签名聚合？</h2><p>有一些非常复杂的技术理由导致跨输入的签名聚合不在最新的 Taproot 提议中。</p><p>首要的理由是降低 Taproot 的技术复杂性，希望这样能更容易说服用户激活 Taproot（虽然 Taproot 的呼声很高，但考虑到之前隔离见证（SegWit）遇到的困难，开发者对新的提议能否激活持谨慎态度）。</p><p>这里主要的技术复杂性在于，它会跟未来增强比特币的方法相互作用。</p><p>本文后面的部分假设你已经知道了比特币的脚本是怎么工作的。如果你并不深入了解比特币脚本的工作原理，那简而言之，跨输入的签名聚合会导致未来增强比特币的方法变得更加复杂，所以大家推迟了它，好让开发者有更多的时间思考。</p><p>（下文是我的理解；可能 <a target=_blank rel=noopener href=https://www.reddit.com/u/pwuille/ >&#x2F;u&#x2F;pwuille</a> 或 <a target=_blank rel=noopener href=https://www.reddit.com/u/ajtowns/ >&#x2F;u&#x2F;ajtowns</a> 可以给出更好的总结。）</p><p>详细说来，Taproot 也引入了 <code>OP_SUCCESS</code> 操作码。如果你知道当前的比特币协议已经定义的 <code>OP_NOP</code> 操作码，那么，你可以认为 <code>OP_SUCCESS</code> 就是 “传出通过的 <code>OP_NOP</code>”。</p><p>现在，<code>OP_NOP</code> 是一个什么也不干的操作。在未来版本的比特币中，它可以被替换成检查某些条件的操作，并在条件不满足时传出失败。举个例子，<code>OP_CHECKLOCKTIMEVERIFY</code> 和 <code>OP_CHECKSEQUENCEVERIFY</code> 之前都是 <code>OP_NOP</code> 操作码（译者注：两个都是脚本层面的时间锁）。更老的节点看到一个 <code>OP_CHECKLOCKTIMEVERIFY</code> 会认为这个操作码不会产生任何操作，但更新的节点会检查 <code>nLockTime</code> 字段是否有一个正确指定的数值，并在条件不满足时传出失败。因为网络中大部分的节点都在使用新得多的节点软件，更老的节点就受到了保护，不会被尝试盗用 <code>OP_CHECKLOCKTIMEVERIFY</code>&#x2F;<code>OP_CHECKSEQUENCEVERIFY</code> 输出的人蒙骗；而这些更老的节点也依然能够跟网络中的其他人保持同步：有赖于一个共识系统必需的严格向后兼容性。</p><p>软分叉基本上意味着：如果一个脚本在最新版本的软件中会处理通过，那在所有旧版本中也必须通过；不能在新版本可以通过、同时在旧版本中却会导致失败，因为这会使网络内产生分歧，会将旧节点踢出网络（即，那就变成一个硬分叉了）。</p><p>但 <code>OP_NOP</code> 是一种非常有限的添加新操作码的方法。替代 <code>OP_NOP</code> 的操作码只能做一件事：检查某些条件是否为真。它们无法为栈推入新数据，也无法让数据从栈中弹出。举个例子，假设我们想加入一个 <code>OP_GETBLOCKHEIGHT</code> 操作码而不是 <code>OP_CHECKLOCKTIMEVERIFY</code>。这个操作码将读取区块链的高度并将该数据推入栈中。如果这个命令提到了一个更老的 <code>OP_NOP</code> 操作码，那么一个像 <code>OP_GETBLOCKHEIGHT 650000 OP_EQUAL</code> 这样的脚本在未来的比特币版本中可能通过，但更老的版本在执行 <code>OP_NOP 650000 OP_EQUAL</code> 时却会失败，因为 <code>OP_EQUAL</code> 预期栈中会有两个元素（但 NOP 无法推入元素，于是栈中只有一个元素）。那么，旧的版本在执行时会失败，更新的版本却会成功，这就成了一个硬分叉，变成了后向不兼容的了。</p><p><code>OP_SUCCESS</code> 有所不同。首先，旧节点在解析脚本时，一旦看到 <code>OP_SUCCESS</code> ，就不会执行脚本主体，而会认为这个脚本已经通过了。所以， <code>OP_GETBLOCKHEIGHT 650000 OP_EQUAL</code> 这个脚本在此时就不会造成问题了：新版本的比特币会正常执行并通过，而无法理解 <code>OP_GETBLOCKHEIGHT 650000 OP_EQUAL</code> 的旧节点会看到 <code>OP_SUCCESS 650000 OP_EQUAL</code> ，然后完全不执行这个脚本、立即通过。这样一来，一个在新版本会通过的脚本，在旧版本中也会通过，保持了共识软分叉需要的后向兼容性。</p><p>那么， <code>OP_SUCCESS</code> 会给跨输入的签名聚合造成什么困难呢？嗯，要求验证签名的其中一种办法是通过操作码 <code>OP_CHECKSIGVERIFY</code>。有了跨输入的签名聚合之后，如果一个公钥表示自己可以用于跨输入的签名聚合，<code>OP_CHECKSIGVERIFY</code>就不会要求有一个签名在栈中，那么栈在签名位置会包含一个无意义的 0 值，然后这个公钥会被加到一个 “总和” 公钥中（也即，这个总和公钥是一个动态延伸的 n-n 公钥，每执行一次 <code>OP_CHECKSIGVERIFY</code> 就加入一个公钥），这个总和公钥以及那个签名会在最后由跨输入签名聚合验证算法来验证。</p><p>这里的重点是，想要把一个公钥加入总和公钥中参与最终签名的检查，就<strong>必须</strong>执行 <code>OP_CHECKSIGVERIFY</code> 。</p><p>但你记得吗， <code>OP_SUCCESS</code> 会阻止执行！在一个脚本解析完之后，只要有一个操作码是 <code>OP_SUCCESS</code> ，旧节点就会认为这个脚本可以通过，完全不执行这个脚本，因为 <code>OP_SUCCESS</code> 在更新的版本中可能有完全迥异的含义，而当前的版本不应对此有任何假设。如果一个脚本在 <code>OP_SUCCESS</code> <em>之外</em> 还有 <code>OP_CHECKSIGVERIFY</code>指令，这个指令在当前的版本中也<strong>不会</strong>执行，因此也无法把 <code>OP_CHECKSIGVERIFY</code> 所提供的公钥加到总和公钥中。更新的版本也必须接受这一点：如果他们解析出的 <code>OP_SUCCESS</code> 有一个新的含义，然后他们执行了该脚本中的一个 <code>OP_CHECKSIGVERIFY</code> ，他们也无法加总出一个跟旧节点相同的总和公钥，因为旧节点根本看不见这些公钥。这就意味着，如果未来有某些操作码替换了一些 <code>OP_SUCCESS</code> 操作码，你可能需要多于一个签名。</p><p>因此，因为实现跨输入的签名聚合并保证其与未来协议插件相兼容的复杂性，跨输入的签名聚合被推迟了。</p><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>