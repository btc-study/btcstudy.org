<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>解释 ItchySats 的 CFD 协议</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">解释 ItchySats 的 CFD 协议</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>解释 ItchySats 的 CFD 协议</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BC%80%E5%90%AF%E4%B8%80%E4%B8%AA-CFD><span class=toc-text>开启一个 CFD</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BB%BA%E7%AB%8B%E5%90%88%E7%BA%A6><span class=toc-text>建立合约</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%94%81%E5%AE%9A%E4%BA%A4%E6%98%93><span class=toc-text>锁定交易</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#DLC-%E8%BE%93%E5%87%BA><span class=toc-text>DLC 输出</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%80%80%E6%AC%BE%E4%BA%A4%E6%98%93><span class=toc-text>退款交易</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%B0%B8%E7%BB%AD-CFD><span class=toc-text>永续 CFD</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%BB%B6%E6%9C%9F><span class=toc-text>延期</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%89%BF%E8%AF%BA%E4%BA%A4%E6%98%93><span class=toc-text>承诺交易</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%83%A9%E7%BD%9A%E4%BA%A4%E6%98%93><span class=toc-text>惩罚交易</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9C%A8%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E5%90%88%E4%BD%9C><span class=toc-text>在区块链上合作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%B1%95%E6%9C%9B%E6%9C%AA%E6%9D%A5><span class=toc-text>展望未来</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%84%9A%E6%B3%A8><span class=toc-text>脚注</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>解释 ItchySats 的 CFD 协议</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt=lucas><div class=page-author-info><strong>lucas</strong><time class=has-text-grey datetime=2022-12-04T05:18:27.000Z>2022-12-04</time></div></div><div class=is-flex><a href=/tags/Discreet-Log-Contract><i class="page-tag mr-1 px-1">Discreet Log Contract</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：lucas</em></p><p><em>来源：<a target=_blank rel=noopener href=https://comit.network/blog/2022/01/11/cfd-protocol-explained/ >https://comit.network/blog/2022/01/11/cfd-protocol-explained/</a></em></p></blockquote><p><img src=/images/cfd-protocol-explained/unboxed.png alt=img></p><p>在 2021 年末，我们跟各位分享了创建<a target=_blank rel=noopener href=https://itchysats.medium.com/itchysats-roadmap-to-the-most-awesome-bitcoin-dex-464a42bf4881>最出众的比特币去中心化交易所</a>的计划。在那篇文章中，我们罗列了如何在那一年剩余的时间里将<a target=_blank rel=noopener href=https://comit.network/blog/2022/01/11/github.com/itchysats/itchysats>我们的解决方案</a>提升到更高层次。我们也承诺会给出我们的比特币 CFD（差价合约）的详细解释。这就是我们今天这篇文章的目的。</p><h2 id=开启一个-CFD><a href=#开启一个-CFD class=headerlink title="开启一个 CFD"></a>开启一个 CFD</h2><p>如果你用过 <code>itchysats</code>，你可能看过这个 画面。在这个界面你可以吃掉挂单者创建的订单。</p><p><img src=/../images/cfd-protocol-explained/eenshot.png alt=img></p><p style=text-align:center>- 吃掉一个订单 -</p><p>你点击界面中的按钮，界面就会告诉你，一个新的差价合约建好了。几秒之后，这个 CFD 会转变成新的 <code>Open（开启）</code> 状态，然后你可以看到一笔交易广播出去了。看起来一切都好，但你可能对发生了什么一无所知。</p><h2 id=建立合约><a href=#建立合约 class=headerlink title=建立合约></a>建立合约</h2><p>点击按钮会给挂单者发送一条消息，告诉他们你希望用一定的杠杆率和数量接受他们的 CFD。如果他们同意了这个请求，应用就会开启 <code>contract_setup</code> （“合约建立”）进程：利用多条消息，交换开启 CFD 所需的双方公钥、地址和签名。</p><p>为了文章的简明，在此我们就不细述这些消息了；如果你想了解更多细节的话，欢迎你阅读代码。我们的 CFD 代码放在一个专门的仓储中：<a target=_blank rel=noopener href=https://comit.network/blog/2022/01/11/github.com/comit-network/maia>maia</a> 。</p><p>相反，我们会集中在这几轮通信的结果中：我们的差价合约实现的组成模块。</p><p><img src=/../images/cfd-protocol-explained/hot_cfd.jpg alt=img></p><p style=text-align:center>- 有限生命的差价合约 -</p><h3 id=锁定交易><a href=#锁定交易 class=headerlink title=锁定交易></a>锁定交易</h3><p>参与一个差价合约的双方需要在区块链上锁定一些资金，这样协议才能强制执行打赌的结果 <sup><a href=#note1 id=jump-1>1</a></sup>。</p><p><code>lock_transaction</code> （“锁定交易”）会从各方处获得一个或多个输入。它会产生一个由挂单者和吃单者的资金合并而成的共享输出。下文我们会把这个共享输出称为 <code>dlc_output</code> 。具体含义我们到下一章再说。锁定交易也可能会包括给各方的一个或多个找零输出。</p><p>在 <code>contract_setup</code> 结束的时候，双方都可以获得这个安全签名的交易的副本。也就是说，挂单者也签名了自己贡献的所有输入，吃单者也是如此。因此，在跑完 <code>contract_setup</code> 流程时，任何一方都可以通过广播锁定交易，从而开启 CDF。不论是谁来广播，或者都广播，都没有关系：被广播的交易是同一笔。</p><p>在锁定交易被广播之前，任何一方都有机会退出正在建立的 CDF。如果他们用在锁定交易中的某个输入被用于零一笔交易，这笔锁定交易自然就无法挖出了（因为会被当成重复花费）。</p><h3 id=DLC-输出><a href=#DLC-输出 class=headerlink title="DLC 输出"></a>DLC 输出</h3><p>如上所述，锁定交易的输入跟我们的协议有关的输出是 <code>dlc_output</code>（“DLC 输出”）。而 DLC（<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/discreet-log-contracts/ >谨慎日志合约</a>）是一种取决于一个受信任的第三方（通常称为 “断言机”）所播报的事件结果产生资金分配结果的输出。依靠它的机制，我们可以让交易的花费条件依赖于区块链外部的事件。在我们这个差价合约的案例中，就是 BTC 的价格运动；我们以 BTC 的价格运动来结算差价合约。</p><p>DLC 输出是一个简单的 <code>2-of-2</code> 多签名输出，一个公钥 <code>A</code> 来自挂单者，另一个公钥 <code>B</code> 来自于吃单者。也就是说，需要挂单者和吃单者各提供一个签名，才能花费这个输出。</p><p>让 DLC 得以工作的东西是预先计算好的、以不同方式花费 DLC 输出的交易。这样的基于事件的结果来花费 DLC 输出的交易称为 “合约执行交易（CET）”。而断言机可以为某一笔 CET 赋能的办法则来源于 “适配器签名”<sup><a href=#note2 id=jump-2>2</a></sup>。我们会用一个简单的例子来展示它是如何工作的。</p><p><strong>CET 案例解释</strong></p><p>在我们这个例子中，挂单者和吃单者建立了一个非常简单的差价合约：如果在合约到期时， BTC 的美元汇率超过 40000，吃单者就赢走所有资金；而另一方面，如果 BTC 的美元汇率低于 40000，则挂单者赢走所有资金。因为只有两种可能的结果，所以我们只需要创建两笔 CET：一笔将 DLC 输出中的所有资金交给吃单者；另一笔把所有资金交给挂单者。</p><p>为了防止 CET 在锁定交易被广播之后立即被广播，双方都只向对方分享自己对每一笔交易的 <em>适配器签名</em>。这样的适配器签名只有在断言机播报（“<em>见证</em>”）价格之后才能被解密 和转化为常规的签名。</p><p>具体到我们这个案例中，在双方开始合约建立流程之前，断言机就已经 <em>宣布</em> 自己将会见证 24 小时之后的 BTC 美元汇率。断言机的身份以公钥 <code>O</code> 来表示，TA 将使用 <code>O</code> 背后的私钥以及一套已知的见证方案<sup><a href=#note3 id=jump-3>3</a></sup>，播报这个汇率。 断言机的 <code>announcemnt</code>（“宣言”）中包含了一个公钥 <code>K</code>，这个公钥代表断言机的承诺 —— TA 会在这个事件的 <code>attestation</code> （“见证消息”）中使用 <code>K</code> 背后的随机数 <code>k</code> 。这个一次性使用的随机数（nonce）（<code>k</code>）让断言机可以无限次见证不同的事件，而无需变换其用于发布见证消息的私钥 <code>o</code> <sup><a href=#note4 id=jump-4>4</a></sup>。</p><p>有了宣言中的 nonce 公钥 <code>K</code>、断言机的见证公钥 <code>O</code> 以及对价格区间的一个标识符（可用于解锁具体的 CET），参与这个差价合约的两方就可以构造出适配点（adaptor point），适配点则可用于产生相应的适配器签名（如上所述，他们仅向对方分享自己公钥的适配器签名）。举个例子，吃单者使用 <code>K</code>、 <code>O</code> 以及一个代表 <code>0-40k USD</code>（0 ~ 40000 美元）的标识符，就可以产生一个适配器点 <code>Y_short</code>。然后，TA 就可以用 <code>Y_short</code> 来加密自己的公钥 <code>B</code> 对那一笔把所有资金都分配给挂单者的 CET 的签名。在合约建立流程期间，吃单者把自己的适配器签名分享给挂单者。如果断言机见证了 BTC 的美元汇率低于或等于 40000，挂单者就可以解密这个签名并发布对应的 CET。</p><p>在实际操作中，我们整合 <sup><a href=#note5 id=jump-5>5</a></sup> 的断言机 <code>olivia</code> 不会见证代表一个价格区间的标识符，也不会见证一个具体的价格。相反，它会见证价格的二进制表示数值，一个接一个。这使得我们可以大量减少 CET 的数量，因此双方需要构造的适配器签名数量也大量减少。上面这个案例是一个简化版本，因为现实世界中 CFD 的可能结果通常会形成一条平滑的曲线。如果我们使用具体的价格，那么 CET 的数量会非常多，导致协议的存储效率和时间效率非常低下。</p><p>将支付曲线离散成区间，并使用播报 BTC 价格的二进制表示的断言机，意味着我们可以实现相对清楚的支付曲线，而无需将合约建立的流程拖得很长并占用惊人的存储空间。我们可能还会撰文讲解实现这些节约的规范，但还是鼓励你看看代码。如果你想了解更多，欢迎<a target=_blank rel=noopener href="https://matrix.to/#/!OSErkwZgvuIhcizfaI:matrix.org?via=matrix.org">向我们提问</a>。</p><h3 id=退款交易><a href=#退款交易 class=headerlink title=退款交易></a>退款交易</h3><p>在上一节中，我们暗示了这个协议需要对第三方（断言机）的信任。即使你将这种信任分散到多个断言机，你也还是得准备应对在价格见证消息应该发布时太多断言机挂掉的情形。</p><p>如果只有 CET 能花费 DLC 输出，那么当 <code>olivia</code> 忘了发布对应于宣言的见证消息时，使用我们这套协议的资金就可能无法花费。</p><p>为了应对这种不太可能发生的情形，双方需要在合约建立流程中合作构造和签名一笔 <code>refund_transaction</code>（“退款交易”）。这笔交易会花费 DLC 输出，将挂单者和吃单者的资金按原比例返还。退款交易的输入会使用一个相对时间锁，从而保证这笔交易只能在锁定交易得到区块确认的一段时间之后才能挖出。这个相对时间锁的数值会设置得双方都有足够长的时间来发布 CET（即只要 <code>olivia</code> 发布了有效的见证消息，对应的 CET 就可以上链）。</p><h2 id=永续-CFD><a href=#永续-CFD class=headerlink title="永续 CFD"></a>永续 CFD</h2><p>前面一个章节是对我们的 CFD 协议的第一个版本的准确描述。但是，在实现它的过程中，我们意识到我们还有一个尚未满足的要求：根据定义，CFD 必须没有到期日。</p><p>现在，我们还不能容易地选取来自传统金融世界的工具（例如差价合约）并在区块链上准确地重新制作出来。我们很可能总是需要预先定义出一个时间点，好让某一方能单方面结算 CFD（在见证消息发布后把 CET 发布上链）。要是没有这个终止点，不合作的对手方就可以无限期冻结你的资金。</p><p>但是，我们依然可以允许在双方一致同意时刷新合约的生命周期，从而越过此前约定的到期时间、模拟出传统差价合约的永续特性。</p><p><img src=/../images/cfd-protocol-explained/ual_cfd.jpg alt=img></p><p style=text-align:center>- 永续的差价合约 -</p><h3 id=延期><a href=#延期 class=headerlink title=延期></a>延期</h3><p>给一个 CFD “延期（Rollover）”，就意味着我们将添加一组全新的 CET，它们将依赖于更遥远的未来被见证的事件结果。构造新 CET 的过程跟前面讲述的没有什么差别。然而，想要直接花费锁定交易，可就不行了。最初在合约建立流程中创建的那一组 CET 依然是完全有效的，所以，虽然理论上双方可以在相应的见证消息出现后也不发布 “旧” 的 CET，但这需要相互信任（即背叛的一方不会得到惩罚）。</p><p>幸运的是，这类问题在之前就已经有解决方案了，最著名的一个例子就是 “<a target=_blank rel=noopener href=https://github.com/lightning/bolts/blob/93909f67f6a48ee3f155a6224c182e612dd5f187/05-onchain.md#revoked-transaction-close-handling>闪电网络的撤销机制</a>”。在开发出 “<a target=_blank rel=noopener href=https://eprint.iacr.org/2020/476.pdf>广义的比特币兼容通道</a>” 的<a target=_blank rel=noopener href=https://github.com/comit-network/thor/ >一个实现</a>之后，我们确定了我们要在自己的 CFD 协议中使用相同的结构。</p><h3 id=承诺交易><a href=#承诺交易 class=headerlink title=承诺交易></a>承诺交易</h3><p>现在，锁定交易的输出要改称为 <code>lock_output</code>（“锁输出”） 。这个输出存在的目的只是为了让 CFD 的创建更加清晰。在锁定交易发布之后，双方将不再能退出合约；其输出也不再被 CET 直接花费。相反，我们要引入一笔 <code>commitment_transaction</code> （“承诺交易”），由这笔交易将锁输出转化为 DLC 输出。</p><p>而 DLC 输出，在现在协议中虽然变成了另一笔交易的输出，但其花费方式与前面的协议没有区别：一组 CET 定义了 DLC 输出如何根据 BTC 的美元汇率来分割。承诺交易的目的是为了保证 DLC 输出只能被一起构造的 CET 花费。</p><p>重要的是，退款交易的作用跟原来一样：它会花费 DLC 输出（现在是承诺交易的输出）。我们这里着重讲解 CET，但前一个章节对退款交易的描述放到这里依然成立。</p><p>举个例子，我们可以设想挂单者和吃单者一致同意延期一个 CFD，因为他们都相信日后的 BTC 价格波动会有利于自己。在合约建立流程中，他们创建并签名 <code>commitment_transaction_0</code> 以及相应的一组 CET。而在 <code>Rollover</code> （“延期”）流程中，他们要制作新的一笔 <code>commitment_transaction_1</code> 交易，以及全新的一组基于 <code>olivia</code> 的新宣言的 CET。因为他们都可以发布完全签名的承诺交易，所以他们最终可以发布 <code>commitment_transaction_1</code> 并根据来自 <code>olivia</code> 的新见证消息来结算 CFD。</p><h3 id=惩罚交易><a href=#惩罚交易 class=headerlink title=惩罚交易></a>惩罚交易</h3><p>那么，要是某一方决定发布旧的一笔承诺交易、使用断言机所见证的旧的 BTC 价格来结算 CFD，该怎么办呢？这就完全违背了 CFD 延期的意义。这就是我们需要撤销机制的地方。</p><p>承诺交易的 DLC 输出有不止一种花费方式。它总共有 3 种花费方式：</p><pre><code>1. 被 CET 花费（而双方手中的 CET 都只有对方的适配器签名，需要来自  `olivia` 的见证消息才能补成常规签名）
2. 被一笔 “退款” 交易花费，这是应对没有 CET 被  `olivia` 解锁的安全机制
3. 被各方的一笔  `punishment_transaction`（“惩罚交易”） 花费，当某一方发布一笔已被撤销的承诺交易时，另一方可单方面构造惩罚交易、取走 DLC 输出中的所有资金
</code></pre><p>在合约建立以及后续每一次延期流程中，双方都要一起为 DLC 输出添加另一个花费条件。他们各生成一对（用于撤销的）密钥 <code>(r, R)</code>，以及一对（用于发布的）密钥 <code>(p, P)</code> ，并将公钥分享给对方。DLC 输出不再是一个使用公钥 <code>A</code> 和 <code>B</code> 的简单 2-of-2 多签名输出。它的脚本还包括：</p><pre><code>1. 挂单者知晓私钥 `a`、 `吃单者的 r` 和 `吃单者的 p` 就可以花费
2. 吃单者知晓私钥 `b`、 `挂单者的 r` 和 `挂单者的 p` 就可以花费
</code></pre><p>双方不是交换对承诺交易的常规签名，而且创建一个适配器签名并交给对方。举个例子，吃单者使用挂单者的 P 加密自己的公钥 <code>B</code> 对承诺交易的签名（从而生成一个适配器签名）。稍后，挂单者可以使用自己的 p 解密吃单者的适配器签名；但是，一旦他们使用这个解密后的签名发布了承诺交易，自己的 p 就泄露给了吃单者。</p><p>此外，每次完成延期流程时，双方都必须交换自己在 上一笔承诺交易中使用的撤销私钥（ <code>r</code> ）。如果一方不愿意分享这个私钥，另一方应该立即广播新的承诺交易。不然，对手就可以选择在任意时间发布某一笔承诺交易；这会给予他们选择更有利的结算结果的选择权。</p><p>安排好所有这些之后，挂单者和吃单者就知道他们可以应对对手尝试花费已被撤销的（并非最新的延期操作或合约建立操作所创建的）承诺交易的情形。只要对手敢于这样做，他们就能知晓对手的私钥 p，加上在延期过程中知晓的对手的 r，就可以签名一笔交易，将 DLC 输出中的所有资金收入囊中。</p><p>显然，这种机制要求双方几乎全时段在线（并且需要存储对手提供的每一个 r）。他们必须时刻关注对手有没有发布已经被撤销的承诺交易。 每个 CET 都有一个相对时间锁，所以被欺诈的一方有充足的时间可以发布惩罚交易。</p><h3 id=在区块链上合作><a href=#在区块链上合作 class=headerlink title=在区块链上合作></a>在区块链上合作</h3><p>如你们所见，这套 CFD 协议是非常有用的。这套系统让我们可以模拟传统 CFD 的机制，并且保护所有相关方的资金，而且是在区块链这样你无需信任任何人的环境中。</p><p>但我们也必须指出另一重局限性：我们无法随时清空仓位；这是我们希望克服的另一点。在传统金融中，你可以随时关闭差价合约，拿走你的盈利或承担你的损失。而在我们的比特币 CFD 中，我们只能等待断言机发布对应于合约建立或延期中的宣言的 BTC 价格的见证消息。</p><p><img src=/../images/cfd-protocol-explained/ent_cfd.jpg alt=img></p><p style=text-align:center>- 合作式结算的 CFD -</p><p>看起来是没有办法让任何一方都能随时单方面关闭 CFD 了，但是我们引入了另一种机制，在双方 <em>一致</em> 同意之时，可以早于见证消息发布的时间关闭仓位。我们管这种机制叫 <code>collaborative_settlement</code>（“合作式关闭”）。如果挂单者和吃单者一致同意以某一种结果结算 CFD，他们可以一起创建和签名一笔交易，直接花费锁输出。这意味着双方都要在线，并一致同意提前平仓 CFD。但是，如果条件不能满足，双方都知道他们依然可以依赖于常规的结算操作（CET），这是由密码学保证的。</p><h2 id=展望未来><a href=#展望未来 class=headerlink title=展望未来></a>展望未来</h2><p>虽然我们对这套比特币 CFD 协议的成果好自豪，我们也知道，还有很多工作要做。我们的<a target=_blank rel=noopener href=https://itchysats.medium.com/itchysats-roadmap-to-the-most-awesome-bitcoin-dex-464a42bf4881>路线图博文</a>介绍了一些我们需要追踪的东西，但我们也在考虑别的一些优化和特性。</p><p>除了我们已经有想法的部分，我们也认为，实现不依赖于单个断言机的 CFD 非常重要。如前所述，基于 DLC 的协议需要信任断言机。但如果我们可以把这部分责任分散给多台断言机，它们勾结和故障的可能性都会大幅降低。更具体地说，有了多个断言机，通过 CET 来结算的 CFD 就不再依赖于单个断言机。相反，我们将使用多个断言机的见证消息来决定哪个 CET 可以执行。举个例子，我们可以实现一种 4-of-7 的机制，7 个断言机中的简单多数才能决定解锁哪一笔 CET。</p><p>这个领域还有许多我们密切关注的正<a target=_blank rel=noopener href=https://github.com/discreetlogcontracts/dlcspecs/blob/master/MultiOracle.md>在进行的研究</a>。你可以在开源的代码库中跟进我们这个<a target=_blank rel=noopener href=https://comit.network/blog/2022/01/11/github.com/comit-network/maia>协议</a>和 <code>itchysats</code> 的进展。如有问题，欢迎加入我们的公开频道：<a target=_blank rel=noopener href=https://t.me/joinchat/ULycH50PLV1jOTI0>Telegram</a> 和 <a target=_blank rel=noopener href="https://matrix.to/#/!OSErkwZgvuIhcizfaI:matrix.org?via=matrix.org">Matrix</a>。</p><h2 id=脚注><a href=#脚注 class=headerlink title=脚注></a>脚注</h2><p>1.<a id=note1> </a>就其核心，差价合约就是对资产未来价格的打赌。 <a href=#jump-1>↩</a></p><p>2.<a id=note2> </a>我们所用的、由适配器签名赋能的 DLC 输出基于 *<a target=_blank rel=noopener href=https://github.com/discreetlogcontracts/dlcspecs>dlcspecs</a>*，这个项目正在为谨慎日志合约开发一套规范。它跟 <a target=_blank rel=noopener href=https://adiabat.github.io/dlc.pdf>Dryja 最初的工作</a> <em>不同</em>。 <a href=#jump-2>↩</a></p><p>3.<a id=note3> </a>这样的见证方案通常是签名方案，比如 Schnorr 签名。实际上我们使用一种更简单的、由我们整合的独立断言机的方案。想了解更多信息，请在我们的 CFD 协议代码库中查找 <code>olivia</code> 以及<a target=_blank rel=noopener href=https://github.com/comit-network/maia/blob/55ba9f2e4f0ff40b0b2e89458fbbbe2dadceb913/src/oracle.rs>这个模块</a>。 <a href=#jump-3>↩</a></p><p>4.<a id=note4> </a>如果不使用 nonce（一次性随机数），或者更常见的，多次使用同一个 nonce，会导致这个断言机的见证私钥在见证结果后泄露。（译者注：即使用同一个 nonce、同一个私钥对不同消息签名会导致私钥泄露。） <a href=#jump-4>↩</a></p><p>5.<a id=note5> </a>重点是保证断言机不属于参与 CFD（广义来说是 DLC）的任何一方。否则他们就有可能为了自己的利益而干预结果。 <a href=#jump-5>↩</a></p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>