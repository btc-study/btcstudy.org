<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>什么是 “锚点输出”？</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">什么是 “锚点输出”？</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>什么是 “锚点输出”？</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%85%B3%E9%97%AD%E9%97%AA%E7%94%B5%E9%80%9A%E9%81%93><span class=toc-text>关闭闪电通道</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8%E5%B0%8F%E9%A2%9D%E7%9A%84%E6%89%8B%E7%BB%AD%E8%B4%B9%EF%BC%8C%E7%AD%89%E5%88%B0%E4%BA%A4%E6%98%93%E5%B9%BF%E6%92%AD%E6%97%B6%E5%86%8D%E8%BF%BD%E5%8A%A0%E5%91%A2%EF%BC%9F><span class=toc-text>为什么我们不能使用小额的手续费，等到交易广播时再追加呢？</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BF%9D%E6%8A%A4%E7%BD%91%E7%BB%9C%E4%B8%8D%E5%8F%97-DoS-%E6%94%BB%E5%87%BB><span class=toc-text>保护网络不受 DoS 攻击</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BA%A4%E6%98%93%E9%92%89%E6%AD%BB><span class=toc-text>交易钉死</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#Carve-Out-%E4%B8%8E%E9%94%9A%E7%82%B9%E8%BE%93%E5%87%BA><span class=toc-text>Carve Out 与锚点输出</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BB%BC%E5%90%88><span class=toc-text>综合</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%83%E4%BC%9A%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E7%BB%88%E7%AB%AF%E7%94%A8%E6%88%B7%EF%BC%9F><span class=toc-text>它会如何影响终端用户？</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%80%E4%BA%9B%E8%B5%84%E6%96%99><span class=toc-text>一些资料</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%84%9A%E6%B3%A8><span class=toc-text>脚注</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>什么是 “锚点输出”？</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Fanis Michalakis"><div class=page-author-info><strong>Fanis Michalakis</strong><time class=has-text-grey datetime=2022-08-08T09:43:01.000Z>2022-08-08</time></div></div><div class=is-flex><a href=/tags/%E4%BA%A4%E6%98%93%E6%B1%A0><i class="page-tag mr-1 px-1">交易池</i></a><a href=/tags/%E9%80%9A%E9%81%93%E6%9E%84%E9%80%A0><i class="page-tag mr-1 px-1">通道构造</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Fanis Michalakis</em></p><p><em>来源：<a target=_blank rel=noopener href=https://fanismichalakis.fr/posts/anchor-outputs/ >https://fanismichalakis.fr/posts/anchor-outputs/</a></em></p></blockquote><p>本博客的前面两篇 “长文” 致力于搜寻特殊类型的闪电通道，它们 <a target=_blank rel=noopener href=https://fanismichalakis.fr/posts/turbo-channels/ >各</a> <a target=_blank rel=noopener href=https://fanismichalakis.fr/posts/what-are-hosted-channels/ >自</a> 以自身的优势强化了闪电网络的用户体验。这一次，我们要研究 “锚点输出（anchor output）”，其目标是保证通道能快速关闭（即使单方面关闭也不例外）。本文将详细介绍闪电通道是如何关闭的、有什么样的问题、锚点输出如何能解决这些问题。最后，我们将看看这个新机制的推出会如何影响用户。</p><h2 id=关闭闪电通道><a href=#关闭闪电通道 class=headerlink title=关闭闪电通道></a>关闭闪电通道</h2><p>在闪电网络中，一个通道的状态（例如，通道两端的余额分布）是以 “<a target=_blank rel=noopener href="https://www.youtube.com/watch?v=aPqI34tpypM">承诺交易</a>” 的形式保存的。这些比特币交易已经由通道的两位参与者签过名，但不会发到比特币区块链上，除非某个参与者准备关闭通道。如果通道的状态改变了（资金从通道的一端移动到了另一端），前一笔承诺交易就会被 “撤销”，双方会制作和签名新的一笔承诺交易（依然不会广播），来记录新的资金分布情形。</p><p>在双方合作关闭通道的情形（也叫 “双向关闭”）中，双方一起构造一笔关闭通道的交易，将通道中的资金根据最新状态<strong>分别</strong>发给两方的账户。而在关闭交易的构造期间，双方可以讨论他们希望为这笔链上交易支付的手续费。交易构建完成，双方就签名，然后将交易广播到比特币网络中。这比单纯广播最后一笔承诺交易要好，因为双方可以根据交易池的拥堵情形调整手续费。</p><p>但在强制关闭的情形中，也就是双方无法就通道关闭交易达成一致的情形中，希望关闭通道的一方要把自己所知的最后一笔承诺交易公布出来 <sup><a href=#note1 id=jump-1>1</a></sup>。这笔承诺交易是在双方最后一次在通道内移动资金的时候合作构造的。在构造的时候，双方也要决定这笔交易的手续费 —— 有点奇怪对不对？他们俩根本就不知道这笔交易会不会真正被发到链上，也不知道这笔交易什么时候会发到链上。</p><p>因为在交易构造好之后，手续费就没法改变了；而重新构造交易又需要双方的签名；所以，你必须确保交易支付了足够多的手续费、能够在广播之后的合理时间内得到区块确认 <sup><a href=#note2 id=jump-2>2</a></sup>。这是不可能的，因为你根本不知道这笔交易什么时候会广播。即使你知道它什么时候会广播，你可能也不知道那时候比特币网络的交易手续费（除非那个时刻就近在眼前）。为了避免这种情形，闪电网络实现通常会给承诺交易安排数倍于交易构建时网络手续费水平的手续费。</p><h2 id=为什么我们不能使用小额的手续费，等到交易广播时再追加呢？><a href=#为什么我们不能使用小额的手续费，等到交易广播时再追加呢？ class=headerlink title=为什么我们不能使用小额的手续费，等到交易广播时再追加呢？></a>为什么我们不能使用小额的手续费，等到交易广播时再追加呢？</h2><p>交易签名之后，其手续费就无法改变了（因为改变手续费会改变整笔交易，让签名作废）。而且，一旦公布，整个网络都会知晓这笔交易。不过，依然有一些办法可以提高（或者说追加）一笔交易的手续费：</p><ul><li>构建、签名和公布一笔新的交易，花费跟原交易相同的输入，但支付更高的手续费。这个叫做 “手续费替换（RBF）”。</li><li>使用 <em>子交易</em> 花费尚未确认的交易的其中一个输出，并在子交易中附加较高的手续费。这叫做 “子为父偿”，它能激励矿工打包这笔未确认的交易，因为这样他们才能打包这笔高手续费的子交易。</li></ul><p>所以，我们不能用 RBF 或 CPFP 来提高交易的手续费吗？这将允许闪电节点为承诺交易附加尽可能少的手续费，等需要的时候再为之追加手续费。</p><p>我们当然可以这样做，就是有一点麻烦。</p><h2 id=保护网络不受-DoS-攻击><a href=#保护网络不受-DoS-攻击 class=headerlink title="保护网络不受 DoS 攻击"></a>保护网络不受 DoS 攻击</h2><p>RBF 和 CPFP 在比特币中实现时，还附带了一些保护措施，用于防止恶意人士利用这些新功能来执行拒绝服务式攻击（DoS）。这种攻击的内核就是要求执行会耗尽资源（CPU、内存，等等）的操作，让组成网络的计算机慢下来甚至完全停机。</p><p>就 RBF 而言，替换交易必须遵循的一条规则是 “所支付的手续费绝对值不低于原交易的手续费”<sup><a href=#note3 id=jump-3>3</a></sup>。这条规则有两个目的。其一，它要激励矿工打包替换交易（而不是原交易）。其二，它要防止有人在网络中滥发低手续费的替换交易。如果替换交易不必支付更高的手续费，攻击者就可以在网络中大肆广播替换交易、使之在节点网络中转发（也即主动消耗节点带宽），从而零成本地攻击网络（因为这些交易不可能上链）。</p><p>至于 CPFP，风险是攻击者利用交易池的工作模式、耗尽一个节点的计算资源。出于效率理由，交易池中的每一笔交易都会指明其依然存在于交易池中的所有的祖先（父代交易、祖代交易，等等）以及后代（子代交易、孙代交易，等等）。这主要是为了帮助矿工挑选整体上支付更高手续费的交易，并拒绝手续费更低的交易。这种设计的一个缺点在于，它会让交易池移除一笔交易的操作变得更加耗费资源，尤其是被移除的交易有许多后代的时候。因此，为防止 DoS 攻击利用这一点，CPFP 有一个限制：交易池中给定的一笔交易不能拥有超过 25 个后代（包括自身在内），而且所有后代的总体积不能超过 101 KvB（它自己也包括在内）。祖先数量的限制也是一样。</p><h2 id=交易钉死><a href=#交易钉死 class=headerlink title=交易钉死></a>交易钉死</h2><p>这两个限制在防止滥用 RBF 和 CPFP 时是必要的。但它们也有缺点：当某用户想给一笔闪电网络承诺交易追加手续费时，它们也可以反过来被用作攻击界面。这样的攻击叫做 “<strong>交易钉死</strong>（transaction pining）”，发生在两个（乃至多个）参与者都能给同一笔交易追加手续费的时候。</p><p>攻击思路是很简单的：通道的其中一个参与者可以故意为原本的承诺交易追加手续费，使之触发（RBF 或 CPFP）的抗 DoS 限制，使另一方无法再为之追加手续费。如此一来，攻击者就能给对方强加自己的交易版本（以及相应的手续费）、阻止对方按自己的意愿追加手续费。</p><p>举个例子，滥用 RBF 抗 DoS 措施的办法是发一笔比原交易体积更大但手续费率更低的交易。因为规则要求的是替换交易所支付的手续费比原交易（<strong>及其</strong>后代）更高（但并不要求手续费率更高），所以对等节点如果想要使用 RBF 来追加手续费，就必须支付比对方所设置的更高的手续费。</p><p>CPFP 的抗 DoS 措施也可以被用来钉死一笔交易，只需要给原交易附加 24 个子交易（或者触发体积限制）即可。另一方将无法再用 CPFP 来为原交易追加手续费。</p><p>因此，攻击者可以利用 RBF 和 CPFP 的抗 DoS 措施、在比特币网络负载量很大或手续费很高时推迟承诺交易的确认。这样的攻击，如果精心策划，可以让攻击者从诚实的闪电网络用户手中窃取资金。所以，找出一些微调规则的办法，使我们能安全地为闪电网络承诺交易追加手续费，是至关重要的。</p><h2 id=Carve-Out-与锚点输出><a href=#Carve-Out-与锚点输出 class=headerlink title="Carve Out 与锚点输出"></a>Carve Out 与锚点输出</h2><p>CPFP 的 “Carve Out” 策略就是这样的微调之一。它允许为一笔交易加入第 25 个后代交易，当且仅当这笔后代交易的重量没有超过 1000 vB、且其只拥有一个未确认的祖先的时候。或者，换句话说，即使一笔未确认的交易已经有 24 个后代 <sup><a href=#note4 id=jump-4>4</a></sup>，Carve Out 也允许为这笔交易追加一个子交易，只要这个子交易的重量没有超过 1000 vB。</p><p>但 Carve Out 并不能解决我们的问题。我们还必须保证，在这笔承诺交易公布后，任何一方都能花费一个输出（并且只能花费一个输出）。考虑有 3 个输出的承诺交易。假设 Alice 可以花费一个输出（输出 #1）、Bob 可以花费两个输出（输出 #2 和 #3）。Bob 依然可以钉死这笔交易：先为输出 #2 附加 24 个后代交易，再为 #3 附加一个子交易。他能这样做，完全有赖于 Carve Out，而他这样做了之后，Alice 就无法为这笔交易附加任何子交易了，那会超过 Carve Out 允许的限度。</p><p>如果承诺交易只有 2 个输出，每一方都只能花费其中一个输出，情形就完全不同了。Bob 可以为自己的输出附加 24 个后代，但是，他无法为 Alice 的输出附加交易。他也无法为自己的输出附加第 25 个后代，因为 Carve Out 策略只允许第 25 个后代是原交易的直系子代。而 Bob 如果附加，则会称为原交易的孙子的孙子的孙子 …… 等等。另一方面，感谢 Carve Out，Alice 可以为自己的输出增加一笔子交易 <sup><a href=#note5 id=jump-5>5</a></sup>。这笔承诺交易及其后代，在整体上稍微逾越了 25 个后代的规则，但依然在 Carve Out 允许的范围内。这样一来，即使 Bob 尝试钉死这笔交易，Alice 也依然可以使用 CPFP 为自己的输出追加手续费。</p><p>我们必须回答的最后一个问题是，如何保证每一方在承诺交易中最多只有一个输出可以花费。无论如何，承诺交易很容易拥有超过 2 个输出，比如通道中拥有一个还未结算的 HTLC（哈希时间锁合约）的时候。</p><p>秘诀在于，我们不需要让每一方都 <em>绝对</em> 只有一个输出。我们只需要让承诺交易，在公开之后，每一方都至多只有一个输出<strong>可以花费</strong>，就行了。这 <em>就是</em> <strong>锚点输出</strong>的做法：承诺交易的每一个输出都带有一个 <a target=_blank rel=noopener href=https://en.bitcoin.it/wiki/CheckSequenceVerify>CSV</a>（相对时间锁）条件，来防止这些输出在一个区块内被花费；同时，它增加了两个输出（每一方一个），专为双方可以使用 CPFP 来追加承诺交易的手续费而设。参与者可以在其它输出依然（被时间锁）锁定的时候，使用自己的这个输出作为锚点、附加一笔乃至更多的后代。</p><p>摘要：锚点输出是一笔承诺交易的两个输出（各属于通道的其中一方），这样任何一方都可以安全地为承诺交易追加手续费，而不必担心交易被对方钉死。这样一来，双方都有机会为关闭交易设置自己想要的手续费。</p><h2 id=综合><a href=#综合 class=headerlink title=综合></a>综合</h2><p>承诺交易对闪电网络的安全模型至为关键，因为它允许通道的参与者单方面关闭通道。然而，从承诺交易的构建，到承诺交易的公布，中间可能存在时延，这使得它们可能会因为手续费设置不当而被阻塞在交易池中。幼稚的解决方案是，在构造承诺交易时故意设置过高的手续费；这是不够的，因为等到这笔承诺交易上链时，通行的手续费率可能比这个故意拔高的手续费率还要高，交易依然可能受阻。</p><p>手续费追加方法 RBF 和 CPFP 都有抗 DoS 措施，这些措施使它们也不足以应对闪电网络（两方可以提高同一笔交易的手续费）的需要。在 CPFP 中，相关的问题由 Carve Out 策略来解决。利用这种策略，通道的每一方都可以利用未确认的承诺交易中的一个专门的输出（叫做 “<strong>锚点输出</strong>”），安全地追加手续费。</p><h2 id=它会如何影响终端用户？><a href=#它会如何影响终端用户？ class=headerlink title=它会如何影响终端用户？></a>它会如何影响终端用户？</h2><p>就我所知，现在 3 大主流的闪电网络实现都已经支持锚点输出。举例来说，在 LND 客户端中，所有承诺交易都有专门的锚定输出、非锚点输出都有长达 1 个区块的相对时间锁，这已经是默认配置。但如果用户没有留存一些钱来发起子交易，这些措施也是无用的。这也是何以 LND 开始强制实施一个它们专有的规则：用户必须为每一个通道保留至少 10 万聪的链上余额。这也是为什么有时候用户会（惊讶地）发现，自己即使拥有 20 万聪，也无法开设一个 15 万聪的通道。这实际上也是促使我开展这份研究的原因：我自己也遭遇到了这方面的困惑。</p><h2 id=一些资料><a href=#一些资料 class=headerlink title=一些资料></a>一些资料</h2><p>Bitcoin Optech 制作了一些很棒的主题页，覆盖了<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/anchor-outputs/ >锚点输出</a>、<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/transaction-pinning/ >交易钉死</a>和 <a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/cpfp-carve-out/ >CPFP Carve Out</a>。</p><p>比特币和闪电网络开发者邮件组也是很棒的信息来源。举个例子，Matt Corallo 的<a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-November/016518.html>初步立场说明</a>。</p><h2 id=脚注><a href=#脚注 class=headerlink title=脚注></a>脚注</h2><p>1.<a id=note1> </a>这就是承诺交易的用处：即使对方不同意（或者离线了），也可以独自关闭交易。 <a href=#jump-1>↩</a></p><p>2.<a id=note2> </a>这是极为重要的，因为闪电网络的一部分安全模型就依赖于时间锁。 <a href=#jump-2>↩</a></p><p>3.<a id=note3> </a>根据 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki#implementation-details>BIP125</a>，“原交易” 指的是最初的那笔交易以及任何花费该交易但还未确认的交易（其后代）。 <a href=#jump-3>↩</a></p><p>4.<a id=note4> </a>它自己也要算进 25 个之中。 <a href=#jump-4>↩</a></p><p>5.<a id=note5> </a>在（相当容易管理的）条件下，这笔交易不能超过 1000 vB。 <a href=#jump-5>↩</a></p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>