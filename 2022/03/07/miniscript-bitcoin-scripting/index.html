<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>Miniscript：简洁高效的比特币脚本编程方法</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Miniscript：简洁高效的比特币脚本编程方法</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>Miniscript：简洁高效的比特币脚本编程方法</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BC%95%E8%A8%80><span class=toc-text>引言</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%AF%94%E7%89%B9%E5%B8%81%E8%84%9A%E6%9C%AC><span class=toc-text>比特币脚本</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%9A%BE%E4%BB%A5%E9%AA%8C%E8%AF%81><span class=toc-text>难以验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#Miniscript><span class=toc-text>Miniscript</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF><span class=toc-text>使用场景</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%9C%80%E4%BC%98%E8%84%9A%E6%9C%AC><span class=toc-text>最优脚本</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%80%9A%E7%94%A8%E7%9A%84%E8%8A%B1%E8%B4%B9%E6%9D%A1%E4%BB%B6><span class=toc-text>通用的花费条件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%82%A8%E5%A4%87%E9%87%91%E8%AF%81%E6%98%8E><span class=toc-text>储备金证明</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%8A%B1%E8%B4%B9%E6%96%B9%E5%BC%8F%E7%9A%84%E7%BB%84%E5%90%88><span class=toc-text>花费方式的组合</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8A%A8%E6%80%81%E7%9A%84%E8%81%94%E7%9B%9F><span class=toc-text>动态的联盟</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8E%86%E5%8F%B2><span class=toc-text>历史</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%9B%B8%E5%85%B3%E5%B7%A5%E4%BD%9C><span class=toc-text>相关工作</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9C%AA%E6%9D%A5%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%92%8C%E7%BB%93%E8%AE%BA><span class=toc-text>未来的工作和结论</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BC%80%E5%A7%8B%E5%9C%A8-Miniscript-%E4%B8%8A%E5%BC%80%E5%8F%91><span class=toc-text>开始在 Miniscript 上开发</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>Miniscript：简洁高效的比特币脚本编程方法</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Pieter Wuille"><div class=page-author-info><strong>Pieter Wuille</strong><time class=has-text-grey datetime=2022-03-07T06:07:42.000Z>2022-03-07</time></div></div><div class=is-flex><a href=/tags/%E5%BC%80%E5%8F%91><i class="page-tag mr-1 px-1">开发</i></a><a href=/tags/Miniscript><i class="page-tag mr-1 px-1">Miniscript</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Pieter Wuille &amp; Andrew Poelstra</em></p><p><em>来源：<a target=_blank rel=noopener href=https://medium.com/blockstream/miniscript-bitcoin-scripting-3aeff3853620>https://medium.com/blockstream/miniscript-bitcoin-scripting-3aeff3853620</a></em></p></blockquote><p><img src=/images/miniscript-bitcoin-scripting/5tYkppoJQkV alt=img></p><h2 id=引言><a href=#引言 class=headerlink title=引言></a>引言</h2><h3 id=比特币脚本><a href=#比特币脚本 class=headerlink title=比特币脚本></a>比特币脚本</h3><p>比特币一直都有一种机制将币的花费条件变得更加复杂（而不是只要你有私钥就一路畅通）：Script（脚本）机制。虽然 Script 主要用于单密钥支付，它也是许多技术（比如多签名钱包、原子化互换结构以及闪电网络）的基础。</p><p>然而，这还不是它的极限。Script 可以用来表示构造一笔交易所需的复杂条件 —— 例如（A、B、C 三把密钥中的任意两个）以及（D 或者（E、F 一道）） —— 还有哈希原像检查、时间锁以及少量更奇特的结构。</p><h3 id=难以验证><a href=#难以验证 class=headerlink title=难以验证></a>难以验证</h3><p>我们远远没有释放 Script 的全部潜能的一个原因是，想要为一些不简单的场景构造脚本并不容易：验证脚本的正确性和安全性很难，而想要发现最经济的编写方法就更难了。</p><p>问题的一部分在于：即使你知道正确的脚本，设计出用户可以参与的应用和协议、构造出使用这些协议的交易，在每次设计出新的构造时都需要大量的专门开发工作。任何形式的灵活性通常都诉诸丑陋的模板匹配来检测兼容的脚本，而每一个增补项都需要更多工程资源用于分析和质保。</p><p>能不能让比特币应用可以跟任何脚本一起工作，而不是仅仅能运行少数为之设计的脚本呢？这样我们就不会限于只能使用一次性的设计，并且可以开始设计那些构造和使用实时生成脚本的应用，只看用户的专门需求是什么。钱包的开发者也可以引入更多基于脚本的选择，同时维持与其它钱包的互操作性。</p><h2 id=Miniscript><a href=#Miniscript class=headerlink title=Miniscript></a>Miniscript</h2><p>下面我们要介绍 <strong>Miniscript</strong>，这是一种以结构化的方式来表示比特币脚本的编程语言，从而，它能为高效分析、组合、通用签名等等前景赋能。</p><p>比如有这样一个比特币脚本：</p><pre><code class=javascript>&lt;A&gt; OP_CHECKSIG OP_IFDUP OP_NOTIF OP_DUP OP_HASH160 &lt;hash160(B)&gt; OP_EQUALVERIFY OP_CHECKSIGVERIFY &lt;144&gt; OP_CSV OP_ENDIF
</code></pre><p>这里的 A 和 B 是公钥。这个脚本可以转化成 Miniscript 记法：</p><pre><code class=javascript>or_d(c:pk(A),and_v(vc:pk_h(B),older(144)))
</code></pre><p>这种记法使之更加清楚：脚本的语义想确保这笔资金在花费时要么得到了 A 的签名，要么是在 144 个区块后得到了 B 的签名。一大部分有意义的脚本都可以用这种办法来编写。</p><p>让脚本编程人类可读（至少工程师可读）只是 Miniscript 的特性之一。它的主要目标是在 Script 上实现自动推理（automated reasoning），就如下面的使用场景所示的一样。</p><h2 id=使用场景><a href=#使用场景 class=headerlink title=使用场景></a>使用场景</h2><p>如今，使用比特币脚本构造复杂花费条件的难度高得没有必要，因为它需要为每一个新的用途开发、测试和部署专门的软件。Miniscript 可以通用化任意的花费条件集合，从而覆盖这些应用场景；而且，通常比专门的解决方案更加简单也更可靠。</p><h3 id=最优脚本><a href=#最优脚本 class=headerlink title=最优脚本></a>最优脚本</h3><p>其中一种用途是为实现给定的一组花费条件找出最优的脚本。在比特币的 Script 中，它有许多不同的方法来要求一个签名、描述和运算（conjunction）以及或运算（disjunction）、实现一个门限签名。即使是对资深的比特币 Script 开发者，正确的选择也依赖于不同条件被满足的相对概率，而这本身是难以计算的。我们的<a target=_blank rel=noopener href=http://bitcoin.sipa.be/miniscript/ >在线编译器</a>，也可以<a target=_blank rel=noopener href=https://github.com/sipa/miniscript>作为 C++ source</a> 来使用，也是 <a target=_blank rel=noopener href=http://bitcoin.sipa.be/miniscript/ >rust-miniscript</a> 库的一部分，可以即时找出对应于给定的一个花费方式的最优 Miniscript 实现。</p><p>引言中的示例可以通过编译下面的条件来获得：</p><pre><code class=java>or(99@pk(A),1@and(pk(B),older(144)))
</code></pre><p>这种方法表示，or 的左分支（A 签名）有 99% 的概率出现，而右分支（B 在 144 个区块后签名）只有 1% 的概率出现。</p><h3 id=通用的花费条件><a href=#通用的花费条件 class=headerlink title=通用的花费条件></a>通用的花费条件</h3><p>对 Script 的许多应用来说，找出有效率的脚本之后，还有一个常见的障碍是不同的花费机制之间缺乏互操作性。希望实现长期时间锁或者复杂多签名要求的用户，可能因为担心交易对手没有（或者不愿意）使用合适的软件来理解并花费这些条件所控制的资金而却步。</p><p>而 Miniscript 因为直接呈现花费条件，可以将任意的条件（policies，后文也译为 “花费方式”）表达得使任何人都可以：</p><ol><li>计算出脚本相应的地址</li><li>确定哪个签名者是签名时候的 必要&#x2F;充分 参与者</li><li>具有充足的签名时，产生出有效的交易</li></ol><p>用户不需要担心所有参与者是否都使用了兼容的软件，以及这个软件是否能存活到资金的时间锁解锁的那一天。</p><p>他们也不需要担心自己的需要可能会变化然后跟当前所用的软件不兼容，因此用户可以得到保证，比特币的 Script 不会捆住他们的手脚。</p><h3 id=储备金证明><a href=#储备金证明 class=headerlink title=储备金证明></a>储备金证明</h3><p>与签名问题相关的问题是<strong>储备金证明问题</strong>，就是一个公司如何证明自己 <em>可以</em> 花费一组比特币资金而又不必实际上花费它们。虽然这样的工具已经有了，比如 <a target=_blank rel=noopener href=https://blockstream.com/2019/02/04/en-standardizing-bitcoin-proof-of-reserves/ >Blockstream 的 Proof of Reserves Tool</a>，但业内还未形成通用的标准。没有 Miniscript，也可能无法形成标准，因为当前大家使用的托管方案太多样了。</p><h3 id=花费方式的组合><a href=#花费方式的组合 class=headerlink title=花费方式的组合></a>花费方式的组合</h3><p>我们先来看一个比特币 Script 开发者被互操作性的需要困住的例子。设想一个公司，托管着大量的比特币，并且希望这些资金只能在获得大多数董事的同意之后才能花费。但是，一些独立董事希望使用自己已有的钱包软件和硬件，而这些软硬件有复杂的签名设置，要动用放在多个不同位置的私钥；而且他们不想要一种只能使用特定设备来签名的方案。</p><p>没有 Miniscript，想要生成可以兼容所有签名者的要求、同时向所有签名者保证所生成的脚本可靠又完整、并且它们的钱包软件会兼容这个结果，将变成一个无法解决的问题。</p><p>使用 Miniscript，这些董事可以简单地在自己的钱包软件中组合这些花费方式，从而建构出一个描述了一个门限要求的花费方式，然后将它编译到 Miniscript。他们可以直接验证这个编译器的输出与最初的花费方式相匹配，而且最初的花费方式满足了每个人的要求。然后，他们可以使用任何兼容 Miniscript 的软件来计算接收资金的地址、在花费时收集签名、将这些签名组合成一笔有效的交易。</p><p>一个简单的理论案例：一个公司正在设置一个由两位董事参与的定制化多签名存储方案。一个董事已经在用 Blockstream Green 钱包（账户初始配置为 2-2，一段时间后会变成 1-2），而另一位董事正在使用 Electrum 钱包（标准的 1-1）。如果没有工具来组合安全的、可以互操作的脚本，我们是不可能让使用 Green 钱包的董事将自己的花费方式变成公司多签名设置的一个 “参与者” 的。但如果 Green 钱包以及构造这个公司多签的软件都支持 Miniscript，那么双方都可以继续使用自己喜欢的钱包，而且都无需知晓背后的脚本是什么。</p><h3 id=动态的联盟><a href=#动态的联盟 class=headerlink title=动态的联盟></a>动态的联盟</h3><p>Miniscript 威力的一个具体案例可以在 <a target=_blank rel=noopener href=https://blockstream.com/liquid/ >Blockstream 的 Liquid 侧链</a>中找到。一个当前正在开发的技术，内部称为 “ <em>动态联盟</em> ”的，允许当前的 Liquid 成员管理新成员的加入，以及更新控制着这个联盟所托管资金的花费条件的脚本。Miniscript 使联盟成员可以快速而高效地建构出这样的脚本 —— 实际上，Miniscript 编译器发现了当前的 <a target=_blank rel=noopener href=https://www.blockstream.info/address/3EiAcrzq1cELXScc98KeCswGWZaPGceT1d>Liquid 脚本</a>的一个更短的 22 字节的版本，轻轻松松就比最初我们煞费苦心人工优化的脚本节约了 5%。但更重要的是，它还使得联盟成员可以自动验证目标脚本的重要特性，从而减少联盟成员一个一个相互协作的需要，以及为目标脚本执行昂贵的人工安全审计的需要。</p><p>具体来说，联盟成员可以自动化验证目标脚本包括了：</p><ol><li>他们自己的密钥</li><li>一个编写正确且足够远期的带时间锁的紧急花费条件</li></ol><p>Miniscript 也使他们能够验证新联盟的参与者是否能够花费旧联盟所控制的资金。这种检查对于保证交易不会导致资金损失是极为关键的，对想要把资金转移到这个系统的用户也是如此；而如果没有 Miniscript，在现实中也几乎不可能。</p><h2 id=历史><a href=#历史 class=headerlink title=历史></a>历史</h2><p>Miniscript 的想法形成于 2018 年夏天，是当时正在开发的多个想法的集大成者。在 7 月中旬，Pieter Wuille 为 Bitcoin Core 钱包引入了输出描述符（output descriptor），这是一种描述 Bitcoin Core 所支持的许多不同地址类型的通用方法。同时，那个夏天在 Blockstream 实习的 Andy Chow 提出了部分签名的比特币交易（PSBT，Partially Signed Bitcoin Transaction，由 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0174.mediawiki>BIP 174</a> 详述）协议，它作为一种钱包互操作性协议，在钱包领域获得了越来越多的关注。</p><p>PSBT 的一个关键部分是 <em>定稿器</em>，某个参与者要负责收集签名者包含在部分签名的比特币交易中的数据并组合成一笔真正的比特币交易。这个组合过程需要理解被签名满足的脚本，这就意味着启用 PSBT 的钱包，如果要做一些复杂的事情，就必须实现自己的专用的定稿器，而这又需要冗余开发并限制了互操作性。</p><p>Blockstream 的 Andrew Poelstra 一直在努力为 rust-bitcoin（Rust 编程语言的一个通用比特币库）接受一种 <a target=_blank rel=noopener href=https://github.com/rust-bitcoin/rust-bitcoin/pull/103>PSBT 实现</a>。这个实现是由 Carl Dong 提出的，但并未包含通用到足以支持该库的所有用户的定稿器。Poelstra <a target=_blank rel=noopener href=http://gnusha.org/rust-bitcoin/2018-07-31.log>看到 IRC 频道里面</a>有人说“如果你有一种高度结构化的脚本模板，那你即使并不真的理解脚本也没关系了”，这个想法成了 Miniscript 的内核。</p><p>不相关的是，Poelstra 和 Wuille 一直在开发一个跟托管有关的项目，并因为缺乏可用于复杂的多参与者脚本的标准工具而遭受挫折。他们两位在 2018 年 8 月碰面讨论这个问题。Wuille 建议实现这些 “高度结构化的脚本模板” 作为 Bitcoin Coin 的输出描述符的一个插件。</p><p>随着这个插件成形，它开始分成两个东西：一个是比特币 Script 的结构化子集，也就是 Miniscript；一个是更简单的 “花费方式语言”，可以直接表示花费条件，并且可以编译成 Miniscript。在 2019 年 1 月，<a target=_blank rel=noopener href="https://www.youtube.com/watch?v=XM1lzN4Zfks">Wuille 在斯坦福区块链大会上演示了初步成果</a>。</p><p>接下来，5 月，Sanket Kanjalkar 加入 Blockstream 开展三个月的实习，专门为 Miniscript 实现工具，并帮助集成到 Bitcoin Core。有了他的帮助，Miniscript 得以完成并多次重新设计成更小、更高效、更容易分析并且抗变形性（against malleability）更好的形式。最后的一组变更是为了验证一大批随机的 Miniscript 兼容脚本是否符合比特币的共识和标准规则。这些迭代的结果就是今天的 Miniscript。</p><h2 id=相关工作><a href=#相关工作 class=headerlink title=相关工作></a>相关工作</h2><p>Miniscript 基于并整合了比特币生态系统中的许多其它项目。具体来说，如上所述，Miniscript 延伸了 Bitcoin Core 钱包的<strong>输出描述符</strong>，并与 <strong>PSBT</strong> 结合来启用完全通用的更新器和定稿器。</p><p>Miniscript 可以<a target=_blank rel=noopener href=https://mobile.twitter.com/danrobinson/status/1091149043563036672>跟 <strong>Ivy</strong> 相比较</a>，Ivy 是另一种为了让比特币 Script 的高级特性更易用而设计的语言。不过，虽然 Ivy 可以编译成 Script，Miniscript 是 Script（的子集）的直接表示，意味着 “miniscript 程序” 的正确性和可靠性可以高效地验证。Miniscript 也支持许多其它形式的静态分析，而 Script 和 Ivy 都不可以。</p><p>Miniscript 的花费方式语言跟 Ivy 相似，两者都是抽象，都必须编译成 Script 才能在区块链上使用。不过，Miniscript 的花费方式语言跟 Miniscript 自身的结构相似，所以容易验证编译器的输出是否与编译器的输入相匹配 —— 实际上，你甚至可以手动验证 —— 也容易验证它是否与用户的期待相匹配。</p><p>另一种跟 Miniscript 相关的区块链语言是 Blocksteam 的 <strong>Simplicity</strong>。跟 Miniscript 一样，<a target=_blank rel=noopener href=https://blockstream.com/2018/11/28/en-simplicity-github/ >Simplicity 是一种设计成可以直接嵌入区块链交易中的低级语言</a>。此外，Simplicity 也支持许多形式的静态分析，这在部署区块链合约时是至关重要的（但它的一些替代品，比如以太坊的 EVM，从设计上就使得这一点非常难甚至不可能实现）。</p><p>Miniscript 与 Simplicity 的区别在于，后者很强大，足以表达任何可计算的函数，而 Miniscript 的表达范围非常有限：它可以表达签名要求、时间锁、哈希原像，以及这些元素的任意组合。这种表达范围上的缩减使得 Miniscript 易于为它所覆盖的应用场景开展分析，更重要的是，这允许它在现有的比特币区块链上工作。相反，Simplicity 就跟比特币 Script 截然不同，依然处于其开发的早期阶段。</p><h2 id=未来的工作和结论><a href=#未来的工作和结论 class=headerlink title=未来的工作和结论></a>未来的工作和结论</h2><p>在设计 Miniscript 时，我们的目标是让比特币 Script 更加易用。虽然许多工作致力于研究和提议 Script 和比特币共识规则的变更以增加额外的特性，我们感觉到，基础设施的缺失使我们甚至无法通用、安全、可组合并且可互操作地使用已经存在的特性。</p><p>这部分工作还没有完成。我们有两个功能性的 Miniscript 实现（C++ 和 Rust）以及花费方式编译器，但为了让这些技术便于使用，我们需要将它们整合进常用的软件中。有了兼容 Miniscript 的 PSBT 实现（更新器和定稿器），许多 PSBT 签名器（包括基于硬件钱包的）将可以用在复杂的脚本中，即使没有明确的支持也可以。这个编译器也可以优化，因为在从花费方式到脚本的转换中，还有许多优化方法尚未被考虑。</p><p>在这个过程中，我们学到了许多东西：</p><ul><li><strong>Script 的资源限制了复杂花费方式的优化</strong>：大量的共识和标准化所施加的资源限制（操作码数量上限、脚本体积上限、堆栈层级上限，等等）使得，一旦一套花费方式接近触碰到这些限制，为之寻找最优的脚本就变得格外困难。这是一个有趣的洞见，也许它能引导未来对 Script 的优化。有关联的事情是，我们也惊讶地发现，比特币的共识规则实际上会统计参与一个执行的 <code>OP_CHECKMULTISIG(VERIFY)</code> 的密钥的数量，将它算进每个脚本不能超过 201 个非 push 操作码的限制中。</li><li><strong>变化的见证数据规模使得手续费估计变得更复杂</strong>：在简单的支付和多签名结构中，见证数据的体积与出现的具体密钥组合无关。然而，一旦我们使用更复杂的脚本，见证数据就会变化，而且可能让手续费估计变得更复杂。具体一个交易输出的潜在签名者，可能需要乐观地猜测可采用的便宜路径并构造出相应的交易。如果这条路径上有密钥或者哈希值不可用，这笔交易就必须改变，手续费也将上升。</li><li><strong>Segwit 的堆栈编码使优化变得复杂</strong>：自 Segwit 之后，输入的堆栈不再被编码为一个脚本，而被直接编码为堆栈元素的一个列表。它有一个糟糕的副作用是把 “true” 的编码从 1 字节变成了 2 字节。因为这一点，Miniscript 需要考虑一个子表达式要放进一个 IF&#x2F;ELSE&#x2F;ENDIF 结构的哪一边。</li><li><strong>不定形（Malleability）</strong>：自 Segwit 一来，交易不定形已不再是协议正确性的死敌，但它仍有一些讨厌的效果（例如传播交易时的费率不确定性、降低致密区块（compact block）的传播速度、干扰哈希锁作为全局发布机制的用法）。因为这些原因，我们在设计 Miniscript 时就考虑到了抗变形性，并学会了一般化地推理见证数据的抗变形性。为了实现这一点，Miniscript 依赖于特定的 Segwit 专用规则，因为在前 Segwit 的交易规则中，抗变形是非常难以实现的。</li><li><strong>消除共用子表达式不容易</strong>：虽然有许多尝试，但 Miniscript 并不支持将重复的子表达式优化出去。虽然在特定的场景中这是有可能做到的，但看起来想要在 Script 中实现一般化是非常困难的。推出特定的堆栈操纵操作码可以改变这一点。</li></ul><h2 id=开始在-Miniscript-上开发><a href=#开始在-Miniscript-上开发 class=headerlink title="开始在 Miniscript 上开发"></a>开始在 Miniscript 上开发</h2><p>有兴趣使用 Miniscript 来开发的开发者可以从我们的<a target=_blank rel=noopener href=http://bitcoin.sipa.be/miniscript/ >在线编译器和分析器</a>开始研究 Miniscript 的构造。也许我们的 <a target=_blank rel=noopener href=https://github.com/apoelstra/rust-miniscript/tree/master/examples>rust-miniscript 应用案例</a>也能帮到你。</p><p>我们欢迎对 <a target=_blank rel=noopener href=https://github.com/sipa/miniscript>C++ miniscript</a> 和 <a target=_blank rel=noopener href=https://github.com/apoelstra/rust-miniscript/ >rust-miniscript</a> 库的贡献，你也可以在 Freenode 上的 IRC 频道 ##miniscirpt 关注我们团队，了解跟 Miniscript 有关的讨论！</p><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>