<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>比特币交易的手续费追加方法简介</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">比特币交易的手续费追加方法简介</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>比特币交易的手续费追加方法简介</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88><span class=toc-text>解决方案</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%89%8B%E7%BB%AD%E8%B4%B9%E6%9B%BF%E6%8D%A2%EF%BC%88RBF%EF%BC%89><span class=toc-text>手续费替换（RBF）</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AD%90%E4%B8%BA%E7%88%B6%E5%81%BF%EF%BC%88CPFP%EF%BC%89><span class=toc-text>子为父偿（CPFP）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E8%80%83%E9%87%8F><span class=toc-text>用户体验考量</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A4%A7%E4%BD%93%E9%87%8F%E7%94%A8%E6%88%B7%E7%9A%84%E8%80%83%E9%87%8F><span class=toc-text>大体量用户的考量</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#RBF-%E7%AE%80%E4%BB%8B><span class=toc-text>RBF 简介</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A6%82%E8%BF%B0-RBF-%E6%98%AF%E4%BB%80%E4%B9%88><span class=toc-text>概述 RBF 是什么</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#RBF-%E7%9A%84%E5%8E%86%E5%8F%B2><span class=toc-text>RBF 的历史</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#BIP125><span class=toc-text>BIP125</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#RBF-%E7%9A%84-5-%E4%B8%AA%E6%9D%A1%E4%BB%B6><span class=toc-text>RBF 的 5 个条件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E5%BB%BA%E8%AE%AE><span class=toc-text>用户体验建议</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BA%92%E6%93%8D%E4%BD%9C%E6%80%A7%E5%92%8C%E5%85%BC%E5%AE%B9%E6%80%A7%E7%9F%A9%E9%98%B5><span class=toc-text>互操作性和兼容性矩阵</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BD%BF%E7%94%A8-RBF-%E7%9A%84%E5%85%AC%E5%8F%B8%E6%A1%88%E4%BE%8B><span class=toc-text>使用 RBF 的公司案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#CPFP-%E7%AE%80%E4%BB%8B><span class=toc-text>CPFP 简介</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#CPFP-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86><span class=toc-text>CPFP 工作原理</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#CPFP-%E7%9A%84%E5%8E%86%E5%8F%B2><span class=toc-text>CPFP 的历史</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#CPFP-%E6%A1%88%E4%BE%8B%E7%A0%94%E7%A9%B6><span class=toc-text>CPFP 案例研究</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E5%BB%BA%E8%AE%AE-1><span class=toc-text>用户体验建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#RBF-%E8%BF%98%E6%98%AF-CPFP%EF%BC%88%E8%BF%98%E6%98%AF%E4%B8%A4%E8%80%85%E9%83%BD%E8%A6%81%EF%BC%89%EF%BC%9F><span class=toc-text>RBF 还是 CPFP（还是两者都要）？</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#RBF-%E7%9A%84%E4%BC%98%E5%8A%BF><span class=toc-text>RBF 的优势</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#CPFP-%E7%9A%84%E4%BC%98%E5%8A%BF><span class=toc-text>CPFP 的优势</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%A4%E8%80%85%E9%83%BD%E7%94%A8><span class=toc-text>两者都用</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%9E%E7%8E%B0%E9%97%AE%E9%A2%98><span class=toc-text>实现问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BB%93%E8%AE%BA><span class=toc-text>结论</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%84%9A%E6%B3%A8><span class=toc-text>脚注</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%B1%E8%AF%86%EF%BC%8C%E5%AF%B9%E7%AD%96%E5%92%8C%E6%BF%80%E5%8A%B1%E5%85%BC%E5%AE%B9><span class=toc-text>共识，对策和激励兼容</span></a></li></ol></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>比特币交易的手续费追加方法简介</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Bitcoin Optech"><div class=page-author-info><strong>Bitcoin Optech</strong><time class=has-text-grey datetime=2022-03-17T07:15:44.000Z>2022-03-17</time></div></div><div class=is-flex><a href=/tags/%E5%BC%80%E5%8F%91><i class="page-tag mr-1 px-1">开发</i></a><a href=/tags/%E4%BA%A4%E6%98%93%E6%B1%A0><i class="page-tag mr-1 px-1">交易池</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Bitcoin Optech</em></p><p><em>来源：<a target=_blank rel=noopener href=https://bitcoinops.org/en/scaling/fee-bumping/ >https://bitcoinops.org/en/scaling/fee-bumping/</a></em></p></blockquote><p>比特币的手续费市场瞬息万变，可能会导致交易上链所需的手续费剧烈上升或下降。</p><p><img src=/images/introduction-to-fee-bumping-by-Bitcoin-Optech/mempool.png alt="Six months of mempool size, grouped by fee-rate, from https://jochen-hoenicke.de/queue/#1,24h"></p><p style=text-align:center>- <em>（6 个月的交易池规模图，以手续费率的高低分组及着色，来自 https://jochen-hoenicke.de/queue/#1,24h）</em> -</p><p>手续费波动性的原因之一是市场选择哪些交易能进入一个区块的机制。在市场上，矿工们每 10 分钟左右供给 400 万重量（weight）（译者注：一种虚设的计量单位，用来度量一笔交易的体积）的区块空间，而用户们则（通过交易费率）竞拍，让自己的交易进入区块。许多钱包的手续费估计算法都粗糙，而用户有时候对高费率并不敏感，这就意味着，当交易池规模急速增长、预期的确认时间开始增加的时候，用户之间的竞拍战争可能迅速升温，钱包也开始为交易附加极高的手续费。</p><p>但这个市场还有个奇怪之处：当用户的竞拍失败、交易未能入块时，<em>这个竞标并不会撤回</em>，而是继续参与下一个区块的竞标。这是因为交易具有一种不变的属性：一旦它从某个区块开始是一笔有效的交易，那么它往后就一直是有效的交易。实际上，作废一笔已然有效的交易（从而 “撤回” 竞标）的唯一方法就是在另一笔交易中花费原交易的输入（不论一个还是多个）。</p><p>这种奇怪的特征一般来说不会对用户造成困扰，因为如果一个用户签名了一笔交易，那他们当然愿意这笔交易立即就能进入区块得到确认，而且相比他们愿意让这笔交易在不远的将来、以同样的代价进入区块。但是，有一种情境中，无法从交易池中撤回交易可能给用户造成严重的困扰：当用户没有给交易附加足够高的交易费，因此交易无法入块，但用户又有紧急需求，想让交易入块。遭遇这种情形可能有很多原因：钱包或者用户个人低估了所需的交易费、用户尝试在预期的手续费范围的底部出价来节约手续费，或者仅仅因为交易广播出去之后，入块所需的手续费率意外暴涨。不论是什么原因，用户会发现自己的交易因为低手续费率而 “困” 在了交易池里，而且未来能入块的希望也非常渺茫。</p><p>交易可能卡住的风险也会影响用户给交易费出低价的空间。如果没有办法让交易在广播之后解除困局，那么用户就不得不在一开始出一个保守（较高）的价格来避免交易卡住的风险。</p><p>因此，我们需要一种办法给已经广播出去的交易追加手续费，原因有：</p><ol><li>为了让用户能 “解困” 已经广播出去的交易</li><li>为了让用户能在一开始给出较低的交易费率、后面再追加手续费</li></ol><h2 id=解决方案><a href=#解决方案 class=headerlink title=解决方案></a>解决方案</h2><p>当前有两种常见的释放滞留在交易池中交易的办法：“手续费替换（Replace-by-fee，RBF）” 和 “子为父偿（Child Pays for Parent，CPFP）”。</p><h3 id=手续费替换（RBF）><a href=#手续费替换（RBF） class=headerlink title=手续费替换（RBF）></a>手续费替换（RBF）</h3><p>用户构造和签名一笔替换交易，替换交易要花费被阻交易的一个或多个相同输入，并且要支付更高的手续费（一般来说是通过减少找零输出的数额，减少的数额就是额外支付的手续费）。如果替换交易附带了足够高的手续费，矿工就有激励打包它。</p><h3 id=子为父偿（CPFP）><a href=#子为父偿（CPFP） class=headerlink title=子为父偿（CPFP）></a>子为父偿（CPFP）</h3><p>用户创建一笔新的交易，新交易要花费被阻交易的一个或多个输出。这笔子交易附带了一大笔手续费 —— 足以提高其自身与被阻交易的联合手续费率，使之高于入块所需的费率。但是，这种办法只有在用户拥有交易的输出时才能动用。</p><p>在选择打包入块的交易时，矿工将需要考虑交易 “包”，要看整个交易包的总体费率。矿工为了最大化区块的手续费收入，是有激励这样做的。</p><p>这个特性也可正确称之为 “裔为祖偿（Descendants-Pay-For-Ancestors）”，因为一个理性的矿工会尝试最大化自己的手续费收入，哪怕交易包内的交易大于两代，也不是问题。举个例子，Bitcoin Core 的挖矿代码会考虑最高达 25 笔交易组成的任意长度交易链条的交易包。</p><h2 id=用户体验考量><a href=#用户体验考量 class=headerlink title=用户体验考量></a>用户体验考量</h2><p>手续费追加策略对比特币钱包和服务的用户体验有显见的影响。比特币服务需要考虑的问题比如：</p><ul><li>完全不提供手续费追加策略，那么用户体验在交易池手续费率暴增以及交易无限期卡住的时候非常差</li><li>一些服务提供了服务层面的合约（Service Level Agreements），保证交易会在一定区块数量或者一定时间内入块确认。不能履行这些 SLA 会导致用户的投诉和罚单。（这些 SLA 是否现实、是否有吸引力，就不在本文讨论范围之内了！）</li><li>一些比特币钱包和服务将发信号表示使用 RBF（signal opt-in RBF）的交易与不使用 RBF 的交易区别对待（比如说不展示 RBF 交易在用户的余额中）。这可能让用户使用选择性支持 RBF 的钱包发送交易时感到困惑。</li><li>使用 RBF 追加手续费会创建一笔新交易（具有新的交易 id）。用户在这一点上也可能感到困惑，如果他们不知道当交易被 RBF，其 txid&#x2F;vout index 会变化的话。</li><li>使用 RBF 追加手续费，无法使用原交易的签名，需要所有签名者重新签名。这对多签名的交易以及签名在专用硬件钱包或者 HSM 上完成的交易影响尤为严重。</li><li>按照定义，手续费追加要提高一笔交易所附带的手续费。尤其对 CPFP，新的手续费率可能会高很多。计算这个手续以及决定谁来支付它（用户还是服务提供商）可能是难题。</li></ul><p>这些问题会在本文的后续章节中得到更细致的讨论。</p><h2 id=大体量用户的考量><a href=#大体量用户的考量 class=headerlink title=大体量用户的考量></a>大体量用户的考量</h2><p>对于那些重度使用比特币区块链的实体（比如交易所和托管商），还有额外的考量：</p><ul><li>服务商有一定数量的 UTXO 在热钱包里。如果所有这些 UTXO 都绑定在卡住的交易中，而这个服务商的钱包不使用未经确认的 UTXO 作为输入，那么他们可能会因为新交易而用尽 UTXO。</li><li>使用选择性 RBF 让这些服务可以在初步发起交易时附带较低的手续费，当交易不能如愿在一定时间内确认时再追加手续费。对于发送大量交易的实体，这种节约会很可观。</li><li>使用 CPFP 追加手续费可能导致总体手续费成本大幅上升，因为子交易和父交易都要支付手续费 —— 但 RBF 交易会完全替换掉原交易，所以你不需要支付额外一笔交易的手续费。对于发送大量交易的实体，CPFP 造成的额外费用可能会很惊人。</li><li>高频花费而且每个区块都广播交易到区块链商的服务商，可以将花费交易关联起来并使用 CPFP，而无需额外的开销。如果一笔交易在该服务商需要广播下一笔交易时还未上链，那他可以在第二笔交易中使用第一笔交易的找零输出，并附带足够高的手续费来提高整个交易包的手续费率。</li><li>实质上使用 “<a target=_blank rel=noopener href=https://en.bitcoin.it/wiki/Techniques_to_reduce_transaction_fees#Payment_batching>批量支付</a>” 的服务商可以使用单笔 RBF 或者 CPFP 交易为多笔支付追加手续费。</li><li>不使用批量支付的服务商可以使用一笔较大的 CPFP 同时为多笔交易追加手续费，而且也可能同时合并这多笔交易的输出。</li><li>交易池的代码允许交易包最多容纳 25 笔未确认的交易（另一重限制是不能超过 404 K 的重量），所以可以用单笔 CPFP 交易来加速的交易的数量是有限的。</li><li>使用择币算法并实质上 “<a target=_blank rel=noopener href=https://en.bitcoin.it/wiki/Techniques_to_reduce_transaction_fees#Change_avoidance>规避找零</a>” 的服务商将有许多没有找零输出的交易，这些交易是无法使用 CPFP 来追加交易费的。更大的钱包有能力规避找零更通常是因为有一个更大的 UTXO 集合可供挑选。</li></ul><p>这些问题也会在本文的后续章节得到更深入的讨论。</p><h2 id=RBF-简介><a href=#RBF-简介 class=headerlink title="RBF 简介"></a>RBF 简介</h2><p>（待续 1）</p><h3 id=概述-RBF-是什么><a href=#概述-RBF-是什么 class=headerlink title="概述 RBF 是什么"></a>概述 RBF 是什么</h3><p>（待续 2）</p><h3 id=RBF-的历史><a href=#RBF-的历史 class=headerlink title="RBF 的历史"></a>RBF 的历史</h3><p>（待续 3）</p><h3 id=BIP125><a href=#BIP125 class=headerlink title=BIP125></a>BIP125</h3><p>（待续 4）</p><h3 id=RBF-的-5-个条件><a href=#RBF-的-5-个条件 class=headerlink title="RBF 的 5 个条件"></a>RBF 的 5 个条件</h3><p>（待续 5）</p><h3 id=用户体验建议><a href=#用户体验建议 class=headerlink title=用户体验建议></a>用户体验建议</h3><p>即使钱包和服务自身不支持用户创建选择使用 RBF 的交易以及替换交易，也应该在处理 RBF 交易时向用户提供清晰和准确的体验：</p><ul><li>钱包在收到选择使用 RBF 的交易时，可以显示这笔交易是表态使用 RBF 的（使用工具提示或弹窗，给出关于 RBF 的额外信息）。</li><li>钱包一定不能将被替换的交易重复计算进去（也就是如果一个 UTXO 在被替换的交易和替换交易中出现就增记或减记两次）。</li><li>钱包和区块浏览器在一笔交易被替换之后，也应该继续显示这笔交易（要么标灰，要么隐藏），并且清晰提示这笔交易已经被替换掉了，不再有效了。</li><li>已经被替换的交易的连接在区块浏览器中应保持可用；也可重定向到替换了该交易的交易处。</li></ul><h3 id=互操作性和兼容性矩阵><a href=#互操作性和兼容性矩阵 class=headerlink title=互操作性和兼容性矩阵></a>互操作性和兼容性矩阵</h3><p>（待续 6）</p><h3 id=使用-RBF-的公司案例><a href=#使用-RBF-的公司案例 class=headerlink title="使用 RBF 的公司案例"></a>使用 RBF 的公司案例</h3><p>（待续 7）</p><h2 id=CPFP-简介><a href=#CPFP-简介 class=headerlink title="CPFP 简介"></a>CPFP 简介</h2><p>子为父偿（CPFP）是一种钱包功能，用户可以花费一笔未确认的交易（<em>父交易</em>）的输出、作为一笔新交易（<em>子交易</em>）的输入。钱包会让子交易附带足够的交易费，从而提高父交易和子交易的联合交易费率。</p><h2 id=CPFP-工作原理><a href=#CPFP-工作原理 class=headerlink title="CPFP 工作原理"></a>CPFP 工作原理</h2><p>在构造一个新区块时，矿工的利益在于用手续费最高的一组交易填满 1vMB 的区块（译者注：vMB 也是一个虚设的计量交易体积的单位，跟上面说的 weight（重量）可以相互换算）。如果所有的未确认交易都是独立的，那么操作就很直接 —— 矿工只需按手续费率高低降序排列，从上往下加入候选区块中直至区块满载。这样做就能最大化矿工从区块中获得的收入（围绕一个区块的最后几个字节，要做稍微复杂一点的操作才能保证尽可能填满了区块）。</p><p>不过，未确认的交易 <em>不是</em> 独立的。有可能会有一连串的未确认交易在花费一笔尚未确认的交易的输出。举个例子，交易 A 有输出 a1 和 a2，交易 B 可能在 A 打包入块之前就使用其中之一作为输入。这时候，如果矿工想要在区块中包含 B，就必须先包含 A，因为如果没有 A，B 就是在花费一个不存在的输出，因此是无效的交易。</p><p>如果一个矿工在构造区块时总是孤立地考虑交易给自己带来的好处，她可能会因为前序交易的低手续费而错过后序交易的极高手续费（甚至更糟糕，她可能会创建一个带有无效交易（依赖于未上链交易）的无效区块）。因此，为了最大化自己的利润，在构造新区块时她应该以 <em>交易包</em>（相互依赖的交易的集合）的角度来选择交易。</p><p>钱包可以利用矿工的这种理性行为模式，激励她们将一笔因低手续费而卡住的交易打包上链，办法就是花费这笔卡住交易的一个输出，并提高整个交易包的整体手续费率。</p><h3 id=CPFP-的历史><a href=#CPFP-的历史 class=headerlink title="CPFP 的历史"></a>CPFP 的历史</h3><p>想要利用 CPFP 来追加手续费，有两个前提条件：</p><ul><li>所用的钱包要允许花费未确认交易的输出，从而能提高联合手续费率</li><li>预期矿工会通过考虑交易包来最大化自己的利润</li></ul><p>在 2012 年以前，区块很少是满的，所以也没什么手续费市场可言。Bitcoin Core 的挖矿部分因此没有特别优化以尽可能获得更多手续费。交易首先按照 “优先级”（每个输入的币龄总和（value X coin age），除以交易的体积）排序，并在区块可以打满的时候<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/blob/9b8eb4d6907502e9b1e74b62a850a11655d50ab5/main.h#L586>提高所需的手续费率</a>。Bitcoin Core <a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/1590>PR #1590</a> 改变了挖矿的代码，变成主要按照手续费率对交易排序，同时保留了一些空间给优先级分数较高的交易。因此，2012 年 9 月发布的 <a target=_blank rel=noopener href=https://bitcoin.org/en/release/v0.7.0>Version 0.7.0</a> 是一个主要按照手续费率来排序交易的 Bitcoin Core 版本。</p><p>大约在同一时间，Luke-jr 开始维护<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/1240>一个补丁</a>，它会在排序可加入区块的交易时考虑其子交易的手续费。这个补丁至少被一些矿工使用了，但因为缺少测试和基准测试，以及担心它可能开启针对矿工的 DoS 攻击界面，从未合并到 Bitcoin Core 中。</p><p>更细致考虑交易包的 Bitcoin Core 挖矿代码在 <a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/pull/7600>2016 年</a>更新。这段代码会考虑 25 笔交易以及 101 vkB 以内的交易包。这个更新纳入到了 <a target=_blank rel=noopener href=https://bitcoincore.org/en/releases/0.13.0/#mining-transaction-selection-child-pays-for-parent>V0.13</a>。</p><p>在本文撰写之时（2018 年 11 月），基本上可以确定，大部分矿工都在运行 Bitcoin Core V0.13 或手续版本，或者其衍生软件。因此，钱包可以安全地假设，后代交易的手续费会在祖先交易是否能入块时被考虑进去。</p><h3 id=CPFP-案例研究><a href=#CPFP-案例研究 class=headerlink title="CPFP 案例研究"></a>CPFP 案例研究</h3><p>Holders 比特币交易所（Hodlers Bitcoin Exchange，HBE）有几十万用户，并且每天都有几千笔取款。因为他们每个区块都要发送许多区块支付，他们会每十分钟发起一笔交易，批量处理取款。</p><p>HBE 希望保持客户的手续费低廉，所以他们总是非常设定非常经济的手续费 —— 他们喜欢给出刚刚好足够入块的交易费，不想多给！这就意味着，偶尔，他们的取款交易不会立即得到确认，会卡在交易池中。用户因此会抱怨取款速度慢或者卡住。</p><p>为了提升他们客户的体验，HBE 实现了 CPFP 来为卡住的批量取款交易追加手续费。为此，他们会使用一笔批量区块交易的找零输出作为另一笔取款的第一个输入，并保证第二笔交易会给出足够高的手续费来拉高两笔交易的平均手续费率。如果这还是不足以让交易被打包，他们会使用第二笔批量取款交易的找零输出作为第三笔交易的输入，以此类推。</p><p>在实现 CPFP 系统时，HBE 需要考虑一下几个方面：</p><ul><li>他们需要保证每一笔批量取款交易都有给自己支付的找零输出。如果没有找零输出，那就没法构造子交易来为父交易追加手续费了。</li><li>他们需要仔细测试手续费率计算的逻辑。子交易必须为父交易支付一些手续费，所以他们的算法需要考虑父交易的重量以及已经支付的手续费，这样才能计算平均手续费率。在创建第三代交易乃至第四代交易时，也要有同样的流程。</li></ul><p>总的来说，HBE 非常满意自己的新 CPFP 实现。客服工单减少了，用户一般都不会注意到他们的取款用到了 CPFP 来追加手续费，因为他们取款交易的 id 和输出的索引都不会改变。</p><h3 id=用户体验建议-1><a href=#用户体验建议-1 class=headerlink title=用户体验建议></a>用户体验建议</h3><p>钱包和浏览器应该向用户提供关于交易包的相关信息：</p><ul><li>如果一笔未确认的交易是未确认的交易包的一部分，服务应该允许专业用户看到祖先和后代交易的手续费率，以及整个交易包的手续费率，从而用户能更准确地估计交易包在未来被打包的机会。</li><li>区块浏览器在一笔交易的其中一个输入不是 segwit 类型的时候，会显示这笔交易 “可以变形”。可以变形的交易加入未确认交易的链条可能是不安全的，因为签名变形会作废所有的后代交易。</li></ul><h2 id=RBF-还是-CPFP（还是两者都要）？><a href=#RBF-还是-CPFP（还是两者都要）？ class=headerlink title="RBF 还是 CPFP（还是两者都要）？"></a>RBF 还是 CPFP（还是两者都要）？</h2><p>（待续 8）</p><h3 id=RBF-的优势><a href=#RBF-的优势 class=headerlink title="RBF 的优势"></a>RBF 的优势</h3><p>（待续 9）</p><h3 id=CPFP-的优势><a href=#CPFP-的优势 class=headerlink title="CPFP 的优势"></a>CPFP 的优势</h3><p>（待续 10）</p><h3 id=两者都用><a href=#两者都用 class=headerlink title=两者都用></a>两者都用</h3><p>（待续 11）</p><h3 id=实现问题><a href=#实现问题 class=headerlink title=实现问题></a>实现问题</h3><p>（待续 12）</p><h2 id=结论><a href=#结论 class=headerlink title=结论></a>结论</h2><p>手续费替换和子为父偿都是有用的手续费追加技术。两个各有各的优点和不足，视场景而定，使用其中某种（或两者都用）可能会比另一种要更合适。</p><p>比特币工程师应该熟悉这两种技术，而且比特币的产品和服务应该（在用户用到这些技术时）向用户提供清晰和准确的体验，即使自身并不支持创建 RBF 和 CPFP 交易。</p><h2 id=脚注><a href=#脚注 class=headerlink title=脚注></a>脚注</h2><h3 id=共识，对策和激励兼容><a href=#共识，对策和激励兼容 class=headerlink title=共识，对策和激励兼容></a>共识，对策和激励兼容</h3><p>这篇文章里讨论的两种方案都跟网络中的节点和矿工在一笔交易入块之前的行为模式有关。因此，这些行为模式更多与对策相关，而不是与共识相关。两种解决方案都是跟矿工的激励兼容的 —— 一个想要尽可能获得收益的矿工，既会接受 RBF 替换交易，也会接受 CPFP 交易包。因此个体节点的交易池（是最便于一个节点猜测下个区块的内容的工具）应该也会接受 RBF 替换交易和 CPFP 交易包。</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>