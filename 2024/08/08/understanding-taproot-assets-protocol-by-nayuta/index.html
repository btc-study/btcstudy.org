<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>理解 Taproot Assets 协议</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">理解 Taproot Assets 协议</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>理解 Taproot Assets 协议</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BB%80%E4%B9%88%E6%98%AF-Taproot%EF%BC%9F><span class=toc-text>什么是 Taproot？</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#Taproot-Assets-%E4%B8%AD%E7%9A%84%E8%B5%84%E4%BA%A7%E8%A1%A8%E7%A4%BA><span class=toc-text>Taproot Assets 中的资产表示</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B5%84%E4%BA%A7%E6%A0%91><span class=toc-text>资产树</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%A8%80%E7%96%8F%E9%BB%98%E5%85%8B%E5%B0%94%E6%80%BB%E5%92%8C%E6%A0%91><span class=toc-text>稀疏默克尔总和树</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B5%84%E4%BA%A7%E5%8F%B6%E5%AD%90%EF%BC%88%E8%B5%84%E4%BA%A7-UTXO%EF%BC%89><span class=toc-text>资产叶子（资产 UTXO）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%B5%84%E4%BA%A7%E5%88%9B%E5%BB%BA><span class=toc-text>资产创建</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%B5%84%E4%BA%A7%E8%BD%AC%E7%A7%BB><span class=toc-text>资产转移</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%90%88%E5%B9%B6-UTXO><span class=toc-text>合并 UTXO</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%86%E5%89%B2-UTXO><span class=toc-text>分割 UTXO</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B5%84%E4%BA%A7%E6%B5%81%E8%BD%AC><span class=toc-text>资产流转</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7><span class=toc-text>可扩展性</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>理解 Taproot Assets 协议</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Hiroki Gondo"><div class=page-author-info><strong>Hiroki Gondo</strong><time class=has-text-grey datetime=2024-08-08T10:16:05.000Z>2024-08-08</time></div></div><div class=is-flex><a href=/tags/Taro><i class="page-tag mr-1 px-1">Taro</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Hiroki Gondo</em></p><p><em>来源：<a target=_blank rel=noopener href=https://medium.com/nayuta-engineering-blog-en/understanding-taproot-assets-protocol-e2dfe3fc1e07>https://medium.com/nayuta-engineering-blog-en/understanding-taproot-assets-protocol-e2dfe3fc1e07</a></em></p></blockquote><p>Taproot Assets 协议（曾用名 “Taro”，下文缩写为 “TAP”）是一种在比特币上表示基于 UTXO 的资产的协议。本文致力于解释 TAP 是如何创建和转移资产的。</p><p>完整的协议分成许多部分。本文主要解释的是 bip-tap 和 bit-tap-ms-smt 。</p><ul><li><a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap-addr.mediawiki>bip-tap-addr</a></li><li><a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap-ms-smt.mediawiki>bip-tap-ms-smt</a></li><li><a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap-proof-file.mediawiki>bip-tap-proof-file</a></li><li><a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap-psbt.mediawiki>bip-tap-psbt</a></li><li><a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap-universe.mediawiki>bip-tap-universe</a></li><li><a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap-vm.mediawiki>bip-tap-vm</a></li><li><a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap.mediawiki>bip-tap</a></li></ul><p>Lightning Labs 作出的实现可见<a target=_blank rel=noopener href=https://github.com/lightninglabs/taproot-assets>此处</a>。</p><h2 id=什么是-Taproot？><a href=#什么是-Taproot？ class=headerlink title="什么是 Taproot？"></a>什么是 Taproot？</h2><p>“<a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki>Taproot</a>” 是一种新型的比特币输出，允许同时指定两种类型的花费条件：密钥花费（<code>Key Path</code>）和脚本花费（<code>Script Path</code>）。</p><p><img src=/images/understanding-taproot-assets-protocol-by-nayuta/1_3ZjfJfqZlG3Sr8zCRpDO6g.png alt=1_3ZjfJfqZlG3Sr8zCRpDO6g></p><p><code>Key Path</code>，就像传统的 P2PKH 输出一样，使用一个公钥的签名来花费。在 Taproot 这里也可以使用 Schnorr 签名的密钥聚合（多签名）。</p><p><code>Script Path</code>，则像传统的 P2SH 一样，允许用一种脚本语言编程复杂的花费条件。并且 Taproot 还允许同时指定多个脚本。这些脚本不会直接序列化在 Taproot 输出中，而是会构造成一棵默克尔树、压缩成为一个根哈希值。当输出使用某个脚本来花费时，只需要暴露这一个脚本（而不需要曝光其它脚本）。</p><p>TAP 在 <code>Script Pat</code> 中嵌入数据（“资产树（Asset Tree）”）。这些数据在比特币节点看来是无法解读的，也检测不出来，因为经过了哈希。</p><p><img src=/../images/understanding-taproot-assets-protocol-by-nayuta/1_vHAqoqHoLHQ6DMZ-nFu5Og.png alt=1_vHAqoqHoLHQ6DMZ-nFu5Og></p><h2 id=Taproot-Assets-中的资产表示><a href=#Taproot-Assets-中的资产表示 class=headerlink title="Taproot Assets 中的资产表示"></a>Taproot Assets 中的资产表示</h2><h3 id=资产树><a href=#资产树 class=headerlink title=资产树></a>资产树</h3><p>资产树是一种两级的 “稀疏默克尔总和树” 结构，表达 Taproot Assets 协议。底下的一级表示一种资产（由 “资产 id（<code>asset_id</code>）” 标识）的 UTXO。上一级则聚合来自下一级的树。</p><p><img src=/../images/understanding-taproot-assets-protocol-by-nayuta/1_ykcsSYt_mGNy8uhutO7K7g.png alt=1_ykcsSYt_mGNy8uhutO7K7g></p><p>上一级默克尔树的根哈希值（<code>asset_tree_root)</code>）的值会嵌入一个 Taproot 输出的 <code>Script Path</code> 中，从而承诺这棵树的状态。</p><p>资产的转移还创建一棵新的资产树，并且旧的那一棵也会更新。这可以通过发起新的一笔比特币交易、花费旧的资产树所在的 Taproot 输出来实现；没有满足规范的转移（例如，通胀、重复话费）会被认为是无效的。*</p><p>* 这里用到的方法是一种叫做 “<a target=_blank rel=noopener href=https://scalingbitcoin.org/transcript/milan2016/client-side-validation>客户端验证</a>” 的概念；熟悉比特币的显著共识的读者可能会对这里的规范的正确性的基础感到好奇，但我会暂时忽略这个问题。</p><h3 id=稀疏默克尔总和树><a href=#稀疏默克尔总和树 class=headerlink title=稀疏默克尔总和树></a>稀疏默克尔总和树</h3><p>“稀疏默克尔总和树”（以下将缩写为 “MS-SMT”）是默克尔树的一个变种，由 <a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap-ms-smt.mediawiki>bip-tap-ms-smt</a> 定义。因为其关键字是 256 比特的，所以它有 2^256 个叶子。绝大部分叶子是空的。</p><p>每个叶子都包含一个数量，而每个分支节点都承诺其子树上的叶子所表示的数量之和。即使一棵子树的内容不可知，只需检查分支节点，就可以知道该子树所包含的总数量。树根则承诺所有叶子所表示的总数量。</p><p>就像通用的默克尔树，只需一棵修剪过的、包含目标叶子的树，就可以提供这些目标叶子在树上的证明（默克尔证明）。但 MS-SMT 还支持 “不包含证明”。这是通过一种限制来实现的：表示不存在的关键字的叶子所包含的数量必须显式设定为一个表明其不存在（None）的值（因此，证明 “None” 的存在就构成了一种不包含证明）。因此，默认的 MS-SMT 会由 2^256 个表示 “None” 的叶子。</p><h3 id=资产叶子（资产-UTXO）><a href=#资产叶子（资产-UTXO） class=headerlink title="资产叶子（资产 UTXO）"></a>资产叶子（资产 UTXO）</h3><p>资产树的低层 MS-MST 以 <code>asset_script_key</code> 作为关键字，以资产叶子作为值。每一个资产叶子都代表着该资产的一个 UTXO（为简洁，下文就直接表述为 “UTXO”*），并且，下列属性（包括可选的一个）会被序列化为 <a target=_blank rel=noopener href=https://github.com/lightning/bolts/blob/master/01-messaging.md#type-length-value-format>“类型-长度-数值” 格式</a>。</p><p>* 不是比特币的 UTXO 哈。</p><ul><li><code>taproot_asset_version</code></li><li><code>asset_genesis</code></li><li><code>asset_id</code></li><li><code>asset_type</code></li><li><code>amt</code></li><li><code>lock_time</code></li><li><code>relative_lock_time</code></li><li><code>prev_asset_witnesses</code><br>- <code>prev_asset_id</code><br>- <code>asset_witness</code><br>- <code>split_commitment_proof</code></li><li><code>split_commitment</code></li><li><code>asset_script_version</code></li><li><code>asset_script_key</code></li><li><code>asset_group_key</code></li><li><code>canonical_universe</code></li></ul><p><code>asset_genesis</code> 就是推导出 <code>asset_id</code> 的原像。</p><p><code>asset_script_key</code> 既是资产叶子的关键字，也是一个 Taproot 形式的公钥（以一个独立于比特币的 <a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap-vm.mediawiki>tap-vm</a> 定义），并且是花费由该资产叶子表示的 UTXO 的条件。</p><p>在花费一个 UTXO 时，首先要满足（外部的）比特币花费条件，然后是（内部的）TAP 花费条件，由 <code>asset_script_key</code>指定，并且 <code>asset_script_key</code> 应该被 <code>prev_asset_id</code> 和 <code>asset_witness</code> 满足。举个例子，<code>asset_witness</code> 是被花费的 UTXO 的 <code>asset_script_key</code> 的签名。</p><p><img src=/../images/understanding-taproot-assets-protocol-by-nayuta/1_8yCJofequ55HYKSPG1Gb-Q.png alt=1_8yCJofequ55HYKSPG1Gb-Q></p><p>如果在一次资产转移中分割了 UTXO，也需要 <code>split_commitment</code> 和 <code>split_commitment_proof</code>。</p><p><code>split_commitment</code> 是一棵 MS-SMT，指代分割之后的所有 UTXO（在这个意义上，资产树其实有三层），而根中的和值是被转移的所有数量。</p><p><code>split_commitment_proof</code> 是 <code>split_commitment</code> 的一个默克尔证据，证明一次分割的存在。</p><p>在所有分割中，只有一个会有 <code>prev_asset_id</code>、<code>asset_witness</code> 和 <code>split_commitment</code>。所有其它分割只有 <code>split_commitment_proof</code>。所有的分割共享 <code>prev_asset_id</code> 和 <code>asset_witness</code>。</p><h2 id=资产创建><a href=#资产创建 class=headerlink title=资产创建></a>资产创建</h2><p><img src=/../images/understanding-taproot-assets-protocol-by-nayuta/1_6Tu6LHxuI1gTzOIKHf04zg.png alt=1_6Tu6LHxuI1gTzOIKHf04zg></p><p>创建一种资产需要在一笔比特币交易的一个 Taproot 输出中嵌入一棵包含新资产的 UTXO 的新的资产树（该交易也就成为这种资产的创世交易）。资产的 ID（<code>asset_id</code>）以下列公式确定。</p><pre><code>asset_id := sha256(genesis_outpoint || sha256(asset_tag) || asset_meta_hash || output_index || asset_type)
</code></pre><p><code>genesis_outpoint</code> 就是被这笔交易花费的前序交易输出，而 <code>output_index</code> 就是包含这棵资产树的输出的索引号。这保证了 <code>asset_id</code> 是全局唯一的。</p><p>新创建的资产 UTXO 省去了 <code>prev_asset_id</code> 和 <code>asset_witness</code>。</p><h2 id=资产转移><a href=#资产转移 class=headerlink title=资产转移></a>资产转移</h2><p>就像比特币 UTXO，资产转移时可能会合并或分割资产 UTXO。但我们先从一个简单的例子 —— 既没有分割，也没有合并 —— 说起 *。</p><p>* 下文的解释作了一些简化。比如，比特币交易的找零输出，就省去了。</p><p><img src=/../images/understanding-taproot-assets-protocol-by-nayuta/1_k9uQ2Brglnx-HOPaqVTupg.png alt=1_k9uQ2Brglnx-HOPaqVTupg></p><p>Alice 有 10 个某资产，全部转移给 Bob。</p><p>Alice 创建并广播一笔比特币交易，花费自己的资产 UTXO 所在的 Taproot 输出。这笔交易有两个 Taproot 输出。一个输出包含了一棵新的资产树，包含了一个新的拥有 10 个某资产、且 Bob 可以控制（比如使用 Bob 的比特币公钥）的 UTXO。另一个输出包含了一棵资产树，是由 Alice 控制的原版资产树移除对应的资产叶子后形成的。</p><p>属于 Bob 的新 UTXO 用 <code>prev_asset_id</code> 来索引 Alice 的前序 UTXO。在 <code>asset_witness</code> 中，放着前序 <code>asset_script_key</code> 的签名。而在这个新 UTXO 的 <code>asset_script_key</code> 中，放着一个新的、由 Bob 提前给出的公钥。</p><p>Bob 需要验证花费条件得到了满足，而且资产在转移后没有通胀，以确认接收这笔支付。</p><ul><li>Bob 新创建的资产树是否包含了一个满足花费条件的新的 UTXO ？</li><li>输入 UXTO 是否已经在 Alice 更新后的资产树上移除了？</li><li>交易中是否有别的 Taproot 输出？它们是否包含另一棵资产树？*</li><li>等等。</li></ul><p>这都是通过 证明&#x2F;验证 MS-SMT 的 包含&#x2F;非包含证据 以及 Taproot 输出的证据和原像来实现的。</p><p>* 如果另一个 UTXO 被添加到了另一棵资产树（而不是 Bob 的资产树）上，并且也花费了输入 UTXO，那就构成了重复花费。</p><h3 id=合并-UTXO><a href=#合并-UTXO class=headerlink title="合并 UTXO"></a>合并 UTXO</h3><p><img src=/../images/understanding-taproot-assets-protocol-by-nayuta/1_2vwC4q_3DOb0R8fs7RXxJQ.png alt=1_2vwC4q_3DOb0R8fs7RXxJQ></p><p>Alice 有在两个叶子中分别有 3 个、7 个某资产，要全部转移给 Bob。</p><p>各个输入 UTXO 可以属于不同的资产树，或同一资产树上的不同关键字（<code>asset_script_key</code>）。Bob 的新 UTXO 应该为这两个花费掉的 UTXO 包含 <code>prev_asset_id</code> 和 <code>asset_witness</code>。</p><h3 id=分割-UTXO><a href=#分割-UTXO class=headerlink title="分割 UTXO"></a>分割 UTXO</h3><p><img src=/../images/understanding-taproot-assets-protocol-by-nayuta/1_mmoYchmgOBsa_MUKPOlbwg.png alt=1_mmoYchmgOBsa_MUKPOlbwg></p><p>Alice 有 7 个某资产，准备转 3 个给 Bob。因此，Alice 会留下 3 个，Bob 会得到 7 个。</p><p>Alice 的找零 UTXO 将有 <code>prev_asset_id</code>、<code>asset_witness</code> 和 <code>split_commitment</code>；Bot 的新 UTXO 将仅有 <code>split_commitment_proof</code> *。</p><p>我不会再解释如何同时合并及分割 UTXO。</p><p>* 这跟<a target=_blank rel=noopener href=https://github.com/Roasbeef/bips/blob/bip-tap/bip-tap.mediawiki>规范</a>的表述稍有区别，但似乎最新的<a target=_blank rel=noopener href=https://github.com/lightninglabs/taproot-assets>实现</a>就是这么做的。</p><h3 id=资产流转><a href=#资产流转 class=headerlink title=资产流转></a>资产流转</h3><p>虽然前面没有体积，但在资产转移可被验证之前，必须先验证每一个输入 UTXO 都是合法的。对于每一个输入 UTXO，必须 证明&#x2F;验证 从该资产的创世交易到如今这个输入、整个流转路径上的每一笔交易，都是正确执行的。</p><p><img src=/../images/understanding-taproot-assets-protocol-by-nayuta/1_6Z-NG7a7zjf1H7hGekaU6g.png alt=1_6Z-NG7a7zjf1H7hGekaU6g></p><p>这条路径是从创世交易到最新交易的一个复杂的图。在上图中，对 <code>Tx A</code>，需要验证所有蓝色的交易（其祖先交易）；而对 <code>Tx B</code>，需要验证所有蓝色和红色交易。这是重大的可扩展性挑战，因为历史会呈准指数级增长。</p><p>此外，因为验证所需的原像和证据是没有发布在区块链上的，如何在资产的发送者和接收者之间传递它们，也是一个问题。</p><h2 id=可扩展性><a href=#可扩展性 class=headerlink title=可扩展性></a>可扩展性</h2><p>逐渐增加的历史是一个重大的可扩展性挑战。已经提出了多种解决方案，但支持闪电网络是最有希望的一个。链下的交易不会使历史增加。</p><p>这套协议是新的，规范也不完整。举个例子，我此前就指出了<a target=_blank rel=noopener href=https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-October/021047.html>这个问题</a>。</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>