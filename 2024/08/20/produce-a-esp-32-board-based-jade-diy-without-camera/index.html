<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>使用 ESP32 开发板自制 Jade 签名器</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">使用 ESP32 开发板自制 Jade 签名器</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>使用 ESP32 开发板自制 Jade 签名器</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%AE%80%E4%BB%8B%EF%BC%9ADIY-%E7%9A%84-Jade><span class=toc-text>简介：DIY 的 Jade</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%A1%AC%E4%BB%B6%E6%8C%91%E9%80%89><span class=toc-text>硬件挑选</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%BF%9E%E6%8E%A5%E7%A1%AC%E4%BB%B6><span class=toc-text>连接硬件</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7><span class=toc-text>安装开发工具</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%8B%E8%BD%BD-Jade-%E6%BA%90%E4%BB%A3%E7%A0%81><span class=toc-text>下载 Jade 源代码</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BC%96%E8%AF%91%E7%83%A7%E5%BD%95%E5%9B%BA%E4%BB%B6><span class=toc-text>编译烧录固件</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8F%90%E5%89%8D%E5%87%86%E5%A4%87><span class=toc-text>提前准备</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%9E%E9%AA%8C%E6%80%A7%E7%83%A7%E5%BD%95><span class=toc-text>实验性烧录</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%89%E5%85%A8%E7%83%A7%E5%BD%95><span class=toc-text>安全烧录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9B%B4%E6%96%B0%E5%9B%BA%E4%BB%B6><span class=toc-text>更新固件</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97><span class=toc-text>操作指南</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90><span class=toc-text>安全分析</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%87%B4%E8%B0%A2><span class=toc-text>致谢</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>使用 ESP32 开发板自制 Jade 签名器</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt=Anony><div class=page-author-info><strong>Anony</strong><time class=has-text-grey datetime=2024-08-20T15:15:00.000Z>2024-08-20</time></div></div><div class=is-flex><a href=/tags/%E5%AE%9E%E8%B7%B5><i class="page-tag mr-1 px-1">实践</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Anony</em></p></blockquote><p>本文介绍了一种在 Windows 电脑上给 ESP32 开发板烧录固件、从而制作出 Jade-DIY 硬件签名器的方法。</p><p><img src=/images/produce-a-esp-32-board-based-jade-diy-without-camera/Jade-DIY-T-Display.jpg alt=Jade-DIY-T-Display></p><h2 id=简介：DIY-的-Jade><a href=#简介：DIY-的-Jade class=headerlink title="简介：DIY 的 Jade"></a>简介：DIY 的 Jade</h2><p>关于 Blockstream 公司推出的 Jade 硬件签名器，Mi Zeng 提供了一份<a href=https://www.btcstudy.org/2023/03/14/review-blockstream-jade-signer-by-mi-zeng/ >详尽的评测</a>。该评测介绍了 Jade 硬件签名器的安全模型，以及一些具有特色的安全功能。</p><p>因为 Jade 的固件是完全开源的，我们只需基于与正式版 Jade 相同的硬件，就可以制作出功能相同的硬件签名器（在下文中，我们将分别称为 “正式版 Jade” 和 “Jade-DIY”）。</p><p>经过测试，我们发现，尽管某一些 Jade-DIY 在功能上无法做到与正式版 Jade 完全相同（下文就会讲到其中一个原因：硬件基础），但在安全特性上，Jade-DIY 跟正式版 Jade 是一样的。正式版 Jade 所具备的安全特性（如：“虚拟安全芯片”、自我擦除 PIN 码），Jade-DIY 都具有。这为 Jade-DIY 赋予了巨大的吸引力，因为可以使用相当便宜的硬件来制作签名器。</p><p>而且，Jade-DIY 在基本功能上非常扎实，绝不逊色于现在市场上主流的签名器。</p><h2 id=硬件挑选><a href=#硬件挑选 class=headerlink title=硬件挑选></a>硬件挑选</h2><p>在 Jade 的 <a target=_blank rel=noopener href=https://github.com/Blockstream/Jade>GitHub 库</a>中，有一个<a target=_blank rel=noopener href=https://github.com/Blockstream/Jade/tree/master/diy>专门的页面</a>，介绍了可以制作成 Jade-DIY 签名器的硬件。读者需要关注的有两个方面：（1）是否配备摄像头，这也是该页面分类的依据；（2）硬件本身的 USB VendorID 和 ProductID 与正式版的 Jade 是否一致。</p><p>后者决定了当我们使用 USB 连接制作好的 Jade-DIY 时，软件钱包会不会将它识别成 Jade。如果不会，则使用起来会更麻烦。不过，这些硬件基本上都支持蓝牙，因此总可以使用蓝牙来连接签名器（如果软件签名器支持的话，比如移动端的 <a target=_blank rel=noopener href=https://blockstream.com/green/ >Green Bitcoin Wallet</a>）。此外，如果你选择使用配有摄像头的硬件，则总是可以使用 Air-gapped（隔空交互）的交互方式（主要就是扫码），因此不必再介意这个问题。</p><p><strong>本教程只针对没有摄像头的硬件</strong>。在这些硬件中，USB VendorID 和 ProductID 与零售正式版 Jade 一致的有（空格前是品牌名，空格后是型号）：</p><ul><li>LILYGO T-Display</li><li>M5Stack Basic Core</li><li>M5Stack FIRE</li></ul><p>出于经济性的考虑，笔者选择了 T-Display。在笔者购买之时，其本身的价格只需 65 元。读者在采购时，应注意不要与 T-Display S3 相混淆。笔者购买的是编号为 Q125 的版本，为使用便利，可以单独购买一个外壳（12 元）。<a target=_blank rel=noopener href="https://github.com/epiccurious/jade-diy?tab=readme-ov-file#ttgo-t-display">据说</a>自带外壳的 K164 版本也可以制作成功。</p><p>下文就将以 T-Display 为示范。另外两款硬件与 T-Display 使用相同的芯片，因此其刷机流程的相似的。</p><h2 id=连接硬件><a href=#连接硬件 class=headerlink title=连接硬件></a>连接硬件</h2><p>T-Display 的 USB 连接口是 Type-C 型的，读者应另外准备好 Type-C 的 USB 连接线。连接 T-Display 之后，观察其能否正常启动。正常情况下，它会先显示 “LILYGO” 的图标，然后出现 “SD card mount failed” 的警示语。</p><p>然后，打开 Windows 的 “设备管理器”，查看 “端口（COM 和 LPT）” 项下是否有 “USB-Enhanced SERIAL CH9102 (COM3)” 一项。如无，则说明未正常连接，应该安装<a target=_blank rel=noopener href=https://www.wch.cn/downloads/CH343SER_EXE.html>驱动</a>。下载并安装驱动后，尝试再次连接。</p><p>如果你安装驱动后依然无法连接，请尝试换一根 USB 连接线（有一些连接线只有供电功能，而没有数据传输功能）。</p><p><img src=/../images/produce-a-esp-32-board-based-jade-diy-without-camera/Jade-DIY-1.png alt=Jade-DIY-1></p><blockquote><p>上面提到的两款 M5Stack 硬件与 T-Display 使用相同的 USBT 芯片，因此可以用相同的方式检验连接。</p></blockquote><h2 id=安装开发工具><a href=#安装开发工具 class=headerlink title=安装开发工具></a>安装开发工具</h2><p>在<a target=_blank rel=noopener href=https://dl.espressif.com/dl/esp-idf/ >ESP-IDF 的网站</a>下载开发工具，请下载 “ESP-IDF v5.2.2 - Offline Installer”。打开安装程序后，在选择安装内容的页面，应该：（1）安装 “Powershell 支持”；（2）在 “Chip Targets” 中，至少安装 “ESP32” 和 “ESP32-S3”。（第一项 “Framework” 和第二项 “ESP-IDF 5.2” 一定不能省去）。</p><p><img src=/../images/produce-a-esp-32-board-based-jade-diy-without-camera/Jade-DIY-2.png alt=Jade-DIY-2></p><p>安装好之后，尝试在新的 PowerShell 窗口的菜单栏中，点击 “+” 号，选择 “ESP-IDF 5.2”，打开一个 ESP-IDF 环境。如果你的 PowerShell 窗口并不如图所示，则请尝试使用别的方式（比如 “开始” 菜单</p><p><img src=/../images/produce-a-esp-32-board-based-jade-diy-without-camera/Jade-DIY-3.png alt=Jade-DIY-3></p><h2 id=下载-Jade-源代码><a href=#下载-Jade-源代码 class=headerlink title="下载 Jade 源代码"></a>下载 Jade 源代码</h2><p>首先，请确保自己安装了 <a target=_blank rel=noopener href=https://git-scm.com/download/win>Git 软件</a>。这是一种版本控制工具，可用于下载开源软件的源代码。</p><p>在一个你喜欢的文件夹中，打开 PowerShell 窗口，输入以下命令并运行：</p><pre><code>git clone --recursive https://github.com/Blockstream/Jade.git
</code></pre><p>这行命令会新建一个 “Jade” 文件夹，并下载 Jade 源代码。</p><p>接下来是本教程最重要的章节。</p><h2 id=编译烧录固件><a href=#编译烧录固件 class=headerlink title=编译烧录固件></a>编译烧录固件</h2><p>在烧录固件时，可以选择启用或不启用 “Secure Boot”。Secure Boot 的功能是给设备注入一个公钥，并要求烧入的固件具备该公钥的签名。如果烧入的固件不具备有效的签名，则设备会拒绝启动。这是一种有用的安全措施，可以防止自己的设备被他人注入带有恶意代码的固件。Jade 源代码库中的 DIY 指南也推荐启用 Secure Boot 功能。因此，本教程也强烈建议启用 Secure Boot 功能。</p><p>下文的 “实验性烧录” 章节将介绍不启用 Secure Boot 的烧录流程；顾名思义，这主要是为了让读者熟悉刷机的流程。而 “安全烧录” 将介绍启用 Secure Boot 的烧录流程。</p><p>注意，此处介绍的启用 Secure Boot 的操作是不可逆的，一旦启用，就无法取消。也即此后如果想要更新设备的固件，也必须使用相同的私钥、签名新的固件，才能刷入。弄丢这个签名固件的私钥将无法再给这个设备更新固件。</p><h3 id=提前准备><a href=#提前准备 class=headerlink title=提前准备></a>提前准备</h3><p><strong>CMD 中的 Python3</strong></p><p>在开始烧录之前，请先打开电脑的 “命令提示符（CMD）”，输入 <code>python3</code> 并回车执行。如果它正确识别及执行，应该能在窗口中看到这样的信息：</p><pre><code>Python 3.12.3 (tags/v3.12.3:f6650f9, Apr  9 2024, 14:05:25) [MSC v.1938 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;
</code></pre><p>如果程序的反应是打开 Windows 商店，说明 CMD 在得到命令 “python3” 时无法正确识别并执行 python 的对应版本，这会导致后续编译中出现一个错误。必须修复这个错误。一种奇怪但有效的办法是在你的 Python 文件夹中复制 “python.exe”，并粘贴到同一文件夹，然后将副本重命名为 “python3.exe”。</p><blockquote><p>给出这个提醒是因为在笔者使用的两台 Windows 电脑（系统分别是 Win10 和 Win11）上，都出现了由此引发的编译错误。</p></blockquote><p><strong>ESP-IDF 运行环境的运行文件夹</strong></p><p>在任意文件夹中打开 “ESP-IDF 5.2” 运行环境；打开之后，它会自动运行一系列环境设置，以保证我们可以使用 ESP-IDF 的功能。运行成功后，它会输出一系列信息，末尾是这样的：</p><pre><code>Go to the project directory and run:
    idf.py build
</code></pre><p>ESP-IDF 的初始运行环境是其安装文件夹，比如说： <code>~\Espressif\frameworks\esp-idf-v5.2.2</code> ，我们需要使用 <code>cd</code> 命令，切换到 “Jade” 文件夹。假设你的 “Jade” 文件夹的地址是 <code>D:\esp\Jade</code>，那么就在 ESP-IDF 运行环境中输入：</p><pre><code>cd D:\esp\Jade
</code></pre><p>最终，你的运行环境的开头应该是这样的：<code>PS D:\esp\Jade&gt;</code> 。</p><p><strong>OpenSSL</strong></p><p>为了生成足够安全的用于签名固件的私钥，请安装 <a target=_blank rel=noopener href=https://slproweb.com/products/Win32OpenSSL.html>OpenSSL 软件</a>。</p><h3 id=实验性烧录><a href=#实验性烧录 class=headerlink title=实验性烧录></a>实验性烧录</h3><p>在位于 “Jade” 文件夹的 ESP-IDF 运行环境中输入以下命令：</p><pre><code>cp configs/sdkconfig_display_ttgo_tdisplay.defaults sdkconfig.defaults
</code></pre><p>这行命令的作用是从 “configs”文件夹中复制一个配置文件，到 “Jade” 文件夹中。需要复制的配置文件当然是因设备而定的，这里提供的是 T-Display 的配置文件。</p><blockquote><p>如果你使用的硬件是 “M5Stack Basic Core”，则命令要改成:</p><pre><code>cp configs/sdkconfig_display_m5blackgray.defaults sdkconfig.defaults
</code></pre></blockquote><p>然后，运行以下命令：</p><pre><code>idf.py build
idf.py flash monitor
</code></pre><p>第一行命令会将文件夹内的源代码编译成可以烧录进入 T-Display 的固件，第二行则实际写入，并在刷机成功后让 T-Display 重启。</p><p>以上就是实验性刷入的过程。你可以把玩一下，看看 Jade-DIY 的功能。</p><blockquote><p>如果你在刷机过程中出错，导致 T-Display 无法正常开机、也无法连接电脑，那么可以尝试<a target=_blank rel=noopener href=https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32/get-started/flashing-troubleshooting.html>这个页面</a>介绍的操作：尝试先断开连接线，然后同时按住机身的三个按钮，然后重新连接电脑。</p></blockquote><h3 id=安全烧录><a href=#安全烧录 class=headerlink title=安全烧录></a>安全烧录</h3><p><strong>生成配置文件</strong></p><p>在位于 “Jade” 文件夹的 ESP-IDF 运行环境中输入以下命令：</p><pre><code>./tools/mkdefaults.py ./configs/sdkconfig_display_ttgo_tdisplay.defaults NDEBUG SECURE
</code></pre><p>运行后，在 “Jade” 文件夹里检查是否有 <code>sdkconfig</code>、<code>sdkconfig.defaults</code> 和 <code>sdkconfig.defaults.orig</code> 三个文件。</p><p>使用 “记事本” 打开 <code>sdkconfig.defaults</code> 文件，寻找其中是否有这几行：</p><pre><code>CONFIG_SECURE_BOOT=y
CONFIG_ESP32_REV_MIN_3=y
</code></pre><p>如果没有这几行内容，或者没有上述三个文件，请重复运行上述命令。</p><p><strong>生成签名固件的私钥</strong></p><p>然后，在 ESP-IDF 运行环境中运行以下命令、使用 OpenSSL 软件生成用于签名固件的私钥：</p><pre><code>openssl genrsa -out ../jade-diy-v2.pem 3072
</code></pre><p>该行会在 “Jade” 文件夹的上级文件夹中生成一个名为 <code>jade-diy-v2.pem</code> 的私钥，该私钥将用在固件的签名中。</p><p>你可以使用别的文件名称，也可以指定另一个文件夹。但这就需要你回过头修改 <code>sdkconfig.defaults</code> 文件中 <code>CONFIG_SECURE_BOOT_SIGNING_KEY=</code> 一行中的相对地址。从便利和安全的角度出发，可以按上述命令生成私钥；在完成烧录后，将该私钥移动到其它相对隐蔽的地方；当以后需要升级固件时，再将私钥放回原位、签名固件并烧录。</p><p><strong>生成引导加载程序和固件</strong></p><p>在 ESP-IDF 运行环境中运行以下命令：</p><pre><code>idf.py bootloader
idf.py build
</code></pre><p>第一行会生成引导加载程序。该程序负责执行 Secure Boot 的功能。第二行则生成执行实际功能的固件。</p><p>在运行第一行命令时，程序可能无法成功运行，因为 <code>SDKCONFIG_DEFAULTS &#39;~/Jade/sdkconfig.defaults.tmp&#39; does not exist</code> 。这时候，往往只需再次运行上文 “<a href=#%E7%94%9F%E6%88%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6>生成配置文件</a>” 一节中的命令，就可以生成所需的 <code>sdkconfig.defaults.tmp</code> 文件。</p><p><strong>写入引导加载程序</strong></p><p>在启用 Secure Boot 之后，ESP-IDF 不会再自动刷入引导加载程序，因此，我们需要手动刷入。</p><p>在 ESP-IDF 运行环境中运行这条命令：</p><pre><code>esptool.py write_flash --erase-all 0x1000 ./build/bootloader/bootloader.bin
</code></pre><p>在这里，<code>--erase-all</code> 的意思是清空闪存中的全部内容（如果你在此前尝试过实验性烧录，可能需要这个标签）；而后面的 <code>0x1000</code> 则代表写入闪存的位置，后面则是待写入的 引导程序的文件位置。</p><p>合理的写入位置可能因设备而不同，如果你并不使用 T-Display，请仔细阅读 <code>idf.py bootloader</code> 命令运行过程中出现在屏幕上的内容，它将提示你： <code>Secure boot enabled...</code>（启用了 Secure boot，因此引导程序不会自动烧录）；再下面就是一行能够执行的命令，包含 <code>python.exe</code>、<code>esptool.py</code> 字样。可以复制该行命令来代替上面这行命令，也可以在该行命令中找出 <code>0x</code> 开头的、表示闪存地址的字符，替换掉上文命令的 <code>0x1000</code> 然后执行。</p><p>如果你无法运行这行命令，则你可能是未正确安装 <code>esptool</code>，可以尝试运行 <code>pip install esptool</code> 来解决。</p><p><strong>写入固件</strong></p><p>在 ESP-IDF 运行环境中运行以下命令：</p><pre><code>idf.py flash
idf.py monitor
</code></pre><p>在运行第二行时，如果长时间运行不结束，可以同时按下键盘上的 “Ctrl” 和 “]” 键主动结束。看看 T-Display（现在应该叫 “Jade-DIY” 了）能否正常启动。可尝试按下设备顶部的重启按钮。</p><p>安全烧录，完成！</p><h2 id=更新固件><a href=#更新固件 class=headerlink title=更新固件></a>更新固件</h2><p>连接 Jade-DIY，在 “Jade” 文件夹下的 ESP-IDF 运行环境中，运行 <code>python jade_ota.py --noagent</code> 来更新固件。该过程可能需要安装一些 python 的依赖，使用 <code>pip install</code> 来解决。</p><p>目前，T-Display 可用的最新固件版本是 <code>1.0.31</code>，相对于正式版 Jade 的固件是落后的。</p><h2 id=操作指南><a href=#操作指南 class=headerlink title=操作指南></a>操作指南</h2><ul><li>T-Display 机身一共有三个按键。在操作 Jade-DIY 时，机身顶部的按钮是 “重启” 键；单独按下机身的两个按钮，可以移动屏幕上的光标；确认选择时，则要同时按下这两个按钮。</li><li>在初始化 Jade-DIY（“Setup Jade”）时，Jade-DIY 会要求你设置一个 6 位数的数字 PIN 码。该 PIN 码在安全上极为关键。但是，要解锁、使用 Jade-DIY 时，必须先使用一款适配的软件钱包唤起 Jade-DIY，才能输入 PIN 码、解锁。<ul><li>这样的软件钱包有：桌面端：<a target=_blank rel=noopener href=https://sparrowwallet.com/ >Sparrow Wallet</a>、<a target=_blank rel=noopener href=https://electrum.org/ >Electrum Wallet</a>；移动端：<a target=_blank rel=noopener href=https://blockstream.com/green/ >Green Wallet</a>。Jade-DIY 可用 USB 连接电脑，用蓝牙连接手机。Jade-DIY 的蓝牙功能默认关闭，需要手动开启。</li></ul></li><li>连接到软件钱包后，使用体验就跟主流的硬件签名器没有多大区别。当需要签名交易时，交易的详细信息将在屏幕上显示。</li><li>解锁 Jade-DIY 之后，可以在 “Duerase PIN” 中设置 “自我擦除 PIN 码”。设置好之后，一旦在解锁时输入这个 PIN 码，将删除设备内的所有内容（包括加密的种子词）。</li><li>Jade-DIY 具备绝大多数 bitcoin-only 签名器的功能，单签、多签都不在话下。</li></ul><h2 id=安全分析><a href=#安全分析 class=headerlink title=安全分析></a>安全分析</h2><p>Jade-DIY 的安全模型是什么样的？</p><p>在本教程中，笔者介绍了启用 Secure Boot 的刷机流程；Secure Boot 是一项非常重要的安全措施，可以应对 Jade-DIY 被注入恶意固件的风险。这种风险是真实的，目前，几乎所有的硬件签名器都提供了这一方面的防护（比如 Keystone，在升级固件的时候也会校验固件有无签名）。</p><p>应用 Secure Boot 之后，经过测试，我们认为 Jade-DIY 的安全性跟正式版 Jade 是一样的。那么正式版 Jade 的安全性又如何？</p><p>如本文开头提到的 <a href=https://www.btcstudy.org/2023/03/14/review-blockstream-jade-signer-by-mi-zeng/ >Mi Zeng 的评测</a>所说的，Jade 以 “虚拟安全芯片” 的设计，来处理 “<a target=_blank rel=noopener href=https://twitter.com/zengmi2140/status/1616069454772994049>安全芯片 vs. 开源</a>” 的取舍：在加密保存种子词的过程中，Jade 使用了来自一个远程服务器的密钥（与本地的 PIN 码共同加密种子词）。而在解锁 Jade 的过程中，只有提供设置好的 PIN 码，才能让适配的软件钱包跟远程服务器通信、获得这个密钥。（这也是为什么在使用其本身保存的种子词时，必须跟适配的软件钱包一起工作）。</p><p>因此，这种模式的安全性，是大于完全不使用安全芯片、也没有额外设计的硬件签名器的（比如较早版本的 Trezor 签名器）。</p><p>不过，与使用了安全芯片并附加了自毁机制（拆机自毁、无效 PIN 码输入达一定次数后自毁）的签名器相比，Jade 在应对设备被劫持之后的物理攻击时稍显不如。</p><p>总的来说，Jade-DIY 以较低的成本，提供了相当不错的安全性，也提供了足够强大的功能。</p><p>开源运动万岁！</p><h2 id=致谢><a href=#致谢 class=headerlink title=致谢></a>致谢</h2><p>感谢 Mi Zeng 在本文撰写阶段给出的有益指引和探讨，当然，文中一切错误由我自己负责。</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>