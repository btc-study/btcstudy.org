<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>CSFS 密钥串联及其在 LN-Symmetry 中的应用</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">CSFS 密钥串联及其在 LN-Symmetry 中的应用</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>CSFS 密钥串联及其在 LN-Symmetry 中的应用</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%8D%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AE%9A%E4%B9%89><span class=toc-text>不常用的定义</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%B2%97%E7%B3%99%E7%9A%84-CTV-CSFS-LN-Symmetry-%E4%BA%A4%E6%98%93><span class=toc-text>粗糙的 CTV-CSFS LN-Symmetry 交易</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#APO-annex-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88><span class=toc-text>APO-annex 解决方案</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%B2%97%E7%B3%99-CTV-CSFS-%E9%80%9A%E9%81%93%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88><span class=toc-text>粗糙 CTV-CSFS 通道的解决方案</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#CTV-CSFS-%E5%A7%94%E6%89%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88><span class=toc-text>CTV-CSFS 委托解决方案</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#CSFS-%E5%AF%86%E9%92%A5%E9%98%B6%E6%A2%AF><span class=toc-text>CSFS 密钥阶梯</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#CTV-CSFS-%E4%B8%8E%E6%B4%BE%E7%94%9F%E5%86%85%E9%83%A8%E5%85%AC%E9%92%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88><span class=toc-text>CTV-CSFS 与派生内部公钥解决方案</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BB%93%E8%AE%BA><span class=toc-text>结论</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>CSFS 密钥串联及其在 LN-Symmetry 中的应用</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Jeremy Rubin"><div class=page-author-info><strong>Jeremy Rubin</strong><time class=has-text-grey datetime=2025-07-28T07:41:36.000Z>2025-07-28</time></div></div><div class=is-flex><a href=/tags/CSFS><i class="page-tag mr-1 px-1">CSFS</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Jeremy Rubin</em></p><p><em>来源：<a target=_blank rel=noopener href=https://rubin.io/bitcoin/2024/12/02/csfs-ctv-rekey-symmetry/ >https://rubin.io/bitcoin/2024/12/02/csfs-ctv-rekey-symmetry/</a></em></p><p><em>本文与 <a target=_blank rel=noopener href=https://twitter.com/reardencode>Rearden</a> 联名发表。</em></p><p>原文发表于 2024 年 12 月。</p></blockquote><p>在今年的 Bitcoin++ 奥斯丁会议上，Rearden 展示了使用多种比特币升级提议来实现的 Lightning Symmetry 的多种方法。所有的方法都要么需要为每一次通道更新多执行一轮签名交易，要么需要强迫结算交易的哈希值暴露在对应的更新交易中。可以总结为：要求为给定的一条通道授权的签名即是可以重新绑定的（rebindable，即不会承诺具体的前序 UTXO），又承诺了一些额外的可见数据，以使该签名有效。</p><p>（译者注：“LN-Symmetry” 即 “对称式闪电通道”。当前正在服役的构造被称为 “LN-Penalty”，基于惩罚使得通道不敢提交旧状态到区块链上，而对应于每一个通道状态，双方所持有的承诺交易都是不对称的。LN-Symmetry 则希望让双方的承诺交易是完全对称的。LN-Symmetry 的思想是使用两笔交易来结算一条通道：更新交易及与之匹配的结算交易；当较旧的更新交易总是可以被较新的更新交易花费，则双方只需保存最新的一对更新交易和结算交易即可保证通道正确结算。）</p><p>我们将从探究为什么 LN-Symmetry 需要这种数据可见性开始，然后深入以往已知解决方案的细节，并展示一种新的通用技术，在两个乃至更多变种中使用 CSFS 。最后，我们基于已经推导出的原理，提出一种最优的解决方案，让 LN-Symmetry 使用额外的一个签名，但不需要额外的交互轮次，而且不需要字符串拼接（concatenation）和其它显式的多重承诺（multi-commitments）。</p><h2 id=不常用的定义><a href=#不常用的定义 class=headerlink title=不常用的定义></a>不常用的定义</h2><ul><li><code>APO</code>：<a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0118.mediawiki>BIP118</a> 所定义的 <code>SIGHASH_ANYPREVOUT</code></li><li><code>IKEY</code>：<a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0349.md>BIP349</a> 所定义的 <code>OP_INTERNALKEY</code></li><li><code>CSFS</code>：<a target=_blank rel=noopener href=https://github.com/bitcoin/bips/pull/1535>BIP348</a> 所定义的 <code>OP_CHECKSIGFROMSTACK</code></li><li><code>S</code>：<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/blob/master/src/script/script.h#L47>比特币协议自身定义的</a>时间锁门槛 <code>500,000,000</code></li></ul><h2 id=粗糙的-CTV-CSFS-LN-Symmetry-交易><a href=#粗糙的-CTV-CSFS-LN-Symmetry-交易 class=headerlink title="粗糙的 CTV-CSFS LN-Symmetry 交易"></a>粗糙的 CTV-CSFS LN-Symmetry 交易</h2><p>一个粗糙的 Taproot LN-Symmetry 通道的脚本是这样的：</p><pre><code>通道:
tr(musig(keyA, keyB), raw(CTV IKEY CSFS VERIFY &lt;S+1&gt; CLTV))
update(n):
tr(musig(keyA, keyB), raw(DEPTH NOTIF &lt;settlement-n-hash&gt; CTV ELSE CTV IKEY CSFS VERIFY &lt;S+n+1&gt; CLTV ENDIF))
update-stack:
&lt;update-n-sig&gt; &lt;update-n-hash&gt;
</code></pre><p>（译者注：<code>update-stack</code> 中的见证数据让通道参与者可以花费通道输出，将对应于通道的第 n 个状态的更新交易发布到链上；这样的更新交易的输出的脚本则如 <code>update(n)</code> 部分所示：它有两个脚本花费条件，由 <code>DEPTH NOTIF</code> 来控制；<code>DEPTH</code> 的功能是获得栈中元素的数量；如果堆栈中没有任何元素，则激活 <code>&lt;settlement-n-hash&gt; CTV</code> 花费条件；如果堆栈中有元素，则激活 <code>CTV IKEY CSFS VERIFY &lt;S+n+1&gt; CLTV</code> 花费条件。可以看出，<code>update-stack</code> 中的见证数据也能用来通过后面这个花费条件。）</p><p>如果一条通道遭遇强制关闭情形，A 将一个更新（交易）输出点发布到链上，那么 B 将因为 <code>settlement-n-hash</code>（结算交易哈希值）中编码的 CSV 时延（无法立即结算）而拥有一个时间窗口，可以发布更新的状态。</p><p>LN-Symmetry 的其中一个规划目标是消除通道参与者为每一条通道存储 <code>O(n)</code> 个状态的需要，但现在我们又遇到了这个问题。因为更新交易的输出的赎回脚本在链上是不可见的，即使 B 能找出更新的状态，如果没有 <code>settlement-n-hash</code>，就无法重新构造出脚本（如果无法重新构造出脚本，也就无法花费它）；除非 B 为每一个状态存储 <code>settlement-n-hash</code>，否则将只有 A 知道这个哈希值。</p><h2 id=APO-annex-解决方案><a href=#APO-annex-解决方案 class=headerlink title="APO-annex 解决方案"></a>APO-annex 解决方案</h2><p>在 @instagibb 的 <a target=_blank rel=noopener href=https://delvingbitcoin.org/t/ln-symmetry-project-recap/359>Lightning Symmetry 研究工作</a>中，他使用了 APO 和 Taproot Annex（附言），参与通道的双方在签名更新交易时，都会让签名承诺一个附言，附言中包含了重新构造更新交易花费脚本所需的结算交易哈希值。</p><p>其脚本（大概）是这样的：</p><pre><code>channel:
tr(musig(keyA, keyB), raw(&lt;1&gt; CHECKSIGVERIFY &lt;S+1&gt; CLTV))
update(n):
tr(musig(keyA, keyB), raw(DEPTH NOTIF &lt;sig&gt; &lt;01||G&gt; CHECKSIG ELSE &lt;1&gt; CHECKSIGVERIFY &lt;S+n+1&gt; CLTV ENDIF))
update-stack:
&lt;update-n-sig&gt;
</code></pre><p>这里我们看到了使用 APO 作为限制条款的用法：使用私钥 <code>1</code> 和公钥 <code>G</code> 来预先计算一个签名。因为 <code>CHECKSIG</code> 操作承诺了 Taproot 附言，这些脚本就不需要通道参与者的特殊处理，只需要将结算交易哈希值放在附言里就可以了，因此，任何一方都可以在日后重新构造出任何旧更新交易的花费脚本。没有附言，基于 APO 的实现将要么回到需要额外的签名轮次，要么使用 <code>OP_RETURN</code> 来曝光这些数据。</p><h2 id=粗糙-CTV-CSFS-通道的解决方案><a href=#粗糙-CTV-CSFS-通道的解决方案 class=headerlink title="粗糙 CTV-CSFS 通道的解决方案"></a>粗糙 CTV-CSFS 通道的解决方案</h2><p>我们能只使用一个额外的签名来承诺一个额外的哈希值吗？</p><pre><code>channel:
tr(musig(keyA, keyB), raw(CTV IKEY CSFS VERIFY IKEY CSFS VERIFY &lt;S+1&gt; CLTV))
update(n):
tr(musig(keyA, keyB), raw(DEPTH NOTIF &lt;settlement-n-hash&gt; CTV ELSE CTV IKEY CSFS VERIFY IKEY CSFS VERIFY &lt;S+n+1&gt; CLTV ENDIF))
update-stack:
&lt;settlement-n-sig&gt; &lt;settlement-n-hash&gt; &lt;update-n-sig&gt; &lt;update-n-hash&gt;
</code></pre><p>这种方法是行不通的，因为这两个签名没有任何关联。恶意的通道参与者可以放置不匹配的结算交易哈希值和更新交易到链上，从而阻止拥有有效更新的对手重新构造出脚本并更新通道状态。</p><p>一个显然的解决方案是组合更新交易哈希值和解锁交易哈希值，但因为比特币没有字符串拼接操作符，所以做不到。最近，出于这个目的，<a target=_blank rel=noopener href=https://x.com/4moonsettler>@4moonsettler</a> 提出了 <code>OP_PAIRCOMMIT</code> 作为替代方案。</p><h2 id=CTV-CSFS-委托解决方案><a href=#CTV-CSFS-委托解决方案 class=headerlink title="CTV-CSFS 委托解决方案"></a>CTV-CSFS 委托解决方案</h2><p>现在来看看我们得出的新的解决方案：将更新交易和结算交易的哈希值通过签名它们的密钥捆绑在一起。 众所周知，CSFS 在委托上十分有用，所以我们最初委托给一个 rekay：</p><pre><code>script(n):
    DUP TOALT DUP TOALT
    IKEY CSFS VERIFY
    OP_SIZE &lt;32&gt; EQUALVERIFY CTV
    2DUP EQUAL NOT VERIFY
    ROT SWAP FROMALT CSFS VERIFY
    FROMALT CSFS VERIFY &lt;S+n+1&gt; CLTV
channel:
    tr(musig(keyA, keyB), raw(&lt;script(0)&gt;))
update(n):
    tr(musig(keyA, keyB),
        raw(DEPTH NOTIF &lt;settlement-n-hash&gt; CTV ELSE &lt;script(n)&gt; ENDIF))
stack(n):
    &lt;settlement-n-sig&gt;
    &lt;update-n-sig&gt;
    &lt;settlement-extradata&gt;
    &lt;update-n-ctv&gt;
    &lt;rekey-sig&gt;
    &lt;rekey&gt;
</code></pre><p>这里的 <code>rekey</code> 是一个临时密钥，可以是随机生成的，也可以基于通道密钥和 BIP32 这样的技术、为每一个状态派生出一个。重要的是，<code>rekey</code> 只用来签名对应于一个状态的更新交易和结算交易哈希值的两条消息。这样一来，它们就只有在一起才是有效的，通道参与者必定能够获得正确的结算交易哈希值来重新构造交易和刷新通道的结算过程。</p><p>这个解决方案的一个怪癖是，如果两个被签名的东西可以相等，那么恶意的参与者就可以直接放置两个相同的更新交易哈希值以及对它的签名在堆栈中，所以，必须用脚本来检查这两个东西不相等。</p><p>因为对参数 <code>update-n-ctv</code> 有个长度检查，所以这个方案是安全的：它可以保证其它 <code>&lt;settlement-extradata&gt;</code> 要么不是一个有效的 CTV 哈希值，要么长度不为 32 。</p><h2 id=CSFS-密钥阶梯><a href=#CSFS-密钥阶梯 class=headerlink title="CSFS 密钥阶梯"></a>CSFS 密钥阶梯</h2><p>“密钥阶梯（Key Laddering）” 延申了上述 rekey 方法，允许递归地对任意数量的变量重新安排密钥。这让 CSFS 无需 OP_CAT 就可以签名要插入一个脚本的变量的集合。</p><p>比如说，要签名 5 个变量（并不是最优的，只是为了清晰）：</p><pre><code>数据签名: &lt;sd1&gt; &lt;d1&gt; &lt;sd2&gt; &lt;d2&gt; &lt;sd3&gt; &lt;d3&gt; &lt;sd4&gt; &lt;d4&gt; &lt;sd5&gt; &lt;d5&gt;
堆栈: 数据签名 + &lt;k5&gt; &lt;s5&gt; &lt;k4&gt; &lt;s4&gt; &lt;k3&gt; &lt;s3&gt; &lt;k2&gt; &lt;s2&gt; &lt;k1&gt; &lt;s1&gt;

程序:

\\ 首先，检查 k1 得到了 IKEY 的签名
    OVER IKEY CSFSV
    DUP TOALT

// 然后，检查 k_i 签名了 k_&#123;i+1&#125;
    // 堆栈: DATASIGS + &lt;k5&gt; &lt;s5&gt; &lt;k4&gt; &lt;s4&gt; &lt;k3&gt; &lt;s3&gt; &lt;k2&gt; &lt;s2&gt; &lt;k1&gt;
    // 异堆栈（altstack）: &lt;k1&gt;

        3DUP ROT SWAP CSFSV 2DROP DUP TOALT

    // 堆栈k: DATASIGS + &lt;k5&gt; &lt;s5&gt; &lt;k4&gt; &lt;s4&gt; &lt;k3&gt; &lt;s3&gt; &lt;k2&gt;
    // 异堆栈: &lt;k1&gt; &lt;k2&gt;

        3DUP ROT SWAP CSFSV 2DROP DUP TOALT

    // 堆栈: DATASIGS + &lt;k5&gt; &lt;s5&gt; &lt;k4&gt; &lt;s4&gt; &lt;k3&gt;
    // 异堆栈: &lt;k1&gt; &lt;k2&gt; &lt;k3&gt;

        3DUP ROT SWAP CSFSV 2DROP DUP TOALT

    // 堆栈: DATASIGS + &lt;k5&gt; &lt;s5&gt; &lt;k4&gt;
    // 异堆栈: &lt;k1&gt; &lt;k2&gt; &lt;k3&gt; &lt;k4&gt;

        3DUP ROT SWAP CSFSV 2DROP

    // 堆栈: &lt;sd1&gt; &lt;d1&gt; &lt;sd2&gt; &lt;d2&gt; &lt;sd3&gt; &lt;d3&gt; &lt;sd4&gt; &lt;d4&gt; &lt;sd5&gt; &lt;d5&gt; &lt;k5&gt;
    // 异堆栈: &lt;k1&gt; &lt;k2&gt; &lt;k3&gt; &lt;k4&gt;


        FROMALT FROMALT FROMALT FROMALT

    // 堆栈: &lt;sd1&gt; &lt;d1&gt; &lt;sd2&gt; &lt;d2&gt; &lt;sd3&gt; &lt;d3&gt; &lt;sd4&gt; &lt;d4&gt; &lt;sd5&gt; &lt;d5&gt; &lt;k5&gt; &lt;k4&gt; &lt;k3&gt; &lt;k2&gt; &lt;k1&gt;
    // 异堆栈:

// 现在，检查对每一个变量的签名

    &lt;6&gt; PICK // sd5
    &lt;6&gt; PICK // d5
    &lt;6&gt; PICK // k5
    CSFSV

    &lt;8&gt; PICK // sd4
    &lt;8&gt; PICK // d4
    &lt;5&gt; PICK // k4
    CSFSV

    &lt;10&gt; PICK // sd3
    &lt;10&gt; PICK // d3
    &lt;4&gt; PICK // k3
    CSFSV

    &lt;12&gt; PICK // sd2
    &lt;12&gt; PICK // d2
    &lt;3&gt; PICK // k2
    CSFSV

    &lt;14&gt; PICK // sd1
    &lt;14&gt; PICK // d1
    &lt;2&gt; PICK // k1
    CSFSV

// 现在，检查不相等，以证明没有哪个公钥被用作了数据:
    // 堆栈: &lt;sd1&gt; &lt;d1&gt; &lt;sd2&gt; &lt;d2&gt; &lt;sd3&gt; &lt;d3&gt; &lt;sd4&gt; &lt;d4&gt; &lt;sd5&gt; &lt;d5&gt; &lt;k5&gt; &lt;k4&gt; &lt;k3&gt; &lt;k2&gt; &lt;k1&gt;
    // 异堆栈:

    // 不需要检查 k1 != d0，因为没有 d0

    // 检查 k2 != d1
    &lt;1&gt; PICK
    &lt;14&gt; PICK
    NOT EQUAL VERIFY

    // 检查 k3 != d2
    &lt;2&gt; PICK
    &lt;12&gt; PICK
    NOT EQUAL VERIFY


    // 检查 k4 != d3
    &lt;3&gt; PICK
    &lt;8&gt; PICK
    NOT EQUAL VERIFY

    // 检查 k5 != d4
    &lt;4&gt; PICK
    &lt;6&gt; PICK
    NOT EQUAL VERIFY


// 堆栈: &lt;sd1&gt; &lt;d1&gt; &lt;sd2&gt; &lt;d2&gt; &lt;sd3&gt; &lt;d3&gt; &lt;sd4&gt; &lt;d4&gt; &lt;sd5&gt; &lt;d5&gt; &lt;k5&gt; &lt;k4&gt; &lt;k3&gt; &lt;k2&gt; &lt;k1&gt;
// 异堆栈:

2DROP 2DROP DROP
TOALT DROP
TOALT DROP
TOALT DROP
TOALT DROP
TOALT DROP

// 堆栈:
// 异堆栈: &lt;d5&gt; &lt;d4&gt; &lt;d3&gt; &lt;d2&gt; &lt;d1&gt;

// 接下来，就随你做什么了
</code></pre><p>这种方法让你可以按顺序签名任意数量的变量。</p><p>一个上述脚本没有显示出来的 “问题” 是，需要保证在每一步中，对数据的签名和对公钥的签名没有掉包。需要细致地保证这一点。</p><p>一种替代方法是 “签名阶梯”，也就是签名下一个签名，而不是签名下一个步骤中的公钥。</p><p>例如，通过 IKEY 来签名第一个签名。然后用这个签名来验证任意 公钥&#x2F;消息 对。这个公钥又可以用在另一个签名中，而被签名的消息就是下一个签名。例如：</p><pre><code>堆栈:
&lt;sig B&gt;
&lt;key A&gt;
&lt;sig^IKEY(sig A)&gt;
&lt;sig^A(sig B)&gt;

DUP TOALT
IKEY CSFS VERIFY
FROMALT

堆栈:
&lt;sig B&gt;
&lt;key A&gt;
&lt;sig^A(sig B)&gt;

ROT ROT CSFS VERIFY
</code></pre><p>阶梯法是很方便的，因为第一个 IKEY 签名承诺了所有其它的数据的角色（密钥 vs. 签名 vs. 参数）。</p><h2 id=CTV-CSFS-与派生内部公钥解决方案><a href=#CTV-CSFS-与派生内部公钥解决方案 class=headerlink title="CTV-CSFS 与派生内部公钥解决方案"></a>CTV-CSFS 与派生内部公钥解决方案</h2><p>对 LN-Symmetry 来说，得到签名的每一笔更新交易都带有一个具体的、单调递增的锁定时间（locktime），而且并不要求每一次更新的内部公钥（internal key）都保持不变，所以，我们可以用一个从通道公钥和锁定时间中确定性地派生出来的公钥、来替代内部密钥，然后几乎就可以使用粗糙的 CTV-CSFS 脚本：</p><pre><code>internalkey(n):
bip32_derive(musig(keyA, keyB), /&lt;S+n+1&gt;)
script(n):
CTV 2DUP EQUAL NOT VERIFY ROT SWAP IKEY CSFS VERIFY IKEY CSFS VERIFY &lt;S+n+1&gt; CLTV
channel:
tr(musig(keyA, keyB), raw(&lt;script(0)&gt;))
update:
tr(internalkey(n), raw(DEPTH NOTIF &lt;settlement-n-hash&gt; CTV ELSE &lt;script(n)&gt; ENDIF))
update-stack:
&lt;settlement-n-sig&gt; &lt;update-n-sig&gt; &lt;settlement-n-hash&gt; &lt;update-n-hash&gt;
</code></pre><p>通道的任何一方都可以从更新交易自身的锁定时间中派生出重新构造花费脚本所需的正确内部公钥。这些派生出来的内部公钥只用于签名一对更新交易和结算交易哈希值，而脚本能检查两个签名是不一样的。</p><h2 id=结论><a href=#结论 class=headerlink title=结论></a>结论</h2><p>这些技术消除了启用 LN-Symmetry 的比特币升级提议包含特定的函数以使用一个签名承诺多个对象的需要。当然，如果一种更高效的组合多个数据为一个承诺的技术可用，那么闪电网络的开发者将能利用它、减少 LN-Symmetry 所需的见证数据大小。</p><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>