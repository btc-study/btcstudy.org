<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>hArk 和 Erk：使用 CTV 和 CSFS 改进 Ark 协议</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/tools>工具</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">hArk 和 Erk：使用 CTV 和 CSFS 改进 Ark 协议</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>hArk 和 Erk：使用 CTV 和 CSFS 改进 Ark 协议</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/tools>工具</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#Ark-%E7%AE%80%E4%BB%8B><span class=toc-text>Ark 简介</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#Arkoor><span class=toc-text>Arkoor</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BE%93%E5%87%BA%E7%9A%84%E8%8A%B1%E8%B4%B9%E6%9D%A1%E4%BB%B6><span class=toc-text>输出的花费条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BB%86%E8%AF%B4%E9%83%A8%E5%88%86%E5%8F%98%E7%A7%8D><span class=toc-text>细说部分变种</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#Ark><span class=toc-text>Ark</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#clArk%EF%BC%8C%E2%80%9C%E6%97%A0%E9%9C%80%E9%99%90%E5%88%B6%E6%9D%A1%E6%AC%BE%E7%9A%84-Ark%E2%80%9D><span class=toc-text>clArk，“无需限制条款的 Ark”</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#Erk%EF%BC%8C%E2%80%9CErik-%E7%9A%84-Ark%E2%80%9D><span class=toc-text>Erk，“Erik 的 Ark”</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#hArk%EF%BC%8C%E2%80%9C%E5%93%88%E5%B8%8C%E9%94%81-Ark%E2%80%9D><span class=toc-text>hArk，“哈希锁 Ark”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BB%93%E8%AE%BA><span class=toc-text>结论</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>hArk 和 Erk：使用 CTV 和 CSFS 改进 Ark 协议</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Steven Roose"><div class=page-author-info><strong>Steven Roose</strong><time class=has-text-grey datetime=2025-09-24T07:45:32.000Z>2025-09-24</time></div></div><div class=is-flex><a href=/tags/Ark><i class="page-tag mr-1 px-1">Ark</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Steven Roose</em></p><p><em>来源：<a target=_blank rel=noopener href=https://roose.io/blog/hark-erk-evolving-the-ark-protocol-using-ctv-and-csfs/ >https://roose.io/blog/hark-erk-evolving-the-ark-protocol-using-ctv-and-csfs/</a></em></p></blockquote><p>（本文同时发布在 <a target=_blank rel=noopener href=https://delvingbitcoin.org/t/evolving-the-ark-protocol-using-ctv-and-csfs/1602/1>Delving Bitcoin 论坛</a>中。）</p><p>上周在 OP_NEXT 论坛上，我提出了 Ark 协议的一种新变种，叫做 “Erk”，它消除了参与回合的用户的所有交互需要。在本文中，Erik De Smedt 和我希望明确 Erk 以及利用 CTV（<a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/c5220f8c3b43821efa3841a6c5e90af9ce5519e8/bip-0119.mediawiki><code>OP_CHECKTEMPLATEVERIFY</code></a>）和 CSFS（<a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/c5220f8c3b43821efa3841a6c5e90af9ce5519e8/bip-0348.md><code>OP_CHECKSIGFROMSTACK</code></a>）可以在 Ark 上作出的其它优化。</p><p>简单来说，我们得出了 Ark 的 <em><strong>两种</strong></em> 相互竞争的协议，它们具有如下特性：</p><ul><li>“Erk”：<ul><li>参与回合的时候不需要用户交互</li><li>离线刷新（服务商可以为用户刷新）</li><li>永续离线刷新（服务商可以为一个用户不断刷新，没有期限）</li><li>在单输入、单输出的 VTXO 上效果最好</li><li>需要 CTV + CSFS</li></ul></li><li>“hArk”：<ul><li>参与回合的时候不需要用户交互</li><li>非常高效，哪怕输入有多个</li><li>无法实现离线刷新（至少到目前为止）</li><li>只需要 CTV</li></ul></li></ul><h2 id=Ark-简介><a href=#Ark-简介 class=headerlink title="Ark 简介"></a>Ark 简介</h2><p>我们先要总结一下现有的基于 CTV 的 Ark 协议以及基于 MuSig 的 clArk 协议，然后是关于新的 Erk 和 hArk 变种的详细解释。</p><p>首先，我们来总结一下会在下文的解释中用到的核心概念。</p><p>我们将 Ark 服务商的公钥记为 $S$，而用户的公钥则记为 $A, B, …$</p><p>Ark 协议的基础砖块是交易树，它让多个用户能够共享一个链上的 UTXO 。下面的骨架图展示了一棵交易树，其中 Alice（$A$）拥有 4 BTC、Bob（$B$）拥有 3 BTC、Carol（$C$）拥有 2 BTC，而 Dave（$D$）拥有 1 BTC 。Ark 是一套离链的协议，所以，在乐观情形下，整个交易树只有注资交易（FUNDING）会得到区块链确认。</p><pre><code>(每个方框都是一笔比特币交易)

                 +------------+
                 |  FUNDING   |
                 +------------+
                       | 10₿
                 +-----+------+
                 |   NODE 1   | 
                 +-----+------+
             +---------┴--------------+
          7₿ |                        | 3₿
        +----+----+              +----+----+
        | NODE 2  |              | NODE 3  |
        +----+----+              +----+----+
             |                        |
       +-----+-----+            +-----+-----+
    4₿ |        3₿ |       2₿   |           | 1₿
    +---+----+  +---+----+   +---+----+  +---+----+
    | EXIT A |  | EXIT B |   | EXIT C |  | EXIT D |
    +--------+  +--------+   +--------+  +--------+
</code></pre><p>在这套装置中，Alice 可以通过广播她所在的交易树分支，来执行单方面退出、领取她的资金。她的分支由这四笔交易组成：<em>FUNDING</em>、<em>NODE 1</em>、<em>NODE 2</em> 和 <em>EXIT A</em> 。在 Alice 知道这些交易（以及让它们变成有效交易所需的见证数据）并且可以用公钥 $A$ 来花费它们的时候，我们就说 Alice 拥有一个 VTXO 。</p><p>每一个 Ark VTXO 都有一个过期时间点，在这个过期时间点之前，这个 VTXO 必须要么被花掉、要么刷新（否则用户就会失去其中的价值）。而 “刷新一个 VTXO”，本质上意味着将一个 VTXO 换成一个新的（刷新时间延后了的）VTXO。刷新操作在 Ark 的 “回合” 中实现，也就是是 Ark 服务商和自己的用户的一个在线交互流程。</p><p>在过期之后，服务商就可以清扫整个交易树中的价值。在理想情况下，服务商可以直接清扫（花费）注资交易，但如果某个（某些）用户执行过单方面退出，服务商就只能清扫尚未有用户退出的所有剩余节点中的价值。</p><h3 id=Arkoor><a href=#Arkoor class=headerlink title=Arkoor></a>Arkoor</h3><p>如果 Alice 持有一个 VTXO、想给 Bob 支付，她可以创建一笔新的链下交易（在类型上称为 “arkoor 交易”）、花费她自己的 VTXO（也即她的退出交易的输出）、为 Bob 创建一个新的 VTXO 。Bob 可以存储构成 Alice 的 VTXO 的所有交易，再加上 Alice 创建的这笔 arkoot 交易，构成他的新的 <em>arkoor VTXO</em> 。</p><p>（译者注：“Arkoor” 是 “Ark out-of-round” 的缩写，顾名思义，是在回合之外执行的。）</p><h3 id=输出的花费条件><a href=#输出的花费条件 class=headerlink title=输出的花费条件></a>输出的花费条件</h3><p>我们将用在 Ark 协议中的输出花费条件分为三种：</p><ul><li><em><strong>节点交易花费条件</strong></em>：用在所有节点交易（也包括注资交易）中的花费条件</li><li><em><strong>叶子条件</strong></em>：用在最后一笔节点交易的输出中的花费条件，支付给一笔退出交易</li><li><em><strong>退出条件</strong></em>：用在退出交易中的花费条件；退出交易是整个交易树的叶子，可被用户用来执行单方面退出</li></ul><p>从逻辑上来说，你可以将这些三种花费条件视为前后相接的。下图指明了上图所示的不同交易所用到的输出花费条件。退出交易后面可以跟随 arkoor 交易或者弃权交易。</p><pre><code>FUNDING
+-------------+-----+
| node policy | 10₿ |
+-------------+-----+

NODE 1
+-------------+-----+
| node policy |  7₿ |
+-------------+-----+
| node policy |  3₿ |
+-------------+-----+

NODE 2
+-------------+-----+
| leaf policy |  4₿ |
+-------------+-----+
| leaf policy |  3₿ |
+-------------+-----+

EXIT A
+-------------+-----+
| exit policy |  4₿ |
+-------------+-----+
</code></pre><p>所有的变种都具有以下共性：</p><ul><li><p>每一个回合都会在一个 <em><strong>过期区块高度</strong></em> $T_{exp}$ ，在这个区块之后，这个回合（所对应的交易树）中的资金就可以被 Ark 服务商密钥清扫。</p></li><li><p>在我们的构造中，所有的交易都是 0 手续费的，都有一个手续费锚点输出。在现实中，手续费可以是非零值，如果服务商倾向于给用户补贴一部分退出成本的话。带有交易费不是整个构造能够工作的必要条件，但带有手续费锚点输出则是。（译者注：这个锚点输出允许用户通过 “CPFP” 方法来追加手续费）。</p></li><li><p><em>节点花费条件</em> 和 <em>叶子花费条件</em> 的功能都是延续交易树的分支，并带有一个替代性的花费路径，让服务商可以在过期之后清扫资金。</p></li><li><p>对用户来说，活性要求是指，他们要在自己的 VTXO 过期之前（也即 $T_{exp}$ 之前）的一段时间里回到互联网上，要么刷新自己的 VTXO ，要么执行单方面退出（如果服务商和自己的 arkoor VTXO 的任何一位前任所有权人行为不轨的话）。</p></li><li><p>一旦退出交易得到区块确认，过期机制就失效了，资金会进入 <em>退出条件</em>。退出条件有两个主要功能以及对应的 <em>条款</em>：</p><ul><li><em><strong>支付条款</strong></em>，给用户和服务商提供了一种合作式创建即时花费的方法（用于创建 arkoor 交易和弃权交易）</li><li><em><strong>退出条款</strong></em>，用户提供了一种访问这些资金的方法，如果 TA 从未用这个 VTXO 创建过即时花费</li></ul><p><em>退出条件</em> 的最初设计在 <em>退出条款</em> 中使用了一个相对时间锁，但我们的更新设计结合了一个绝对时间锁 $T_{exp}$ 和一个相对时间锁 $\Delta t$ 。</p><ul><li>这个相对时间锁保证了，<em>支付条款</em> 优先于 <em>退出条款</em>。</li><li>这个绝对时间锁保证了，这个 VTXO 的任何后续的所有权人（任何可能通过使用 <em>支付条款</em> 的 arkoor 交易收到这个 VTXO 的人），除了在 $T_{exp}$ 之前一段时间上线之外，没有别的活性要求</li></ul></li></ul><h2 id=细说部分变种><a href=#细说部分变种 class=headerlink title=细说部分变种></a>细说部分变种</h2><h3 id=Ark><a href=#Ark class=headerlink title=Ark></a>Ark</h3><p>最初版本的 Ark 协议基于 CTV 。我们对这个想法的最新迭代也一样。</p><p><em>节点花费条件</em> 和 <em>退出条件</em> 都使用了 <code>OP_CTV</code> 来承诺下一笔交易。</p><ul><li><em>节点条件</em> 和 <em>叶子条件</em>：$CTV\ or\ (S + T_{exp})$</li><li><em>退出条件</em>：$(A + S)\ or\ (A + T_{exp} + \Delta t)$</li></ul><p>在回合中（刷新 VTXO 的时候），用户需要签名一笔 <em>弃权交易</em>，将自己的 VTXO交给服务商，并且，该弃权交易的生效条件是下一回合的正确开启。一个 <em>连接器</em> 是下一个回合的注资交易的一个专用后代交易，它会被用作 <em>弃权交易</em> 的一个输出，从而保证，服务商只有在下一回合（的注资交易）成功得到确认时，才能强制执行这个弃权交易。一旦所有用户都为自己的 VTXO 签名了弃权交易，服务商就可以签名注资交易、并广播到比特币网络中。</p><p>弃权交易有两个输入：</p><ul><li>退出交易的输出，使用 <em>退出花费条件</em> 的 <em>支付条款</em></li><li>连接器输入，来自新回合的注资交易的一连串后代交易的一个输出</li></ul><p>弃权交易只有一个输出，就是将所有资金发送给服务商。</p><pre><code>forfeit tx:
| inputs    | outputs | 
+===========+=========+
| exit tx   |       S | 
+-----------+---------+
| connector |         | 
+-----------+---------+
</code></pre><h3 id=clArk，“无需限制条款的-Ark”><a href=#clArk，“无需限制条款的-Ark” class=headerlink title="clArk，“无需限制条款的 Ark”"></a>clArk，“无需限制条款的 Ark”</h3><p>clArk 与 Ark 非常相似，只是在交易树上使用了递归的多签名装置。每一个 <em>节点条件</em> 都包含了一个多签名装置，使用该节点下的所有叶子的公钥。</p><ul><li><em>节点条件</em>：$(A + B + C + … + S)\ or\ (S + T_{exp})$</li><li><em>叶子条件</em>：$(A + S) or\ (S + T_{exp})$</li><li><em>退出条件</em>：$(A + S)\ or\ (A + T_{exp} + \Delta t)$</li></ul><p>回合机制是一样的，也使用了 <em>连接器</em>。唯一的区别在于，在所有客户端签名（自己所在的）交易树的分支时，需要一个额外的阶段。</p><h3 id=Erk，“Erik-的-Ark”><a href=#Erk，“Erik-的-Ark” class=headerlink title="Erk，“Erik 的 Ark”"></a>Erk，“Erik 的 Ark”</h3><p>我在 OP_NEXT 大会上演示 Erk 之后，我们又作了一些额外的升级。</p><p>Erk 的花费条件跟 Ark 中的一模一样，但我们让签名变成 <em><strong>可以重新绑定的</strong></em>（“可以重新绑定的签名” 是使用 APO 语义的签名，意思是他们不承诺具体的 UTXO 输入，所以可以用来花费任何包含相同公钥的输出）。我们可以使用 CTV + CSFS 来实现可以重新绑定的签名。</p><ul><li><em>节点条件</em> 和 <em>叶子条件</em>：$CTV\ or\ (S + T_{exp})$</li><li><em>退出条件</em>：$(A + S)\ or\ (A + T_{exp} + \Delta t)$</li></ul><p><em>退出条件</em> 中的 $A + S$，就是我们要使用重绑定签名的地方。</p><p>Erk 的核心和基本原则体现在下列交易中，我们称为 <em>退款交易</em>。</p><pre><code>refund tx:
| inputs             |        outputs | 
+====================+================+
| old exit tx for A  | exit policy A&#39; | 
+--------------------+----------------+
| new exit tx for A&#39; |              S | 
+--------------------+----------------+
</code></pre><p>Erk 回合没有用户交互（我们把 “用户交互” 定义为 “所有用户同时采取行动”）。用户通过发送一个新的公钥（$A’$）以及一个签过名的退款交易给服务商，来参与一个回合。注意，退款交易的一个输入是用当前的公钥 $A$ 来签名的，而另一个输入则是用新的公钥 $A’$ 来签名的。</p><p>这时候，服务商可以安全地创建一棵新的 VTXO 树、为用户发行相同的 VTXO（减去一些手续费）。这个新的 VTXO 有一个 <em>退出条件</em>，使用的新公钥 $A’$。</p><p>用户可以随时安全地签名这笔退款交易，因为他们依然能从交易的其中一个输出中收到自己的钱。所以如果这笔交易被服务商恶意使用，用户并不会丢失任何资金。</p><p>服务商也可以在收到这样的签过名的退款交易之后创建回合，因为，如果用户尝试（恶意地）退出原本的旧 VTXO，服务商可以揭晓这个新 VTXO，然后同时花费两者、拿走用户无权拥有的东西。</p><p><strong>Arkoor</strong></p><p>在 Erk 变种中实现 arkoor 交易需要格外小心。设想，如果用户 Alice 把自己的新 VTXO 发送给了 Bob（使用一笔 arkoor 交易），然后又恶意的尝试退出旧的 VTXO 。服务商将被迫广播新的 VTXO 并使用退款交易，这就把 Bob 的 arkoor VTXO 作废掉了。</p><p>然而，因为作为交易树的叶子的退出交易，跟退款交易拥有相同的输出花费条件（对公钥 $A’$ 来说），那么 Bob 可以要求 Alice 提供可以重新绑定的 arkoor 签名：这个签名在这两种输出上都可以使用。（注意，同一时间，只有其中一个才能存在，因为退款交易是退出交易的子交易。）</p><p>这一设计让 arkoor 交易在 Erk 上也可以实现，前提是每一个新的 VTXO 都来自一个 VTXO 输入。当我们尝试将这种设计推广到多个 VTXO 输入被合并为一个 VTXO 输出的情形中时，arkoor 构造就会无法工作。</p><p><strong>离线刷新</strong></p><p>现在，设想如果用户已经预先为自己的 VTXO 签名了一笔退款交易（就在这个 VTXO 刚刚创建好的时候）、把这个签名交给了服务商，然后就离线了。这意味着，这个服务商可以随时安全地重新发行这个 VTXO，只要持有这笔退款交易，就不怕用户同时领取这两个 VTXO 。这意味着，即使用户放弃了手动刷新，服务商也可以自动帮助 TA 。也可以让瞭望塔来监控这个 Ark，并在服务商没有帮助刷新用户的 VTXO 时通知这个用户。</p><p>（译者注：“瞭望塔” 指的是能够监控比特币区块链并代替客户对其中发生的事件作出响应的互联网服务。）</p><p>此外，设想第一次刷新将公钥 $A$ 变更为 $A’$，Alice 也可以预先为未来的 VTXO $A’$ 签名一笔退款交易，从而将公钥变更为 $A’’$。实际上，Alice 可以预先签名任意次数的刷新操作，每一次都将资金转入一个新的公钥（还可以每一次都减去一些数额，作为给服务商的服务费）。这样一来，一个服务商可以不断刷新一个 VTXO，用户不需要回到互联网上，除非一个瞭望塔提醒 TA 服务商并没有遵守约定。</p><p>也许一个恶意的服务商可以尝试迅速地应用所有这些退款交易，从而领走所有的服务费（请注意，这不一定是经济的，因为他需要为每一笔交易支付挖矿手续费）。可以通过在每一笔退款交易中放置绝对时间锁来避免这一点：服务商只能在根据预计的回合时间计算出来的未来时间点之后使用相应的退款交易。）</p><h3 id=hArk，“哈希锁-Ark”><a href=#hArk，“哈希锁-Ark” class=headerlink title="hArk，“哈希锁 Ark”"></a>hArk，“哈希锁 Ark”</h3><p>Erk 看起来非常强大（尽管我们放弃了 “aArk” 这个可能的代号），但依然有两个主要缺点：</p><ul><li>服务商为了 “报复” 一个恶意退出操作，必须揭晓新 VTXO 所在的交易树分支。这在 “入场 VTXO” —— 用户自己在移动资金到一个 Ark 中时创建的 VTXO） —— 上问题尤其突出。入场 VTXO 只由一笔注资交易和一笔退出交易构成（该注资交易的输出使用 <em>叶子花费条件</em>）。这意味着用户尝试恶意退出的代价是很低的，而服务商要报复的代价则可能是很高的。</li><li>Erk 只能支持单 VTXO 输入的刷新。</li></ul><p>hArk 并不是 Erk 的变种，而是跟 Erk 完全不同的 Ark 变种。它的回合机制也不要求任何用户交互，它是链上踪迹最小化的，而且完美适配多 VTXO 输入的情形。</p><p>在 hArk 中，<em>叶子花费条件</em> 与 <em>节点花费条件</em> 不同，在于前者要求知道一个秘密值。</p><ul><li><em>节点条件</em>：$CTV\ or\ (S + T_{exp})$</li><li><em>叶子条件</em>：概念上是 $(CTV + secret) or\ (S + T_{exp})$（$secret$ 即所要求的秘密值），但另类的 $(A + S + secret tweak) or\ (S + T_{exp})$ 可以使用 Taproot 密钥路径花费，所以更加高效</li><li><em>退出条件</em>：$(A + S)\ or\ (A + T_{exp} + \Delta t)$</li></ul><p>在 hArk 的回合中，用户提交自己希望刷新的 VTXO 输出。服务商为树上的每一个新 VTXO 创建一个秘密值。因为一开始只有服务商才知道这个秘密值，所以 TA 可以安全地为回合（交易树）注资。一开始，没有任何一个新 VTXO 是能被用户访问的，因为所有的秘密值都还是保密的。</p><p>在回合注资交易得到区块确认之后，用户再签名一笔 <em>弃权交易</em>。这笔弃权交易将跟 Ark 和 clArk 中弃权交易不同，它让服务商可以通过揭晓秘密值来领取 VTXO 中的价值。</p><p>这笔弃权交易的输出花费条件是 $(S + secret)\ or\ (A + \Delta t)$ 。粗略地说，秘密值的检查可以通过使用简单的哈希锁来实现，但也可以在 Taproot 的密钥花费路径（Schnorr 签名）中使用 “适配器签名” 来实现，可以节约一些字节。</p><pre><code>forfeit tx:
| inputs  |    outputs | 
+=========+============+
| exit tx | S + secret |
|         | or  A + Δt |
+---------+------------+
</code></pre><p>在用户签名这笔弃权交易之后，服务商再告诉用户这个秘密值。这样一来，用户就能访问新的 VTXO 了。</p><p>如果用户签名这笔弃权交易之后，这个服务商拒绝交出相关的秘密值，那么用户将被迫尝试单方面退出，最终，这要么将钱交回给用户，要么服务商再链上揭晓这个秘密值。</p><h2 id=结论><a href=#结论 class=headerlink title=结论></a>结论</h2><p>如果 CTV 可用，我们就能在 Ark 回合机制中完全消除所有用户交互。VTXO 刷新将变成一个完全异步的过程，用户可以自由登记，服务商可以独立地发行新的 VTXO，用户日后回到互联网上，就可以完成整个流程。</p><p>如果 CTV 之上还有 CSFS 可用，那么离线刷新甚至可以递归使用。这让服务商可以无需用户参与、自动刷新 VTXO，并且用户可以将监控正确动作的任务委托给第三方（瞭望塔）。</p><p>Erk 和 hArk 可以同时使用。用户可以总是预先签名 Erk 退款交易，以防自己不能及时上线，但依然使用 hArk 方法手动参与回合，比如需要合并多个 VTXO 为一个的时候，或是他们希望尽快刷新的时候。</p><p>我们想象，上述方案可以极大地强化 Ark 的用户体验、Ark 在移动端场景中的可用性，以及 Ark 服务商可以提供的功能性。</p><p>（完）</p></article></div></div></main><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:!0,skipTags:["script","noscript","style","textarea","pre","code"]}}),MathJax.Hub.Queue(function(){for(var a=MathJax.Hub.getAllJax(),e=0;e<a.length;e+=1)a[e].SourceElement().parentNode.className+=" has-jax"})</script><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>