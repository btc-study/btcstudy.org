<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>Bitcoin Core 28.0 交易池特性钱包集成指南</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Bitcoin Core 28.0 交易池特性钱包集成指南</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>Bitcoin Core 28.0 交易池特性钱包集成指南</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%80%E7%88%B6%E4%B8%80%E5%AD%90%EF%BC%881P1C%EF%BC%89%E4%BA%A4%E6%98%93%E5%8C%85%E8%BD%AC%E5%8F%91><span class=toc-text>一父一子（1P1C）交易包转发</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#TRUC-%E4%BA%A4%E6%98%93><span class=toc-text>TRUC 交易</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#1P1C-%E6%8B%93%E6%89%91%E7%9A%84%E4%BA%A4%E6%98%93%E5%8C%85-RBF><span class=toc-text>1P1C 拓扑的交易包 RBF</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%94%AF%E4%BB%98%E5%88%B0%E9%94%9A%E7%82%B9%EF%BC%88P2A%EF%BC%89><span class=toc-text>支付到锚点（P2A）</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%94%A8%E6%88%B7%E6%8C%87%E5%BC%95><span class=toc-text>用户指引</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%AE%80%E5%8D%95%E6%94%AF%E4%BB%98><span class=toc-text>简单支付</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#Coinjoin><span class=toc-text>Coinjoin</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C><span class=toc-text>闪电网络</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#Ark><span class=toc-text>Ark</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%97%AA%E7%94%B5%E9%80%9A%E9%81%93%E6%8B%BC%E6%8E%A5><span class=toc-text>闪电通道拼接</span></a></li></ol></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>Bitcoin Core 28.0 交易池特性钱包集成指南</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt="Gregory Sanders"><div class=page-author-info><strong>Gregory Sanders</strong><time class=has-text-grey datetime=2025-01-07T10:15:56.000Z>2025-01-07</time></div></div><div class=is-flex><a href=/tags/%E5%BC%80%E5%8F%91><i class="page-tag mr-1 px-1">开发</i></a><a href=/tags/%E4%BA%A4%E6%98%93%E6%B1%A0><i class="page-tag mr-1 px-1">交易池</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Gregory Sanders</em></p><p><em>来源：<a target=_blank rel=noopener href=https://bitcoinops.org/en/bitcoin-core-28-wallet-integration-guide/ >https://bitcoinops.org/en/bitcoin-core-28-wallet-integration-guide/</a></em></p></blockquote><p><a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/releases/tag/v28.0>Bitcoin Core 28.0</a> 包含了一些新的 P2P 和交易池条款<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-28.0.md>特性</a>，可能对一些钱包和交易类型有用。Gregory Sanders 给出了一份概要的指南，介绍了这些新特性以及单项或集体使用它们的方法。</p><h2 id=一父一子（1P1C）交易包转发><a href=#一父一子（1P1C）交易包转发 class=headerlink title=一父一子（1P1C）交易包转发></a>一父一子（1P1C）交易包转发</h2><p>在 Bitcoin Core 28.0 以前，每一笔交易都必须达到或者超过一个节点的交易池动态最低费率，才能进入这个节点的交易池。这个数值（最低费率）大体上会随着交易的拥塞而上涨和回落，从而为交易的传播创造一个浮动的地板价格。这一机制，给处理预签名交易且无法签名<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/replace-by-fee/ >替代交易</a>的钱包带来了极大的困难，因为它们将不得不预测：当这笔预签名的交易需要确认的时候，交易传播的地板价会变成什么样。即便是几分钟之后的情形，也难以预测；如果时间跨度超过几个月，那显然是不可能的。</p><p>“<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/package-relay/ >交易包转发</a>” 是一项人们梦寐以求的功能，可以缓解这种交易因为缺乏手续费追加能力而无法得到确认的风险。一旦得到合理的开发并在网络中广泛部署，交易池转发将允许钱包开发者通过另一笔相关的交易来为某一笔交易支付手续费，从而，低手续费的祖先交易也可以进入交易池。</p><p>Bitcoin Core 28.0 为包含一笔父交易和一笔子交易的交易包（“1P1C”）实现了交易包转发的一种受限制的变种。1P1C 允许一笔父交易进入交易池，无论该父交易是否达到了交易池的动态最低费率，只要一笔子交易在为它应用简单的 “<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/cpfp/ >子为父偿（CPFP）</a>” 手续费追加。如果子交易还有额外的未确认父交易，那么这些交易都不会在 1P1C 的规则下得到转发。这种限制极大地简化了实现，并允许交易池的其他设计（比如 “<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/cluster-mempool/ >族群交易池</a>”）得到应用，同时依然能满足大量的应用场景。</p><p>除非交易的版本是 “<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/version-3-transaction-relay/ >TRUC 交易</a>”（详见下文），在 1P1C 规则下传播的交易依然必须满足 <em>静态的</em> 每一虚拟字节支付 1 聪的费率下限。</p><p>关于这项特性的最后一个警告是，本版本的传播保证也是受限的。如果一个 Bitcoin Core 节点连接到了一个足够强硬的敌手，敌手可以打破父子交易对的传播。交易包转发的额外补强措施，作为一个<a target=_blank rel=noopener href=https://github.com/bitcoin/bitcoin/issues/27463>项目</a>，还在继续开发。</p><p>通用的交易包转发留待未来实现，并且需要得到来自受限的交易包转发及其在网络中被采用的信息。</p><p>此处是在一个 regtest 环境中建立一个演示 1P1C 转发的钱包的命令：</p><pre><code>bitcoin-cli -regtest createwallet test
&#123;
  &quot;name&quot;: &quot;test&quot;
&#125;
</code></pre><pre><code># 获得一个自己给自己支付的地址
bitcoin-cli -regtest -rpcwallet=test getnewaddress
bcrt1qqzv3ekkueheseddqge3mqdcukse6p9d5yuqxv3
</code></pre><pre><code># 创建一笔费率低于最低转发费率（“minrelay”）的交易
bitcoin-cli -regtest -rpcwallet=test -generate 101
&#123;
[
...
]
&#125;

bitcoin-cli -regtest -rpcwallet=test listunspent
[
  &#123;
    &quot;txid&quot;: &quot;49ea7a01bcba744bd82ecea3e36c4ee9a994f010508a28a09df38f652e74643b&quot;,
    &quot;vout&quot;: 0,
    ...
    &quot;amount&quot;: 50.00000000,
    ...
  &#125;
]

# 交易池的 minfee 和 minrelay 设成了相同的值，以便于测试这一功能
# 我们将使用 TRUC 交易类型，以允许零费率交易并要求 1P1C 转发。
# 启用完全 RBF（Fullrbf），这也是 28.0 的默认值。
bitcoin-cli -regtest getmempoolinfo
&#123;
  &quot;loaded&quot;: true,
  ...
  &quot;mempoolminfee&quot;: 0.00001000,
  &quot;minrelaytxfee&quot;: 0.00001000,
  ...
  “fullrbf”: true,
&#125;

# 先将交易的版本号设为 2
bitcoin-cli -regtest createrawtransaction &#39;[&#123;&quot;txid&quot;: &quot;49ea7a01bcba744bd82ecea3e36c4ee9a994f010508a28a09df38f652e74643b&quot;, &quot;vout&quot;: 0&#125;]&#39; &#39;[&#123;&quot;bcrt1qqzv3ekkueheseddqge3mqdcukse6p9d5yuqxv3&quot;: &quot;50.00000000&quot;&#125;]&#39;

02000000013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff01f90295000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000

# 再将开头的 02 换成 03，也即 TRUC 交易的版本号
03000000013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff01f90295000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000

# 签名并发送
bitcoin-cli -regtest -rpcwallet=test signrawtransactionwithwallet 03000000013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff01f90295000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000
&#123;
  &quot;hex&quot;: &quot;030000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff01f90295000000000016001400991cdadccdf30cb5a04663b0371cb433a095b40247304402200a82f2fd8aa5f32cdfd9540209ccfc36a95eea21518ede1c3787561c8fb7269702207a258e6f027ce156271879c38628ad9b3425b83c33d8cd95fb20dd3c567fdff70121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000&quot;,
  &quot;complete&quot;: true
&#125;

bitcoin-cli -regtest sendrawtransaction 030000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff01f90295000000000016001400991cdadccdf30cb5a04663b0371cb433a095b40247304402200a82f2fd8aa5f32cdfd9540209ccfc36a95eea21518ede1c3787561c8fb7269702207a258e6f027ce156271879c38628ad9b3425b83c33d8cd95fb20dd3c567fdff70121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000

error code: -26
error message:
min relay fee not met, 0 &lt; 110

# 我们需要使用这个输出的交易包转发和 CPFP
bitcoin-cli -regtest decoderawtransaction 030000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff01f90295000000000016001400991cdadccdf30cb5a04663b0371cb433a095b40247304402200a82f2fd8aa5f32cdfd9540209ccfc36a95eea21518ede1c3787561c8fb7269702207a258e6f027ce156271879c38628ad9b3425b83c33d8cd95fb20dd3c567fdff70121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000

&#123;
  &quot;txid&quot;: &quot;bf9164db69d216da4af6d9c720a0cec6d7e0bafb1702fdf8c2cd5606101576de&quot;,
  &quot;hash&quot;: &quot;7d855ffbd8bc17892e28f3f326d0e4919d35c27a7370f5d9f9ce538e93a347cf&quot;,
  &quot;version&quot;: 3,
  &quot;size&quot;: 191,
  &quot;vsize&quot;: 110,
  ...
  &quot;vout&quot;: [
    ...
    &quot;scriptPubKey&quot;: &#123;
      &quot;hex&quot;: &quot;001400991cdadccdf30cb5a04663b0371cb433a095b4&quot;,
    ...
&#125;

# 从输出中扣减掉为 CPFP 准备的手续费
bitcoin-cli -regtest createrawtransaction &#39;[&#123;&quot;txid&quot;: &quot;bf9164db69d216da4af6d9c720a0cec6d7e0bafb1702fdf8c2cd5606101576de&quot;, &quot;vout&quot;: 0&#125;]&#39; &#39;[&#123;&quot;bcrt1qqzv3ekkueheseddqge3mqdcukse6p9d5yuqxv3&quot;: &quot;49.99994375&quot;&#125;]&#39;
0200000001de7615100656cdc2f8fd0217fbbae0d7c6cea020c7d9f64ada16d269db6491bf0000000000fdffffff0100ed94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000

# 签名 TRUC 变体并发送（作为一个 1P1C 交易包）
bitcoin-cli -regtest -rpcwallet=test signrawtransactionwithwallet 0300000001de7615100656cdc2f8fd0217fbbae0d7c6cea020c7d9f64ada16d269db6491bf0000000000fdffffff0100ed94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000 &#39;[&#123;&quot;txid&quot;: &quot;bf9164db69d216da4af6d9c720a0cec6d7e0bafb1702fdf8c2cd5606101576de&quot;, &quot;vout&quot;: 0, &quot;scriptPubKey&quot;: &quot;001400991cdadccdf30cb5a04663b0371cb433a095b4&quot;, &quot;amount&quot;: &quot;50.00000000&quot;&#125;]&#39;
&#123;
  &quot;hex&quot;: &quot;03000000000101de7615100656cdc2f8fd0217fbbae0d7c6cea020c7d9f64ada16d269db6491bf0000000000fdffffff0100ed94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4024730440220685a6d76db97b2c27950f267b70d606f1864002ff6b4617cd2e29afd5ddfac83022037be8bb2ebe8194b4263f16a634e5c00a5f6c4eef0968d12994ed66dcf15b9ac0121020797cc343a24dfe49c7ee9b94bf3daaf15308d8c12e3f0f7e102b95ee55f939f00000000&quot;,
  &quot;complete&quot;: true
&#125;

bitcoin-cli -regtest -rpcwallet=test submitpackage &#39;[&quot;030000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff01f90295000000000016001400991cdadccdf30cb5a04663b0371cb433a095b40247304402200a82f2fd8aa5f32cdfd9540209ccfc36a95eea21518ede1c3787561c8fb7269702207a258e6f027ce156271879c38628ad9b3425b83c33d8cd95fb20dd3c567fdff70121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000&quot;, &quot;03000000000101de7615100656cdc2f8fd0217fbbae0d7c6cea020c7d9f64ada16d269db6491bf0000000000fdffffff0100ed94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4024730440220685a6d76db97b2c27950f267b70d606f1864002ff6b4617cd2e29afd5ddfac83022037be8bb2ebe8194b4263f16a634e5c00a5f6c4eef0968d12994ed66dcf15b9ac0121020797cc343a24dfe49c7ee9b94bf3daaf15308d8c12e3f0f7e102b95ee55f939f00000000&quot;]&#39;
&#123;
  &quot;package_msg&quot;: &quot;success&quot;,
  &quot;tx-results&quot;: &#123;
    &quot;7d855ffbd8bc17892e28f3f326d0e4919d35c27a7370f5d9f9ce538e93a347cf&quot;: &#123;
      &quot;txid&quot;: &quot;bf9164db69d216da4af6d9c720a0cec6d7e0bafb1702fdf8c2cd5606101576de&quot;,
      &quot;vsize&quot;: 110,
      &quot;fees&quot;: &#123;
        &quot;base&quot;: 0.00000000,
        &quot;effective-feerate&quot;: 0.00025568,
        &quot;effective-includes&quot;: [
          &quot;7d855ffbd8bc17892e28f3f326d0e4919d35c27a7370f5d9f9ce538e93a347cf&quot;,
          &quot;4333b3d2eea820373262c7ffb768028bc82f99f47839349722eb60c58cd65b55&quot;
        ]
      &#125;
    &#125;,
    &quot;4333b3d2eea820373262c7ffb768028bc82f99f47839349722eb60c58cd65b55&quot;: &#123;
      &quot;txid&quot;: &quot;6c2f4dec614c138703f33e6a5c215112bad4cf79593e9757105e09b09bf3e2de&quot;,
      &quot;vsize&quot;: 110,
      &quot;fees&quot;: &#123;
        &quot;base&quot;: 0.00005625,
        &quot;effective-feerate&quot;: 0.00025568,
        &quot;effective-includes&quot;: [
          &quot;7d855ffbd8bc17892e28f3f326d0e4919d35c27a7370f5d9f9ce538e93a347cf&quot;,
          &quot;4333b3d2eea820373262c7ffb768028bc82f99f47839349722eb60c58cd65b55&quot;
        ]
      &#125;
    &#125;
  &#125;,
  &quot;replaced-transactions&quot;: [
  ]
&#125;
</code></pre><p>这个 1P1C 交易包进入了本地的交易池，实质费率是 25.568 聪&#x2F;vB，虽然其中的父交易的费率低于最低转发费率。成功！</p><h2 id=TRUC-交易><a href=#TRUC-交易 class=headerlink title="TRUC 交易"></a>TRUC 交易</h2><p>“确认前拓扑受限的（TRUC）” 交易也叫 “v3 交易”，是一种新的、可选的<a target=_blank rel=noopener href=https://bitcoinops.org/en/blog/waiting-for-confirmation/ >交易池条款</a>，旨在允许可靠的交易手续费替换（RBF）、缓解跟手续费相关的交易<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/transaction-pinning/ >钉死</a>攻击以及交易包限制钉死攻击。它的核心理念是：<strong>虽然许多特性并不适合所有交易，但我们可以为内部拓扑受到限制的交易包实现它们</strong>。TRUC 创造了一种以拓扑上的限制为代价、选择性进入这些更健壮的条款的方法。</p><p>简而言之，一笔 TRUC 交易就是一笔 nVersion 字段的值为 3 的交易，并且，其交易单体不能超过 10 kvB、其仅有的一笔子交易也是 TRUC 交易且体积不得超过 1kvB。TRUC 交易不能花费未确认且非 TRUC 的交易，反之也如此（未确认且非 TRUC 的交易也不能花费 TRUC 交易）。所有 TRUC 交易也都被认为选择性使用 RBF，不论是否在交易中表达了 <a target=_blank rel=noopener href=https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki>BIP125 信号</a>。如果另一笔不冲突的 TRUC 子交易被添加到了父 TRUC 交易，该交易会被当成跟原本的子交易<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/kindred-replace-by-fee/ >冲突</a>，然后适用通常的 RBF 替换规则，包括手续费率检查和总手续费检查。</p><p>TRUC 交易也允许是 0 手续费的，因为子交易足以为整个交易包追加手续费。</p><p>这种受限制的拓扑也恰好在 1P1C 转发范式内，如果所有版本的预签名交易都是 TRUC 交易的话，就不必管交易的对手方做什么。</p><p>TRUC 支付是可以替换的，所以，任何携带了不完全属于交易者的输入的交易都是可以被重复花费的。换句话说，收取 TRUC 的零确认支付是在安全性上不如收取非 TRUC 的零确认支付。</p><h2 id=1P1C-拓扑的交易包-RBF><a href=#1P1C-拓扑的交易包-RBF class=headerlink title="1P1C 拓扑的交易包 RBF"></a>1P1C 拓扑的交易包 RBF</h2><p>有时候，1P1C 交易包中的父交易会跟交易池内的交易相冲突。在这笔父交易的多个版本都得到了预签名的时候，可能就会出现这种情况。以往，这笔新的父交易会在 RBF 规则下被单独考虑，并且，如果手续费太低的话，就会被抛弃。</p><p>而使用 1P1C 拓扑交易包 RBF，这个新的子交易也会被纳入 RBF 检查的考量，这就允许钱包开发者通过 P2P 网络获得可靠的 1P1C 交易包传播，无论哪个版本的交易曾经进入交易池。</p><p>注意，目前，冲突交易的单体和 1P1C 交易包都不能有别的依赖。否则，替代交易会被拒绝。这样的族群的冲突可能有任意多个。在未来，当我们实现族群交易池的时候，这条规则会被放松。</p><p>继续我们前面的 1P1C 案例，我们准备对已有的这个 1P1C 交易包执行一次交易包 RBF，这一次将使用一笔非 TRUC 的交易包：</p><pre><code># 父子交易对
bitcoin-cli -regtest getrawmempool
[
  &quot;bf9164db69d216da4af6d9c720a0cec6d7e0bafb1702fdf8c2cd5606101576de&quot;,
  &quot;6c2f4dec614c138703f33e6a5c215112bad4cf79593e9757105e09b09bf3e2de&quot;
]

# 使用一个新的 v2 1P1C 交易包来重复花费上述父交易 
# 新交易包中的父交易的手续费率超过最低转发费率，但不足以 RBF 原交易包
bitcoin-cli -regtest createrawtransaction &#39;[&#123;&quot;txid&quot;: &quot;49ea7a01bcba744bd82ecea3e36c4ee9a994f010508a28a09df38f652e74643b&quot;, &quot;vout&quot;: 0&#125;]&#39; &#39;[&#123;&quot;bcrt1qqzv3ekkueheseddqge3mqdcukse6p9d5yuqxv3&quot;: &quot;49.99999&quot;&#125;]&#39;

02000000013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff0111ff94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000

# 签名并发送（将遭遇失败）
bitcoin-cli -regtest -rpcwallet=test signrawtransactionwithwallet 02000000013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff0111ff94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000
&#123;
  &quot;hex&quot;: &quot;020000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff0111ff94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4024730440220488d98ad79495276bb4cdda4d7c62292043e185fa705d505c7dceef76c4b61d30220567243245416a9dd3b76f3d94bfd749e0915929226ba079ec918f6675cbfa3950121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000&quot;,
  &quot;complete&quot;: true
&#125;

bitcoin-cli -regtest sendrawtransaction 020000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff0111ff94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4024730440220488d98ad79495276bb4cdda4d7c62292043e185fa705d505c7dceef76c4b61d30220567243245416a9dd3b76f3d94bfd749e0915929226ba079ec918f6675cbfa3950121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000

error code: -26
error message:
insufficient fee, rejecting replacement f17146d87a029cb04777256fc0382c637a31b2375f3981df0fb498b9e44ceb59, less fees than conflicting txs; 0.00001 &lt; 0.00005625

# 通过子交易，向新的交易包注入更多手续费，以打败旧的交易包
bitcoin-cli -regtest createrawtransaction &#39;[&#123;&quot;txid&quot;: &quot;f17146d87a029cb04777256fc0382c637a31b2375f3981df0fb498b9e44ceb59&quot;, &quot;vout&quot;: 0&#125;]&#39; &#39;[&#123;&quot;bcrt1qqzv3ekkueheseddqge3mqdcukse6p9d5yuqxv3&quot;: &quot;49.99234375&quot;&#125;]&#39;

020000000159eb4ce4b998b40fdf81395f37b2317a632c38c06f257747b09c027ad84671f10000000000fdffffff01405489000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000

# 签名并发送（新的交易包）
bitcoin-cli -regtest -rpcwallet=test signrawtransactionwithwallet 020000000159eb4ce4b998b40fdf81395f37b2317a632c38c06f257747b09c027ad84671f10000000000fdffffff01405489000000000016001400991cdadccdf30cb5a04663b0371cb433a095b400000000 &#39;[&#123;&quot;txid&quot;: &quot;f17146d87a029cb04777256fc0382c637a31b2375f3981df0fb498b9e44ceb59&quot;, &quot;vout&quot;: 0, &quot;scriptPubKey&quot;: &quot;001400991cdadccdf30cb5a04663b0371cb433a095b4&quot;, &quot;amount&quot;: &quot;49.99999&quot;&#125;]&#39;
&#123;
  &quot;hex&quot;: &quot;0200000000010159eb4ce4b998b40fdf81395f37b2317a632c38c06f257747b09c027ad84671f10000000000fdffffff01405489000000000016001400991cdadccdf30cb5a04663b0371cb433a095b40247304402205d086fa617bdbf5a3df3a15cc9a927ad884c714d46d9ef6762ad2fa6a259740c022032c60b4fe5d533d990489c27dc3283d8b3999b97f6c12986ac8159b92cb6de820121020797cc343a24dfe49c7ee9b94bf3daaf15308d8c12e3f0f7e102b95ee55f939f00000000&quot;,
  &quot;complete&quot;: true
&#125;

bitcoin-cli -regtest -rpcwallet=test submitpackage &#39;[&quot;020000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff0111ff94000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4024730440220488d98ad79495276bb4cdda4d7c62292043e185fa705d505c7dceef76c4b61d30220567243245416a9dd3b76f3d94bfd749e0915929226ba079ec918f6675cbfa3950121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000&quot;, &quot;0200000000010159eb4ce4b998b40fdf81395f37b2317a632c38c06f257747b09c027ad84671f10000000000fdffffff01405489000000000016001400991cdadccdf30cb5a04663b0371cb433a095b40247304402205d086fa617bdbf5a3df3a15cc9a927ad884c714d46d9ef6762ad2fa6a259740c022032c60b4fe5d533d990489c27dc3283d8b3999b97f6c12986ac8159b92cb6de820121020797cc343a24dfe49c7ee9b94bf3daaf15308d8c12e3f0f7e102b95ee55f939f00000000&quot;]&#39;
&#123;
  &quot;package_msg&quot;: &quot;success&quot;,
  &quot;tx-results&quot;: &#123;
    &quot;fe15d23f59537d12cddf510616397b639a7b91ba2f846c64533e847e53d7c313&quot;: &#123;
      &quot;txid&quot;: &quot;f17146d87a029cb04777256fc0382c637a31b2375f3981df0fb498b9e44ceb59&quot;,
      &quot;vsize&quot;: 110,
      &quot;fees&quot;: &#123;
        &quot;base&quot;: 0.00001000,
        &quot;effective-feerate&quot;: 0.03480113,
        &quot;effective-includes&quot;: [
          &quot;fe15d23f59537d12cddf510616397b639a7b91ba2f846c64533e847e53d7c313&quot;,
          &quot;256cebd037963d77b2692cdc33ee36ee0b0944e6b9486a6aaad0792daa0f677c&quot;
        ]
      &#125;
    &#125;,
    &quot;256cebd037963d77b2692cdc33ee36ee0b0944e6b9486a6aaad0792daa0f677c&quot;: &#123;
      &quot;txid&quot;: &quot;858fe07b01bc7c1c1dda50ba16a33b164c0bc03d0eff8f9546558c088e087f60&quot;,
      &quot;vsize&quot;: 110,
      &quot;fees&quot;: &#123;
        &quot;base&quot;: 0.00764625,
        &quot;effective-feerate&quot;: 0.03480113,
        &quot;effective-includes&quot;: [
          &quot;fe15d23f59537d12cddf510616397b639a7b91ba2f846c64533e847e53d7c313&quot;,
          &quot;256cebd037963d77b2692cdc33ee36ee0b0944e6b9486a6aaad0792daa0f677c&quot;
        ]
      &#125;
    &#125;
  &#125;,
  &quot;replaced-transactions&quot;: [
    &quot;bf9164db69d216da4af6d9c720a0cec6d7e0bafb1702fdf8c2cd5606101576de&quot;,
    &quot;6c2f4dec614c138703f33e6a5c215112bad4cf79593e9757105e09b09bf3e2de&quot;
  ]
&#125;
</code></pre><h2 id=支付到锚点（P2A）><a href=#支付到锚点（P2A） class=headerlink title=支付到锚点（P2A）></a>支付到锚点（P2A）</h2><p>“<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/anchor-outputs/ >锚点输出</a>” 可以定义为一种输出，父交易携带它的唯一目的就是允许子交易通过 CPFP 来为父交易追加手续费。因为这样的输出并非支付，它们是低价值的，面额接近于 “粉尘数额”，而且会被立即花掉。</p><p>Bitcoin Core 28.0 添加了一种新的输出脚本类型 “<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/ephemeral-anchors/ >支付到锚点（P2A）</a>”，允许使用一种优化的 “无密钥” 锚点。这种输出的脚本是 “OP_1 &lt;4e73&gt;”，花费它不需要任何见证数据，这意味着需要为它支付的手续费会比现有的锚点输出更小。它也允许任何人凭它来创建用于 CPFP 的子交易。</p><p>P2A 可以独立于 TRUC 交易和 1P1C 交易包来使用。一笔带有 P2A 输出但没有子交易的交易也可以得到广播，只不过这种输出很容易被花掉。类似地，交易包和 TRUC 交易也不是必须使用 P2A 输出。</p><p>这种新的输出的粉尘面额下限是 240 聪。携带低于这个面额的 P2A 输出的交易不会得到传播，即使它们在交易包中被花费，因为交易包条款依然完全实施<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/uneconomical-outputs/ >粉尘</a>面额限制。虽然这个提议曾经跟 “临时粉尘” 提议相关联，但现在已经不是这样了。</p><p>创建和花费 P2A 的案例：</p><pre><code># Regtest 上的 P2A 地址是 “bcrt1pfeesnyr2tx”，主网上的 P2A 地址是 “bc1pfeessrawgf”
bitcoin-cli -regtest getaddressinfo bcrt1pfeesnyr2tx
&#123;
  &quot;address&quot;: &quot;bcrt1pfeesnyr2tx&quot;,
  &quot;scriptPubKey&quot;: &quot;51024e73&quot;,
  &quot;ismine&quot;: false,
  &quot;solvable&quot;: false,
  &quot;iswatchonly&quot;: false,
  &quot;isscript&quot;: true,
  &quot;iswitness&quot;: true,
  &quot;ischange&quot;: false,
  &quot;labels&quot;: [
  ]
&#125;

# 这是一种隔离见证输出，类型为 “anchor”
bitcoin-cli -regtest decodescript 51024e73
&#123;
  &quot;asm&quot;: &quot;1 29518&quot;,
  &quot;desc&quot;: &quot;addr(bcrt1pfeesnyr2tx)#swxgse0y&quot;,
  &quot;address&quot;: &quot;bcrt1pfeesnyr2tx&quot;,
  &quot;type&quot;: &quot;anchor&quot;
&#125;

# P2WPKH 和 P2S 输出的最低面额
bitcoin-cli -regtest createrawtransaction &#39;[&#123;&quot;txid&quot;: &quot;49ea7a01bcba744bd82ecea3e36c4ee9a994f010508a28a09df38f652e74643b&quot;, &quot;vout&quot;: 0&#125;]&#39; &#39;[&#123;&quot;bcrt1qqzv3ekkueheseddqge3mqdcukse6p9d5yuqxv3&quot;: &quot;0.00000294&quot;&#125;, &#123;&quot;bcrt1pfeesnyr2tx&quot;: &quot;0.00000240&quot;&#125;]&#39;
02000000013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff02260100000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4f0000000000000000451024e7300000000

# 签名和发送带有 P2A 输出的交易
bitcoin-cli -regtest -rpcwallet=test signrawtransactionwithwallet 02000000013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff02260100000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4f0000000000000000451024e7300000000
&#123;
  &quot;hex&quot;: &quot;020000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff02260100000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4f0000000000000000451024e7302473044022002c7e756b15135a3c0a061df893a857b42572fd816e41d3768511437baaeee4102200c51fcce1e5afd69a28c2d48a74fd5e58b280b7aa2f967460673f6959ab565e80121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000&quot;,
  &quot;complete&quot;: true

# 关闭健全费用检查
bitcoin-cli -regtest -rpcwallet=test sendrawtransaction 020000000001013b64742e658ff39da0288a5010f094a9e94e6ce3a3ce2ed84b74babc017aea490000000000fdffffff02260100000000000016001400991cdadccdf30cb5a04663b0371cb433a095b4f0000000000000000451024e7302473044022002c7e756b15135a3c0a061df893a857b42572fd816e41d3768511437baaeee4102200c51fcce1e5afd69a28c2d48a74fd5e58b280b7aa2f967460673f6959ab565e80121030af1fadce80bcb8ba614634bc82c71eea2ed87a5692d3127766cc896cef1bdb100000000 &quot;0&quot;
fdee3b6a5354f31ce32242db10eb9ee66017e939ea87db0c39332262a41a424b

# 替换前一个交易包
bitcoin-cli -regtest getrawmempool
[
  &quot;fdee3b6a5354f31ce32242db10eb9ee66017e939ea87db0c39332262a41a424b&quot;
]

# 对子交易，将价值都变成手续费；让 65vbyte 大小的交易使用 OP_RETURN 输出，以避免 tx-size-small 错误
bitcoin-cli -regtest createrawtransaction &#39;[&#123;&quot;txid&quot;: &quot;fdee3b6a5354f31ce32242db10eb9ee66017e939ea87db0c39332262a41a424b&quot;, &quot;vout&quot;: 1&#125;]&#39; &#39;[&#123;&quot;data&quot;: &quot;feeeee&quot;&#125;]&#39;
02000000014b421aa4622233390cdb87ea39e91760e69eeb10db4222e31cf354536a3beefd0100000000fdffffff010000000000000000056a03feeeee00000000

# 不需要签名；这是一种不需要见证数据的隔离见证输出
bitcoin-cli -regtest -rpcwallet=test sendrawtransaction 02000000014b421aa4622233390cdb87ea39e91760e69eeb10db4222e31cf354536a3beefd0100000000fdffffff010000000000000000056a03feeeee00000000
8d092b61ef3c1a58c24915671b91fbc6a89962912264afabc071a4dbfd1a484e
</code></pre><h2 id=用户指引><a href=#用户指引 class=headerlink title=用户指引></a>用户指引</h2><p>以下不再是更新公告式的特性说明，而会介绍一些常见的钱包模式，以及它们如何能从这些更新中获益，不论钱包是否主动升级。</p><h3 id=简单支付><a href=#简单支付 class=headerlink title=简单支付></a>简单支付</h3><p>支付者面临的一个问题是，无法保证支付交易的接收者不能创建一个任意长的交易链条、从而将支付交易钉死在交易池中；因此也无法有把握地运行 RBF。如果用户希望有更加可预测的 RBF 行为，一种办法是选择性进入 TRUC 交易。即使是接收支付，也可以通过一笔最大可达 1kvB 的子交易（花费正在等待确认的支付）来可靠地追加手续费。</p><p>如果采用这种技术，钱包软件应该：</p><ul><li>将交易版本号设为 3</li><li>仅使用已经得到确认的输出</li><li>保持交易体积在 10kvB 以下（与非 TRUC 交易所面临的 100 kvB 限制不同）<ul><li>这个更严格的限制依然支持稍微大一些的批量支付</li><li>如果钱包没有别的选择，只能花费一个未确认的输入，那么这个输入必须来自一笔 TRUC 交易，并且这笔新交易的体积要低于 1kvB</li></ul></li></ul><h3 id=Coinjoin><a href=#Coinjoin class=headerlink title=Coinjoin></a>Coinjoin</h3><p>在 <a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/coinjoin/ >coinjoin</a> 场景中，人们关注的是隐私性，但 coinjoin 交易本身并没有隐藏起来的需要，因此，为 coinjoin 交易使用 TRUC 交易可能是有价值的。一笔 coinjoin 交易可能因为费率不够而无法进入区块链，从而需要手续费追加。</p><p>还可以跟 TRUC 交易一道，加入 P2A 输入，从而允许另一个钱包（比如瞭望塔）单独为交易支付手续费。</p><p>如果其他参与者也想花费自己的未确认的 coinjoin 交易输出，可能就会发生 “TRUC 亲属驱逐”。亲属交易驱逐可以保持 TRUC 的拓扑限制，但允许发生更高费率的 CPFP —— 新的子交易可以 “替代” 旧的子交易，无需花费相同的输入（译者注：此处的 “替代” 打双引号是因为这两笔子交易本身并非冲突交易，它们并没有花费相同的输入，只是因为 TRUC 只允许一个子交易，才会不能共存）。因此，coinjoin 交易的所有参与者都总是能够 CPFP coinjoin 交易。</p><p>警告：一笔 coinjoin 交易的参与者依然可以通过重复花费自己在 coinjoin 交易中的输入来挫败 coinjoin 交易（只需付出微小的经济代价）；要反击，就需要 coinjoin 交易 RBF 掉攻击者的第一笔交易。</p><h3 id=闪电网络><a href=#闪电网络 class=headerlink title=闪电网络></a>闪电网络</h3><p>在商店网络协议中生成的交易有几种主要的类型：</p><ol><li>注资交易：单方注资或双方注资的交易，用于建立合约。对及时确认相对不敏感。</li><li>承诺交易：承诺一条支付通道的最新状态。这些交易是不对称的，而且当前双方需要一笔 “update_fee” 消息来更新将注资输出中的多少价值变成手续费。这里的手续费必须足以将最新版本的承诺交易传播到矿工的交易池。</li><li>与 HTLC 相关的预签名交易。</li></ol><p>使用 1P1C 转发和交易包 RBF，更新后的 Bitcoin Core 节点可以极大低提高闪电网络的安全性。闪电通道的单方面关闭可以通过低于交易池最低费率的承诺交易来实现，也可以跟另一个低费率、无法立即进入区块的承诺交易包相冲突。</p><p>为了最大限度利用这一升级，钱包和后端应该集成 Bitcoin Core 的 RPC 命令 <strong>submitpackage</strong> ：</p><pre><code>bitcoin-cli submitpackage ‘[“&lt;commitment_tx_hex&gt;”, “&lt;anchor_spend_hex&gt;”]’
</code></pre><p>钱包实现应该让自己的软件集成这个命令，并使用这个命令来发送承诺交易以及一笔花费锚点输出的子交易，以保证这个交易包能以合适的费率到达矿工的交易池。</p><p>注意：如果你发送的是一个包含单个父交易和多个子交易的交易包，命令依然会返回 “成功”，但这样的交易包无法在（本次更新的） 1P1C 交易包转发条款下转发。</p><p>如果有足够多的节点升级到支持这些特性，闪电网络协议可能会升级为抛弃 “update_fee” 消息 —— 这一消息本身也是多年来网络手续费暴涨期间、许多通道不必要地强制关闭的源头。移除这种消息之后，承诺交易可以设置为静态的 1 聪&#x2F;vB 费率。使用 TRUC 交易，我们可以保证，相互竞争的承诺交易及其花费锚点输出的子交易可以在网络中相互 RBF；而且，如果同一笔承诺交易有相互竞争的输出花费子交易，RBF 依然可以发生，无论被花费的是哪个输出。TRUC 交易可以是 0 费率的，允许进一步降低规范的复杂性。有了 TRUC 亲属驱逐，我们也可以抛弃长达 1 区块的 CSV 锁定时间，因为我们已经不再需要担心哪个未确认的输出会被花费，只要每一方都至少可以花费一个输出。</p><p>使用 TRUC + P2A 输出，我们可以将承诺交易当前的两个锚点输出减少为一个无密钥的锚点，从而降低对区块空间的使用。无密钥锚点不需要进入公钥，花费起来也不需要签名，可以进一步降低对区块空间的使用。手续费追加也可以外包给没有私钥的其他代理人。锚点也可以由双方共享密钥材料的一个输出组成，而不使用 P2A，代价则是在良性的单方关闭场景中占用更多 vbyte。</p><p>在实现一些高级特性，比如 “通道拼接” 时，也可以追求类似的策略，以降低 RBF 钉死攻击风险。举个例子，一笔体积小于 1 kvB 的 TRUC 通道拼接交易，可以 CPFP 另一条通道的单方关闭交易，而追加手续费的用户也无需担心 RBF 钉死攻击。后续的手续费追加可以通过连续替代这笔通道拼接交易来实现。代价则是在通道拼接期间暴露 TRUC 交易类型。</p><p>如你所见，这些更新后的特性可以避免许多复杂性并节约空间占用，只要每一笔交易都符合 1P1C 范式。</p><h3 id=Ark><a href=#Ark class=headerlink title=Ark></a>Ark</h3><p>并非所有交易都符合 1P1C 范式。一个主要的例子就是 <a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/ark/ >Ark</a> 输出，它承诺的是一棵由预签名的（或者被限制条款锁定的）交易组成的树；这棵树可以使一个共享 UTXO 的内部状态完全展开。</p><p>如果一个 Ark 服务供应商（ASP）离线了，或不处理某一笔交易，用户可以选择单方面退出，那么这名用户需要提交一系列的交易，以展开自己在交易树上的分支。这需要 O(logn) 笔交易。如果其他用户也在同一时间尝试离开这棵树，导致超过了交易池的限制，或产生了相互冲突的交易但都不足以及时进入区块，问题就会变得更加复杂。如果单方退出的相关交易经过了特别长的时间窗口都没有得到区块确认，这个 APS 就可以单方面取走这棵交易树上的所有资金、导致用户资金损失。</p><p>理想情况下，一棵 Ark 树的单方面退出应该是这样的：</p><ol><li>发布从树根（Ark 输出）到最底层的虚拟 UTXO（vUTXO）的完整默克尔分支</li><li>构成分支的每一笔交易都是 0 费率的，以避免手续费预测以及提前确认由谁来支付手续费</li><li>最终的叶子交易有一个 0 价值的锚点，并被单方退出的用户所花费，从而为整个默克尔分支 CPFP 支付手续费，让整个默克尔分支可以进入矿工的交易池然后进入区块</li></ol><p>为了塑造这样的理想情形，我们还缺少一些东西：</p><ol><li>通用的交易包转发。当前，我们还没有方法，能在这个 P2P 网络中可靠地转发由 0 费率交易构成的交易链条。</li><li>如果太多分支以较低费率发布，某些用户可能无法及时发布自己的分支，因为已有的发布已经触及了后代交易的数量限制。这可能会变成灾难，如果 Ark 的参与者数量变得很大，就像理想化的 Ark 使用场景中那样。</li><li>我们需要通用的亲属驱逐。而且当前，还不能为无价值的锚定支持 0 价值的输出。</li></ol><p>反过来，我们可以尝试将所需的交易结构尽可能放进 1P1C 范式中，代价是一些额外的手续费。所有的 Ark 树交易（从树根开始），都设为 TRUC 交易，并添加一个最小价值的 P2A 输出。</p><p>当一个用户决定单方面从一棵 Ark 树退出，这名用户需要发布根交易以及花费其 P2A 输出、追加手续费的交易，然后等待确认。一旦根交易得到确认，就发布他们在默克尔分支上的下一笔交易，以及花费其 P2A 输出、追加手续费的交易（然后等待确认）。以此类推，直到发布整个默克尔分支、从 Ark 树中安全地取回自己的资金。同一棵 Ark 树的其他用户可能恶意或者以外地提交相同的交易、并使用太低的费率，但亲属驱逐保证了，在每一步中，低于 1kvB 的诚实子交易总是能 RBF 相互竞争的子交易，既不需要锁定所有其它输出，也不需要设置多个锚点输出。</p><p>假设交易树的形式是二叉树，相比理想化的 Ark，第一位退出的用户需要多占用接近 100% 的 vbyte；如果是完全展开整棵树，则需要多占用大约 50% 的 vbyte。如果是四叉树，展开整棵树可以降低到只多占用大约 25% 的 vbyte。</p><h3 id=闪电通道拼接><a href=#闪电通道拼接 class=headerlink title=闪电通道拼接></a>闪电通道拼接</h3><p>其它类型的拓扑也出现在更高级的闪电网络构造中，可能需要一些工作来匹配 1P1C 交易包转发。</p><p>闪电网络中的 “<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/splicing/ >通道拼接</a>” 是一种新兴的标准操作，而且已经被使用了。每一次拼接都会花费原有的注资输出、将合约中的资金重新存入一个新的注资输出，并为两个注资输出准备相同的预签名承诺交易链条。在拼接交易还未确认的时候，基于原注资输出和通道状态和新注资输出的通道状态是同时签名和追踪的。</p><p>会超出 1P1C 范式的一个例子是这样的：</p><ol><li>Alice 和 Bob 为一条通道注资。</li><li>Alice <em>拼出</em> 一些资金给一个由 Carol 控制的链上资金，Carol 正在使用一组冷密钥，所以无法 CPFP。而这笔拼接交易就在那里等待确认等了几个驾驽车。</li><li>Bob 的节点离线了，或出于什么原因强制关闭了通道。</li><li>费率的暴涨（可能又有什么 token 发售了），将这笔拼接交易的确认进一步推迟。</li></ol><p>Alice 希望给 Caol 的链上支付尽快发生，所以她不会拿没有发生拼接的承诺交易上联。这意味着，拼接交易 -&gt; 承诺交易 -&gt; 锚点花费变成了需要传播的交易包。</p><p>反过来，让我们看看怎么把它放进 1P1C 范式中，同时减少不必要的空间占用。闪电钱包可以为一笔链上支付运行两次（而不是一次）通道拼接，那么这两笔拼接交易就会相互冲突。其中一个版本使用由费率估算器选出的相对保守的费率，而另一个版本可以包含一个 240 聪的 P2A 输出（或者 0 聪的 P2A 输出，在有了 “<a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/ephemeral-anchors/ >临时锚点</a>” 之后）。</p><p>首先，广播没有锚点的拼接交易。</p><p>如果没有发生费率暴涨，该交易会得到确认，然后 Alice 可以按需继续强制关闭通道，就像正常情形。</p><p>如果手续费市场突发变化，导致第一笔拼接交易等待了太长时间，那么就广播带有锚点的拼接交易以及花费锚点的子交易（作为 1P1C 交易包），从而使用交易包 RBF 替代掉第一笔拼接交易。这一手续费追加将让给 Carol 的支付得到确认，然后 Alice 可以按需继续强制关闭通道。</p><p>拼接交易的更多副本可以使用多种费率水平，但要提醒的是，每多一个副本，就需要多一组承诺交易的签名，以及对承诺交易中给出的 HTLC（offered HTLC） 的签名。</p><p>（完）</p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>