<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>闪电网络：技术与用户体验（七）：手续费支付</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/mempool>mempool</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">闪电网络：技术与用户体验（七）：手续费支付</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>闪电网络：技术与用户体验（七）：手续费支付</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/mempool>mempool</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%89%8B%E7%BB%AD%E8%B4%B9%E7%9A%84%E6%94%AF%E4%BB%98%E4%B8%8E%E8%BF%BD%E5%8A%A0><span class=toc-text>手续费的支付与追加</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#RBF><span class=toc-text>RBF</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#CPFP><span class=toc-text>CPFP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%97%A9%E6%9C%9F%E8%AE%BE%E8%AE%A1%EF%BC%88Legacy-Channels%EF%BC%89><span class=toc-text>早期设计（Legacy Channels）</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%94%9A%E7%82%B9%E9%80%9A%E9%81%93><span class=toc-text>锚点通道</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A4%8D%E6%9D%82%E7%9A%84%E4%BA%8B%E5%AE%9E><span class=toc-text>复杂的事实</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%9F%BA%E4%BA%8E-1P1C-%E4%BA%A4%E6%98%93%E5%8C%85%E7%9A%84%E6%96%B0%E8%8C%83%E5%BC%8F><span class=toc-text>基于 1P1C 交易包的新范式</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BB%93%E8%AF%AD><span class=toc-text>结语</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%84%9A%E6%B3%A8><span class=toc-text>脚注</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>闪电网络：技术与用户体验（七）：手续费支付</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt=Anony><div class=page-author-info><strong>Anony</strong><time class=has-text-grey datetime=2025-04-29T11:29:53.000Z>2025-04-29</time></div></div><div class=is-flex><a href=/tags/%E9%80%9A%E9%81%93%E6%9E%84%E9%80%A0><i class="page-tag mr-1 px-1">通道构造</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：Anony</em></p><p><em><a href=https://www.btcstudy.org/2024/03/04/lightning-network-technology-improvement-and-users-experience-part-6/ >前篇见此处</a></em></p></blockquote><p>在本系列的<a href=https://www.btcstudy.org/2024/03/04/lightning-network-technology-improvement-and-users-experience-part-2/ >第二篇文章</a>中，我们已经指出，闪电通道的构造方法和最终效果，可以随比特币协议的提升而提升。然而，实际上，在一个较少获得关注、但与通道的构造紧密相关的领域，闪电通道一直在比特币协议的共识规则未升级的前提下不断优化，那就是交易的手续费支付。</p><p>在闪电通道中，通道状态以承诺交易来表达，而每一笔承诺交易都有可能被发送上链，那就必须为这些交易考虑手续费问题。反过来，支付手续费的方法也会影响通道内可用的余额和批量处理交易的可能性，进而影响用户体验。</p><p>在本文中，我们会回顾闪电通道的手续费支付设计是如何得到逐步优化的，这些优化又如何改进用户体验。需要读者先理解闪电网络的工作原理和安全要求。</p><p>在开始之前，请想一个 “简单” 的问题：一条通道是由双方共同拥有的，双方都有可能在其中持有余额，那么，在需要将交易提交上链的时候，应该由谁来支付手续费呢？在比特币交易中，这该如何实现？</p><p>好了，我们先从比特币手续费支付的方法说起。</p><h2 id=手续费的支付与追加><a href=#手续费的支付与追加 class=headerlink title=手续费的支付与追加></a>手续费的支付与追加</h2><p>在一笔比特币交易得到区块确认时，其输入资金之和与输出资金之和的差值，可以被挖出这个区块的矿工收取，这个差值就被称为 “手续费”，也是矿工将这笔交易纳入区块的主要激励。</p><p>在构造交易时，用户为交易选定输入和输出，同时也就决定了手续费的大小。然而，手续费市场可能会剧烈变化，用户选定的手续费大小，可能在稍后被证明不足以让该交易在用户希望的时间内得到确认，因此，我们需要考虑 “追加” 手续费。这是改善用户体验的必需。</p><h3 id=RBF><a href=#RBF class=headerlink title=RBF></a>RBF</h3><p>其中一种方法称作 “手续费替换（Replace-by-fee）”，其原理是使用原交易的部分或全部输入来发起一笔新交易，并让新交易（替代交易）携带比原交易更高的手续费，从而吸引矿工打包替代交易。如下图所示（留意数额）：</p><p><img src=/images/lightning-network-technology-improvement-and-users-experience-part-7/RBF.svg alt=RBF></p><p>你也可以认为，Tx #1 是在尝试重复花费 UTXO #0，两笔交易是在 “赛跑”。但因为 Tx #1 给出了更高的手续费，显然矿工会更喜欢这笔交易。这就起到了我们所说的 “追加手续费”、吸引矿工优先打包交易的效果。</p><h3 id=CPFP><a href=#CPFP class=headerlink title=CPFP></a>CPFP</h3><p>另一种方法是，使用原交易的输出发起新交易，并让新交易携带较高的手续费，从而，矿工如果想要打包新交易，就必须打包原交易（换句话说，旧交易和新交易将作为一个整体 —— “交易包” —— 与交易池内的其它交易竞争）；这就叫 “子为父偿（CPFP）”。如下图所示</p><p><img src=/../images/lightning-network-technology-improvement-and-users-experience-part-7/CPFP.svg alt=RBF></p><p>与 RBF 相比，CPFP 有个缺点：新交易需要占用额外的区块空间（也就意味着新交易所携带的部分手续费将用来让自身得到确认，而不是为原交易追加），而 RBF 则基本上不需要。这意味着在两种方法都能使用的场合，RBF 的效率更高、经济性更好。</p><p>有了这些基本概念，我们再来看看闪电通道的设计。</p><h2 id=早期设计（Legacy-Channels）><a href=#早期设计（Legacy-Channels） class=headerlink title="早期设计（Legacy Channels）"></a>早期设计（Legacy Channels）</h2><p><img src=/../images/lightning-network-technology-improvement-and-users-experience-part-7/Legacy-LN.svg alt=RBF></p><p>上图展示了对通道的一个参与者来说，与一个通道状态有关的交易：Offered HTLC 和 Received HTLC 分别代表着这个参与向对方提供的 HTLC 以及从对方收到的 HTLC，为一致地适用基于惩罚的闪电通道安全规则（LN-Penalty），这两类输出都必须得到预签名的交易（并在交易的输出中放置惩罚分支，在上图中没有画出） <sup><a href=#note2 id=jump-2>[2]</a></sup>。上图所概述的两类交易（承诺交易、HTLC 相关交易）都必须考虑手续费支付和追加的问题。</p><p>最初的闪电网络规范在手续费支付上作了这些设计：（1）总是由通道的发起方为承诺交易支付手续费（这跟本系列第五篇提到的 “<a href=https://www.btcstudy.org/2024/03/01/lightning-network-technology-improvement-and-users-experience-part-5>单向注资</a>” 设计是高度绑定的）；（2）在 HTLC 交易中，让交易的得益者来支付手续费。除此之外，尽管承诺交易的特殊性使得 RBF 几乎不可用（设想在强制关闭场景中，一方希望让一笔承诺交易上链，但对方却不配合，他们无法形成新的交易来替代以往签名的承诺交易），承诺交易<strong>没有</strong>作出便于使用 CPFP 的设计 —— 尽管 To Local 输出是交给交易广播者自己的，但这个输出带有时间锁，无法立即动用，因此也就无法<strong>即时</strong>用于发起子交易；HTLC 交易自身同样需要对方的签名，而其输出同样带有时间锁分支。（这是一种粗心大意吗？我想再往下看，你会得出自己的答案。）</p><p>这样的设计在以下几个方面影响了用户体验：</p><ol><li>总是让一方支付手续费，有损于公平；</li><li>承诺交易无法使用 RBF，又没有针对 CPFP 的设计，因此必须在构造阶段就保证其带有高得足以得到确认的手续费；但是，由于承诺交易在未来的上链时间是不确定的，这就成了一个几乎无解的问题 —— 实用的办法就只有非常保守地高估手续费 <sup><a href=#note3 id=jump-3>[3]</a></sup>；但这些手续费又会占用一部分通道资金，降低通道的有用性；<ul><li>此外，手续费市场也会波动，由此带来的预估手续费的波动，也会使通道参与者的可用余额产生波动，这会给用户带来困惑；而且，在链上手续费高涨的时期（也是人们最希望能够利用闪电网络来节约手续费的时期），这会大大压缩可用的通道容量、削弱闪电网络的效用 <sup><a href=#note4 id=jump-4>[4]</a></sup>。</li></ul></li></ol><p>那么，要如何优化呢？</p><h2 id=锚点通道><a href=#锚点通道 class=headerlink title=锚点通道></a>锚点通道</h2><p>“锚点通道（Anchor Channels）” 的思想是，在承诺交易中额外为每一方安排一个低价值但即刻可用的输出（同时为所有其它输出增加一个长达 1 区块的相对时间锁），以允许每一方都能在广播承诺交易之后，使用该锚点输出来发起 CPFP。当然，由于锚点输出自身的价值较低，用户必须为子交易注入额外的资金，才能成功追加手续费。</p><p>除此之外，锚点通道还对 HTLC 交易应用了一种大胆的技巧：当一方为对方的 HTLC 交易签名时，使用 “SIGHASH_SINGLE | ANYONECANPAY” 的哈希标签 <sup><a href=#note5 id=jump-5>[5]</a></sup>；这种标签使得签名仅覆盖<strong>一对</strong>输入（也即目标 HTLC）和输出，并使这对输入和输出可以组合到其它有效的交易中。这就使用户可以将自己得到的多个预签名 HTLC 交易组合成一笔。而且，闪电网络规范还特别规定：锚点通道的 HTLC 交易自身不应携带任何手续费；也即，用户就应该将自己应得的 HTLC 交易都组合（批处理）成一笔，然后通过为之添加输入和找零输出的方式支付手续费。</p><p>在这两项设计的结合之下，闪电通道的实现得到了简化，手续费占用余额的问题得到了优化：</p><ol><li>在承诺交易中，不必完全依赖于承诺交易自身来支付手续费，相反，可以设定一个较为稳定的手续费，并将手续费追加的问题留给依据锚点输出发起的子交易；这样，手续费占用通道可用余额的问题就得到了缓解；<ul><li>请注意，这并没有完全解决需要预估手续费的问题。因为手续费市场的波动，交易能够得到节点转发的费率门槛值也会波动，尽管承诺交易不必再保证自己随时都能得到确认，但依然需要保证自身的费率高得能够吸引节点传播；如果传播不出去，那 CPFP 方法也不会奏效。但这个难度已经降低了。</li></ul></li><li>在 HTLC 交易中，手续费不再由交易的输入（也即 HTLC）来支付，因此也不必再考虑费率水平如何影响 HTLC 交易的构造及其可欲性。</li></ol><p>代价是，在使用锚点通道时，用户必须确保自己在钱包中放置了可用的链上资金，以备支付手续费的需要。这会降低闪电网络在降低比特币网络 UTXO 集规模上的扩容效果。</p><h2 id=复杂的事实><a href=#复杂的事实 class=headerlink title=复杂的事实></a>复杂的事实</h2><p>你可能会认为，给定比特币交易的结构和追加手续费的方法，应用上述改进应该是自然而然并且简单的。然而，事实是，尽管可以说是顺理成章的，却并不那么容易。因为，多笔交易所能形成的顺序关系（拓扑），是多种多样的。而无论 RBF 还是 CPFP，允许这种行为，都等于是允许交易的发起者占用传播交易的节点的一部分资源。这种占用必须得到约束，否则攻击者就可以通过交易包的构造和交易的替换，对传播交易的节点发起 DoS 攻击。但另一方面，这些用来约束行为的规则也有可能被利用来发起攻击。</p><p>举个例子。为约束 CPFP 行为，Bitcoin Core 的交易池规则要求，一笔未确认的交易只有拥有 24 个后代交易。那么好了，在上述锚点通道的承诺交易中，由于两方都有锚点输出，因此，一方可以通过利用己方的锚点输出给承诺交易添加 24 个子交易，从而阻止对方发起 CPFP。由于这种攻击风险（它被称作 “交易钉死攻击”）的存在，上述 Bitcoin Core 规则允许一个例外：当一笔子交易自身重量低于 1000 vB、且仅有一个未确认的祖先交易时，则可成为该未确认祖先交易的第 25 个后代交易。这一例外规则（称为 “Carve Out”）使上述锚点通道得以安全运作（但依然无法排除被对手影响的风险） <sup><a href=#note6 id=jump-6>[6]</a></sup>。</p><p>最终来说，由比特币全节点组成的网络以及被各个节点适用的交易池规则，构成了闪电通道这样的合约式协议的安全依赖（它们往往都需要让交易即时得到确认，来保证用户的资金安全性；相应地，合约式协议的设计也将依赖于交易池规则的开发状况），但这些交易池规则却可能不够完美。设计出可靠又能抵御滥用的交易池规则，并不是容易的事。</p><p>自 2022 年以来，比特币的开发者们开始形成对交易池规则的新想法，其中著名的有 “v3 交易 <sup><a href=#note7 id=jump-7>[7]</a></sup>” 和 “族群交易池 <sup><a href=#note8 id=jump-8>[8]</a></sup>”；前者通过约束交易间的拓扑来支持设计更精妙的规则，后者则希望重新设计交易池的内部排序来支持更好的 RBF 规则。有趣的是，由于族群交易池不允许 CPFP-Carve Out，v3 交易（现已改称 “TRUC 交易”）将是我们走向族群交易池的桥梁。</p><p>下一节，我们就介绍这些想法在 Bitcoin Core 28.0 中的实现（详情可见这份指南 <sup><a href=#note9 id=jump-9>[9]</a></sup>），以及闪电通道可以如何利用它们来改善用户体验。</p><h2 id=基于-1P1C-交易包的新范式><a href=#基于-1P1C-交易包的新范式 class=headerlink title="基于 1P1C 交易包的新范式"></a>基于 1P1C 交易包的新范式</h2><p>首先，Bitcoin Core 28.0 引入了一种新的交易池单元，称为 “1P1C 交易包”，故名思议，就是仅由两笔亲子交易组成的交易包，它们会作为一个整体跟其它交易池单元（比如交易单体或其它 1P1C 交易包）竞争区块确认。其中，父交易的手续费率只需满足 1 聪&#x2F;vB 的费率下限，不再需要考虑节点随时波动的进入交易池的手续费率门槛。</p><p>其次，在 1P1C 交易包基础上，如果其中的交易都使用 “3” 的版本号，那么它们会适用 “TRUC 交易” 的规则：其中的交易单体体积不得超过10 kvB、子交易体积不得超过 1kvB；父交易的费率不再有任何要求（可以是零费率）；最重要的是，当另一笔子交易被添加到同一个父交易上时，不论它与原来的子交易是否使用了相同的输入，都会当成两者冲突，并适用 RBF 替代规则。</p><p>也就是说，虽然 28.0 允许了交易包的转发，但将交易包的形式限制成了仅有两笔交易的形式，并且，在子交易层级上的直接冲突和竞争，都不能破坏这样的形式。这种约束极大地降低了分析和设计替代规则的难度。</p><p>回到闪电通道：</p><ul><li>当闪电通道的承诺交易采用 v3 交易，它自身就无需携带任何手续费，这就彻底解决了需要预估手续费以及手续费占用通道容量的问题！<ul><li>不再需要考虑变更手续费，也就不再需要协商手续费，也不会再有因为手续费意见分歧而关闭通道的恼人情形！</li></ul></li><li>由于不再依赖 Carve-Out，我们也不必再为双方各设置一个锚点，只需设置一个双方都可以使用的锚点输出即可。这可以降低承诺交易的体积，略微改善经济性。甚至可以使用不需要密钥就能花费的锚点输出 <sup><a href=#note10 id=jump-10>[10]</a></sup>。</li></ul><h2 id=结语><a href=#结语 class=headerlink title=结语></a>结语</h2><p>回到文章开头的问题：应该由谁来为承诺交易支付手续费呢？理想情况下，当然是谁希望让一笔交易上链，就由谁来支付手续费。如今，在 1P1C 交易包和 TRUC 交易的支持下，我们终于能够实现这种理想。</p><p>闪电通道在手续费支付方法上的改进历程，与人们对比特币节点交易池规则的研究和开发是相伴相随的。这种共生关系，在另一个角度上体现了闪电网络的价值：为满足闪电通道运行需求而推动的改进，可以为其它合约式协议的进驻铺平道路。</p><h2 id=脚注><a href=#脚注 class=headerlink title=脚注></a>脚注</h2><p>1.<a id=note1> </a><a target=_blank rel=noopener href=https://github.com/lightning/bolts/blob/master/02-peer-protocol.md#channel-establishment-v1>https://github.com/lightning/bolts/blob/master/02-peer-protocol.md#channel-establishment-v1</a> <a href=#jump-1>↩</a></p><p>2.<a id=note2> </a><a target=_blank rel=noopener href=https://ellemouton.com/posts/htlc-deep-dive/ >https://ellemouton.com/posts/htlc-deep-dive/</a> <a href=#jump-2>↩</a></p><p>3.<a id=note3> </a>有一种有趣的想法，来自 Peter Todd，就是在更新状态时，让通道参与者为同一个通道状态按照不同的手续费水平签名多套承诺交易，从而允许参与者依据上链时的具体情形广播合适费率的承诺交易，包括也可以在彼时发起 RBF。但可以想象，这种版本不一定适合所有类型的通道参与者。详见：<a href=https://www.btcstudy.org/2024/01/07/v3-transactions-review-by-peter-todd/#%E6%89%8B%E7%BB%AD%E8%B4%B9%E6%9B%BF%E6%8D%A2>https://www.btcstudy.org/2024/01/07/v3-transactions-review-by-peter-todd/#%E6%89%8B%E7%BB%AD%E8%B4%B9%E6%9B%BF%E6%8D%A2</a> <a href=#jump-3>↩</a></p><p>4.<a id=note4> </a><a href=https://www.btcstudy.org/2024/01/12/rethinking-lightning-by-benthecarman/ >https://www.btcstudy.org/2024/01/12/rethinking-lightning-by-benthecarman/</a> <a href=#jump-4>↩</a></p><p>5.<a id=note5> </a>在为比特币交易的输入生成签名时，可以通过一种叫做 “sighash” 的标签来表明该签名所覆盖的交易部分（也即该资金的主人所同意的资金用法）；只有变更被签名覆盖了的部分才会使签名失效（无法通过比特币脚本的验证程序）。常见的标签是 “SIGHASH_ALL”，意味着该签名覆盖了所有的交易输入和输出 —— 增加、删除、改变交易输入和输出的任何部分都会使签名失效。详见：<a href=https://www.btcstudy.org/2021/11/09/bitcoin-signature-types-sighash/ >https://www.btcstudy.org/2021/11/09/bitcoin-signature-types-sighash/</a> <a href=#jump-5>↩</a></p><p>6.<a id=note6> </a><a href=https://www.btcstudy.org/2022/08/08/anchor-outputs/ >https://www.btcstudy.org/2022/08/08/anchor-outputs/</a> <a href=#jump-6>↩</a></p><p>7.<a id=note7> </a><a target=_blank rel=noopener href=https://bitcoinops.org/en/topics/version-3-transaction-relay/ >https://bitcoinops.org/en/topics/version-3-transaction-relay/</a> <a href=#jump-7>↩</a></p><p>8.<a id=note8> </a><a href=https://www.btcstudy.org/2024/01/16/an-overview-of-the-cluster-mempool-proposal/ >https://www.btcstudy.org/2024/01/16/an-overview-of-the-cluster-mempool-proposal/</a> <a href=#jump-8>↩</a></p><p>9.<a id=note9> </a><a href=https://www.btcstudy.org/2025/01/07/bitcoin-core-28-wallet-integration-guide/ >https://www.btcstudy.org/2025/01/07/bitcoin-core-28-wallet-integration-guide/</a> <a href=#jump-9>↩</a></p><p>10.<a id=note10> </a><a target=_blank rel=noopener href=https://delvingbitcoin.org/t/which-ephemeral-anchor-script-should-lightning-use/1412>https://delvingbitcoin.org/t/which-ephemeral-anchor-script-should-lightning-use/1412</a> <a href=#jump-10>↩</a></p></article></div></div></main><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>