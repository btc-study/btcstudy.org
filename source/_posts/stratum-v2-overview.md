---
title: '去中心化矿池协议 Stratum V2 概述'
author: 'Stratum'
date: '2023/11/30 18:16:41'
cover: ''
excerpt: 'Stratum V2 协议套件由 4 个协议组成'
tags:
- 挖矿
---


> *作者：Stratum*
> 
> *来源：<https://stratumprotocol.org/docs/>*



Stratum V2 协议套件由 4 个协议组成（作为主体的挖矿协议以及 3 个子协议），为参与比特币挖矿的主体指定了 5 个角色及其通信标准，使用了 3 种类型的通信信道。本文介绍了 Stratum V2 所定义的角色、信道，并总结了每一种子协议的实现。至于技术橡树，请参考 [GitHub](https://www.github.com/stratum-mining/sv2-spec) 上的完整文档。

## 角色

我们为 Stratum V2 协议套件中的主体定义了 5 种角色，这些主体之间的关系可以用上下游来分类。

### 挖矿设备（或者，矿工）

计算哈希值的实际挖矿设备。“矿工” 可以指代多种多样的哈希率生产者：从大规模的企业矿场，到再页岩油钻井平台现场偷偷摸摸收集天然气的移动挖矿操作。在描述矿工时，最有用的是描述其跟上游的矿池通信的规模：一个 10PH 的、跟一个水电站合作的矿场，作为一个单元跟矿池通信，虽然在其内部也将工作分给许多台挖矿设备，也可以被认为是一个 “矿工”，只是有别于在街头车库里运行一台 S19 的 “矿工”。如下所述，矿工将自己的哈希率 “提供” 给某个矿池。从 Stratum V2 的角度看，矿工是最下游的角色。

### 矿池

矿池是一个通信节点，负责协调哈希率并分发挖矿奖励。他们为终端的设备创建工作（job），验证区块和分数（shares），并将发现的区块传播到比特币网络。矿池并不保管、也不控制哈希率。兼容 Stratum 协议的终端设备可以在几分钟内切换矿池。因此，矿池要基于时延、易用性、偿债可靠性以及相关的联网服务来相互竞争，而 Stratum V2 可以大幅提升这里的每一项。可以认为矿池是最上游的角色。矿池可以跟下游的角色（代理或者挖矿设备）开启任意类型的通信信道（见下文）。

### 代理

代理是矿工和矿池之间的中介，聚合连接并翻译挖矿通信（Sv1->Sv2 或者 Sv2->Sv1）。代理可能会提供额外的功能，包括监控服务或者工作声明优化。矿工和矿池都可以运行代理，而且他们会基于不同的应用场景、出于不同的理由而运行代理。

**挖矿代理**

Sv2 挖矿代理是挖矿设备与 Sv2 矿池之间的中间人。它接收来自多个设备的挖矿请求、聚合它们然后转发给 Sv2 矿池。它可以跟上游（Sv2 矿池）开启 群/延伸 信道，也可以跟下游（Sv2 挖矿设备）开启标准信道。

**翻译代理**

翻译代理负责 Sv1 挖矿设备和一个 Sv2 矿池或者挖矿代理之间的通信。它让 Sv1 的设备能跟基于 Sv2 的挖矿基础设施交互，弥合较老的 Sv1 协议和 Sv2 之间的鸿沟。它可以跟上游（Sv2 矿池或者挖矿代理）之间开启拓展新蛋。举个例子，一个矿池可能会运行一个翻译代理，作为初始连接服务，以接收 Sv1 和 Sv2 的连接，然后跟 Sv2 矿工建立直接的标准信道、使用这个代理来翻译与 Sv1 矿工的通信。

### 工作声明器

工作声明器（JD）是即可属于矿池也可属于矿工的角色，但也可以由任何第三方来运行。它们连接到一个模板供应方，从而能够接收和验证定制化的区块模板。它们是为了实现所谓的 “工作声明协议” 而需要的角色。它们可以通过工作分发协议，进一步分发工作给一个挖矿代理（或者代理）。

**工作声明服务端**

工作声明服务端（JDS）是矿池端的 JD，负责分配工作声明客户端所需的挖矿工作 token，以创建定制化的工作。它也是（使用工作声明协议）连接到矿池的矿工发现有效区块时，负责为矿池传播区块的实体。

**工作声明客户端**

工作声明客户端（JDC）是矿工端的 JD，负责从它连接到的模板供应方收取区块模板并创建新的挖矿工作。它向 JDS 声明定制化的工作，以开始挖矿。JDC 也负责启动备用矿池机制，在所声明的工作被 JDS 拒绝时自动切换到后备矿池。在穷尽备用之后，它可以切换成独自挖矿（Solo Mining），直至市场上出现新的安全的矿池。

### 模板供应方

模板供应方（TP）既可以部署在矿池一边，也可以不受到矿工一边，但也可以由任何第三方来运行。当 TP 部署在矿工一边时，它可以从本地的比特币节点抽取交易。如此一来，矿工就可以创建定制化的区块模板了，而且可以通过工作声明协议向矿池声明定制化的挖矿工作。

## 子协议

### 挖矿协议

也叫 “主协议”，是 Stratum V1 的直接后继者。主协议用于挖矿，也是整个协议套件中唯一需要在所有场景中都实现的部分。它用在挖矿设备、代理和矿池服务的沟通中。如果一个 矿工/矿池 并不支持交易选择和挖矿工作声明，这就是唯一需要实现的协议。

**信道**

协议定义了三种类型的信道：

- 标准信道：不修改 默克尔路径/coinbase 交易，尽可能简化彼此之间以及跟上游节点的通信。
- 延伸信道：给出对搜索空间的延伸控制，从而可以实现高级的应用场景（例如，来回翻译 v1 和 V2 消息，难度聚合、定制化搜索空间分割，等等）。
- 群信道：标准信道的简单集合，在单个连接内开展，从而可以通过一个共同的信道来访问。

### 工作声明协议

工作声明协议是给矿工（一般来说是一个矿场）使用的，用来向矿池声明一个定制化的区块模板。这种声明的结果可以被复用到矿池的所有终端矿工连接中，从而减少计算强度。换句话说，单个声明可以应用到整个矿场的许多设备上，甚至多个矿场，从而实现更高的效率。这个协议是独立的，以允许矿池在独立的基础设施上中断这些连接，而不影响挖矿协议连接。这个协议是整个协议中的一个独立、可选的基础设施，而且可以由第三方来给矿场提供。这也是整个协议套件最突出的特性，因为它可以推动交易选择权力的去中心化。

### 模板分发协议

模板分发协议用来协助从 Bitcoin Core 中抽取可以构造下一个区块的信息。它的设计目标是取代 gitblocktemplate（BIP 22 和 23），为那些整合了 Stratum V2 其他方面的人提供更高的效率，而且更易于实现。

### 工作分发协议

用来将新声明的工作传递给利益相关的节点，既可以是代理，也可以是实际挖矿设备。这个协议是工作声明协议的补充。在矿工并不自建和声明自己的工作（即自选挖矿交易）的时候，工作会直接从矿池分发给代理和终端设备，就像最初的 stratum 协议。但是，这个协议将留给未来的文档指定，因为，当工作声明器成为一个更大的挖矿协议代理的一部分时，分发协议通常是不必要的。

