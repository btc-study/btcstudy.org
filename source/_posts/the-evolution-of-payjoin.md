---
title: 'Payjoin 的演化：从两方协议到多方框架'
author: 'Conor Okus'
date: '2025/04/15 17:24:55'
cover: ''
excerpt: '多方 Payjoin 希望解决这种内生于两方模式的 “对手方隐私性” 问题'
tags:
- PayJoin
---


> *作者：Conor Okus*
> 
> *来源：<https://payjoindevkit.org/2025/03/18/the-evolution-of-payjoin/>*



“Payjoin” 是一种革命性的协议，让钱包可以相互沟通并创建出合作式的、更加智能也更高效的比特币交易。它提供了一种批量处理（batching）支付的技术，使用这种技术的交换和支付的处理者可以[节约手续费](https://payjoin.org/docs/how-payjoin-saves)、保护自己和用户的金融[隐私](https://payjoin.org/docs/why-payjoin/privacy)，同时还能增加比特币的[可扩展性](https://payjoin.org/docs/why-payjoin/scaling)。

BTCPayServer 软件已经支持了 Payjoin 技术，而且在 2024 年，这个项目跟 “[Async Payjoin](https://www.bullbitcoin.com/blog/bull-bitcoin-wallet-payjoin)（异步Payjoin）” 在 Bull Bitcoin 移动端钱包中的实现、[Cake Wallet](https://github.com/cake-tech/cake_wallet/pull/1889) 中的持续开发工作一道，带来了重大的进展。

## Payjoin 的演化

### Pay-to-Endpoint（P2EP）与 Bustapay（BIP79）：打下基础

最初，优化比特币支付表现的工作就探索了批量处理发送者和接收者支付的办法。“[Pay-to-Endpoint（P2EP）](https://blog.blockstream.com/en-improving-privacy-using-pay-to-endpoint/)” 带来了让支付的接收者通过互联网（web），在构造交易的过程中贡献输入，从而让转账更加高效、与标准的交易更加相似的想法。因为支付的双方都可以为交易贡献输入，他们可以趁机归集 UTXO、分摊交易的固定成本、打破区块链分析中常用的 “[输入所有权同一](https://en.bitcoin.it/wiki/Common-input-ownership_heuristic)” 假设。

基于这种想法，“[Bustapay（BIP79）](https://github.com/bitcoin/bips/blob/master/bip-0079.mediawiki)”提供了一套具体的协议，让商家可以跟自己的顾客构造 P2EP 批处理交易。商家可以先分享一个支付请求 URL，表明自己有能力跟支付者合并交易输入。虽然这种技术的采用范围依然有限，它表明交互式的交易构造可以拥有可靠的用户体验并提供独特的好处，从而为 Payjoin 奠定了基础。

### Payjoin V1（BIP78）

在 Bustapay 的基础上，“[Payjoin V1（BIP78）](https://payjoin.org/docs/how-it-works/payjoin-v1-bip-78)” 提炼了 发送者-接收者 的交易协作过程，使之成为更加可靠和可延展的协议。BIP78 基于一套 HTTP 协议、标准的比特币 URI 请求格式以及 “待签名的比特币交易（[PSBT](https://en.bitcoin.it/wiki/BIP_0174)）” 格式，将钱包间的沟通标准化，使得 [Payjoin 的体验](https://bitcoin.design/guide/case-studies/payjoin/)在不同的钱包和硬件签名器之间更易于相互操作。

然而， Payjoin V1 也有局限性。它需要发送者和接收者同时在线（同步通信），并且，接收者需要运行一个服务端，以便参与交易构造协作。虽然有这些挑战，Payjoin 在支付处理软件中的实现证明了其可用性，让交互式交易批处理可以更上一层楼。

### Payjoin V2（BIP77）：异步通信

“[Payjoin V2（BIP77）](https://payjoin.org/docs/how-it-works/payjoin-v2-bip-77)” 通过引入异步通信改进了 V1 的局限性：双方不再需要在同一时间在线。V2 不再使用直接交互，而是使用一个邮件服务器临时存储待完成的交易，所以发送者可以先提交一个 Payjoin 请求，然后接收者可以稍后（在回到线上的时候）再补完这笔交易。重要的是，发送者和接收者之间的消息是端到端加密的，意思是邮件服务器无法看到它所存储的交易的细节，这就保护了每一个参与者的隐私。

这一版本让 Payjoin 更易于日常使用，尤其是对无法跟发送者保持实时连接的商家和服务而言。通过让交易可以更加灵活地补完，Payjoin V2 扩大了交易批处理的范围，同时保持了隐私性。

## 展望未来：Payjoin V3

Payjoin 生态系统的下一次进化志在超越两方模式，启用真正的多方批量处理交易。

### 两方 Payjoin 的局限性

当前版本的 Payjoin 在延申到更复杂的支付场景时，就会面临内在的局限性。比如说，当多个人都希望支付给同一个人、或者一个人希望在一笔交易中支付给多个人时，当前的协议无法处理这样的场景，因为它被设计为围绕一个严格的 发送者-接收者 模式。

更进一步地说，两方 Payjoin 面临着一种重大的隐私性局限：因为只有两个人在交互，他们依然知道彼此的输入和输出。这就意味着，虽然 Payjoin 提供了对抗第三方观察者的隐私性好处，但参与者完全能看到彼此交易的细节。

多方 Payjoin 希望解决这种内生于两方模式的 “对手方隐私性” 问题。通过加入多个参与者，他们可能没有任何一方知道所有输入和输出的全部知识，从而不仅能够对区块链观察者保持隐私，还可以在参与构造交易的人之间保持隐私性。

### 多方解决方案

Payjoin V3 将通过引入一套允许多方向一笔交易贡献输入输出的协作模式来解决这些局限性。这创造了一个灵活的参与者网络，所有人都一起构造更加高效的交易。

在以往的版本中，交易的构造遵循一种死板的 请求-响应 模式，V3 将允许多个参与者合作式为交易加入自己的输入和输出，从而创造出真正最优化的比特币交易。这种方法在实质上等同于 Greg Maxwell 最早在 2013 年提出的 “[cut-through](https://bitcointalk.org/index.php?topic=281848.0)” 概念，该概念指出，可以通过合并比特币交易，来同时提升网络的隐私性和效率性。

**值得指出的是，这种方法的真实好处最初将在一个产品内实现** —— 比如交易所或者拥有庞大用户用户基础的自主保管钱包。这些效率和隐私性好处，最初将出现在单个实体可以协调多个用户的交易的封闭生态系统中。

通过实现这样的协作框架，Payjoin V3 将比特币生态系统中的一个长期存在的想法带到了现实，它对交易的效率和隐私性都有重大影响。

## 实现路线图

Payjoin Dev Kit 的开发团队为 Payjoin V3 的实现提出了一个四阶段方法：

### 0 阶段：多位发送者，单一接收者的 Payjoin（当前阶段）

在这个最初阶段，开发目标是通过实验和测试来验证多方参与的核心概念。开发团队已经开发出了一个演示 5 方交易（4 位发送者和 1 位接收者）的原型，并详细说明了其取舍和挑战。一个多方 Payjoin 的实现已经计划了[实验性发布](https://github.com/payjoin/rust-payjoin/pull/434)。

### 1 阶段：多位发送者，多位接收者的 Payjoin

延申上一个阶段，本阶段将引入多位发送者和多位接收者共同参与的交易。这一强化将提升批处理交易的灵活性，并提供 UTXO 管理的效率。

### 2 阶段：隐私性优化

开发团队将建立隐私性的度量指标：创建一个分析交易隐私性的形式化框架、开发可以评估不同场景的分析工具、为隐私性最大会而优化交易模式，并记录发现，从而指引开发决策。

### 3 阶段：去中心化市场机制

最后一个阶段致力于开发一种联盟组建协议（coalition formation protocol），让互不相识的比特币交易可以参与同一笔批处理交易。这一系统将包含一套去中心化的发行协议（可以匹配兼容的交易伙伴同时保持隐私性）、可持续的经济激励结构、信任需求最小号的密码学机制，以及可以支持大规模交易协作的可扩展策略。

## 展望未来

Payjoin 正在从一个简单的两方协议进化成复杂的多方交易框架，它有望革新比特币交易构造和处理的方式。本路线图从一个实验性的 5 方交易开始，走向一个完全成熟的、去中心化的准交易池（交易在其中等待结盟机会），旨在形成一个更加隐私、高效和可扩展的比特币网络。

在本博客未来的帖子中，开发团队将提供在多个场景中利用 Payjoin 的案例，比如集成了闪电网络的 e-cash 铸币厂：

- 单条闪电通道的高效注资
- 开启和关闭多条通道的最优化批处理
- 在为单次通道拼接操作注入资金时保持客户的隐私性和效率
- 跨越多条通道的多次拼接操作的协作式注资
- 归类预防，让通过通道的 开启/关闭 来识别铸币厂的交易变得更加困难，同时通过更加高效的归集操作来减少交易手续费

我们将展示 Payjoin 的额外的好处，包括通过伺机的 UTXO 归集来节约手续费、通过交易 [cut-through](https://payjoin.org/docs/how-payjoin-saves#payjoin-payment-batching) 来降低开箱，并通过专业化的通道管理 Payjoin 实现来提高[闪电网络的效率](https://payjoin.org/docs/why-payjoin/lightning)。这些创新不是小修小补，而是对比特币使用模式的底层变革，但它不需要大量改变协议，而且保持了用户的隐私性。

（完）