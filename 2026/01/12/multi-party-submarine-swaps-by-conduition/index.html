<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><title>多方的潜水艇互换</title><meta name=keywords content="比特币, 中本聪, 比特币区块链, 闪电网络, 比特币 layer 2, 健全货币, 密码货币, 密码朋克, 学习比特币, BTC, BTC Study, Bitcoin, bitcoin, proof of work"><meta name=description content=比特币思想的中文集结地><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1"><link rel=icon href=/favicon.ico><link rel=stylesheet href="/style/common/bulma.css?v=1682773100887"><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href="/style/common/iconfont.css?v=1682773100887"><link rel=stylesheet href="/style/base.css?v=1682773100887"><link rel=stylesheet href="/style/common/helper.css?v=1682773100887"><link rel=stylesheet href="/style/themes/animation.css?v=1682773100887"><script>function ready(){var e=document.querySelector(".body-container"),t=localStorage.getItem("theme")||"light";["light","dark"].includes(t)||(t="light",localStorage.setItem("theme","light")),e.classList.remove("appearance-auto"),e.classList.add("appearance-"+t),quickInitialTheme()}function quickInitialTheme(){var e=localStorage.getItem("theme")||"light",t=document.querySelector(".logo-light"),o=document.querySelector(".logo-dark"),d=document.querySelector("#mobile-header-logo > .logo-light"),l=document.querySelector("#mobile-header-logo > .logo-dark"),a=document.getElementById("theme-btn"),i=document.querySelector(".slide-theme-light"),c=document.querySelector(".slide-theme-dark");document.body.classList.add(e),("dark"===e?(t.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"),l.classList.remove("hidden"),a.classList.remove("icon-icon_dark"),a.classList.add("icon-icon_light"),i):c).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",ready)</script><script src="/js/common.js?v=1682773100887"></script><script src=/js/libs/zepto.min.js></script><link rel=stylesheet href="/style/post.css?v=1682773100887"><link rel=stylesheet href="/style/themes/highlight.css?v=1682773100887"><meta name=generator content="Hexo 6.3.0"><link rel=alternate href=/atom.xml title="BTC Study" type=application/atom+xml></head><body class="is-flex is-flex-direction-column" onload=initialTheme()><div class=clip></div><div class="body-container appearance-auto"><header class="header-widget is-hidden-mobile is-flex is-flex-shrink-0 is-align-items-center is-justify-content-center" id=header><div class="is-flex header-widget-container is-flex-shrink-0 is-align-items-center"><section class="is-hidden-mobile is-flex-shrink-0"><h1><a href=/ ><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></a></h1></section><div class="is-flex is-flex-direction-column header-menu-wrap"><aside class="is-flex-shrink-0 is-flex is-flex-direction-row is-align-items-center" id=header-menu><a class="is-inline-block header-activity mr-4" href=/ >首页</a><a class="is-inline-block mr-4" href=/archives>全站目录</a><a class="is-inline-block mr-4" href=/tags>标签</a><a class="is-inline-block mr-4" href=/maps>地图</a><a class="is-inline-block mr-4" href=/tools>工具</a><a class="is-inline-block mr-4" target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div class="right-content is-flex is-flex-direction-row is-align-items-center"><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input type=range min=12 max=32 step=2></div></div></div><i class="iconfont icon-icon_dark mr-1" id=theme-btn></i><div class=search-wrap><input class=pl-3 id=search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search" id=search-input-btn></i></div></div></aside><div class="header-title is-hidden-mobile is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopic><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">多方的潜水艇互换</p><div class="size-wrap mr-1"><i class="iconfont icon-a-bianzu5" id=change-size-btn2></i><div class=size-input-wrap><div class=input-wrap><input id=size-change-input2 type=range min=12 max=32 step=2></div></div></div></div></div></div></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-tablet" id=mobile-header><div class="is-flex is-flex-direction-row is-align-items-center"><i class="iconfont icon-icon_bar mobile-header-menu"></i><div id=mobile-header-logo><svg class=logo-light width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#000000></path></g></g></g></svg><svg class="logo-dark hidden" width=125px height=23px viewBox="0 0 125 23" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title>BTCStudy</title><g id=页面-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=首页-响应式 transform="translate(-249.000000, -23.000000)" fill-rule=nonzero><g id=BTCStudy transform="translate(249.680000, 23.192000)"><path d="M9.072,17.808 C11.312,17.808 13.024,17.408 14.208,16.608 C15.392,15.808 15.984,14.672 15.984,13.2 C15.984,12.192 15.712,11.332 15.168,10.62 C14.624,9.908 13.872,9.384 12.912,9.048 C13.632,8.68 14.188,8.18 14.58,7.548 C14.972,6.916 15.168,6.2 15.168,5.4 C15.168,4.056 14.608,2.988 13.488,2.196 C12.368,1.404 10.736,1.008 8.592,1.008 L8.592,1.008 L-5.68434189e-14,1.008 L-5.68434189e-14,17.808 L9.072,17.808 Z M7.968,7.68 L4.704,7.68 L4.704,4.44 L7.968,4.44 C9.568,4.44 10.368,4.976 10.368,6.048 C10.368,7.136 9.568,7.68 7.968,7.68 L7.968,7.68 Z M8.688,14.376 L4.704,14.376 L4.704,10.968 L8.688,10.968 C10.352,10.968 11.184,11.536 11.184,12.672 C11.184,13.808 10.352,14.376 8.688,14.376 L8.688,14.376 Z M26.544,17.808 L26.544,4.776 L31.68,4.776 L31.68,1.008 L16.632,1.008 L16.632,4.776 L21.792,4.776 L21.792,17.808 L26.544,17.808 Z M41.592,18.144 C43.128,18.144 44.512,17.872 45.744,17.328 C46.976,16.784 48,16 48.816,14.976 L48.816,14.976 L45.792,12.24 C44.704,13.552 43.384,14.208 41.832,14.208 C40.92,14.208 40.108,14.008 39.396,13.608 C38.684,13.208 38.132,12.644 37.74,11.916 C37.348,11.188 37.152,10.352 37.152,9.408 C37.152,8.464 37.348,7.628 37.74,6.9 C38.132,6.172 38.684,5.608 39.396,5.208 C40.108,4.808 40.92,4.608 41.832,4.608 C43.384,4.608 44.704,5.264 45.792,6.576 L45.792,6.576 L48.816,3.84 C48,2.816 46.976,2.032 45.744,1.488 C44.512,0.944 43.128,0.672 41.592,0.672 C39.832,0.672 38.252,1.044 36.852,1.788 C35.452,2.532 34.352,3.568 33.552,4.896 C32.752,6.224 32.352,7.728 32.352,9.408 C32.352,11.088 32.752,12.592 33.552,13.92 C34.352,15.248 35.452,16.284 36.852,17.028 C38.252,17.772 39.832,18.144 41.592,18.144 Z" id=BTC fill=#F2A900></path><path d="M56.64,18.144 C58.24,18.144 59.6,17.9 60.72,17.412 C61.84,16.924 62.68,16.272 63.24,15.456 C63.8,14.64 64.08,13.728 64.08,12.72 C64.08,11.552 63.772,10.628 63.156,9.948 C62.54,9.268 61.812,8.772 60.972,8.46 C60.132,8.148 59.072,7.856 57.792,7.584 C56.656,7.344 55.832,7.112 55.32,6.888 C54.808,6.664 54.552,6.328 54.552,5.88 C54.552,5.432 54.768,5.068 55.2,4.788 C55.632,4.508 56.32,4.368 57.264,4.368 C58.768,4.368 60.32,4.8 61.92,5.664 L61.92,5.664 L63.384,2.136 C62.568,1.656 61.624,1.292 60.552,1.044 C59.48,0.796 58.392,0.672 57.288,0.672 C55.672,0.672 54.308,0.912 53.196,1.392 C52.084,1.872 51.248,2.524 50.688,3.348 C50.128,4.172 49.848,5.096 49.848,6.12 C49.848,7.288 50.152,8.216 50.76,8.904 C51.368,9.592 52.096,10.092 52.944,10.404 C53.792,10.716 54.848,11.008 56.112,11.28 C57.264,11.536 58.1,11.78 58.62,12.012 C59.14,12.244 59.4,12.6 59.4,13.08 C59.4,13.992 58.488,14.448 56.664,14.448 C55.704,14.448 54.728,14.296 53.736,13.992 C52.744,13.688 51.872,13.288 51.12,12.792 L51.12,12.792 L49.56,16.296 C50.36,16.856 51.4,17.304 52.68,17.64 C53.96,17.976 55.28,18.144 56.64,18.144 Z M71.856,18.024 C72.48,18.024 73.068,17.96 73.62,17.832 C74.172,17.704 74.64,17.52 75.024,17.28 L75.024,17.28 L73.896,14.088 C73.496,14.36 73.032,14.496 72.504,14.496 C72.088,14.496 71.756,14.364 71.508,14.1 C71.26,13.836 71.136,13.472 71.136,13.008 L71.136,13.008 L71.136,8.688 L74.112,8.688 L74.112,5.28 L71.136,5.28 L71.136,1.896 L66.576,1.896 L66.576,5.28 L64.68,5.28 L64.68,8.688 L66.576,8.688 L66.576,13.056 C66.576,14.704 67.032,15.944 67.944,16.776 C68.856,17.608 70.16,18.024 71.856,18.024 Z M82.248,18.024 C83,18.024 83.712,17.888 84.384,17.616 C85.056,17.344 85.632,16.944 86.112,16.416 L86.112,16.416 L86.112,17.808 L90.456,17.808 L90.456,4.8 L85.896,4.8 L85.896,11.064 C85.896,12.104 85.668,12.876 85.212,13.38 C84.756,13.884 84.168,14.136 83.448,14.136 C82.744,14.136 82.208,13.912 81.84,13.464 C81.472,13.016 81.288,12.304 81.288,11.328 L81.288,11.328 L81.288,4.8 L76.728,4.8 L76.728,12.072 C76.728,14.056 77.228,15.544 78.228,16.536 C79.228,17.528 80.568,18.024 82.248,18.024 Z M99.048,18.024 C100.744,18.024 102.016,17.52 102.864,16.512 L102.864,16.512 L102.864,17.808 L107.208,17.808 L107.208,0 L102.648,0 L102.648,5.928 C101.8,5.032 100.6,4.584 99.048,4.584 C97.864,4.584 96.784,4.856 95.808,5.4 C94.832,5.944 94.06,6.724 93.492,7.74 C92.924,8.756 92.64,9.936 92.64,11.28 C92.64,12.624 92.924,13.808 93.492,14.832 C94.06,15.856 94.832,16.644 95.808,17.196 C96.784,17.748 97.864,18.024 99.048,18.024 Z M100.008,14.4 C99.208,14.4 98.552,14.124 98.04,13.572 C97.528,13.02 97.272,12.256 97.272,11.28 C97.272,10.32 97.528,9.568 98.04,9.024 C98.552,8.48 99.208,8.208 100.008,8.208 C100.808,8.208 101.46,8.48 101.964,9.024 C102.468,9.568 102.72,10.32 102.72,11.28 C102.72,12.256 102.464,13.02 101.952,13.572 C101.44,14.124 100.792,14.4 100.008,14.4 Z M112.368,22.68 C113.728,22.68 114.88,22.356 115.824,21.708 C116.768,21.06 117.568,19.936 118.224,18.336 L118.224,18.336 L123.84,4.8 L119.496,4.8 L116.28,12.744 L113.088,4.8 L108.408,4.8 L113.976,17.976 C113.784,18.36 113.548,18.64 113.268,18.816 C112.988,18.992 112.632,19.08 112.2,19.08 C111.832,19.08 111.468,19.012 111.108,18.876 C110.748,18.74 110.44,18.552 110.184,18.312 L110.184,18.312 L108.6,21.504 C109.032,21.856 109.596,22.14 110.292,22.356 C110.988,22.572 111.68,22.68 112.368,22.68 Z" id=Study fill-opacity=0.85 fill=#FFFFFF></path></g></g></g></svg></div><div class="mobile-header-title is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height hidden" id=postTopicMobile><p class=is-full-height>多方的潜水艇互换</p></div></div></div><i class="iconfont icon-icon_search mobile-header-searchIcon"></i><div class=mobile-search-wrap><div class=search-input><input class=pl-3 id=mobile-search-input placeholder=请输入搜索关键词><i class="iconfont icon-icon_search mobile-search-input-btn"></i><button class=mobile-search-input-btn>搜 索</button></div></div></header><div class=mobile-slide-menu><a class=header-activity href=/ >首页</a><a href=/archives>全站目录</a><a href=/tags>标签</a><a href=/maps>地图</a><a href=/tools>工具</a><a target=_blank rel=noopener href=https://123btc.org/ >123btc</a><div><p class="slide-menu-theme is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center"><span>主题设置</span><span><i class="iconfont icon-icon_light slide-theme-light hidden"></i><i class="iconfont icon-icon_dark slide-theme-dark hidden"></i></span></p><p class=slide-menu-fontsize><span>字体设置</span><span><i class="iconfont icon-bianzubeifen"></i><i class="iconfont icon-bianzu"></i></span></p></div></div><div class="search-mask hidden"><script src="/js/header.js?v=1682773100887"></script></div><main><main class="container is-max-widescreen content section post-page pt-4"><div class="columns is-flex-desktop is-justify-content-center"><div class="column is-3 silde-bar is-hidden-mobile"><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%9B%9E%E9%A1%BE><span class=toc-text>回顾</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%88%E7%8E%87><span class=toc-text>效率</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%89%A9%E5%AE%B9><span class=toc-text>扩容</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%93%BE%E5%86%85-%E9%93%BE%E5%A4%96-%E4%BA%92%E6%8D%A2%E7%9A%84%E5%90%83%E5%8D%95%E4%BA%BA><span class=toc-text>链内 -&gt; 链外 互换的吃单人</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-%EF%BC%88%E9%93%BE%E5%86%85%EF%BC%89%E5%BC%BA%E5%88%B6%E6%89%A7%E8%A1%8C><span class=toc-text>1. （链内）强制执行</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%EF%BC%88%E9%93%BE%E5%A4%96%EF%BC%89%E5%90%88%E4%BD%9C><span class=toc-text>2. （链外）合作</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-%E8%B6%85%E6%97%B6><span class=toc-text>3. 超时</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%80%A7%E8%83%BD><span class=toc-text>性能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%93%BE%E5%A4%96-%E9%93%BE%E5%86%85-%E4%BA%92%E6%8D%A2%E7%9A%84%E5%90%83%E5%8D%95%E4%BA%BA><span class=toc-text>链外 -&gt; 链内 互换的吃单人</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-%EF%BC%88%E9%93%BE%E5%86%85%EF%BC%89%E5%BC%BA%E5%88%B6%E6%89%A7%E8%A1%8C-1><span class=toc-text>1. （链内）强制执行</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-%EF%BC%88%E9%93%BE%E5%A4%96%EF%BC%89%E5%90%88%E4%BD%9C-1><span class=toc-text>2. （链外）合作</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B6%85%E6%97%B6><span class=toc-text>超时</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%80%A7%E8%83%BD-1><span class=toc-text>性能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%87%8F%E5%B0%91%E9%AA%9A%E6%89%B0><span class=toc-text>减少骚扰</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%BA%E4%BA%86%E7%9A%84%E5%B7%A5%E4%BD%9C><span class=toc-text>为了的工作</span></a></li></ol></div><div class="column is-9 post-container"><h1 class="mt-0 mb-2" id=postTitle>多方的潜水艇互换</h1><div class=page-author><div class="is-flex is-flex-direction-row page-data mr-6"><img class=mr-1 src=/images/default_avatar.png alt=conduition><div class=page-author-info><strong>conduition</strong><time class=has-text-grey datetime=2026-01-12T09:05:57.000Z>2026-01-12</time></div></div><div class=is-flex><a href=/tags/%E6%BD%9C%E6%B0%B4%E8%89%87%E4%BA%92%E6%8D%A2><i class="page-tag mr-1 px-1">潜水艇互换</i></a></div></div><article class="mt-4 post-content"><blockquote><p><em>作者：conduition</em></p><p><em>来源：<a target=_blank rel=noopener href=https://conduition.io/scriptless/multi-party-submarine-swaps/ >https://conduition.io/scriptless/multi-party-submarine-swaps/</a></em></p></blockquote><p>“<a target=_blank rel=noopener href=https://docs.lightning.engineering/the-lightning-network/multihop-payments/understanding-submarine-swaps>潜水艇互换</a>” 允许闪电网络上的用户免信任地将链内的 UTXO 置换成闪电通道中的余额。它基本上就是用于闪电网络的原子化互换，并且对闪电节点运营者极其有用（可用来重新平衡他们的通道，以及其他事项）。</p><p>随着潜水艇互换变得日益重要和常见，也许是时候该看看如何更好地扩大潜水艇互换的吞吐量了 —— 如今，更多的对等节点和流动性提供者可以参与互换。</p><h2 id=回顾><a href=#回顾 class=headerlink title=回顾></a>回顾</h2><p>传统的潜水艇互换是一种两方的原子化互换，使用两个哈希时间锁合约（HTLC）：一个部署在比特币链内；另一个部署在闪电网络中。</p><p>假设 Alice 想要卖出链内的比特币，换成一笔闪电支付；而 Bob 想要使用他的闪电通道余额来购买 Alice 的链内资金。</p><p>首先，Alice 要生成一个只有她自己知道的随机秘密值 $s$ 。</p><p>Alice 和 Bob 构造一个 2-of-2 的托管地址：如果 Bob 知晓了 $s$ ，将拥有这个地址的完全花费权限，这是用一个哈希锁条件来表达的；此外，在网络达到特定的区块高度 $B$ 之后，Alice 将获得这个地址的完全花费权限。</p><p>这是一个用描述符来表达的案例：</p><pre><code class=descriptor>tr(
  musig(&lt;alice_pubkey&gt;, &lt;bob_pubkey&gt;),
  &#123;
    and(sha256(&lt;hash&gt;), pk(&lt;bob_pubkey&gt;)),
    and(after(&lt;B&gt;), pk(&lt;alice_pubkey&gt;))
  &#125;
)
</code></pre><p>Alice 把自己的钱币存入这个 2-of-2 托管合约，确信自己可以在区块高度 $B$ 之后重新拿回资金，以及，Bob 当前是无法取走其中的钱的，因为只有她自己知道 $s$ 。</p><p>然后，Alice 给 Bob 一个闪电发票，其要求支付的数额与钱币的面额一样，并使用 $SHA256(s)$ 作为支付哈希值。Bob 可以支付这个发票，同时（通过 HTLC 的时间锁）要求 Alice 最晚在区块高度 $B - \Delta$ 就要释放原像（领取支付），这里的 $\Delta$ 是合理的时间延迟。如果 Alice 领取了 Bob 的闪电支付 HTLC（不论是与自己的通道对手完成协商，在链外释放原像、领取资金；还是强制关闭通道，Alice 在链内曝光原像来领取），Bob 就会知道 Alice 的秘密值原像 $s$ ，然后他就可以转走 上述托管合约中的资金。如果 Alice 很狡猾，到最后一刻，也就是区块高度 $B - \Delta$ 才领取支付，Bob 也拥有 $\Delta$ 个区块来知晓 $s$ 并使用它来领取 Alice 在链内的 HTLC（即上述合约）。</p><p>就是这样！Bob 和 Alice 可以彼此置换链内和链外的钱币，双方都没有机会欺诈对方。为了提升隐私性和效率性，Alice 和 Bob 可以合作：一旦 Bob 支付了闪电发票，双方就使用 <a target=_blank rel=noopener href=https://conduition.io/cryptography/musig/ >MuSig</a> 来联合签名花费上述合约的交易、将资金转移给 Bob（从而外人无法看出这是一笔 HTLC&#x2F;潜水艇互换 交易）。</p><h2 id=效率><a href=#效率 class=headerlink title=效率></a>效率</h2><p>一些潜水艇互换供应商，比如 <a target=_blank rel=noopener href=https://lightning.engineering/loop/ >Lightning Labs 的 Loop 服务</a>，会批量处理他们的链内交易。在清扫他们收到的链内钱币之时，一次清扫多个合约可以更好地将大量资金归集到少量的 UTXO 中。在给潜水艇互换的托管合约地址注资时，也可以这样做，每个输出都给一个独立的潜水艇互换合约注资。</p><p>但是，这里依然有一个效率瓶颈，来自潜水艇互换协议自身的拓扑。我们有许多小节点（用户），全部都跟一个潜水艇互换服务商（比如 Loop 或 Boltz）交互。用户们完全不知道其他人的交易，所以每一笔潜水艇互换都是一个完全独立的合约，发生在一个用户和一个互换服务商之间。这就产生了浪费。</p><p>而每一个从链内钱币到链外支付的潜水艇互换，都要求用户发起一笔单独的注资交易，因为用户们不知道彼此，所以无法一起批量处理他们的主子交易。此外，每一个潜水艇互换都会创建一个独立的注资交易输出，所以，即使注资交易 <em>得到了</em> 批处理（就像 Loop 的链外到链内协议一样），我们依然有 $n$ 个单独的注入了资金的 HTLC 地址，可能要用 $n$ 笔额外的交易来解决。</p><h2 id=扩容><a href=#扩容 class=headerlink title=扩容></a>扩容</h2><p>我们可以通过将潜水艇互换从单一接单者协议转变成 $n$-吃单者协议，来提高效率。 我们不再假设在每次互换中都是一个挂单人（maker）和一个吃单人（taker），而是假设有一个挂单人<strong>以及 $n$ 个吃单人</strong>，他们有能力进行带有身份认证的通信，不论是通过 P2P 还是一个代理（比如挂单人）。这些参与者将通过将他们的 $n$ 个潜水艇互换合约聚合成一个注资 UTXO，一起执行一次免信任的原子化互换。</p><p>这会增加协议的复杂性和碎片化，但也能极大地提高链内效率。我们来看看这是怎么做到的。</p><h2 id=链内-链外-互换的吃单人><a href=#链内-链外-互换的吃单人 class=headerlink title="链内 -&gt; 链外 互换的吃单人"></a>链内 -&gt; 链外 互换的吃单人</h2><p>我们先来看看 $n$ 个吃单人参与从链内到链外资金置换的情形。在这种情形下，交易的两边是：</p><ul><li><strong>吃单人</strong>：一组 $n$ 个吃单人，希望将小额的链内 UTXO 换成链外的闪电通道余额。</li><li><strong>挂单人</strong>：单个个人或企业，希望将闪电余额换成链内资金。</li></ul><p>不像传统的潜水艇互换中那样，吃单人们注资 $n$ 个链内单独的链内托管地址 —— 而是一起注资到单个托管合约中，并且资金是在单笔交易中转入的 —— 这个托管合约，要么被挂单人花掉（如果合约执行顺利的话），要么退回给各位吃单人（如果合约执行不顺利的话）。</p><ol><li>挂单人生成 $n$ 个随机秘密值 ${s_1, s_2, …, s_n}$（为每个吃单人安排一个）。</li><li>吃单人和挂单人一起创建一个 n-of-n 的 taproot 哈希锁地址，如果挂单人可以揭晓 ${s_1, s_2, …, s_n }$，就能从这个地址中转走资金。</li></ol><p>以下是一个用描述符来表示的三重哈希锁案例：</p><pre><code>tr(
  musig(
    &lt;taker1_pubkey&gt;,
    &lt;taker2_pubkey&gt;,
    &lt;taker3_pubkey&gt;,
    &lt;maker_pubkey&gt;
  ),
  and(
    hash160(&lt;hash1&gt;),
    hash160(&lt;hash2&gt;),
    hash160(&lt;hash3&gt;),
    pk(&lt;maker_pubkey&gt;)
  )
)
</code></pre><p>使用 taproot 脚本，我们可以（通过聚合公钥协议）使用 4-of-4 的内部公钥，从而，在各方都配合的情况下，将体积很大的哈希锁完全隐藏起来。我们使用 <code>hash160</code> 而费 <code>SHA256</code> 是为了节约区块空间，同时保留在闪电网络中以相同的秘密值（原像）使用 HTLC 的选择。</p><ol start=3><li>吃单人们构造一笔 <em>注资交易</em>，将众人的 UTXO 支付给上述多签名地址（可能会有找零输出）。吃单人们<strong>暂不</strong>签名注资交易。</li><li>吃单人们构造一笔 <em>超时交易</em>，也即退还款项的交易。这笔超时交易将 <em>注资交易</em> 输出中的资金返还给各吃单人。<em>超时交易</em> 必须带有一个解锁时间点为区块高度 $B$ 的绝对时间锁。</li><li>吃单人和挂单人一起签名 <em>超时交易</em>。挂单人当然没有意见，因为它带有绝对时间锁。</li><li>挂单人建立 $n$ 个闪电网络 HTLC，每个 HTLC 为其中一个吃单人支付对应的互换金额。给吃单人 $i$ 的 HTLC 使用 $SHA256(s_i)$ 作为支付哈希值。各吃单人的互换金额可能不一样。吃单人们还无法 <em>领取</em> 这些 HTLC ，因为只有挂单人知道每一个 HTLC 的原像 ${s_1, s_2, …, s_n }$ 。这些 HTLC 的绝对时间锁必须至少是 $B + \Delta$ ，其中的 $\Delta$ 就是一个合理的时延（以区块为单位）。</li><li>在所有的吃单人都在自己的通道中收到了 HTLC 之后，吃单人们一起签名并发布 <em>注资交易</em>。</li><li>所有人等待注资交易得到区块确认。</li></ol><p>挂单人有三种选择。</p><h3 id=1-（链内）强制执行><a href=#1-（链内）强制执行 class=headerlink title="1. （链内）强制执行"></a>1. （链内）强制执行</h3><p>挂单人可以使用原像 ${s_1, s_2, …, s_n }$ 在哈希锁花费路径中领取注资交易输出。这样的 <em>申领交易</em> 会在网络中揭晓所有原像，从而吃单人们可以用这些原像来领取各自收到的 HTLC 中的资金。</p><p>即使挂单人拖到最后一刻才发布 <em>领取交易</em>，吃单人们依然有 $\Delta$ 个区块的时间窗口来领取各自通道中的 HTLC 中的资金。</p><h3 id=2-（链外）合作><a href=#2-（链外）合作 class=headerlink title="2. （链外）合作"></a>2. （链外）合作</h3><p>挂单人可以将 ${s_1, s_2, …, s_n }$ 中的每一个分别交给对应的吃单人。吃单人可以使用这些原像来领取自己通道中的 HTLC 。作为交换，吃单人们应该跟挂单人配合签名一笔交易，从而将注资交易输出中的资金释放给挂单人。</p><p>即使有人拿原像兑换 HTLC 之后拒不交出签名，挂单人依然可以在链内强制执行、取走注资交易输出中的资金。</p><p>请注意，挂单人只交出 <em>一部分</em> 原像（而不是全部交付）是不理性的，因为实质上，每一个原像都是从挂单人处领取一些资金的权利。只要挂单人想在链上取走资金，就必然要揭晓所有的原像，而不是一部分。</p><h3 id=3-超时><a href=#3-超时 class=headerlink title="3. 超时"></a>3. 超时</h3><p>挂单人可以选择不揭晓任何原像。因此，吃单人将无法领取各自通道中的 HTLC 。当网络达到区块高度 $B$ 的时候，任何一个吃单人都可以发布 <em>超时交易</em>，从而让资金返还给各吃单人。再过 $\Delta$ 个区块，他们各自通道中的 HTLC 也将过时。</p><h3 id=性能><a href=#性能 class=headerlink title=性能></a>性能</h3><p>如果使用 $n$ 次传统的潜水艇互换，链内的足迹最少也将是：</p><ul><li>$n$ 个不同的注资交易，每笔交易至少包含 1 个输入和 1 个输出</li><li>$n$ 个不同的输入，领走各托管地址中的资金（也许可以批处理成单笔交易）</li></ul><p>在理想情况下，我们这里的多方互换方法可以将（$n$ 次互换）链内足迹减少到：</p><ul><li>注资交易将至少有 $n$ 个输入，至少 1 个输出（可能会更多，因为有找零输出）</li><li>1 个输入，领取注资交易输出（也许可以跟其它领取交易批量处理）</li></ul><p>值得指出的是，如果 $n$ 较大，一些吃单人不配合，为了在链内领取注资交易输出，挂单人可能需要在交易的见证输出中发布大量的 RMD160 哈希值和一个体积巨大的脚本。这可能会影响性能分析和 $n$ 的选择。</p><h2 id=链外-链内-互换的吃单人><a href=#链外-链内-互换的吃单人 class=headerlink title="链外 -&gt; 链内 互换的吃单人"></a>链外 -&gt; 链内 互换的吃单人</h2><p>现在，来看看我们的方法在相反的情形中是如何工作的。</p><p>这时候，参与交易的两种角色是：</p><ul><li><strong>吃单人</strong>：多个小体量的参与者，希望将闪电通道中的余额换成小额的链内 UTXO 。</li><li><strong>挂单人</strong>：单个个人或企业，希望将大额的链内 UTXO 换成闪电通道内的余额。</li></ul><p>这时候，挂单人不再像传统的潜水艇互换那样生成 $n$ 个单独的链内托管地址，而是为一个托管地址注入资金，预期这个地址会在单个交易中花费 —— 要么是发送资金给各吃单人（如果互换顺利）、要么是返回给挂单人（如果互换不顺利）。</p><ol><li>挂单人生成 $n$ 个随机秘密值 ${s_1, s_2, …, s_n }$（为每个吃单人安排一个）。</li><li>吃单人和挂单人一起创建一个 1-of-n 的 taproot 哈希锁地址</li></ol><p>以下是一个用描述符来表示的吃单人数量为 3 的案例：</p><pre><code>taker_joint_pubkey = musig(
  &lt;taker1_pubkey&gt;,
  &lt;taker2_pubkey&gt;,
  &lt;taker3_pubkey&gt;
);

tr(
  musig(
    &lt;taker1_pubkey&gt;,
    &lt;taker2_pubkey&gt;,
    &lt;taker3_pubkey&gt;,
    &lt;maker_pubkey&gt;
  ),
  &#123;
    &#123;
      and(
        hash160(&lt;hash1&gt;),
        pk(taker_joint_pubkey)
      ),
      and(
        hash160(&lt;hash2&gt;),
        pk(taker_joint_pubkey)
      )
    &#125;,
    and(
      hash160(&lt;hash3&gt;),
      pk(taker_joint_pubkey)
    )
  &#125;
)
</code></pre><p>注意，在这个脚本中，吃单人是 3 个不同的哈希锁花费条件的联合收款方，也就是说，<code>&lt;hash1&gt;</code>、<code>&lt;hash2&gt;</code>、<code>&lt;hash3&gt;</code> 三个原像中的任何一个，都可以被吃单人用来领取其中的资金。</p><ol start=3><li>挂单人构造一笔 <em>注资交易</em>，它花费挂单人的 UTXO ，支付到上述 taproot 地址中（交易可能带有诏令输出）。挂单人<strong>暂不</strong>签名这笔注资交易。</li><li>挂单人构造一笔 <em>超时交易</em>，它花费 <em>注资交易</em> 的输出，将资金返回给挂单人。带有解锁时间点为区块高度 $B$ 的绝对时间锁。</li><li>吃单人和挂单人一起签名 <em>超时交易</em>。吃单人愿意接受，因为超时交易有绝对时间锁。</li><li>吃单人们合作构造 $n$ 笔 <em>领取交易</em>，每一笔领取交易都使用注资交易输出的不同哈希锁花费分支来花费它、在吃单人们之间分割资金。吃单人们合作签名所有 $n$ 笔 <em>领取交易</em>，没有任何一笔会被公开，直到 ${s_1, s_2, …, s_n}$ 中的一个被揭晓。吃单人们都愿意签名这些交易，因为这些交易不会侵吞属于他们自己的资金。每一个吃单人 $i$ 都必须获得对应于自己的哈希值 $RMD160(SHA256(s_i))$一笔完全签名的领取交易，从而，只要吃单人 $i$ 知晓了 $s_i$，就能够发布领取交易。</li><li>挂单人签名并广播 <em>注资交易</em>。</li><li>每个人都等待注资交易得到区块确认。</li><li>吃单人们建立 $n$ 个 HTLC 并通过闪电网络支付给挂单人，支付参与互换的金额，使用对应于自己的 $SHA256(s_i)$ 作为支付哈希值。吃单人们可能会使用不同的数额。每个 HTLC 的超时时间最晚也只能是 $B - \Delta$ ，这里的 $\Delta$ 是合理的时间延迟（以区块数量为单位）。<strong>挂单人必须等到所有的 HTLC 都送达之后，才能结算其中任何一个。</strong></li><li>挂单人可以使用原像 ${s_1, s_2, …, s_n }$ 来结算任何一个 HTLC （也可以全部结算）。也就是任何一个吃单人都会获得至少一个原像 $s_i$ 。请注意，理性的挂单人要么会领取 <em>所有的</em> HTLC，要么 <em>一个都不领</em>。因为哪怕揭晓一个 $s_i$ ，都会让吃单者们取走注资交易的输出中的资金。</li></ol><h3 id=1-（链内）强制执行-1><a href=#1-（链内）强制执行-1 class=headerlink title="1. （链内）强制执行"></a>1. （链内）强制执行</h3><p>任何一个吃单人 $i$，在知道原像 $s_i$ 之后，都可以发布一笔 <em>领取交易</em>（是早前由所有吃单人签名过的）。这笔原子化的交易会将挂单人的资金在吃单人之间公平分配。</p><p>即使挂单人希望等到其闪电通道内的 HTLC（根本上来自各位吃单人）超时之前的最后一刻才揭晓所有原像 ${s_1, s_2, …, s_n}$ ，也即最坏情况下，吃单人们也将拥有 $\Delta$ 个区块的时间窗口来发布和确认一笔 <em>领取交易</em>。</p><h3 id=2-（链外）合作-1><a href=#2-（链外）合作-1 class=headerlink title="2. （链外）合作"></a>2. （链外）合作</h3><p>一旦挂单人领取了其闪电通道内所有的 HTLC，也即所有的原像 ${s_1, s_2, …, s_n}$ 都曝光了，挂单人可以跟吃单人们配合签名一笔新版本的领取交易，使用那个 4-of-4 的内部公钥。这让他们可以藏起合约中的哈希锁花费分支，提高隐私性和链内效率。</p><p>如果有人不签名这个新版本的领取交易，某一个吃单人可以退回到发布自己的 <em>领取交易</em>，只需在区块高度 $B$ 之前（在 <em>超时交易</em> 变成有效交易之前）。</p><h3 id=超时><a href=#超时 class=headerlink title=超时></a>超时</h3><p>如果挂单人什么也没做（不释放原像），那么来自吃单人的 HTLC 会在区块高度 $B - \Delta$ 过期，从而给吃单人返回闪电通道余额。然后，等到区块高度 $B$ ，挂单人就可以用超时交易来清扫注资交易输出。</p><p>如果吃单人在挂单人发布 <em>注资交易</em> 之后不再响应，挂单人什么都不需要做，只需等待区块高度 $B$ ，然后发布超时交易。</p><h3 id=性能-1><a href=#性能-1 class=headerlink title=性能></a>性能</h3><p>如果使用 $n$ 次传统的潜水艇互换，链内的足迹最少也将是：</p><ul><li>$n$ 个不同的托管输出（也许可以批量处理为用一笔注资交易生成）</li><li>$n$ 笔不同的交易来领取上述托管输出，每笔交易都至少包含 1 个输入和 1 个输出（无法批量处理）</li></ul><p>在理想情况下，我们这里的多方互换方法可以将（$n$ 次互换）链内足迹减少到：</p><ul><li>1 个托管输出（也许可以批量处理为一个较大体积的注资交易）</li><li>1 笔领取交易，带有 1 个输入和 $n$ 个输出（在吃单人之间分配资金）</li></ul><p>在部分吃单人或挂单人不合作的情形中，吃单人需要使用其中一个哈希锁分支来领取链内资金。</p><h2 id=减少骚扰><a href=#减少骚扰 class=headerlink title=减少骚扰></a>减少骚扰</h2><p>尽管将潜水艇互换拓展为多方协议是显然有可能的，但这样做可以获得具体多少效率提升，是可以争议的，因为这很大程度上取决于过程中的各方是否配合。从链内到链外的互换尤其如此，只要一个吃单人不合作，就可以迫使挂单人支付额外的手续费来（发布一连串似乎毫无必要的哈希值和原像）领取资金。</p><p>同样的骚扰攻击在传统的潜水艇互换协议中也存在，但在多方参与的环境中影响更大，因为一颗老鼠屎就能弄坏一锅汤（让互换对每个人都变得更贵）。</p><p>为了遏制来自吃单人的骚人，挂单人可以实现以下技术：</p><ul><li>手续费。挂单人可以在闪电发票金额中加入手续费，要求吃单人支付（在从链外到链内的互换中）；或者，可以减少在 HTLC 中支付给吃单人的数额（在从链内到链外的互换中）。这将激励挂单人提供互换服务，并让骚扰攻击变得更加昂贵。</li><li>预存系统。挂单人可以强迫吃单人预先提供一个数额为互换金额的小比例的 HTLC 作为存款（使用 “HODL 发票”）。如果吃单人在互换过程中批核，则挂单人可以取消发票、退回存款。如果吃单人不配合，挂单人可以结算发票、取走存款，作为惩罚。这种存款不是免信任的 —— 挂单人可以无条件取走它；所以，需要一定程度的信任、责任感和声誉。</li><li>匿名使用的 token 。吃单人可以从挂单人处购买一些 ecash token ，日后，将它兑换为与挂单人参与一次多方潜水艇互换的资格。</li><li>忠诚债券。这将允许匿名的挂单人或吃单人通过牺牲一些比特币来换取一个永久的 挂单人&#x2F;吃单人 身份，证明自己会诚实参与交易。</li></ul><h2 id=为了的工作><a href=#为了的工作 class=headerlink title=为了的工作></a>为了的工作</h2><ul><li>闪电网络上的 “点时间锁合约（PTLC）” 将允许显著提高两个方向上的多方潜水艇互换的链内隐私性和效率。那么，基于 PTLC 的多方潜水艇互换会是什么样的？到底能获得多少效率提升？</li><li>是否有可能执行 n-to-m 潜水艇互换，即 $n$ 个链内 UTXO 的卖方与 $m$ 个通过闪电支付来购买的买方达成交易？</li></ul><p>（完）</p></article></div></div></main><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:!0,skipTags:["script","noscript","style","textarea","pre","code"]}}),MathJax.Hub.Queue(function(){for(var a=MathJax.Hub.getAllJax(),e=0;e<a.length;e+=1)a[e].SourceElement().parentNode.className+=" has-jax"})</script><script src="/js/post.js?v=1682773100887"></script><script src="/js/highlight.min.js?v=1682773100887"></script><script>var containerEl=document.querySelector(".post-container"),postFontSize=localStorage.getItem("post-font-size")||"16",inputEl=document.querySelector("#size-change-input"),inputEl2=document.querySelector("#size-change-input2");inputEl.value=postFontSize,inputEl2.value=postFontSize,containerEl.style.fontSize=postFontSize+"px",$(function(){function e(t){$(".post-container").css("font-size",t+"px"),localStorage.setItem("post-font-size",t),$("#size-change-input").val(t),$("#size-change-input2").val(t)}$("#size-change-input").on("input propertychange",function(t){e(t.target.value)}),$("#size-change-input2").on("input propertychange",function(t){e(t.target.value)})})</script><script>hljs.initHighlightingOnLoad()</script></main></div><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0"><section class=sns-container><a title=nostr target=_blank rel="noopener nofollow" href=https://iris.to/npub1g2qs0ca5kpwlrcfug2em4jelmh65clk3yccwjxrs6hvdpd9qj80q022j4m>Nostr</a><a title=rss target=_blank rel="noopener nofollow" href=/atom.xml>rss</a><a title=telegram target=_blank rel="noopener nofollow" href=//t.me/btcstudyorg>Telegram</a></section></footer><script async src="/js/buttons.js?v=1682773100887"></script><script async src="/js/index.js?v=1682773100887"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVCJ9XXG1Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JVCJ9XXG1Z")</script><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?c92c073c85be5be8d9b1b76f62a7e306",e.async=!0,e.defer=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script></body></html>